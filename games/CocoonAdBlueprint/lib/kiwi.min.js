var Kiwi;(function(e){var t=function(){function t(t,n,r,i){if(typeof t==="undefined"){t=""}if(typeof n==="undefined"){n="KiwiGame"}if(typeof r==="undefined"){r=null}if(typeof i==="undefined"){i={}}var s=this;this._startup=null;this.audio=null;this.fileStore=null;this.input=null;this.cameras=null;this.pluginManager=null;this.loader=null;this.raf=null;this.stage=null;this.states=null;this.time=null;this.tweens=null;this.rnd=null;this._frameRate=60;this._interval=1e3/60;this._delta=0;console.log("Kiwi.Game: "+n+" is booting, using Kiwi.js version "+e.VERSION);if(e.DEVICE===null){e.DEVICE=new e.System.Device}if(i.debug!=="undefined"&&typeof i.debug==="number"){switch(i.debug){case e.DEBUG_ON:this._debugOption=i.debug;console.log("  Kiwi.Game: Debugging turned ON.");break;case e.DEBUG_OFF:this._debugOption=i.debug;console.log("  Kiwi.Game: Debugging turned OFF.");break;default:this._debugOption=e.DEBUG_ON;console.error("  Kiwi.Game: Debug option passed, but is not a valid option. Turned ON by default.");break}}else{this._debugOption=e.DEBUG_ON;console.log("  Kiwi.Game: Debug option not specified. Turned ON by default.")}if(i.bootCallback!=="undefined"){this.bootCallbackOption=i.bootCallback}if(i.deviceTarget!=="undefined"&&typeof i.deviceTarget==="number"){switch(i.deviceTarget){case e.TARGET_BROWSER:this._deviceTargetOption=i.deviceTarget;console.log("  Kiwi.Game: Targeting BROWSERS.");break;case e.TARGET_COCOON:this._deviceTargetOption=i.deviceTarget;console.log("  Kiwi.Game: Targeting COCOONJS.");break;default:this._deviceTargetOption=e.TARGET_BROWSER;console.error("  Kiwi.Game: Target device specified, but is not a valid option. Defaulting to BROWSER.");break}}else{this._deviceTargetOption=e.TARGET_BROWSER;console.log("  Kiwi.Game: Targeted device not specified. Defaulting to BROWSER")}var o=e.RENDERER_WEBGL;var u=e.RENDERER_CANVAS;if(i.renderer!=="undefined"&&typeof i.renderer==="number"){switch(i.renderer){case e.RENDERER_CANVAS:this._renderOption=i.renderer;console.log("  Kiwi.Game: Rendering using CANVAS.");break;case e.RENDERER_WEBGL:if(e.DEVICE.webGL){this._renderOption=i.renderer;console.log("  Kiwi.Game: Rendering using WEBGL.")}else{this._renderOption=u;console.log("  Kiwi.Game: WEBGL renderer requested but device does not support WEBGL. Rendering using CANVAS.")}break;case e.RENDERER_AUTO:if(e.DEVICE.webGL){this._renderOption=o;console.log("  Kiwi.Game: Renderer auto-detected WEBGL.")}else{this._renderOption=u;console.log("  Kiwi.Game: Renderer auto-detected CANVAS.")}break;default:if(e.DEVICE.webGL){this._renderOption=o;console.log("  Kiwi.Game: Renderer specified, but is not a valid option. Defaulting to WEBGL.")}else{this._renderOption=u;console.log("  Kiwi.Game: Renderer specified, but is not a valid option. WEBGL renderer sought by default but device does not support WEBGL. Defaulting to CANVAS.")}break}}else{if(e.DEVICE.webGL){this._renderOption=o;console.log("  Kiwi.Game: Renderer not specified. Defaulting to WEBGL.")}else{this._renderOption=u;console.log("  Kiwi.Game: Renderer not specified. WEBGL renderer sought by default but device does not support WEBGL. Defaulting to CANVAS.")}}this.id=e.GameManager.register(this);this._startup=new e.System.Bootstrap;this.audio=new e.Sound.AudioManager(this);this.fileStore=new e.Files.FileStore(this);this.input=new e.Input.InputManager(this);var a=e.Stage.DEFAULT_WIDTH;var f=e.Stage.DEFAULT_HEIGHT;if(i.width!=="undefined"&&typeof i.width==="number"){a=i.width}if(i.height!=="undefined"&&typeof i.height==="number"){f=i.height}console.log("  Kiwi.Game: Stage Dimensions: "+a+"x"+f);if(i.scaleType!=="undefined"){switch(i.scaleType){case e.Stage.SCALE_FIT:console.log("  Kiwi.Game: Stage scaling set to FIT.");break;case e.Stage.SCALE_STRETCH:console.log("  Kiwi.Game: Stage scaling set to STRETCH.");break;case e.Stage.SCALE_NONE:console.log("  Kiwi.Game: Stage scaling set to NONE.");break;default:console.log("  Kiwi.Game: Stage specified, but is not a valid option. Set to NONE.");i.scaleType=0;break}}else{i.scaleType=0}this.stage=new e.Stage(this,n,a,f,i.scaleType);this.renderer=null;this.cameras=new e.CameraManager(this);if(this._deviceTargetOption!==e.TARGET_COCOON)this.huds=new e.HUD.HUDManager(this);this.loader=new e.Files.Loader(this);this.states=new e.StateManager(this);this.rnd=new e.Utils.RandomDataGenerator([Date.now.toString()]);this.time=new e.Time.ClockManager(this);this.tweens=new e.Animations.Tweens.TweenManager(this);if(r!==null){this.states.addState(r,true)}else{console.log("  Kiwi.Game: Default State not passed.")}this.pluginManager=new e.PluginManager(this,i.plugins);if(this.deviceTargetOption===e.TARGET_BROWSER){if(t!==""){if(document.getElementById(t))console.log("  Kiwi.Game: Game being created inside "+t+".");else console.log('  Kiwi.Game: The element "'+t+'" could not be found. Appending the game to the body.')}else{console.log("  Kiwi.Game: No DOM parent specified. Appending the game to the body.")}this._startup.boot(t,function(){return s._start()})}else{if(t!=="")console.log("  Kiwi.Game: Not Targetting a BROWSER. DOM Parent parameter ignored.");this._start()}}Object.defineProperty(t.prototype,"renderOption",{get:function(){return this._renderOption},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"deviceTargetOption",{get:function(){return this._deviceTargetOption},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"debugOption",{get:function(){return this._debugOption},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"debug",{get:function(){return this._debugOption===e.DEBUG_ON},enumerable:true,configurable:true});t.prototype.objType=function(){return"Game"};Object.defineProperty(t.prototype,"frameRate",{get:function(){return this._frameRate},set:function(e){if(e>60)e=60;if(e>=0){this._frameRate=e;this._interval=1e3/this._frameRate}},enumerable:true,configurable:true});t.prototype._start=function(){var t=this;this.stage.boot(this._startup);if(!this.stage.renderer)console.error("Could not create rendering context");if(this._renderOption===e.RENDERER_WEBGL&&this.stage.ctx)this._renderOption=e.RENDERER_CANVAS;this.renderer=this.stage.renderer;this.renderer.boot();this.cameras.boot();if(this._deviceTargetOption!==e.TARGET_COCOON)this.huds.boot();this.time.boot();this.input.boot();this.audio.boot();this.fileStore.boot();this.loader.boot();this.states.boot();this.pluginManager.boot();this._lastTime=Date.now();this.raf=new e.Utils.RequestAnimationFrame(function(){return t._loop()});this.raf.start();if(this.bootCallbackOption){console.log("  Kiwi.Game: invoked boot callback");this.bootCallbackOption(this)}};t.prototype._loop=function(){this._delta=this.raf.currentTime-this._lastTime;if(this._delta>this._interval){this.time.update();this.audio.update();this.input.update();this.tweens.update();this.cameras.update();if(this._deviceTargetOption!==e.TARGET_COCOON)this.huds.update();this.states.update();this.pluginManager.update();if(this.states.current!==null){this.cameras.render();this.states.postRender()}this._lastTime=this.raf.currentTime-this._delta%this._interval}};return t}();e.Game=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(t,n,r,i,s){this._scaleType=e.Stage.SCALE_NONE;this.offset=new e.Geom.Point;this.container=null;this._game=t;this.name=n;this.domReady=false;this._alpha=1;this._x=0;this._y=0;this._width=r;this._height=i;this.color="ffffff";this._scale=new e.Geom.Point(1,1);this._scaleType=s;this.onResize=new e.Signal;this.onWindowResize=new e.Signal;this._renderer=null}t.prototype.objType=function(){return"Stage"};Object.defineProperty(t.prototype,"scaleType",{get:function(){return this._scaleType},set:function(e){this._scaleType=e;this._scaleContainer()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(this._game.deviceTargetOption===e.TARGET_BROWSER){this.container.style.opacity=String(e.Utils.GameMath.clamp(t,1,0))}this._alpha=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){if(this._game.deviceTargetOption===e.TARGET_BROWSER){this.container.style.left=String(t+"px")}else if(this._game.deviceTargetOption===e.TARGET_COCOON){this.canvas.style.left=String(t+"px")}this._x=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){if(this._game.deviceTargetOption===e.TARGET_BROWSER){this.container.style.top=String(t+"px")}else if(this._game.deviceTargetOption===e.TARGET_COCOON){this.canvas.style.top=String(t+"px")}this._y=t},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleX",{get:function(){return this._scale.x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleY",{get:function(){return this._scale.y},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e;var t=parseInt(e,16);var n=t>>16&255;var r=t>>8&255;var i=t&255;this._normalizedColor={r:n/255,g:r/255,b:i/255,a:1}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rgbColor",{get:function(){return{r:this._normalizedColor.r*255,g:this._normalizedColor.g*255,b:this._normalizedColor.b*255}},set:function(e){this.color=this.componentToHex(e.r)+this.componentToHex(e.g)+this.componentToHex(e.b)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"normalizedColor",{get:function(){return this._normalizedColor},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},enumerable:true,configurable:true});t.prototype.boot=function(t){var n=this;this.domReady=true;this.container=t.container;if(this._game.deviceTargetOption===e.TARGET_BROWSER){this.offset=this.getOffsetPoint(this.container);this._x=this.offset.x;this._y=this.offset.y;window.addEventListener("resize",function(e){return n._windowResized(e)},true)}this._createCompositeCanvas();if(this._game.deviceTargetOption===e.TARGET_COCOON){this._scaleContainer()}else{this._calculateContainerScale()}};t.prototype.getOffsetPoint=function(t,n){if(typeof n==="undefined"){n=new e.Geom.Point}var r=t.getBoundingClientRect();var i=t.clientTop||document.body.clientTop||0;var s=t.clientLeft||document.body.clientLeft||0;var o=window.pageYOffset||t.scrollTop||document.body.scrollTop;var u=window.pageXOffset||t.scrollLeft||document.body.scrollLeft;return n.setTo(r.left+u-s,r.top+o-i)};t.prototype._windowResized=function(e){this._calculateContainerScale();this.onWindowResize.dispatch()};t.prototype._calculateContainerScale=function(){this.offset=this.getOffsetPoint(this.container);this._scaleContainer();this._scale.x=this._width/this.container.clientWidth;this._scale.y=this._height/this.container.clientHeight};t.prototype._createCompositeCanvas=function(){if(this._game.deviceTargetOption==e.TARGET_COCOON){this.canvas=document.createElement(navigator["isCocoonJS"]?"screencanvas":"canvas")}else{this.canvas=document.createElement("canvas");this.canvas.style.width="100%";this.canvas.style.height="100%"}this.canvas.id=this._game.id+"compositeCanvas";this.canvas.style.position="absolute";this.canvas.width=this.width;this.canvas.height=this.height;if(this._game.renderOption===e.RENDERER_CANVAS){this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="#fff";this.gl=null}else if(this._game.renderOption===e.RENDERER_WEBGL){this.gl=this.canvas.getContext("webgl");if(!this.gl){this.gl=this.canvas.getContext("experimental-webgl");if(!this.gl){console.warn("Kiwi.Stage: WebGL rendering is not available despite the device apparently supporting it. Reverting to CANVAS.");this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="#fff";this.gl=null}else{console.warn("Kiwi.Stage: 'webgl' context is not available. Using 'experimental-webgl'")}}if(this.gl){this.gl.clearColor(1,1,1,1);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.ctx=null}}if(this.ctx){this._renderer=new e.Renderers.CanvasRenderer(this._game)}else if(this.gl){this._renderer=new e.Renderers.GLRenderManager(this._game)}if(this._game.deviceTargetOption===e.TARGET_BROWSER){this.container.appendChild(this.canvas)}else{document.body.appendChild(this.canvas)}};t.prototype.resize=function(t,n){this.canvas.height=n;this.canvas.width=t;this._height=n;this._width=t;if(this._game.deviceTargetOption===e.TARGET_BROWSER){this._calculateContainerScale()}this.onResize.dispatch(this._width,this._height)};t.prototype.setRGBColor=function(e,t,n){this.rgbColor={r:e,g:t,b:n};return this.rgbColor};t.prototype.componentToHex=function(e){var t=e.toString(16);return t.length==1?"0"+t:t};t.prototype.createDebugCanvas=function(){if(e.Utils.Common.isUndefined(this.debugCanvas)==false)return;if(this._game.deviceTargetOption===e.TARGET_COCOON){console.log("Debug canvas not supported in cocoon, creating canvas and context anyway")}this.debugCanvas=document.createElement("canvas");this.debugCanvas.id=this._game.id+"debugCanvas";this.debugCanvas.style.position="absolute";this.debugCanvas.width=this.width;this.debugCanvas.height=this.height;this.debugCanvas.style.width="100%";this.debugCanvas.style.height="100%";this.dctx=this.debugCanvas.getContext("2d");this.clearDebugCanvas();if(this._game.deviceTargetOption===e.TARGET_BROWSER){this.container.appendChild(this.debugCanvas)}};t.prototype.clearDebugCanvas=function(e){this.dctx.fillStyle=e||"rgba(255,0,0,.2)";this.dctx.clearRect(0,0,this.width,this.height);this.dctx.fillRect(0,0,this.width,this.height)};t.prototype.toggleDebugCanvas=function(){this.debugCanvas.style.display=this.debugCanvas.style.display==="none"?"block":"none"};t.prototype._scaleContainer=function(){if(this._game.deviceTargetOption==e.TARGET_BROWSER){this.container.style.width=String(this._width+"px");this.container.style.height=String(this._height+"px");if(this._scaleType==e.Stage.SCALE_NONE){this.container.style.maxWidth="";this.container.style.minWidth=""}if(this._scaleType==e.Stage.SCALE_STRETCH||this._scaleType==e.Stage.SCALE_FIT){this.container.style.minWidth="100%";this.container.style.maxWidth="100%"}if(this._scaleType==e.Stage.SCALE_STRETCH){this.container.style.minHeight="100%";this.container.style.maxHeight="100%"}else{this.container.style.minHeight="";this.container.style.maxHeight=""}if(this._scaleType==e.Stage.SCALE_FIT){this.container.style.height=String(this.container.clientWidth/this._width*this._height)+"px"}}if(this._game.deviceTargetOption==e.TARGET_COCOON){switch(this._scaleType){case e.Stage.SCALE_FIT:this.canvas.style.cssText="idtkscale:ScaleAspectFit";break;case e.Stage.SCALE_STRETCH:this.canvas.style.cssText="idtkscale:ScaleToFill";break;case e.Stage.SCALE_NONE:this.canvas.style.cssText="";break}}};t.DEFAULT_WIDTH=800;t.DEFAULT_HEIGHT=600;t.SCALE_NONE=0;t.SCALE_FIT=1;t.SCALE_STRETCH=2;return t}();e.Stage=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function e(e,t){this._components={};this._type=e;this._owner=t}e.prototype.objType=function(){return"ComponentManager"};e.prototype.hasComponent=function(e){if(this._components[e]){return true}return false};e.prototype.hasActiveComponent=function(e){if(this._components[e]&&this._components[e].active===true){return true}return false};e.prototype.getComponent=function(e){if(this._components[e]){return this._components[e]}return null};e.prototype.add=function(e){this._components[e.name]=e;return e};e.prototype.addBatch=function(){var e=[];for(var t=0;t<arguments.length-0;t++){e[t]=arguments[t+0]}for(var n=0;n<e.length;n++){this.add(e[n])}};e.prototype.removeComponent=function(e,t){if(typeof t==="undefined"){t=true}var n=e.name;if(this._components[n]){if(t){this._components[n].destroy()}delete this._components[n];return true}return false};e.prototype.removeComponentByName=function(e,t){if(typeof t==="undefined"){t=true}if(this._components[e]){if(t){this._components[e].destroy()}delete this._components[e];return true}return false};e.prototype.removeAll=function(e){if(typeof e==="undefined"){e=true}for(var t in this._components){this.removeComponent(this._components[t],e)}};e.prototype.preUpdate=function(){for(var e in this._components){if(this._components[e].active){this._components[e].preUpdate()}}};e.prototype.update=function(){for(var e in this._components){if(this._components[e].active){this._components[e].update()}}};e.prototype.postUpdate=function(){for(var e in this._components){if(this._components[e].active){this._components[e].postUpdate()}}};e.prototype.preRender=function(){for(var e in this._components){if(this._components[e].active){this._components[e].preRender()}}};e.prototype.render=function(){for(var e in this._components){if(this._components[e].active){this._components[e].render()}}};e.prototype.postRender=function(){for(var e in this._components){if(this._components[e].active){this._components[e].postRender()}}};return e}();e.ComponentManager=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(e,t){this._game=e;this._plugins=t||new Array;this._bootObjects=new Array;this.validatePlugins();this._createPlugins()}Object.defineProperty(t,"availablePlugins",{get:function(){var e=[];for(var n=0;n<t._availablePlugins.length;n++){e.push({name:t._availablePlugins[n].name,version:t._availablePlugins[n].version})}return e},enumerable:true,configurable:true});t.register=function(e){console.log("Kiwi.PluginManager: Attempting to register plugin :"+e.name);if(this._availablePlugins.indexOf(e)==-1){var t=true;for(var n=0;n<this._availablePlugins.length;n++){if(e.name===this._availablePlugins[n].name){t=false}}if(t){this._availablePlugins.push(e);console.log("  Kiwi.PluginManager: Registered plugin "+e.name+": version "+e.version)}else{console.log("  Kiwi.PluginManager: A plugin with the same name has already been registered. Ignoring this plugin.")}}else{console.log("  Kiwi.PluginManager: This plugin has already been registered. Ignoring second registration.")}};Object.defineProperty(t.prototype,"objType",{get:function(){return"PluginManager"},enumerable:true,configurable:true});t.prototype.validatePlugins=function(){var t=new Array;console.log("Kiwi.PluginManager: Validating Plugins");for(var n=0;n<this._plugins.length;n++){var r=this._plugins[n];if(typeof r=="string"||r instanceof String){if(e.Plugins.hasOwnProperty(r)&&this.pluginIsRegistered(r)){t.push(r);console.log("  Kiwi.PluginManager: Plugin '"+r+"' appears to be valid.");console.log("  Kiwi.PluginManager: Name:"+e.Plugins[r].name);console.log("  Kiwi.PluginManager: Version:"+e.Plugins[r].version);if(typeof e.Plugins[r].minimumKiwiVersion!=="undefined"){console.log("  Kiwi.PluginManager: "+r+" requires minimum Kiwi version "+e.Plugins[r].minimumKiwiVersion);var i=e.Utils.Version.parseVersion(e.VERSION);var s=e.Utils.Version.parseVersion(e.Plugins[r].minimumKiwiVersion);if(i.majorVersion>s.majorVersion){console.warn("  Kiwi.PluginManager: This major version of Kiwi is greater than that required by '"+r+"'. It is unknown whether this plugin will work with this version of Kiwi")}else{if(e.Utils.Version.greaterOrEqual(e.VERSION,e.Plugins[r].minimumKiwiVersion)){console.log("  Kiwi.PluginManager: Kiwi version meets minimum version requirements for '"+r+"'.")}else{console.warn("  Kiwi.PluginManager: Kiwi version ("+e.VERSION+") does not meet minimum version requirements for the plugin ("+e.Plugins[r].minimumKiwiVersion+").")}}}else{console.warn("  Kiwi.PluginManager: '"+r+"' is missing the minimumKiwiVersion property. It is unknown whether '"+r+"' will work with this version of Kiwi")}}else{console.log("  Kiwi.PluginManager: Plugin '"+r+"' appears to be invalid. No property with that name exists on the Kiwi.Plugins object or the Plugin is not registered. Check that the js file containing the plugin has been included. This plugin will be ignored")}}else{console.log("  Kiwi.PluginManager: The supplied plugin name at index "+n+"is not a string and will be ignored")}}this._plugins=t;for(var n=0;n<this._plugins.length;n++){var o=this._plugins[n];var r=e.Plugins[o];if(typeof r.pluginDependencies!=="undefined"){if(r.pluginDependencies.length===0){console.log("  Kiwi.PluginManager: '"+o+"' does not depend on any other plugins.")}else{console.log("  Kiwi.PluginManager: '"+o+"' depends on the following plugins:");for(var u=0;u<r.pluginDependencies.length;u++){console.log(r.pluginDependencies[u].name,r.pluginDependencies[u].minimumVersion);if(!this.validMinimumPluginVersionExists(r.pluginDependencies[u].name,r.pluginDependencies[u].minimumVersion)){console.warn("  Kiwi.PluginManager: '"+r.pluginDependencies[u].name+" hasn't been added to this game via the config, doesn't exist, or does not meet minimum version requirement ( "+r.pluginDependencies[u].minimumVersion+").")}}}}else{console.log("  Kiwi.PluginManager: '"+o+"' does not depend on any other plugins.")}}};t.prototype.validMinimumPluginVersionExists=function(t,n){var r=false;var i=false;if(this._plugins.indexOf(t)!==-1){r=true;if(e.Utils.Version.greaterOrEqual(n,e.Plugins[t].version)){i=true}}return r&&i};t.prototype.pluginIsRegistered=function(t){var n=false;for(var r=0;r<e.PluginManager._availablePlugins.length;r++){if(e.PluginManager._availablePlugins[r].name===t){n=true}}return n};t.prototype._createPlugins=function(){for(var t=0;t<this._plugins.length;t++){var n=this._plugins[t];if(e.Plugins[n].hasOwnProperty("create")){var r=e.Plugins[n].create(this._game);if(r)this._bootObjects.push(r)}}};t.prototype.boot=function(){for(var e=0;e<this._bootObjects.length;e++){if("boot"in this._bootObjects[e]){this._bootObjects[e].boot.call(this._bootObjects[e])}else{console.warn("Kiwi.PluginManager: Warning! No boot function found on boot object")}}};t.prototype.update=function(){for(var e=0;e<this._bootObjects.length;e++){if("update"in this._bootObjects[e]){this._bootObjects[e].update.call(this._bootObjects[e])}}};t._availablePlugins=new Array;return t}();e.PluginManager=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(e){this._game=e;this._cameras=[];this._nextCameraID=0}t.prototype.objType=function(){return"CameraManager"};t.prototype.boot=function(){this.create("defaultCamera",0,0,this._game.stage.width,this._game.stage.height);this.defaultCamera=this._cameras[0]};t.prototype.create=function(t,n,r,i,s){var o=new e.Camera(this._game,this._nextCameraID++,t,n,r,i,s);this._cameras.push(o);return o};t.prototype.remove=function(e){var t=this._cameras.indexOf(e);if(t!==-1){this._cameras.splice(t,1);return true}return false};t.prototype.update=function(){if(this._cameras.length===0){return false}for(var e=0;e<this._cameras.length;e++){this._cameras[e].update()}};t.prototype.render=function(){if(this._cameras.length===0){return false}for(var e=0;e<this._cameras.length;e++){this._cameras[e].render()}};t.prototype.removeAll=function(){this._cameras=[]};t.prototype.zeroAllCameras=function(){for(var e=0;e<this._cameras.length;e++){this.zeroCamera(this._cameras[e])}this.zeroCamera(this.defaultCamera)};t.prototype.zeroCamera=function(e){e.transform.x=0;e.transform.y=0;e.transform.rotation=0;e.transform.scaleX=1;e.transform.scaleY=1;e.transform.rotPointX=e.width/2;e.transform.rotPointY=e.height/2};return t}();e.CameraManager=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function e(e,t){this.name="";this.isPersistent=false;this.isCreated=false;this.isInitialised=false;this.isReady=false;this.hasPreloader=false;this.runCount=0;this.type=0;this._state=e;this.name=t;if(typeof this._state["preload"]==="function"){this.hasPreloader=true}}e.prototype.objType=function(){return"StateConfig"};e.prototype.reset=function(){this.isReady=false;this.isCreated=false;this.createParams=[];this.initParams=[]};return e}();e.StateConfig=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(e){this.current=null;this._newStateKey=null;this._game=e;this._states=[]}t.prototype.objType=function(){return"StateManager"};t.prototype.checkKeyExists=function(e){for(var t=0;t<this._states.length;t++){if(this._states[t].config.name===e){return true}}return false};t.prototype.checkValidState=function(e){if(!e["game"]||!e["config"]){return false}return true};t.prototype.addState=function(e,t){if(typeof t==="undefined"){t=false}console.log("Kiwi.StateManager: Adding state");var n;if(typeof e==="function"){n=new e}else if(typeof e==="string"){n=window[e]}else{n=e}if(n.config.name&&this.checkKeyExists(n.config.name)===true){if(this._game.debug)console.error("  Kiwi.StateManager: Could not add "+n.config.name+" as a State with that name already exists.");return false}n.game=this._game;if(this.checkValidState(n)===false){if(this._game.debug)console.error("  Kiwi.StateManager: "+n.config.name+" isn't a valid state. Make sure you are using the Kiwi.State class!");return false}else{this._states.push(n);if(this._game.debug)console.log("  Kiwi.StateManager: "+n.config.name+" was successfully added.");if(t===true){this.setCurrentState(n.config.name)}return true}};t.prototype.boot=function(){};t.prototype.setCurrentState=function(e){if(this.current!==null&&this.current.config.name===e||this.checkKeyExists(e)===false){return false}if(this._game.debug)console.log('Kiwi.StateManager: Switching to "'+e+'" State.');this._newStateKey=e;return true};t.prototype.bootNewState=function(){if(this.current!==null){this.current.shutDown();this._game.input.reset();this.current.destroy(true);this._game.fileStore.removeStateFiles(this.current);this.current.config.reset();this._game.cameras.zeroAllCameras()}this.current=this.getState(this._newStateKey);this._newStateKey=null;this.checkInit();this.checkPreload()};t.prototype.switchState=function(e,t,n,r){if(typeof t==="undefined"){t=null}if(typeof n==="undefined"){n=null}if(typeof r==="undefined"){r=null}if(this.current!==null&&this.current.config.isReady===false){if(this._game.debug)console.error("Kiwi.StateManager: Cannot change to a new state till the current state has finished loading!");return false}if(this.checkKeyExists(e)===false&&t!==null){if(this.addState(t,false)===false){return false}}if(n!==null||r!==null){var i=this.getState(e);i.config.initParams=[];i.config.createParams=[];for(var s in n){i.config.initParams.push(n[s])}for(var o in r){i.config.createParams.push(r[o])}}return this.setCurrentState(e)};t.prototype.getState=function(e){for(var t=0;t<this._states.length;t++){if(this._states[t].config.name===e){return this._states[t]}}return null};t.prototype.checkPreload=function(){var e=this;this.rebuildLibraries();this._game.loader.init(function(t,n,r){return e.onLoadProgress(t,n,r)},function(){return e.onLoadComplete()});this.current.preload();this._game.loader.startLoad()};t.prototype.callCreate=function(){if(this._game.debug)console.log("Kiwi.StateManager: Calling "+this.current.name+":Create");if(this.current.config.createParams){this.current.create.apply(this.current,this.current.config.createParams)}else{this.current.create.call(this.current)}this.current.config.runCount++;this.current.config.isCreated=true};t.prototype.checkInit=function(){if(this.current.config.isInitialised===false){this.current.boot();if(this.current.config.initParams){this.current.init.apply(this.current,this.current.config.initParams)}else{this.current.init.call(this.current)}this.current.config.isInitialised=true}};t.prototype.onLoadProgress=function(e,t,n){this.current.loadProgress(e,t,n)};t.prototype.onLoadComplete=function(){this.current.loadComplete();this.rebuildLibraries();this.current.config.isReady=true;this.callCreate()};t.prototype.rebuildLibraries=function(){this.current.audioLibrary.rebuild(this._game.fileStore,this.current);this.current.dataLibrary.rebuild(this._game.fileStore,this.current);this.current.textureLibrary.rebuild(this._game.fileStore,this.current);if(this._game.renderOption==e.RENDERER_WEBGL){this._game.renderer.initState(this.current)}};t.prototype.update=function(){if(this.current!==null){if(this.current.config.isReady===true){this.current.preUpdate();this.current.update();this.current.postUpdate()}else{this.current.loadUpdate()}}if(this._newStateKey!==null){this.bootNewState()}};t.prototype.postRender=function(){if(this.current!==null){if(this.current.config.isReady===true){this.current.postRender()}}};return t}();e.StateManager=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(t,n,r){this._parent=null;this._alpha=1;this.width=0;this.height=0;this.atlas=null;this._cellIndex=0;this.name="";this._clock=null;this.state=t;this.game=t.game;this.id=this.game.rnd.uuid();this.state.addToTrackingList(this);this._clock=this.game.time.clock;this._exists=true;this._active=true;this._visible=true;this.components=new e.ComponentManager(e.ENTITY,this);this.transform=new e.Geom.Transform;this.transform.x=n;this.transform.y=r}Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(e){this.transform.parent=e!==null?e.transform:null;this._parent=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this.transform.x},set:function(e){this.transform.x=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this.transform.y},set:function(e){this.transform.y=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleX",{get:function(){return this.transform.scaleX},set:function(e){this.transform.scaleX=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleY",{get:function(){return this.transform.scaleY},set:function(e){this.transform.scaleY=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rotPointX",{get:function(){return this.transform.rotPointX},set:function(e){this.transform.rotPointX=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rotPointY",{get:function(){return this.transform.rotPointY},set:function(e){this.transform.rotPointY=e},enumerable:true,configurable:true});t.prototype.childType=function(){return e.ENTITY};Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){if(e<=0)e=0;if(e>1)e=1;this._alpha=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"cellIndex",{get:function(){return this._cellIndex},set:function(e){if(this.atlas!==null){var t=this.atlas.cells[e];if(t!==undefined){this._cellIndex=e;this.width=t.w;this.height=t.h}else{if(this.game.debug)console.error("Could not the set the cellIndex of a Entity, to cell that does not exist on its TextureAtlas.")}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"exists",{get:function(){return this._exists},set:function(e){this._exists=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"active",{get:function(){return this._active},set:function(e){this._active=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"willRender",{get:function(){return this._willRender},set:function(e){this._willRender=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"inputEnabled",{get:function(){return this._inputEnabled},set:function(e){this._inputEnabled=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(e){this._clock=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},set:function(e){this._dirty=e},enumerable:true,configurable:true});t.prototype.objType=function(){return"Entity"};t.prototype.update=function(){};t.prototype.render=function(e){};t.prototype.renderGL=function(e,t,n){if(typeof n==="undefined"){n=null}};t.prototype.destroy=function(e){if(typeof e==="undefined"){e=false}this._exists=false;this._active=false;this._visible=false;if(e===true){if(this.parent!==null&&typeof this.parent!=="undefined")this.parent.removeChild(this);if(this.state)this.state.removeFromTrackingList(this);delete this._parent;delete this.transform;delete this._clock;delete this.state;delete this.game;delete this.atlas;if(this.components)this.components.removeAll(true);delete this.components}};return t}();e.Entity=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function e(e,t){this.active=true;this.dirty=false;this.owner=e;this.game=this.owner.game;this.name=t;this.active=true}e.prototype.objType=function(){return"Component"};e.prototype.preUpdate=function(){};e.prototype.update=function(){};e.prototype.postUpdate=function(){};e.prototype.destroy=function(){this.active=false;delete this.game;delete this.owner;this.name=""};return e}();e.Component=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(t,n){if(typeof n==="undefined"){n=""}this.name="";this._parent=null;this.game=null;this.state=null;this._dirty=true;this._tempRemoveChildren=null;if(t!==null){this.state=t;this.game=this.state.game;this.id=this.game.rnd.uuid();this.state.addToTrackingList(this)}this.name=n;this.components=new e.ComponentManager(e.GROUP,this);this._exists=true;this._active=true;this._visible=true;this.transform=new e.Geom.Transform;this.members=[]}t.prototype.objType=function(){return"Group"};t.prototype.childType=function(){return e.GROUP};Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(e){this.transform.parent=e!==null?e.transform:null;this._parent=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this.transform.x},set:function(e){this.transform.x=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this.transform.y},set:function(e){this.transform.y=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleX",{get:function(){return this.transform.scaleX},set:function(e){this.transform.scaleX=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scaleY",{get:function(){return this.transform.scaleY},set:function(e){this.transform.scaleY=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e},enumerable:true,configurable:true});t.prototype.numChildren=function(){return this.members.length};Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},set:function(e){if(e!==undefined){this._dirty=e;for(var t=0;t<this.members.length;t++){this.members[t].dirty=e}}},enumerable:true,configurable:true});t.prototype.contains=function(e){return this.members.indexOf(e)===-1?false:true};t.prototype.containsDescendant=function(t){for(var n=0;n<this.members.length;n++){console.log(n);var r=this.members[n];if(r.id==t.id||r.childType()==e.Group&&r.containsDesendant(t)){return true}}return false};t.prototype.containsAncestor=function(e,t){if(e.parent===null||e.parent===undefined){return false}if(e.parent==t)return true;return e.parent.containsAncestor(e.parent,t)};t.prototype.addChild=function(t){if(t.childType()===e.STATE||t==this)return;if(t.parent!==null)t.parent.removeChild(t);this.members.push(t);t.parent=this;return t};t.prototype.addChildAt=function(t,n){if(t.childType()===e.STATE||t==this)return;if(t.parent!==null)t.parent.removeChild(t);this.members.splice(n,0,t);t.parent=this;return t};t.prototype.addChildBefore=function(e,t){if(e.transform.parent!==this.transform&&t.transform.parent===this.transform){var n=this.getChildIndex(t);this.members.splice(n,0,e);e.parent=this}return e};t.prototype.addChildAfter=function(e,t){if(e.transform.parent!==this.transform&&t.transform.parent===this.transform){var n=this.getChildIndex(t)+1;this.members.splice(n,0,e);e.parent=this}return e};t.prototype.getChildAt=function(e){if(this.members[e]){return this.members[e]}else{return null}};t.prototype.getChildByName=function(e){for(var t=0;t<this.members.length;t++){if(this.members[t].name===e){return this.members[t]}}return null};t.prototype.getChildByID=function(e){for(var t=0;t<this.members.length;t++){if(this.members[t].id===e){return this.members[t]}}return null};t.prototype.getChildIndex=function(e){return this.members.indexOf(e)};t.prototype.removeChild=function(e,t){if(typeof t==="undefined"){t=false}if(e.parent===this){var n=this.getChildIndex(e);if(n>-1){this.members.splice(n,1);e.parent=null;if(t){e.destroy()}}}return e};t.prototype.removeChildAt=function(e){if(this.members[e]){var t=this.members[e];return this.removeChild(t)}else{return null}};t.prototype.removeChildren=function(e,t,n){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=2147483647}if(typeof n==="undefined"){n=false}t-=e;var r=this.members.splice(e,t);for(var i=0;i<r.length;i++){r[i].parent=null;if(n){r[i].destroy()}}return r.length};t.prototype.setChildIndex=function(e,t){if(e.parent!==this||this.getChildIndex(e)===t){return false}this.removeChild(e);this.addChildAt(e,t);return true};t.prototype.swapChildren=function(e,t){if(e.parent!==this||t.parent!==this){return false}var n=this.getChildIndex(e);var r=this.getChildIndex(t);if(n!==-1&&r!==-1&&n!==r){this.members[n]=t;this.members[r]=e;return true}return false};t.prototype.swapChildrenAt=function(e,t){var n=this.getChildAt(e);var r=this.getChildAt(t);if(n!==null&&r!==null){if(n==r||n.parent!==this||r.parent!==this){return false}this.members[e]=r;this.members[t]=n;return true}return false};t.prototype.replaceChild=function(e,t){if(e===t)return false;var n=this.getChildIndex(e);if(n>-1){if(t.parent){t.parent.removeChild(t)}this.removeChildAt(n);this.addChildAt(t,n);t.parent=null;return true}return false};t.prototype.forEach=function(e,t){var n=[];for(var r=0;r<arguments.length-2;r++){n[r]=arguments[r+2]}if(this.members.length>0){this.members.forEach(function(r){return t.apply(e,[r].concat(n))})}};t.prototype.forEachAlive=function(e,t){var n=[];for(var r=0;r<arguments.length-2;r++){n[r]=arguments[r+2]}if(this.members.length>0){this.members.forEach(function(r){if(r.exists)t.apply(e,[r].concat(n))})}};t.prototype.setAll=function(e,t,n){if(e===null){for(var r=0;r<this.members.length;r++){this.members[r][t]=n}}else{for(var r=0;r<this.members.length;r++){this.members[r][e][t]=n}}};t.prototype.callAll=function(e,t,n){if(e===null){for(var r=0;r<this.members.length;r++){this.members[r][t].apply(this.members[r],n)}}else{for(var r=0;r<this.members.length;r++){this.members[r][e][t].apply(this.members[r][e],n)}}};t.prototype.update=function(){this.components.preUpdate();this.components.update();if(this.members.length>0){for(var e=0;e<this.members.length;e++){if(this.members[e].active===true){this.members[e].update()}if(this.members[e].exists===false){this.members[e].destroy(true)}}}this.components.postUpdate()};Object.defineProperty(t.prototype,"exists",{get:function(){return this._exists},set:function(e){this._exists=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"active",{get:function(){return this._active},set:function(e){this._active=e},enumerable:true,configurable:true});t.prototype.render=function(e){};t.prototype.removeFirstAlive=function(e){if(typeof e==="undefined"){e=false}return this.removeChild(this.getFirstAlive(),e)};t.prototype.getFirstAlive=function(){for(var e=0;e<this.members.length;e++){if(this.members[e].exists===true){return this.members[e]}}return null};t.prototype.getFirstDead=function(){for(var e=0;e<this.members.length;e++){if(this.members[e].exists===false){return this.members[e]}}return null};t.prototype.countLiving=function(){var e=0;for(var t=0;t<this.members.length;t++){if(this.members[t].exists===true){e++}}return e};t.prototype.countDead=function(){var e=0;for(var t=0;t<this.members.length;t++){if(this.members[t].exists===false){e++}}return e};t.prototype.getRandom=function(e,t){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(this.members.length===0){return null}if(t===0){t=this.members.length}if(e<0||e>t){e=0}var n=e+Math.random()*(e+t);if(n>this.members.length){return this.members[this.members.length-1]}else{return this.members[n]}};t.prototype.clear=function(){this.members.length=0};Object.defineProperty(t.prototype,"willRender",{get:function(){return this._willRender},set:function(e){this._willRender=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e},enumerable:true,configurable:true});t.prototype.destroy=function(e,t){if(typeof e==="undefined"){e=false}if(typeof t==="undefined"){t=true}this._exists=false;this._active=false;this._visible=false;if(e===true){if(this._tempRemoveChildren!==null)t=this._tempRemoveChildren;if(t==true){for(var n=0;n<this.members.length;n++){this.members[n].destroy(true)}}else{}if(this.parent!==null)this.parent.removeChild(this);if(this.state)this.state.removeFromTrackingList(this);delete this.transform;if(this.components)this.components.removeAll();delete this.components;delete this.name;delete this.members;delete this.game;delete this.state;delete this._tempRemoveChildren}else{this._tempRemoveChildren=t}};return t}();e.Group=t})(Kiwi||(Kiwi={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];r.prototype=t.prototype;e.prototype=new r};var Kiwi;(function(e){var t=function(t){function n(n){t.call(this,null,n);this.game=null;this.config=new e.StateConfig(this,n);this.components=new e.ComponentManager(e.STATE,this);this.transform.parent=null;this._trackingList=[]}__extends(n,t);n.prototype.objType=function(){return"State"};n.prototype.childType=function(){return e.GROUP};n.prototype.boot=function(){this.textureLibrary=new e.Textures.TextureLibrary(this.game);this.textures=this.textureLibrary.textures;this.audioLibrary=new e.Sound.AudioLibrary(this.game);this.audio=this.audioLibrary.audio;this.dataLibrary=new e.Files.DataLibrary(this.game);this.data=this.dataLibrary.data};n.prototype.setType=function(e){if(this.config.isInitialised===false){this.config.type=e}};n.prototype.init=function(){var e=[];for(var t=0;t<arguments.length-0;t++){e[t]=arguments[t+0]}};n.prototype.preload=function(){};n.prototype.loadProgress=function(e,t,n){};n.prototype.loadComplete=function(){};n.prototype.loadUpdate=function(){for(var e=0;e<this.members.length;e++){if(this.members[e].active===true){this.members[e].update()}}};n.prototype.create=function(){var e=[];for(var t=0;t<arguments.length-0;t++){e[t]=arguments[t+0]}};n.prototype.preUpdate=function(){this.components.preUpdate()};n.prototype.update=function(){this.components.update();for(var e=0;e<this.members.length;e++){if(this.members[e].active===true){this.members[e].update()}if(this.members[e].exists===false){this.members[e].destroy(true)}}};n.prototype.postUpdate=function(){this.components.postUpdate()};n.prototype.postRender=function(){};n.prototype.shutDown=function(){};n.prototype.addImage=function(e,t,n,r,i,s,o){if(typeof n==="undefined"){n=true}this.game.loader.addImage(e,t,r,i,s,o,n)};n.prototype.addSpriteSheet=function(e,t,n,r,i,s,o,u,a,f,l,c){if(typeof i==="undefined"){i=true}this.game.loader.addSpriteSheet(e,t,n,r,s,o,u,a,f,l,c,i)};n.prototype.addTextureAtlas=function(e,t,n,r,i){if(typeof i==="undefined"){i=true}this.game.loader.addTextureAtlas(e,t,n,r,i)};n.prototype.addJSON=function(e,t,n){if(typeof n==="undefined"){n=true}this.game.loader.addJSON(e,t,n)};n.prototype.addAudio=function(e,t,n){if(typeof n==="undefined"){n=true}this.game.loader.addAudio(e,t,n)};n.prototype.addToTrackingList=function(e){if(this._trackingList.indexOf(e)!==-1)return;this._trackingList.push(e)};n.prototype.removeFromTrackingList=function(e){var t=this._trackingList.indexOf(e);if(t>-1){this._trackingList.splice(t,1)}};n.prototype.destroyUnused=function(){var e=0;for(var t=0;t<this._trackingList.length;t++){if(this.containsAncestor(this._trackingList[t],this)===false){this._trackingList[t].destroy();this._trackingList.splice(t,1);t--;e++}}return e};n.prototype.destroy=function(e){if(typeof e==="undefined"){e=true}if(e==true){for(var t=0;t<this._trackingList.length;t++){this._trackingList[t].destroy(true,false)}this._trackingList=[];for(var t=0;t<this.members.length;t++){this._destroyChildren(this.members[t]);delete this.members[t]}this.members=[]}};n.prototype._destroyChildren=function(t){if(t.childType()==e.GROUP){for(var n=0;n<t.members.length;n++){this._destroyChildren(t.members[n])}}t.destroy(true)};return n}(e.Group);e.State=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(t,n,r,i,s,o,u){this.fitToStage=true;this._game=t;this.id=n;this.name=r;this.width=o;this.height=u;this.transform=new e.Geom.Transform(i,s);this.transform.rotPointX=i+o/2;this.transform.rotPointY=s+u/2;this._game.stage.onResize.add(this._updatedStageSize,this)}t.prototype.objType=function(){return"Camera"};t.prototype._updatedStageSize=function(e,t){this.width=e;this.height=t};Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},set:function(e){this._dirty=e},enumerable:true,configurable:true});t.prototype.transformPoint=function(e){var t=e.clone();var n=this.transform.getConcatenatedMatrix();n.append(1,0,0,1,-this.transform.rotPointX,-this.transform.rotPointY);n.invert();return n.transformPoint(t)};t.prototype.update=function(){};t.prototype.render=function(){this._game.renderer.render(this)};return t}();e.Camera=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function t(){this._bindings=[];this._prevParams=null;this.memorize=false;this._shouldPropagate=true;this.active=true}t.prototype.objType=function(){return"Signal"};t.prototype.validateListener=function(e,t){if(typeof e!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}};t.prototype._registerListener=function(t,n,r,i){var s=this._indexOfListener(t,r);var o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==n){throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(!n?"":"Once")+"() the same listener without removing the relationship first.")}}else{o=new e.SignalBinding(this,t,n,r,i);this._addBinding(o)}if(this.memorize&&this._prevParams){o.execute(this._prevParams)}return o};t.prototype._addBinding=function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e.priority<=this._bindings[t].priority);this._bindings.splice(t+1,0,e)};t.prototype._indexOfListener=function(e,t){var n=this._bindings.length;var r;while(n--){r=this._bindings[n];if(r.getListener()===e&&r.context===t){return n}}return-1};t.prototype.has=function(e,t){if(typeof t==="undefined"){t=null}return this._indexOfListener(e,t)!==-1};t.prototype.add=function(e,t,n){if(typeof t==="undefined"){t=null}if(typeof n==="undefined"){n=0}this.validateListener(e,"add");return this._registerListener(e,false,t,n)};t.prototype.addOnce=function(e,t,n){if(typeof t==="undefined"){t=null}if(typeof n==="undefined"){n=0}this.validateListener(e,"addOnce");return this._registerListener(e,true,t,n)};t.prototype.remove=function(e,t){if(typeof t==="undefined"){t=null}this.validateListener(e,"remove");var n=this._indexOfListener(e,t);if(n!==-1){this._bindings[n]._destroy();this._bindings.splice(n,1)}return e};t.prototype.removeAll=function(){var e=this._bindings.length;while(e--){this._bindings[e]._destroy()}this._bindings.length=0};t.prototype.getNumListeners=function(){return this._bindings.length};t.prototype.halt=function(){this._shouldPropagate=false};t.prototype.dispatch=function(){var e=[];for(var t=0;t<arguments.length-0;t++){e[t]=arguments[t+0]}if(!this.active){return}var n=this._bindings.length;var r;if(this.memorize){this._prevParams=e}if(!n){return}r=this._bindings.slice(0);this._shouldPropagate=true;do{n--}while(r[n]&&this._shouldPropagate&&r[n].execute(e)!==false)};t.prototype.forget=function(){this._prevParams=null};t.prototype.dispose=function(){this.removeAll();delete this._bindings;delete this._prevParams};t.VERSION="1.0.0";return t}();e.Signal=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){var t=function(){function e(e,t,n,r,i){if(typeof i==="undefined"){i=0}this.active=true;this.params=null;this._listener=t;this._isOnce=n;this.context=r;this._signal=e;this.priority=i||0}e.prototype.objType=function(){return"SignalBinding"};e.prototype.execute=function(e){var t;var n;if(this.active&&!!this._listener){n=this.params?this.params.concat(e):e;t=this._listener.apply(this.context,n);if(this._isOnce){this.detach()}}return t};e.prototype.detach=function(){return this.isBound()?this._signal.remove(this._listener,this.context):null};e.prototype.isBound=function(){return!!this._signal&&!!this._listener};e.prototype.isOnce=function(){return this._isOnce};e.prototype.getListener=function(){return this._listener};e.prototype.getSignal=function(){return this._signal};e.prototype._destroy=function(){delete this._signal;delete this._listener;delete this.context};return e}();e.SignalBinding=t})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r,i,s,o){if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}if(typeof o==="undefined"){o=false}t.call(this,n,i,s);if(typeof r=="undefined"){console.error("A Texture Atlas was not passed when instantiating a new Sprite.");this.visible=false;this.active=false;return}if(this.game.renderOption===e.RENDERER_WEBGL){this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")}this.atlas=r;this.name=this.atlas.name;this.cellIndex=this.atlas.cellIndex;this.width=r.cells[this.cellIndex].w;this.height=r.cells[this.cellIndex].h;this.transform.rotPointX=this.width/2;this.transform.rotPointY=this.height/2;this.box=this.components.add(new e.Components.Box(this,i,s,this.width,this.height));this.input=this.components.add(new e.Components.Input(this,this.box,o));if(this.atlas.type===e.Textures.TextureAtlas.SINGLE_IMAGE){this.animation=null;this._isAnimated=false}else{this.animation=this.components.add(new e.Components.AnimationManager(this));this._isAnimated=true}}__extends(n,t);n.prototype.objType=function(){return"Sprite"};n.prototype.update=function(){t.prototype.update.call(this);if(this._isAnimated){this.animation.update();this.width=this.atlas.cells[this.cellIndex].w;this.height=this.atlas.cells[this.cellIndex].h}this.input.update()};n.prototype.render=function(e){t.prototype.render.call(this,e);if(this.alpha>0){var n=this.game.stage.ctx;n.save();if(this.alpha>0&&this.alpha<=1){n.globalAlpha=this.alpha}var r=this.transform;var i=r.getConcatenatedMatrix();n.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);var s=this.atlas.cells[this.cellIndex];n.drawImage(this.atlas.image,s.x,s.y,s.w,s.h,-r.rotPointX,-r.rotPointY,s.w,s.h);n.restore()}};n.prototype.renderGL=function(e,t,n){if(typeof n==="undefined"){n=null}this.glRenderer.addToBatch(e,this,t)};return n}(e.Entity);t.Sprite=n})(e.GameObjects||(e.GameObjects={}));var t=e.GameObjects})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r,i,s){if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}t.call(this,n,i,s);if(this.game.renderOption===e.RENDERER_WEBGL){this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")}if(typeof r=="undefined"){console.error("A Texture Atlas was not passed when instantiating a new Static Image.");this.visible=false;this.active=false;return}this.atlas=r;this.cellIndex=this.atlas.cellIndex;this.width=r.cells[this.cellIndex].w;this.height=r.cells[this.cellIndex].h;this.transform.rotPointX=this.width/2;this.transform.rotPointY=this.height/2;this.box=this.components.add(new e.Components.Box(this,i,s,this.width,this.height))}__extends(n,t);n.prototype.objType=function(){return"Sprite"};n.prototype.render=function(e){t.prototype.render.call(this,e);if(this.alpha>0){var n=this.game.stage.ctx;n.save();if(this.alpha>0&&this.alpha<=1){n.globalAlpha=this.alpha}var r=this.transform;var i=r.getConcatenatedMatrix();n.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);var s=this.atlas.cells[this.cellIndex];n.drawImage(this.atlas.image,s.x,s.y,s.w,s.h,-r.rotPointX,-r.rotPointY,s.w,s.h);n.restore()}};n.prototype.renderGL=function(e,t,n){if(typeof n==="undefined"){n=null}this.glRenderer.addToBatch(e,this,t)};return n}(e.Entity);t.StaticImage=n})(e.GameObjects||(e.GameObjects={}));var t=e.GameObjects})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r,i,s,o,u,a,f){if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}if(typeof o==="undefined"){o="#000000"}if(typeof u==="undefined"){u=32}if(typeof a==="undefined"){a="normal"}if(typeof f==="undefined"){f="sans-serif"}t.call(this,n,i,s);this._tempDirty=true;if(this.game.renderOption===e.RENDERER_WEBGL){this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")}this._text=r;this._fontWeight=a;this._fontSize=u;this._fontColor=o;this._fontFamily=f;this._textAlign="left";this._baseline="top";this._tempDirty=true;this._canvas=document.createElement("canvas");this._canvas.width=2;this._canvas.height=2;this._ctx=this._canvas.getContext("2d");this.atlas=new e.Textures.SingleImage(this.game.rnd.uuid(),this._canvas);this.state.textureLibrary.add(this.atlas);this.atlas.dirty=true;this._alignWidth=0}__extends(n,t);n.prototype.objType=function(){return"Textfield"};Object.defineProperty(n.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e;this._tempDirty=true},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"color",{get:function(){return this._fontColor},set:function(e){this._fontColor=e;this._tempDirty=true},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight=e;this._tempDirty=true},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize=e;this._tempDirty=true},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this._fontFamily=e;this._tempDirty=true},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"textAlign",{get:function(){return this._textAlign},set:function(e){this._textAlign=e;this._tempDirty=true},enumerable:true,configurable:true});n.prototype._renderText=function(){this._ctx.font=this._fontWeight+" "+this._fontSize+"px "+this._fontFamily;var t=this._ctx.measureText(this._text);var n=t.width;var r=this._fontSize*1.3;this._alignWidth=n;if(e.Utils.Common.base2Sizes.indexOf(n)==-1){var i=0;while(n>e.Utils.Common.base2Sizes[i])i++;n=e.Utils.Common.base2Sizes[i]}if(e.Utils.Common.base2Sizes.indexOf(r)==-1){var i=0;while(r>e.Utils.Common.base2Sizes[i])i++;r=e.Utils.Common.base2Sizes[i]}this._canvas.width=n;this._canvas.height=r;this._ctx.clearRect(0,0,n,r);this._ctx.font=this._fontWeight+" "+this._fontSize+"px "+this._fontFamily;this._ctx.fillStyle=this._fontColor;this._ctx.textBaseline=this._baseline;this._ctx.fillText(this._text,0,0);this.atlas.cells[0]={x:0,y:0,w:this._canvas.width,h:this._canvas.height};this._tempDirty=false;this.atlas.dirty=true};n.prototype.render=function(t){if(this.alpha>0&&this.visible){var n=this.game.stage.ctx;n.save();var r=this.transform;if(this.alpha>0&&this.alpha<=1){n.globalAlpha=this.alpha}if(this._tempDirty)this._renderText();var i=0;switch(this._textAlign){case e.GameObjects.Textfield.TEXT_ALIGN_LEFT:i=0;break;case e.GameObjects.Textfield.TEXT_ALIGN_CENTER:i=this._alignWidth*.5;break;case e.GameObjects.Textfield.TEXT_ALIGN_RIGHT:i=this._alignWidth;break}var s=r.getConcatenatedMatrix();n.transform(s.a,s.b,s.c,s.d,s.tx-i,s.ty);n.drawImage(this._canvas,0,0,this._canvas.width,this._canvas.height,-r.rotPointX,-r.rotPointY,this._canvas.width,this._canvas.height);n.restore()}};n.prototype.renderGL=function(t,n,r){if(typeof r==="undefined"){r=null}if(this._tempDirty)this._renderText();var i=[];var s=this.transform;var o=s.getConcatenatedMatrix();var u=0;switch(this._textAlign){case e.GameObjects.Textfield.TEXT_ALIGN_LEFT:u=0;break;case e.GameObjects.Textfield.TEXT_ALIGN_CENTER:u=-(this._alignWidth*.5);break;case e.GameObjects.Textfield.TEXT_ALIGN_RIGHT:u=-this._alignWidth;break}var a=new e.Geom.Point(u-s.rotPointX,0-s.rotPointY);var f=new e.Geom.Point(this._canvas.width+u-s.rotPointX,0-s.rotPointY);var l=new e.Geom.Point(this._canvas.width+u-s.rotPointX,this._canvas.height-s.rotPointY);var c=new e.Geom.Point(u-s.rotPointX,this._canvas.height-s.rotPointY);a=o.transformPoint(a);f=o.transformPoint(f);l=o.transformPoint(l);c=o.transformPoint(c);i.push(a.x,a.y,0,0,this.alpha,f.x,f.y,this._canvas.width,0,this.alpha,l.x,l.y,this._canvas.width,this._canvas.height,this.alpha,c.x,c.y,0,this._canvas.height,this.alpha);this.glRenderer.concatBatch(i)};n.TEXT_ALIGN_CENTER="center";n.TEXT_ALIGN_RIGHT="right";n.TEXT_ALIGN_LEFT="left";return n}(e.Entity);t.Textfield=n})(e.GameObjects||(e.GameObjects={}));var t=e.GameObjects})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(){function t(t,n,r){if(typeof r==="undefined"){r=-1}this.allowCollisions=e.Components.ArcadePhysics.NONE;this.properties={};this.tilemap=t;this.index=n;this.cellIndex=r;this.offset=new e.Geom.Point(0,0)}t.prototype.objType=function(){return"TileType"};return t}();t.TileType=n})(t.Tilemap||(t.Tilemap={}));var n=t.Tilemap})(e.GameObjects||(e.GameObjects={}));var t=e.GameObjects})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(){function n(e,t,n,r){if(typeof r==="undefined"){r=0}this.tileWidth=0;this.tileHeight=0;this.width=0;this.height=0;this.properties={};this.tileTypes=[];this.createTileType(-1);this.layers=[];this.state=e;this.game=e.game;if(t!==undefined&&n!==undefined){this.createFromFileStore(t,n,r)}else if(t!==undefined||n!==undefined){console.log("You must pass BOTH the TileMapDataKey and TextureAtlas inorder to create a TileMap from the File Store.")}}Object.defineProperty(n.prototype,"widthInPixels",{get:function(){return this.width*this.tileWidth},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"heightInPixels",{get:function(){return this.height*this.tileHeight},enumerable:true,configurable:true});n.prototype.createFromFileStore=function(e,n,r){if(typeof r==="undefined"){r=0}var i=null;switch(typeof e){case"string":if(this.game.fileStore.exists(e)==false){console.error("The JSON file you have told to use for a TileMap does not exist.");return false}i=JSON.parse(this.game.fileStore.getFile(e).data);break;case"object":i=e;break;default:console.error("The type of TileMapData passed could not be idenified. Please either pass a name of JSON file to use OR an object to be used.")}this.orientation=i.orientation==undefined?t.ORTHOGONAL:i.orientation;this.tileWidth=i.tilewidth==undefined?32:i.tilewidth;this.tileHeight=i.tileheight==undefined?32:i.tileheight;this.width=i.width;this.height=i.height;for(var s in i.properties){this.properties[s]=i.properties[s]}if(i.tilesets!=="undefined"&&r!==-1)this._generateTypesFromTileset(i.tilesets,n,r);for(var o=0;o<i.layers.length;o++){var u=i.layers[o];switch(i.layers[o].type){case"tilelayer":var a=u.width!==undefined?u.width:this.width;var f=u.height!==undefined?u.height:this.height;var l=this.createNewLayer(u.name,n,u.data,a,f,u.x*this.tileWidth,u.y*this.tileHeight);l.orientation=this.orientation;l.visible=u.visible==undefined?true:u.visible;l.alpha=u.opacity==undefined?1:u.opacity;if(u.properties!==undefined)l.properties=u.properties;break;case"objectgroup":this.createNewObjectLayer();break;case"imagelayer":this.createNewImageLayer();break}}};n.prototype._generateTypesFromTileset=function(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];var s=i.margin;var o=i.spacing;var u=i.tilewidth;var a=i.tileheight;var f=i.imagewidth-s;var l=i.imageheight-s;var c=i.tileoffset==undefined?{x:0,y:0}:i.tileoffset;for(var h=s;h<l;h+=a){for(var p=s;p<f;p+=u){var d=t.cells[n]==undefined?-1:n;var v=this.createTileType(d);v.offset.x=c.x;v.offset.y=c.y;n++}}for(var m in i.tileproperties){var v=this.tileTypes[parseInt(i.firstgid)+parseInt(m)];v.properties=i.tileproperties[m]}}};n.prototype.setTo=function(e,t,n,r){this.tileWidth=e;this.tileHeight=t;this.width=n;this.height=r};n.prototype.createTileType=function(e){if(typeof e==="undefined"){e=-1}var n=new t.TileType(this,this.tileTypes.length,e);this.tileTypes.push(n);return n};n.prototype.createTileTypes=function(e){var t=[];for(var n=0;n<e.length;n++){t.push(this.createTileType(e[n]))}return t};n.prototype.createTileTypesByRange=function(e,t){var n=[];for(var r=e;r<=e+t;r++){n.push(this.createTileType(r))}return n};n.prototype.setCell=function(e,t){this.tileTypes[e].cellIndex=t};n.prototype.setCellsByRange=function(e,t,n){for(var r=e;r<e+n;r++){this.tileTypes[r].cellIndex=t;t++}};n.prototype.createNewLayer=function(t,n,r,i,s,o,u,a,f){if(typeof r==="undefined"){r=[]}if(typeof i==="undefined"){i=this.width}if(typeof s==="undefined"){s=this.height}if(typeof o==="undefined"){o=0}if(typeof u==="undefined"){u=0}if(typeof a==="undefined"){a=this.tileWidth}if(typeof f==="undefined"){f=this.tileHeight}if(r.length<i*s){var l=r.length-1;while(++l<i*s){r.push(0)}}var c=new e.GameObjects.Tilemap.TileMapLayer(this,t,n,r,a,f,o,u,i,s);this.layers.push(c);return c};n.prototype.createNewObjectLayer=function(){console.log("OBJECT GROUP layers are currently not supported.")};n.prototype.createNewImageLayer=function(){console.log("IMAGE layers are currently not supported.")};n.prototype.getLayerByName=function(e){for(var t=0;t<this.layers.length;t++){if(this.layers[t].name==e){return this.layers[t]}}return null};n.prototype.getLayer=function(e){return this.layers[e]!==undefined?this.layers[e]:null};n.prototype.objType=function(){return"TileMap"};return n}();t.TileMap=n;t.ISOMETRIC="isometric";t.ORTHOGONAL="orthogonal"})(t.Tilemap||(t.Tilemap={}));var n=t.Tilemap})(e.GameObjects||(e.GameObjects={}));var t=e.GameObjects})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(n){function r(r,i,s,o,u,a,f,l,c,h){if(typeof f==="undefined"){f=0}if(typeof l==="undefined"){l=0}if(typeof c==="undefined"){c=0}if(typeof h==="undefined"){h=0}n.call(this,r.state,f,l);this.properties={};this.orientation=t.ORTHOGONAL;if(this.game.renderOption===e.RENDERER_WEBGL){this.glRenderer=this.game.renderer.requestSharedRenderer("TextureAtlasRenderer")}this.name=i;this.atlas=s;this.tilemap=r;this._data=o;this.tileWidth=u;this.tileHeight=a;this.width=c;this.height=h;this.physics=this.components.add(new e.Components.ArcadePhysics(this,null));this.physics.immovable=true}__extends(r,n);r.prototype.childType=function(){return e.TILE_LAYER};r.prototype.objType=function(){return"TileMapLayer"};Object.defineProperty(r.prototype,"widthInPixels",{get:function(){return this.width*this.tilemap.tileWidth},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"heightInPixels",{get:function(){return this.height*this.tilemap.tileHeight},enumerable:true,configurable:true});r.prototype.countTiles=function(e){var t=0;for(var n=0;n<this._data.length;n++){if(e==undefined&&this._data[n]!==0)t++;else if(e===this._data[n])t++}return t};Object.defineProperty(r.prototype,"tileData",{get:function(){return this._data},enumerable:true,configurable:true});r.prototype.getIndexFromXY=function(e,t){var n=e+t*this.width;if(n<0||n>=this._data.length)return-1;else return n};r.prototype.getTileFromXY=function(e,t){var n=this.getIndexFromXY(e,t);return n!==-1?this.tilemap.tileTypes[this._data[n]]:null};r.prototype.getIndexFromCoords=function(t,n){if(t>this.transform.worldX+this.widthInPixels||n>this.transform.worldY+this.heightInPixels||t<this.transform.worldX||n<this.transform.worldY)return-1;var r=e.Utils.GameMath.snapToFloor(t-this.transform.worldX,this.tileWidth)/this.tileWidth;var i=e.Utils.GameMath.snapToFloor(n-this.transform.worldY,this.tileHeight)/this.tileHeight;return this.getIndexFromXY(r,i)};r.prototype.getTileFromCoords=function(e,t){var n=this.getIndexFromCoords(e,t);return n!==-1?this.tilemap.tileTypes[this._data[n]]:null};r.prototype.getIndexesByType=function(e){var t=[];for(var n=0;n<this._data.length;n++){if(this._data[n]==e)t.push(n)}return t};r.prototype.setTile=function(e,t,n){var e=this.getIndexFromXY(e,t);if(e!==-1){this._data[e]=n;return true}return false};r.prototype.setTileByIndex=function(e,t){this._data[e]=t};r.prototype.randomizeTiles=function(e,t,n,r,i){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=this.width}if(typeof i==="undefined"){i=this.height}if(e==undefined){e=[];var s=0;while(s++<this.tilemap.tileTypes.length){e.push(s)}}for(var o=n;o<n+i;o++){for(var s=t;s<t+r;s++){var u=this.getIndexFromXY(s,o);if(u!==-1)this._data[u]=this.game.rnd.pick(e)}}};r.prototype.fill=function(e,t,n,r,i){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=this.width}if(typeof i==="undefined"){i=this.height}for(var s=n;s<n+i;s++){for(var o=t;o<t+r;o++){var u=this.getIndexFromXY(o,s);if(u!==-1)this._data[u]=e}}};r.prototype.replaceTiles=function(e,t,n,r,i,s){if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}if(typeof i==="undefined"){i=this.width}if(typeof s==="undefined"){s=this.height}for(var o=r;o<r+s;o++){for(var u=n;u<n+i;u++){var a=this.getIndexFromXY(u,o);if(a!==-1&&this._data[a]==e)this._data[a]=t}}};r.prototype.swapTiles=function(e,t,n,r,i,s){if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}if(typeof i==="undefined"){i=this.width}if(typeof s==="undefined"){s=this.height}for(var o=r;o<r+s;o++){for(var u=n;u<n+i;u++){var a=this.getIndexFromXY(u,o);if(a!==-1){if(this._data[a]==e)this._data[a]=t;else if(this._data[a]==t)this._data[a]=e}}}};r.prototype.getOverlappingTiles=function(t,n){if(typeof n==="undefined"){n=e.Components.ArcadePhysics.ANY}if(t.components.hasComponent("Box")==false)return[];var r=t.components.getComponent("Box").worldHitbox;if(r.left>this.transform.worldX+this.widthInPixels||r.right<this.transform.worldX||r.bottom<this.transform.worldY||r.top>this.transform.worldY+this.heightInPixels)return[];var i=r.x-this.transform.worldX;var s=r.y-this.transform.worldY;var o=e.Utils.GameMath.snapToFloor(i,this.tileWidth)/this.tileWidth;var u=e.Utils.GameMath.snapToFloor(s,this.tileHeight)/this.tileHeight;var a=e.Utils.GameMath.snapToCeil(r.width,this.tileWidth)/this.tileWidth;var f=e.Utils.GameMath.snapToCeil(r.height,this.tileHeight)/this.tileHeight;var l=this.getCollidableTiles(o,u,a+1,f+1,n);for(var c=0;c<l.length;c++){var h=l[c];if(h.x>r.right||h.x+this.tileWidth<r.left||h.y>r.bottom||h.y+this.tileHeight<h.top){l.splice(c,1);c--}}return l};r.prototype.getCollidableTiles=function(t,n,r,i,s){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=this.width}if(typeof i==="undefined"){i=this.height}if(typeof s==="undefined"){s=e.Components.ArcadePhysics.ANY}var o=[];if(t>this.width||n>this.height)return;if(t<0)t=0;if(n<0)n=0;if(t+r>this.width)r=this.width-t;if(n+i>this.height)i=this.height-n;for(var u=n;u<n+i;u++){for(var a=t;a<t+r;a++){var f=this.getIndexFromXY(a,u);if(f===-1)continue;var l=this.tileData[f];if((this.tilemap.tileTypes[l].allowCollisions&s)!==e.Components.ArcadePhysics.NONE){o.push({index:f,type:l,x:a*this.tileWidth,y:u*this.tileHeight})}}}return o};r.prototype.update=function(){n.prototype.update.call(this);this.physics.update()};r.prototype._calculateBoundaries=function(e,n){if(this.orientation==t.ORTHOGONAL){var r=1/this.scaleX;var i=1/this.scaleY;this._maxX=Math.min(Math.ceil(e.width/this.tileWidth)+1,this.width)*r;this._maxY=Math.min(Math.ceil(e.height/this.tileHeight)+1,this.height)*i;this._startX=Math.floor((-e.transform.x-this.transform.worldX)/this.tileWidth*r);this._startY=Math.floor((-e.transform.y-this.transform.worldY)/this.tileHeight*i);if(this._startX<0)this._startX=0;if(this._startY<0)this._startY=0;if(this._maxX>this.width)this._maxX=this.width;if(this._maxY>this.height)this._maxY=this.height;if(this._startX+this._maxX>this.width)this._maxX=this.width-this._startX;if(this._startY+this._maxY>this.height)this._maxY=this.height-this._startY;return}if(this.orientation==t.ISOMETRIC){this._startX=0;this._startY=0;this._maxX=this.width;this._maxY=this.height}};r.prototype.chartToScreen=function(e,t,n){return{x:e.x*t-e.y*t,y:e.x*n/2+e.y*n/2}};r.prototype.screenToChart=function(e,t,n){var r=Math.floor(e.x/t);var i=Math.floor((e.y-r*(n/2))/n);return{x:r+i,y:i}};r.prototype.render=function(e){if(this.visible===false||this.alpha<.1||this.exists===false){return}var n=this.game.stage.ctx;n.save();if(this.alpha>0&&this.alpha<=1){n.globalAlpha=this.alpha}var r=this.transform;var i=r.getConcatenatedMatrix();n.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);this._calculateBoundaries(e,i);for(var s=this._startY;s<this._startY+this._maxY;s++){for(var o=this._startX;o<this._startX+this._maxX;o++){if((this._temptype=this.getTileFromXY(o,s))&&this._temptype.cellIndex!==-1){var u=this.atlas.cells[this._temptype.cellIndex];var a;var f;if(this.orientation==t.ISOMETRIC){var l=this._temptype.offset.x;var c=this._temptype.offset.y;var h=this.tileWidth*(this.width*2-1);var p=this.tileHeight*this.height;var d=this.tileWidth/2;var v=this.chartToScreen({x:o,y:s},this.tileWidth/2,this.tileHeight);a=v.x+this._temptype.offset.x-d;f=v.y-(u.h-this.tileHeight)+this._temptype.offset.y}else{a=o*this.tileWidth+this._temptype.offset.x;f=s*this.tileHeight-(u.h-this.tileHeight)+this._temptype.offset.y}n.drawImage(this.atlas.image,u.x,u.y,u.w,u.h,a,f,u.w,u.h)}}}n.restore();return true};r.prototype.renderGL=function(n,r,i){if(typeof i==="undefined"){i=null}var s=[];var o=new e.Geom.Point;var u=new e.Geom.Point;var a=new e.Geom.Point;var f=new e.Geom.Point;var l=this.transform;var c=l.getConcatenatedMatrix();this._calculateBoundaries(r,c);for(var h=this._startY;h<this._startY+this._maxY;h++){for(var p=this._startX;p<this._startX+this._maxX;p++){this._temptype=this.getTileFromXY(p,h);if(this._temptype.cellIndex==-1)continue;var d=this.atlas.cells[this._temptype.cellIndex];var v;var m;if(this.orientation==t.ISOMETRIC){var g=this._temptype.offset.x;var y=this._temptype.offset.y;var b=this.tileWidth*(this.width*2-1);var w=this.tileHeight*this.height;var E=this.tileWidth/2;var S=this.chartToScreen({x:p,y:h},this.tileWidth/2,this.tileHeight);v=S.x+this._temptype.offset.x-E;m=S.y+this._temptype.offset.y}else{v=p*this.tileWidth+this._temptype.offset.x;m=h*this.tileHeight+this._temptype.offset.y}o.setTo(v-l.rotPointX,m-l.rotPointY-(d.h-this.tileHeight));u.setTo(v+d.w-l.rotPointX,m-l.rotPointY-(d.h-this.tileHeight));a.setTo(v+d.w-l.rotPointX,m+d.h-l.rotPointY-(d.h-this.tileHeight));f.setTo(v-l.rotPointX,m+d.h-l.rotPointY-(d.h-this.tileHeight));o=c.transformPoint(o);u=c.transformPoint(u);a=c.transformPoint(a);f=c.transformPoint(f);s.push(o.x+l.rotPointX,o.y+l.rotPointY,d.x,d.y,this.alpha,u.x+l.rotPointX,u.y+l.rotPointY,d.x+d.w,d.y,this.alpha,a.x+l.rotPointX,a.y+l.rotPointY,d.x+d.w,d.y+d.h,this.alpha,f.x+l.rotPointX,f.y+l.rotPointY,d.x,d.y+d.h,this.alpha)}}this.glRenderer.concatBatch(s)};return r}(e.Entity);t.TileMapLayer=n})(t.Tilemap||(t.Tilemap={}));var n=t.Tilemap})(e.GameObjects||(e.GameObjects={}));var t=e.GameObjects})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r){if(typeof r==="undefined"){r=true}t.call(this,n,"Animation");this.currentAnimation=null;this.entity=n;this._atlas=this.entity.atlas;this._animations={};if(r==true){for(var i=0;i<this._atlas.sequences.length;i++){this.createFromSequence(this._atlas.sequences[i],false)}}if(this._animations["default"]){this.currentAnimation=this._animations["default"]}else{var s=[];for(var i=0;i<this._atlas.cells.length;i++){s.push(i)}this.currentAnimation=this.add("default",s,.1,true,false)}this.onChange=new e.Signal;this.onPlay=new e.Signal;this.onStop=new e.Signal;this.onUpdate=new e.Signal}__extends(n,t);Object.defineProperty(n.prototype,"isPlaying",{get:function(){return this.currentAnimation.isPlaying},enumerable:true,configurable:true});n.prototype.objType=function(){return"AnimationManager"};n.prototype.add=function(t,n,r,i,s,o){if(typeof i==="undefined"){i=false}if(typeof s==="undefined"){s=false}if(typeof o==="undefined"){o=true}var u=new e.Animations.Sequence(t,n,r,i);if(o==true)this._atlas.sequences.push(u);return this.createFromSequence(u,s)};n.prototype.createFromSequence=function(t,n){if(typeof n==="undefined"){n=false}this._animations[t.name]=new e.Animations.Animation(t.name,t,this.entity.clock,this);if(n)this.play(t.name);return this._animations[t.name]};n.prototype.play=function(e,t){if(typeof e==="undefined"){e=this.currentAnimation.name}if(typeof t==="undefined"){t=true}if(t==false&&this.currentAnimation.name===e&&this.currentAnimation.isPlaying==true){return this.currentAnimation}else{return this._play(e)}};n.prototype.playAt=function(e,t){if(typeof t==="undefined"){t=this.currentAnimation.name}return this._play(t,e)};n.prototype._play=function(e,t){if(typeof t==="undefined"){t=null}this._setCurrentAnimation(e);if(t!==null)this.currentAnimation.playAt(t);else this.currentAnimation.play();this.onPlay.dispatch(this.currentAnimation);this.updateCellIndex();return this.currentAnimation};n.prototype.stop=function(){if(this.isPlaying===true){this.currentAnimation.stop();this.onStop.dispatch(this.currentAnimation)}};n.prototype.pause=function(){this.currentAnimation.pause()};n.prototype.resume=function(){this.currentAnimation.resume()};n.prototype.switchTo=function(e,t){if(typeof t==="undefined"){t=null}var n=false;switch(typeof e){case"string":if(this.currentAnimation.name!==e){this._setCurrentAnimation(e);n=true}break;case"number":this.currentAnimation.frameIndex=e;n=true;break}if(t||t===null&&this.isPlaying&&n)this.play();if(t==false&&this.isPlaying)this.stop();this.updateCellIndex()};n.prototype.nextFrame=function(){this.currentAnimation.nextFrame();this.updateCellIndex()};n.prototype.prevFrame=function(){this.currentAnimation.prevFrame();this.updateCellIndex()};n.prototype._setCurrentAnimation=function(e){if(this.currentAnimation.name!==e){if(this.currentAnimation!==null)this.currentAnimation.stop();if(this._animations[e]){this.currentAnimation=this._animations[e];this.onChange.dispatch(e,this.currentAnimation)}}};n.prototype.update=function(){if(this.currentAnimation){this.currentAnimation.update()}};Object.defineProperty(n.prototype,"currentCell",{get:function(){return this.currentAnimation.currentCell},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"frameIndex",{get:function(){return this.currentAnimation.frameIndex},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"length",{get:function(){return this.currentAnimation.length},enumerable:true,configurable:true});n.prototype.getAnimation=function(e){return this._animations[e]};n.prototype.updateCellIndex=function(){if(typeof this.currentAnimation!=="undefined"){this.onUpdate.dispatch(this.currentAnimation);this.entity.cellIndex=this.currentAnimation.currentCell}};n.prototype.destroy=function(){t.prototype.destroy.call(this);for(var e in this._animations){this._animations[e].destroy();delete this._animations[e]}delete this._animations;delete this.currentAnimation;delete this._atlas};return n}(e.Component);t.AnimationManager=n})(e.Components||(e.Components={}));var t=e.Components})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r,i,s,o){if(typeof r==="undefined"){r=0}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}if(typeof o==="undefined"){o=0}t.call(this,n,"Box");this.autoUpdate=true;this.entity=n;this.dirty=true;this._rawBounds=new e.Geom.Rectangle(r,i,s,o);this._rawCenter=new e.Geom.Point(r+s/2,i+o/2);this._rawHitbox=new e.Geom.Rectangle;this._hitboxOffset=new e.Geom.Point;this.hitbox=new e.Geom.Rectangle(0,0,s,o);this.autoUpdate=true}__extends(n,t);n.prototype.objType=function(){return"Box"};Object.defineProperty(n.prototype,"hitboxOffset",{get:function(){if(this.dirty&&this.autoUpdate==true&&this.entity.atlas!==null){this._hitboxOffset.x=this.entity.atlas.cells[this.entity.cellIndex].hitboxes[0].x;this._hitboxOffset.y=this.entity.atlas.cells[this.entity.cellIndex].hitboxes[0].y}return this._hitboxOffset},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"rawHitbox",{get:function(){if(this.dirty){this._rawHitbox.x=this.rawBounds.x+this.hitboxOffset.x;this._rawHitbox.y=this.rawBounds.y+this.hitboxOffset.y;if(this.autoUpdate==true){var e=this.entity.atlas;if(e!==null){this._rawHitbox.width=e.cells[this.entity.cellIndex].hitboxes[0].w;this._rawHitbox.height=e.cells[this.entity.cellIndex].hitboxes[0].h}}}return this._rawHitbox},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"hitbox",{get:function(){if(this.dirty){this._transformedHitbox=this._rotateHitbox(this.rawHitbox.clone())}return this._transformedHitbox},set:function(e){this._hitboxOffset.x=e.x;this._hitboxOffset.y=e.y;this._rawHitbox=e;this._rawHitbox.x+=this._rawBounds.x;this._rawHitbox.y+=this._rawBounds.y;this.autoUpdate=false},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"worldHitbox",{get:function(){if(this.dirty){this._worldHitbox=this._rotateHitbox(this.rawHitbox.clone(),true)}return this._worldHitbox},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"rawBounds",{get:function(){if(this.dirty){this._rawBounds.x=this.entity.x;this._rawBounds.y=this.entity.y;this._rawBounds.width=this.entity.width;this._rawBounds.height=this.entity.height}return this._rawBounds},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"rawCenter",{get:function(){if(this.dirty){this._rawCenter.x=this.rawBounds.x+this.rawBounds.width/2,this._rawCenter.y=this.rawBounds.y+this.rawBounds.height/2}return this._rawCenter},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"center",{get:function(){if(this.dirty){var t=this.entity.transform;var n=t.getConcatenatedMatrix();n.setTo(n.a,n.b,n.c,n.d,t.x+t.rotPointX,t.y+t.rotPointY);this._transformedCenter=n.transformPoint(new e.Geom.Point(this.entity.width/2-t.rotPointX,this.entity.height/2-t.rotPointY))}return this._transformedCenter},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"bounds",{get:function(){if(this.dirty){this._transformedBounds=this._rotateRect(this.rawBounds.clone())}return this._transformedBounds},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"worldBounds",{get:function(){if(this.dirty){this._worldBounds=this._rotateRect(this.rawBounds.clone(),true)}return this._worldBounds},enumerable:true,configurable:true});n.prototype._rotateRect=function(t,n){if(typeof n==="undefined"){n=false}var r=new e.Geom.Rectangle;var i=this.entity.transform;var s=i.getConcatenatedMatrix();if(!n){s.setTo(s.a,s.b,s.c,s.d,i.x+i.rotPointX,i.y+i.rotPointY)}r=this.extents(s.transformPoint({x:-i.rotPointX,y:-i.rotPointY}),s.transformPoint({x:-i.rotPointX+t.width,y:-i.rotPointY}),s.transformPoint({x:-i.rotPointX+t.width,y:-i.rotPointY+t.height}),s.transformPoint({x:-i.rotPointX,y:-i.rotPointY+t.height}));return r};n.prototype._rotateHitbox=function(t,n){if(typeof n==="undefined"){n=false}var r=new e.Geom.Rectangle;var i=this.entity.transform;var s=i.getConcatenatedMatrix();if(!n){s.setTo(s.a,s.b,s.c,s.d,i.x+i.rotPointX,i.y+i.rotPointY)}r=this.extents(s.transformPoint({x:-i.rotPointX+this._hitboxOffset.x,y:-i.rotPointY+this._hitboxOffset.y}),s.transformPoint({x:-i.rotPointX+t.width+this._hitboxOffset.x,y:-i.rotPointY+this._hitboxOffset.y}),s.transformPoint({x:-i.rotPointX+t.width+this._hitboxOffset.x,y:-i.rotPointY+t.height+this._hitboxOffset.y}),s.transformPoint({x:-i.rotPointX+this._hitboxOffset.x,y:-i.rotPointY+t.height+this._hitboxOffset.y}));return r};n.prototype.draw=function(e,t){if(typeof t==="undefined"){t=this.game.cameras.defaultCamera}var n=this.entity.transform;var r=t.transform;e.strokeStyle="red";e.fillRect(this.rawCenter.x+r.x-1,this.rawCenter.y+r.y-1,3,3);e.strokeRect(n.x+r.x+n.rotPointX-3,n.y+r.y+n.rotPointY-3,7,7);e.strokeStyle="blue";e.strokeRect(this.bounds.x+r.x,this.bounds.y+r.y,this.bounds.width,this.bounds.height);e.strokeStyle="green";e.strokeRect(this.hitbox.x+r.x,this.hitbox.y+r.y,this.hitbox.width,this.hitbox.height);e.strokeStyle="white";e.strokeRect(this.rawHitbox.x+r.x,this.rawHitbox.y+r.y,this.rawHitbox.width,this.rawHitbox.height);e.strokeStyle="purple";e.strokeRect(this.worldBounds.x,this.worldBounds.y,this.worldBounds.width,this.worldBounds.height);e.strokeStyle="cyan";e.strokeRect(this.worldHitbox.x,this.worldHitbox.y,this.worldHitbox.width,this.worldHitbox.height)};n.prototype.extents=function(t,n,r,i){var s=Math.min(t.x,n.x,r.x,i.x);var o=Math.max(t.x,n.x,r.x,i.x);var u=Math.min(t.y,n.y,r.y,i.y);var a=Math.max(t.y,n.y,r.y,i.y);return new e.Geom.Rectangle(s,u,o-s,a-u)};n.prototype.destroy=function(){t.prototype.destroy.call(this);delete this.entity};return n}(e.Component);t.Box=n})(e.Components||(e.Components={}));var t=e.Components})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r,i){if(typeof i==="undefined"){i=false}t.call(this,n,"Input");this._isDragging=null;this._dragEnabled=false;this._dragSnapToCenter=false;this._nowDown=null;this._nowUp=null;this._nowEntered=null;this._nowLeft=null;this._nowDragging=null;this._onEntered=new e.Signal;this._onLeft=new e.Signal;this._onDown=new e.Signal;this._onUp=new e.Signal;this._onDragStarted=new e.Signal;this._onDragStopped=new e.Signal;this._box=r;this._distance=new e.Geom.Point;this._withinBounds=null;this._outsideBounds=true;this._isUp=true;this._isDown=null;this._isDragging=null;this._justEntered=false;this._tempDragDisabled=false;this._tempPoint=new e.Geom.Point;this._tempCircle=new e.Geom.Circle(0,0,0);this.enabled=i}__extends(n,t);n.prototype.objType=function(){return"Input"};Object.defineProperty(n.prototype,"onEntered",{get:function(){if(this.enabled==false)this.enabled=true;return this._onEntered},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"onLeft",{get:function(){if(this.enabled==false)this.enabled=true;return this._onLeft},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"onDown",{get:function(){if(this.enabled==false)this.enabled=true;return this._onDown},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"onUp",{get:function(){if(this.enabled==false)this.enabled=true;return this._onUp},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"onDragStarted",{get:function(){return this._onDragStarted},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"onDragStopped",{get:function(){return this._onDragStopped},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"onRelease",{get:function(){return this.onUp},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"onPress",{get:function(){return this.onDown},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"isDown",{get:function(){return this._isDown!==null},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"isUp",{get:function(){return this._isUp},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"withinBounds",{get:function(){return this._withinBounds!==null},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"outsideBounds",{get:function(){return this._outsideBounds},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"isDragging",{get:function(){return this._isDragging!==null},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"dragDistance",{get:function(){return this._dragDistance},set:function(e){this._dragDistance=e},enumerable:true,configurable:true});n.prototype.enableDrag=function(e,t){if(typeof e==="undefined"){e=false}if(typeof t==="undefined"){t=1}if(this.enabled==false)this.enabled=true;this._dragEnabled=true;this._dragSnapToCenter=e;this._dragDistance=t;this._isDragging=null};n.prototype.disableDrag=function(){this._dragEnabled=false;this._isDragging=null};n.prototype.update=function(){if(this.enabled===false||!this.game||this.owner.active===false){return}this._nowDown=null;this._nowUp=null;this._nowEntered=null;this._nowLeft=null;this._nowDragging=null;if(e.DEVICE.touch){this._updateTouch()}else{this._updateMouse()}if(this.isDragging){this._tempPoint=this.game.cameras.defaultCamera.transformPoint(this._isDragging.point);if(this._dragSnapToCenter===false){this.owner.transform.x=e.Utils.GameMath.snapTo(this._tempPoint.x-this._box.hitboxOffset.x-this._distance.x,this._dragDistance);this.owner.transform.y=e.Utils.GameMath.snapTo(this._tempPoint.y-this._box.hitboxOffset.y-this._distance.y,this._dragDistance)}else{this.owner.transform.x=e.Utils.GameMath.snapTo(this._tempPoint.x-this._box.hitboxOffset.x-this._box.worldHitbox.width/2,this._dragDistance);this.owner.transform.y=e.Utils.GameMath.snapTo(this._tempPoint.y-this._box.hitboxOffset.y-this._box.worldHitbox.height/2,this._dragDistance)}}};n.prototype._updateTouch=function(){for(var e=0;e<this.game.input.touch.maximumPointers;e++){if(this.game.input.touch.fingers[e].active===true){this._evaluateTouchPointer(this.game.input.touch.fingers[e])}else if(this.isDown===true&&this._isDown.id===this.game.input.touch.fingers[e].id){this._nowUp=this.game.input.touch.fingers[e]}else if(this.isDown===false&&this._nowUp===null&&this.withinBounds===true&&this._withinBounds.id===this.game.input.touch.fingers[e].id){this._nowUp=this.game.input.touch.fingers[e]}}if(this._nowEntered!==null&&this.withinBounds===false){this._withinBounds=this._nowEntered;this._outsideBounds=false;this._onEntered.dispatch(this.owner,this._nowEntered)}if(this._nowLeft!==null&&this.withinBounds===true){this._withinBounds=null;this._outsideBounds=true;this._onLeft.dispatch(this.owner,this._nowLeft)}if(this._nowDown!==null&&this.isDown===false){this._onDown.dispatch(this.owner,this._nowDown);this._isDown=this._nowDown;this._isUp=false;this._withinBounds=this._nowDown;this._outsideBounds=false}if(this._dragEnabled==true&&this.isDragging===false&&this._nowDragging!==null){this._onDragStarted.dispatch(this.owner,this._nowDragging);this._isDragging=this._nowDragging}if(this._nowUp!==null){this._onUp.dispatch(this.owner,this._nowUp);this._isDown=null;this._isUp=true;this._withinBounds=null;this._outsideBounds=true;if(this.isDragging===true&&this._isDragging.id==this._nowUp.id){this._isDragging=null;this._onDragStopped.dispatch(this.owner,this._nowUp)}}};n.prototype._evaluateTouchPointer=function(t){if(this.isDown===false||this._isDown.id===t.id){this._tempPoint=this.game.cameras.defaultCamera.transformPoint(t.point);this._tempCircle.setTo(this._tempPoint.x,this._tempPoint.y,t.circle.diameter);if(e.Geom.Intersect.circleToRectangle(this._tempCircle,this._box.worldHitbox).result){if(this.isDown===true&&this._isDown.id===t.id||this.isDown===false&&t.duration>1){this._nowEntered=t}if(this.isDown===false&&t.frameDuration<2){this._nowDown=t}if(this._dragEnabled&&this.isDragging==false&&this.isDown==true){this._distance.x=this._tempPoint.x-this._box.worldHitbox.left;this._distance.y=this._tempPoint.y-this._box.worldHitbox.top;this._nowDragging=t}}else{if(this.isDown===true){this._nowLeft=t}else if(this.withinBounds===true&&this._withinBounds.id==t.id){this._nowLeft=t}}}};n.prototype._updateMouse=function(){this._evaluateMousePointer(this.game.input.mouse.cursor);if(this._nowLeft!==null){this._onLeft.dispatch(this.owner,this._nowLeft)}if(this._nowEntered!==null){this._onEntered.dispatch(this.owner,this._nowEntered)}if(this._nowDown!==null&&this.isDown===false){this._onDown.dispatch(this.owner,this._nowDown);this._isDown=this._nowDown;this._isUp=false}if(this._dragEnabled==true&&this.isDragging===false&&this._nowDragging!==null){this._onDragStarted.dispatch(this.owner,this._nowDragging);this._isDragging=this._nowDragging}if(this.isDown===true&&this._nowUp!==null&&this._isDown.id===this._nowUp.id){this._onUp.dispatch(this.owner,this._nowUp);if(this.isDragging===true&&this._isDragging.id==this._nowUp.id){this._isDragging=null;this._onDragStopped.dispatch(this.owner,this._nowUp)}this._isDown=null;this._isUp=true}};n.prototype._evaluateMousePointer=function(t){this._tempPoint=this.game.cameras.defaultCamera.transformPoint(t.point);if(e.Geom.Intersect.pointToRectangle(this._tempPoint,this._box.worldHitbox).result){if(this._dragEnabled&&this.isDragging===false){this._distance.x=this._tempPoint.x-this._box.worldHitbox.left;this._distance.y=this._tempPoint.y-this._box.worldHitbox.top}if(this.withinBounds===false){this._nowEntered=t;this._withinBounds=t;this._outsideBounds=false;this._justEntered=true}}else{if(this.withinBounds===true&&this.isDragging===false){this._nowLeft=t;this._withinBounds=null;this._outsideBounds=true}}if(t.isDown===true){if(this._justEntered){this._isDown=t;this._isUp=false;this._tempDragDisabled=true}if(this.withinBounds===true&&this.isDown===false&&this._nowDown===null){this._nowDown=t}if(this._dragEnabled===true&&this.isDragging==false&&this._tempDragDisabled===false){if(this.isDown==true){this._nowDragging=t}}}else{if(this._tempDragDisabled===true)this._tempDragDisabled=false;if(this.isDown===true){this._nowUp=t}}if(this._justEntered)this._justEntered=false};n.prototype.destroy=function(){t.prototype.destroy.call(this);this.enabled=false;delete this._box;delete this._isDown;delete this._isUp;delete this._isDragging;delete this._dragEnabled;if(this._onDown)this._onDown.dispose();delete this._onDown;if(this._onDragStarted)this._onDragStarted.dispose();delete this._onDragStarted;if(this._onUp)this._onUp.dispose();delete this._onUp;if(this._onLeft)this._onLeft.dispose();delete this._onLeft;if(this._onEntered)this._onEntered.dispose();delete this._onEntered;if(this._onDragStopped)this._onDragStopped.dispose();delete this._onDragStopped;delete this._dragDistance};return n}(e.Component);t.Input=n})(e.Components||(e.Components={}));var t=e.Components})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(e){function t(t){e.call(this,t,"Sound");this._audio=[]}__extends(t,e);t.prototype.objType=function(){return"Sound"};t.prototype.addSound=function(e,t,n,r){if(typeof n==="undefined"){n=1}if(typeof r==="undefined"){r=false}if(this._validate(e)==true)return;var i=this.game.audio.add(t,n,r);this._audio[e]=i;return i};t.prototype.removeSound=function(e){if(this._validate(e)==false)return;this._audio[e].stop();this._audio[e].destroy();delete this._audio[e]};t.prototype.getSound=function(e){if(this._validate(e)==false)return;return this._audio[e]};t.prototype._validate=function(e){if(this._audio[e]===undefined){return false}else{return true}};t.prototype.play=function(e){if(this._validate(e)==false)return;this._audio[e].play()};t.prototype.stop=function(e){if(this._validate(e)==false)return;this._audio[e].stop()};t.prototype.pause=function(e){if(this._validate(e)==false)return;this._audio[e].pause()};t.prototype.resume=function(e){if(this._validate(e)==false)return;this._audio[e].resume()};t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t in this._audio){this._audio[t].stop();this._audio[t].destroy();delete this._audio[t]}delete this._audio};return t}(e.Component);t.Sound=n})(e.Components||(e.Components={}));var t=e.Components})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(r,i){t.call(this,r,"ArcadePhysics");this._callbackFunction=null;this._callbackContext=null;this.parent=r;this.box=i;this.transform=this.parent.transform;this.last=new e.Geom.Point(this.transform.worldX,this.transform.worldY);this.mass=1;this.elasticity=0;this.immovable=false;this.moves=true;this.touching=n.NONE;this.wasTouching=n.NONE;this.allowCollisions=n.ANY;this.velocity=new e.Geom.Point;this.acceleration=new e.Geom.Point;this.drag=new e.Geom.Point;this.maxVelocity=new e.Geom.Point(1e4,1e4);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e4}__extends(n,t);n.prototype.isTouching=function(e){return(this.touching&e)==e};n.prototype.solid=function(e){if(e!==undefined){if(e)this.allowCollisions=n.ANY;else this.allowCollisions=n.NONE}return(this.allowCollisions&n.ANY)>n.NONE};n.prototype.setCallback=function(e,t){this._callbackFunction=e;this._callbackContext=t};n.separate=function(e,t){var n=this.separateX(e,t);var r=this.separateY(e,t);return n||r};n.separateX=function(t,r){var i=t.components.getComponent("ArcadePhysics");var s=r.components.getComponent("ArcadePhysics");if(i.immovable&&s.immovable)return false;var o=0;var u=i.transform.worldX-i.last.x;var a=s.transform.worldX-s.last.x;if(u==a)return false;var f=u>0?u:-u;var l=a>0?a:-a;var c=i.box.worldHitbox;var h=s.box.worldHitbox;var p=new e.Geom.Rectangle(c.x-(u>0?u:0),i.last.y+i.box.hitboxOffset.y,c.width+(u>0?u:-u),c.height);var d=new e.Geom.Rectangle(h.x-(a>0?a:0),s.last.y+s.box.hitboxOffset.y,h.width+(a>0?a:-a),h.height);if(p.x+p.width>d.x&&p.x<d.x+d.width&&p.y+p.height>d.y&&p.y<d.y+d.height){var v=f+l+n.OVERLAP_BIAS;if(u>a){o=c.x+c.width-h.x;if(o>v||!(i.allowCollisions&n.RIGHT)||!(s.allowCollisions&n.LEFT)){o=0}else{i.touching|=n.RIGHT;s.touching|=n.LEFT}}else{o=c.x-h.width-h.x;if(-o>v||!(i.allowCollisions&n.LEFT)||!(s.allowCollisions&n.RIGHT)){o=0}else{i.touching|=n.LEFT;s.touching|=n.RIGHT}}}if(o!=0){var m=i.velocity.x;var g=s.velocity.x;if(!i.immovable&&!s.immovable){o*=.5;i.transform.x=i.transform.x-o;s.transform.x=s.transform.x+o;var y=Math.sqrt(g*g*s.mass/i.mass)*(g>0?1:-1);var b=Math.sqrt(m*m*i.mass/s.mass)*(m>0?1:-1);var w=(y+b)*.5;y-=w;b-=w;i.velocity.x=w+y*i.elasticity;s.velocity.x=w+b*s.elasticity}else if(!i.immovable){i.transform.x=i.transform.x-o;i.velocity.x=g-m*i.elasticity}else if(!s.immovable){s.transform.x=s.transform.x+o;s.velocity.x=m-g*s.elasticity}return true}return false};n.separateY=function(t,r){var i=t.components.getComponent("ArcadePhysics");var s=r.components.getComponent("ArcadePhysics");if(i.immovable&&s.immovable)return false;var o=0;var u=i.transform.worldY-i.last.y;var a=s.transform.worldY-s.last.y;if(u==a)return false;var f=u>0?u:-u;var l=a>0?a:-a;var c=i.box.worldHitbox;var h=s.box.worldHitbox;var p=new e.Geom.Rectangle(c.x,c.y-(u>0?u:0),c.width,c.height+f);var d=new e.Geom.Rectangle(h.x,h.y-(a>0?a:0),h.width,h.height+l);if(p.x+p.width>d.x&&p.x<d.x+d.width&&p.y+p.height>d.y&&p.y<d.y+d.height){var v=f+l+n.OVERLAP_BIAS;if(u>a){o=c.y+c.height-h.y;if(o>v||!(i.allowCollisions&n.DOWN)||!(s.allowCollisions&n.UP)){o=0}else{i.touching|=n.DOWN;s.touching|=n.UP}}else{o=c.y-h.height-h.y;if(-o>v||!(i.allowCollisions&n.UP)||!(s.allowCollisions&n.DOWN)){o=0}else{i.touching|=n.UP;s.touching|=n.DOWN}}if(o!=0){var m=i.velocity.y;var g=s.velocity.y;if(!i.immovable&&!s.immovable){o*=.5;i.transform.y=i.transform.y-o;s.transform.y=s.transform.y+o;var y=Math.sqrt(g*g*s.mass/i.mass)*(g>0?1:-1);var b=Math.sqrt(m*m*i.mass/s.mass)*(m>0?1:-1);var w=(y+b)*.5;y-=w;b-=w;i.velocity.y=w+y*i.elasticity;s.velocity.y=w+b*s.elasticity}else if(!i.immovable){i.transform.y=i.transform.y-o;i.velocity.y=g-m*i.elasticity;if(r.active&&s.moves&&u>a)i.transform.x=i.transform.worldX+r.transform.worldX-s.last.x}else if(!s.immovable){s.transform.y=s.transform.y+o;s.velocity.y=m-g*s.elasticity;if(t.active&&i.moves&&u<a)s.transform.x=s.transform.worldX+t.transform.worldX-i.last.x}return true}}return false};n.separateTiles=function(e,t,n){if(e.components.hasComponent("ArcadePhysics")==false)return false;if(e.components.getComponent("ArcadePhysics").immovable)return false;var r=false;var i=false;for(var s=0;s<n.length;s++){var o=n[s];if(!r)r=this.separateTilesX(e,t,o);if(!i)i=this.separateTilesY(e,t,o)}return r||i};n.separateTilesX=function(t,r,i){var s=t.components.getComponent("ArcadePhysics");var o=r.components.getComponent("ArcadePhysics");var u=s.transform.worldX-s.last.x;var a=o.transform.worldX-o.last.x;if(u==a)return false;var f=u>0?u:-u;var l=a>0?a:-a;var c=0;var h=f+l+n.OVERLAP_BIAS;var p=s.box.worldHitbox;var d=r.tilemap.tileTypes;var v=r.tileData;var m=o.transform.worldX+i.x;var g=new e.Geom.Rectangle(p.x-(u>0?u:0),s.last.y+s.box.hitboxOffset.y,p.width+(u>0?u:-u),p.height);var y=new e.Geom.Rectangle(m-(a>0?a:0),o.last.y+i.y,r.tileWidth+(a>0?a:-a),r.tileHeight);if(g.x+g.width>y.x&&g.x<y.x+y.width&&g.y+g.height>y.y&&g.y<y.y+y.height){if(u>a){c=p.x+p.width-m;if(c>h||!(s.allowCollisions&n.RIGHT)||!(d[v[i.index]].allowCollisions&n.LEFT)){c=0}else{s.touching|=n.RIGHT}}else{c=p.x-r.tileWidth-m;if(-c>h||!(s.allowCollisions&n.LEFT)||!(d[v[i.index]].allowCollisions&n.RIGHT)){c=0}else{s.touching|=n.LEFT}}if(c!=0){var b=s.velocity.x;var w=o.velocity.x;s.transform.x=s.transform.x-c;s.velocity.x=w-b*s.elasticity;return true}}return false};n.separateTilesY=function(t,r,i){var s=t.components.getComponent("ArcadePhysics");var o=r.components.getComponent("ArcadePhysics");var u=s.transform.worldY-s.last.y;var a=o.transform.worldY-o.last.y;if(u==a)return false;var f=u>0?u:-u;var l=a>0?a:-a;var c=0;var h=f+l+n.OVERLAP_BIAS;var p=s.box.worldHitbox;var d=r.tilemap.tileTypes;var v=r.tileData;var m=r.transform.worldY+i.y;var g=new e.Geom.Rectangle(p.x,p.y-(u>0?u:0),p.width,p.height+f);var y=new e.Geom.Rectangle(o.transform.worldX+i.x,m-(a>0?a:0),r.tileWidth,r.tileHeight+l);if(g.x+g.width>y.x&&g.x<y.x+y.width&&g.y+g.height>y.y&&g.y<y.y+y.height){if(u>a){c=p.y+p.height-m;if(c>h||!(s.allowCollisions&n.DOWN)||!(d[v[i.index]].allowCollisions&n.UP)){c=0}else{s.touching|=n.DOWN}}else{c=p.y-r.tileHeight-m;if(-c>h||!(s.allowCollisions&n.UP)||!(d[v[i.index]].allowCollisions&n.DOWN)){c=0}else{s.touching|=n.UP}}if(c!=0){var b=s.velocity.y;var w=o.velocity.y;s.transform.y=s.transform.y-c;s.velocity.y=w-b*s.elasticity;return true}}return false};n.prototype.overlapsTiles=function(t,r,i){if(typeof r==="undefined"){r=false}if(typeof i==="undefined"){i=e.Components.ArcadePhysics.ANY}if(this.parent.childType()!==e.TILE_LAYER)return false;var s=this.parent.getOverlappingTiles(t,i);if(s.length>0){if(r)n.separateTiles(t,this.parent,s);return true}else{return false}};n.prototype.overlaps=function(e,t){if(typeof t==="undefined"){t=false}if(e.components.hasComponent("Box")==false)return;var r=e.components.getComponent("Box");var i=r.worldHitbox.x+r.worldHitbox.width>this.box.worldHitbox.x&&r.worldHitbox.x<this.box.worldHitbox.x+this.box.worldHitbox.width&&r.worldHitbox.y+r.worldHitbox.height>this.box.worldHitbox.y&&r.worldHitbox.y<this.box.worldHitbox.y+this.box.worldHitbox.height;if(i){if(t)n.separate(this.owner,e);if(this._callbackFunction!==null&&this._callbackContext!==null){this._callbackFunction.call(this._callbackContext,this.owner,e)}}return i};n.prototype.overlapsGroup=function(t,n){if(typeof n==="undefined"){n=false}var r=false;for(var i=0;i<t.members.length;i++){if(t.members[i].childType()===e.GROUP){this.overlapsGroup(t.members[i],n)}else{if(this.overlaps(t.members[i],n)){if(this._callbackContext!==null&&this._callbackFunction!==null)this._callbackFunction.call(this._callbackContext,this.owner,t.members[i]);r=true}}}return r};n.prototype.overlapsArray=function(t,n){if(typeof n==="undefined"){n=false}var r=false;for(var i=0;i<t.length;i++){if(typeof t[i].childType!=="undefined"){if(t[i].childType()==e.GROUP){this.overlapsGroup(t[i],n)}else{if(this.overlaps(t[i],n)){if(this._callbackFunction!==null&&this._callbackContext!==null){this._callbackFunction.call(this._callbackContext,this.owner,t[i])}r=true}}}}return r};n.computeVelocity=function(e,t,r,i){if(typeof t==="undefined"){t=0}if(typeof r==="undefined"){r=0}if(typeof i==="undefined"){i=1e4}if(t!=0)e+=t*n.updateInterval;else if(r!=0){r=r*n.updateInterval;if(e-r>0)e=e-r;else if(e+r<0)e+=r;else e=0}if(e!=0&&i!=1e4){if(e>i)e=i;else if(e<-i)e=-i}return e};n.prototype.updateMotion=function(){var e;var t;t=(n.computeVelocity(this.angularVelocity,this.angularAcceleration,this.angularDrag,this.maxAngular)-this.angularVelocity)/2;this.angularVelocity+=t;this.transform.rotation+=this.angularVelocity*n.updateInterval;this.angularVelocity+=t;t=(n.computeVelocity(this.velocity.x,this.acceleration.x,this.drag.x,this.maxVelocity.x)-this.velocity.x)/2;this.velocity.x+=t;e=this.velocity.x*n.updateInterval;this.velocity.x+=t;this.transform.x=this.transform.x+e;t=(n.computeVelocity(this.velocity.y,this.acceleration.y,this.drag.y,this.maxVelocity.y)-this.velocity.y)/2;this.velocity.y+=t;e=this.velocity.y*n.updateInterval;this.velocity.y+=t;this.transform.y=this.transform.y+e};n.prototype.update=function(){this.last.x=this.transform.worldX;this.last.y=this.transform.worldY;if(this.moves)this.updateMotion();this.wasTouching=this.touching;this.touching=n.NONE};n.prototype.destroy=function(){t.prototype.destroy.call(this);delete this.transform;delete this.owner;delete this._callbackContext;delete this._callbackFunction};n.prototype.objType=function(){return"ArcadePhysics"};n.collide=function(e,t,r){if(typeof r==="undefined"){r=true}return n.overlaps(e,t,r)};n.collideGroup=function(e,t,r){if(typeof r==="undefined"){r=true}return n.overlapsObjectGroup(e,t,r)};n.collideGroupGroup=function(e,t,r){if(typeof r==="undefined"){r=true}return n.overlapsGroupGroup(e,t,r)};n.overlaps=function(e,t,n){if(typeof n==="undefined"){n=true}var r=e.components.getComponent("ArcadePhysics");return r.overlaps(t,n)};n.overlapsObjectGroup=function(e,t,n){if(typeof n==="undefined"){n=true}var r=e.components.getComponent("ArcadePhysics");return r.overlapsGroup(t,n)};n.overlapsGroupGroup=function(t,r,i){if(typeof i==="undefined"){i=true}var s=false;var o=t.members;var u=0;while(u<t.members.length){if(o[u].childType()==e.GROUP){if(n.overlapsGroupGroup(o[u++],r,i))s=true}else{if(n.overlapsObjectGroup(o[u++],r,i))s=true}}return s};n.overlapsArrayGroup=function(t,r,i){if(typeof i==="undefined"){i=true}var s=false;for(var o=0;o<t.length;o++){if(typeof t[o].childType!=="undefined"){if(t[o].childType()===e.GROUP){if(n.overlapsGroupGroup(t[o],r,i))s=true}else{if(n.overlapsObjectGroup(t[o],r,i))s=true}}}return s};n.updateInterval=1/10;n.LEFT=1;n.RIGHT=16;n.UP=256;n.DOWN=4096;n.NONE=0;n.CEILING=n.UP;n.FLOOR=n.DOWN;n.WALL=n.LEFT|n.RIGHT;n.ANY=n.LEFT|n.RIGHT|n.UP|n.DOWN;n.OVERLAP_BIAS=4;return n}(e.Component);t.ArcadePhysics=n})(e.Components||(e.Components={}));var t=e.Components})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._calculateBytes=true;this._fileTotal=0;this._currentFile=0;this._bytesTotal=0;this._bytesLoaded=0;this._bytesCurrent=0;this._fileChunk=0;this._percentLoaded=0;this._complete=false;this._game=e}t.prototype.objType=function(){return"Loader"};t.prototype.boot=function(){this._fileList=[];this._loadList=[]};t.prototype.init=function(e,t,n){if(typeof e==="undefined"){e=null}if(typeof t==="undefined"){t=null}if(typeof n==="undefined"){n=false}this._fileList.length=0;this._loadList.length=0;this._calculateBytes=n;this._complete=false;if(e!==null){this._onProgressCallback=e}if(t!==null){this._onCompleteCallback=t}};t.prototype.addImage=function(t,n,r,i,s,o,u){if(typeof u==="undefined"){u=true}var a=new e.Files.File(this._game,e.Files.File.IMAGE,n,t,true,u);a.metadata={width:r,height:i,offsetX:s,offsetY:o};this._fileList.push(a)};t.prototype.addSpriteSheet=function(t,n,r,i,s,o,u,a,f,l,c,h){if(typeof h==="undefined"){h=true}var p=new e.Files.File(this._game,e.Files.File.SPRITE_SHEET,n,t,true,h);p.metadata={frameWidth:r,frameHeight:i,numCells:s,rows:o,cols:u,sheetOffsetX:a,sheetOffsetY:f,cellOffsetX:l,cellOffsetY:c};this._fileList.push(p)};t.prototype.addTextureAtlas=function(t,n,r,i,s){if(typeof s==="undefined"){s=true}var o=new e.Files.File(this._game,e.Files.File.TEXTURE_ATLAS,n,t,true,s);var u=new e.Files.File(this._game,e.Files.File.JSON,i,r,true,s);o.metadata={jsonID:r};u.metadata={imageID:t};this._fileList.push(o,u)};t.prototype.addAudio=function(t,n,r,i){if(typeof r==="undefined"){r=true}if(typeof i==="undefined"){i=true}if(e.Utils.Common.isString(n)){this.attemptToAddAudio(t,n,r,i)}else if(e.Utils.Common.isArray(n)){for(var s=0;s<n.length;s++){if(e.Utils.Common.isString(n[s])==false)continue;if(this.attemptToAddAudio(t,n[s],r,i)==true)break}}};t.prototype.attemptToAddAudio=function(t,n,r,i){var s=new e.Files.File(this._game,e.Files.File.AUDIO,n,t,true,r);var o=false;switch(s.fileExtension){case"mp3":o=e.DEVICE.mp3;break;case"ogg":case"oga":o=e.DEVICE.ogg;break;case"m4a":o=e.DEVICE.m4a;break;case"wav":case"wave":o=e.DEVICE.wav;break}if(o==true||i==false){this._fileList.push(s);return true}else{if(this._game.debug)console.error("Kiwi.Loader: Audio Format not supported on this Device/Browser.");return false}};t.prototype.addJSON=function(t,n,r){if(typeof r==="undefined"){r=true}this._fileList.push(new e.Files.File(this._game,e.Files.File.JSON,n,t,true,r))};t.prototype.addXML=function(t,n,r){if(typeof r==="undefined"){r=true}this._fileList.push(new e.Files.File(this._game,e.Files.File.XML,n,t,true,r))};t.prototype.addBinaryFile=function(t,n,r){if(typeof r==="undefined"){r=true}this._fileList.push(new e.Files.File(this._game,e.Files.File.BINARY_DATA,n,t,true,r))};t.prototype.addTextFile=function(t,n,r){if(typeof r==="undefined"){r=true}this._fileList.push(new e.Files.File(this._game,e.Files.File.TEXT_DATA,n,t,true,r))};t.prototype.startLoad=function(){if(this._fileList.length===0){this._onCompleteCallback()}else{this._onProgressCallback(0,0,null);this._fileTotal=this._fileList.length;this._bytesLoaded=0;this._bytesTotal=0;this._bytesCurrent=0;this._currentFile=0;this._fileChunk=0;this._percentLoaded=0;if(this._calculateBytes===true){this.getNextFileSize()}else{this._fileChunk=Math.floor(100/this._fileTotal);this._loadList=this._fileList;this.nextFile()}}};t.prototype.getNextFileSize=function(){var e=this;if(this._fileList.length===0){var t=this._fileList.shift();t.getFileDetails(function(t){return e.addToBytesTotal(t)})}else{this.nextFile()}};t.prototype.addToBytesTotal=function(e){this._bytesTotal+=e.fileSize;this._loadList.push(e);this.getNextFileSize()};t.prototype.nextFile=function(){var e=this;this._currentFile++;var t=this._loadList.shift();t.load(function(t){return e.fileLoadComplete(t)},function(t){return e.fileLoadProgress(t)})};t.prototype.fileLoadProgress=function(e){if(this._calculateBytes===true){this._bytesCurrent=e.bytesLoaded;if(this._onProgressCallback){this._onProgressCallback(this.getPercentLoaded(),this.getBytesLoaded(),e)}}};t.prototype.fileLoadComplete=function(e){if(this._calculateBytes===true){this._bytesLoaded+=e.bytesTotal;this._bytesCurrent=0;if(this._onProgressCallback){this._onProgressCallback(this.getPercentLoaded(),this._bytesLoaded,e)}}else{if(this._onProgressCallback){this._onProgressCallback(this.getPercentLoaded(),0,e)}}if(this._loadList.length===0){this._complete=true;if(this._game.debug){console.log("All files have loaded")}if(this._onCompleteCallback){this._onCompleteCallback()}}else{this.nextFile()}};t.prototype.getBytesLoaded=function(){return this._bytesLoaded+this._bytesCurrent};t.prototype.getPercentLoaded=function(){if(this._calculateBytes===true){return Math.round(this.getBytesLoaded()/this._bytesTotal*100)}else{return Math.round(this._currentFile/this._fileTotal*100)}};t.prototype.calculateBytes=function(e){if(e){this._calculateBytes=e}return this._calculateBytes};t.prototype.complete=function(){return this._complete};return t}();t.Loader=n})(e.Files||(e.Files={}));var t=e.Files})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._game=e;this.data={}}t.prototype.objType=function(){return"DataLibrary"};t.prototype.clear=function(){for(var e in this.data){delete this.data[e]}};t.prototype.add=function(t){switch(t.dataType){case e.Files.File.JSON:case e.Files.File.XML:case e.Files.File.BINARY_DATA:case e.Files.File.TEXT_DATA:this.data[t.key]=t;break;default:break}};t.prototype.rebuild=function(e,t){this.clear();if(this._game.debug){console.log("Kiwi.DataLibrary: Rebuilding Data Library")}var n=e.keys;for(var r=0;r<n.length;r++){var i=this._game.fileStore.getFile(n[r]);if(i.isData){if(this._game.debug){console.log("  Kiwi.DataLibrary: Adding Data: "+i.fileName)}t.dataLibrary.add(i)}}};return t}();t.DataLibrary=n})(e.Files||(e.Files={}));var t=e.Files})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(t,n,r,i,s,o){if(typeof i==="undefined"){i=""}if(typeof s==="undefined"){s=true}if(typeof o==="undefined"){o=true}this._xhr=null;this._saveToFileStore=true;this._useTagLoader=true;this.fileSize=0;this.ETag="";this.lastModified="";this.timeStarted=0;this.timeFinished=0;this.duration=0;this.hasError=false;this.success=false;this.onCompleteCallback=null;this.onProgressCallback=null;this.lastProgress=0;this.percentLoaded=0;this.status=0;this.statusText="";this.bytesLoaded=0;this.bytesTotal=0;this.readyState=0;this.timeOutDelay=4e3;this.hasTimedOut=false;this.timedOut=0;this.attemptCounter=0;this.maxLoadAttempts=2;this.maxHeadLoadAttempts=1;this._game=t;this.dataType=n;this.fileURL=r;if(r.lastIndexOf("/")>-1){this.fileName=r.substr(r.lastIndexOf("/")+1);this.filePath=r.substr(0,r.lastIndexOf("/")+1)}else{this.filePath="";this.fileName=r}this.fileExtension=r.substr(r.lastIndexOf(".")+1).toLowerCase();if(e.DEVICE.blob){this._useTagLoader=true}else{this._useTagLoader=true}if(this.dataType===e.Files.File.AUDIO){if(this._game.audio.usingAudioTag===true){this._useTagLoader=true}else{this._useTagLoader=false}}if(this.dataType===e.Files.File.JSON){this._useTagLoader=false}this._saveToFileStore=s;this._fileStore=this._game.fileStore;if(this._game.states.current&&!o){this.ownerState=this._game.states.current}else{this.ownerState=null}if(this.key===""){this.key=this.fileName}else{this.key=i}}t.prototype.objType=function(){return"File"};t.prototype.addTag=function(e){if(this._tags.indexOf(e)==-1){this._tags.push(e)}};t.prototype.removeTag=function(e){var t=this._tags.indexOf(e);if(t!=-1){this._tags.splice(t,1)}};t.prototype.hasTag=function(e){if(this._tags.indexOf(e)==-1){return false}return true};Object.defineProperty(t.prototype,"isTexture",{get:function(){if(this.dataType===t.IMAGE||this.dataType===t.SPRITE_SHEET||this.dataType===t.TEXTURE_ATLAS){return true}return false},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isAudio",{get:function(){if(this.dataType===t.AUDIO){return true}return false},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isData",{get:function(){if(this.dataType===t.XML||this.dataType===t.JSON||this.dataType===t.TEXT_DATA||this.dataType===t.BINARY_DATA){return true}return false},enumerable:true,configurable:true});t.prototype.load=function(e,t,n,r,i){if(typeof e==="undefined"){e=null}if(typeof t==="undefined"){t=null}if(typeof n==="undefined"){n=null}if(this._game.debug){console.log("Kiwi.File: Attempting to load: "+this.fileName)}this.onCompleteCallback=e;this.onProgressCallback=t;if(r!=undefined)this.maxLoadAttempts=r;if(i!=undefined)this.timeOutDelay=i;if(n!==null){this._fileStore=n;this._saveToFileStore=true}this.start();if(this._useTagLoader===true){this.tagLoader()}else{this.xhrLoader()}};t.prototype.start=function(){this.timeStarted=Date.now();this.lastProgress=Date.now();this.percentLoaded=0;this.attemptCounter=0};t.prototype.stop=function(){this.percentLoaded=100;this.timeFinished=Date.now();this.duration=this.timeFinished-this.timeStarted};t.prototype.tagLoader=function(){var t=this;if(this.dataType===e.Files.File.IMAGE||this.dataType===e.Files.File.SPRITE_SHEET||this.dataType===e.Files.File.TEXTURE_ATLAS){this.data=new Image;this.data.src=this.fileURL;this.data.onload=function(e){return t.tagLoaderOnLoad(e)};this.data.onerror=function(e){return t.tagLoaderOnError(e)};this.data.onreadystatechange=function(e){return t.tagLoaderOnReadyStateChange(e)}}else if(this.dataType===e.Files.File.AUDIO){this.data=document.createElement("audio");this.data.src=this.fileURL;this.data.preload="auto";if(this._game.audio.locked){this.tagLoaderAudioLocked()}else{this.data.addEventListener("canplaythrough",function(){return t.tagLoaderProgressThrough(null)},false);if(this._game.deviceTargetOption==e.TARGET_COCOON){this.data.load()}else{this.data.volume=0;this.data.play()}}}};t.prototype.tagLoaderOnReadyStateChange=function(e){};t.prototype.tagLoaderOnError=function(e){this.hasError=true;this.error=e;if(this.onCompleteCallback){this.onCompleteCallback(this)}};t.prototype.tagLoaderProgressThrough=function(t){var n=this;if(this.percentLoaded!==100){if(this.dataType===e.Files.File.AUDIO){this.data.removeEventListener("canplaythrough",function(){return n.tagLoaderProgressThrough(null)});this.data.pause();this.data.currentTime=0;this.data.volume=1}this.tagLoaderOnLoad(null)}};t.prototype.tagLoaderAudioLocked=function(){this.percentLoaded=100;this.tagLoaderOnLoad(null)};t.prototype.tagLoaderOnLoad=function(e){this.stop();if(this._game.debug)console.log("Kiwi.File: Successfully Loaded: "+this.fileName);if(this._saveToFileStore===true){this._fileStore.addFile(this.key,this)}if(this.onCompleteCallback){this.onCompleteCallback(this)}};t.prototype.xhrLoader=function(){var e=this;this.attemptCounter++;this._xhr=new XMLHttpRequest;this._xhr.open("GET",this.fileURL,true);if(this.timeOutDelay!==null)this._xhr.timeout=this.timeOutDelay;this._xhr.responseType="arraybuffer";this._xhr.onloadstart=function(t){return e.xhrOnLoadStart(t)};this._xhr.onprogress=function(t){return e.xhrOnProgress(t)};this._xhr.ontimeout=function(t){return e.xhrOnTimeout(t)};this._xhr.onabort=function(t){return e.xhrOnAbort(t)};this._xhr.onload=function(t){return e.xhrOnLoad(t)};this._xhr.onreadystatechange=function(t){return e.xhrOnReadyStateChange(t)};this._xhr.send()};t.prototype.xhrOnReadyStateChange=function(e){this.readyState=e.target.readyState;if(this.readyState===4){this.xhrOnLoad(e)}};t.prototype.xhrOnLoadStart=function(e){this.timeStarted=e.timeStamp;this.lastProgress=e.timeStamp};t.prototype.xhrOnAbort=function(e){if(this._game.debug)console.log("Kiwi.File: "+this.fileName+" loading was aborted.");this.error=e};t.prototype.xhrOnError=function(e){if(this._game.debug)console.log("Kiwi.File: Error during load: "+this.fileName);this.error=e};t.prototype.xhrOnTimeout=function(e){if(this._game.debug)console.log("Kiwi.File: Timed out: "+this.fileName);this.hasTimedOut=true;this.timedOut=Date.now();this.error=e};t.prototype.xhrOnProgress=function(e){this.bytesLoaded=parseInt(e.loaded);this.bytesTotal=parseInt(e.totalSize);this.percentLoaded=Math.round(this.bytesLoaded/this.bytesTotal*100);if(this.onProgressCallback){this.onProgressCallback(this)}};t.prototype.xhrOnLoad=function(e){if(this.timeFinished>0)return;this.status=this._xhr.status;this.statusText=this._xhr.statusText;if(this._xhr.status===200){this.stop();this.success=true;this.hasError=false;if(this._game.debug)console.log("Kiwi.File: Successfully Loaded: "+this.fileName);this.fileType=this._xhr.getResponseHeader("Content-Type");this.bytesTotal=parseInt(this._xhr.getResponseHeader("Content-Length"));this.lastModified=this._xhr.getResponseHeader("Last-Modified");this.ETag=this._xhr.getResponseHeader("ETag");this.buffer=this._xhr.response;this.processFile()}else{if(this.attemptCounter>=this.maxLoadAttempts){this.success=false;this.hasError=true;if(this._game.debug)console.error("Kiwi.File: "+this.fileName+" wasn't loaded.");this.parseComplete()}else{if(this._game.debug)console.log("Kiwi.File: "+"Retrying to load: "+this.fileName);this.xhrLoader()}}};t.prototype.processFile=function(){switch(this.dataType){case e.Files.File.IMAGE:case e.Files.File.SPRITE_SHEET:case e.Files.File.TEXTURE_ATLAS:this.createBlob();break;case e.Files.File.JSON:this.data="";var t=new Uint8Array(this.buffer);for(var n=0;n<t.length;n++){this.data+=String.fromCharCode(t[n])}this.parseComplete();break;case e.Files.File.AUDIO:if(this._game.audio.usingWebAudio){this.data={raw:this._xhr.response,decoded:false,buffer:null};var r=this;this._game.audio.context.decodeAudioData(this.data.raw,function(e){if(e){r.data.buffer=e;r.data.decoded=true;r.parseComplete()}})}break;default:this.parseComplete()}};t.prototype.createBlob=function(){var e=this;this.data=document.createElement("img");this.data.onload=function(){return e.revoke()};var t="";if(this.fileExtension==="jpg"||this.fileExtension==="jpeg"){t="image/jpeg"}else if(this.fileExtension==="png"){t="image/png"}else if(this.fileExtension==="gif"){t="image/gif"}var n=new window["Blob"]([this.buffer],{type:t});if(window["URL"]){this.data.src=window["URL"].createObjectURL(n)}else if(window["webkitURL"]){this.data.src=window["webkitURL"].createObjectURL(n)}};t.prototype.revoke=function(){if(window["URL"]){window["URL"].revokeObjectURL(this.data.src)}else if(window["webkitURL"]){window["webkitURL"].revokeObjectURL(this.data.src)}this.parseComplete()};t.prototype.parseComplete=function(){if(this._saveToFileStore===true){this._fileStore.addFile(this.key,this)}if(this.onCompleteCallback){this.onCompleteCallback(this)}};t.prototype.getFileDetails=function(e,t,n){if(typeof e==="undefined"){e=null}if(typeof n==="undefined"){n=this.timeOutDelay}this.onCompleteCallback=e;if(this.maxHeadLoadAttempts!==undefined)this.maxHeadLoadAttempts=t;this.attemptCounter=0;this.sendXHRHeadRequest(n)};t.prototype.sendXHRHeadRequest=function(e){var t=this;this.attemptCounter++;this._xhr=new XMLHttpRequest;this._xhr.open("HEAD",this.fileURL,false);this._xhr.onload=function(e){return t.getXHRResponseHeaders(e)};this._xhr.ontimeout=function(e){return t.xhrHeadOnTimeout(e)};this._xhr.onerror=function(e){return t.xhrHeadOnError(e)};if(this.timeOutDelay!==null)this._xhr.timeout=e;this._xhr.send()};t.prototype.xhrHeadOnTimeout=function(e){this.hasTimedOut=true;this.timedOut=Date.now();this.error=e};t.prototype.xhrHeadOnError=function(e){this.hasError=true;this.error=e;this.status=this._xhr.status;this.statusText=this._xhr.statusText};t.prototype.getXHRResponseHeaders=function(e){this.status=this._xhr.status;this.statusText=this._xhr.statusText;if(this._xhr.status===200){this.fileType=this._xhr.getResponseHeader("Content-Type");this.fileSize=parseInt(this._xhr.getResponseHeader("Content-Length"));this.lastModified=this._xhr.getResponseHeader("Last-Modified");this.ETag=this._xhr.getResponseHeader("ETag");this.completeXHRHeadRequest(true)}else{this.completeXHRHeadRequest(false)}};t.prototype.completeXHRHeadRequest=function(e){if(e==false&&this.attemptCounter<this.maxLoadAttempts){this.sendXHRHeadRequest(this.timeOutDelay);return}if(this.onCompleteCallback){this.attemptCounter=0;this.onCompleteCallback(this)}};t.IMAGE=0;t.SPRITE_SHEET=1;t.TEXTURE_ATLAS=2;t.AUDIO=3;t.JSON=4;t.XML=5;t.BINARY_DATA=6;t.TEXT_DATA=7;return t}();t.File=n})(e.Files||(e.Files={}));var t=e.Files})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e){this._size=0;this._game=e;this._files={}}e.prototype.objType=function(){return"FileStore"};e.prototype.boot=function(){};e.prototype.getFile=function(e){return this._files[e]};e.prototype.getFilesByTag=function(e){var t={};for(var n in this._files){if(this._files[n].hasTag(e)){t[n]=this._files[n]}}return t};e.prototype.removeFilesByTag=function(e){var t=0;for(var n in this._files){if(this._files[n].hasTag(e)){this.removeFile(n);t++}}return t};Object.defineProperty(e.prototype,"keys",{get:function(){var e=new Array;for(var t in this._files){e.push(t)}return e},enumerable:true,configurable:true});e.prototype.size=function(){return this._size};e.prototype.addFile=function(e,t){if(!this._files[e]){this._files[e]=t;this._size++;return true}return false};e.prototype.exists=function(e){if(this._files[e]){return true}else{return false}};e.prototype.removeStateFiles=function(e){for(var t in this._files){if(this._files[t].ownerState===e){this.removeFile(t)}}};e.prototype.removeFile=function(e){if(this._files[e]){this._files[e]=null;delete this._files[e];return true}return false};return e}();e.FileStore=t})(e.Files||(e.Files={}));var t=e.Files})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(){this.isReady=false;this.container=null;this.input=null}t.prototype.objType=function(){return"Bootstrap"};t.prototype.boot=function(e,t,n){var r=this;if(typeof t==="undefined"){t=null}if(typeof n==="undefined"){n=true}this._callback=t;this._domParent=e;this._createContainer=n;if(document.readyState==="complete"||document.readyState==="interactive"){this.ready()}else{document.addEventListener("DOMContentLoaded",function(){return r.ready()},false);window.addEventListener("load",function(){return r.ready()},false)}};t.prototype.ready=function(){var e=this;if(this.isReady===true){return}if(!document.body){window.setTimeout(function(){return e.ready()},13)}else{this.isReady=true;if(this._createContainer===true){if(this._domParent===""){this.container=document.createElement("div");this._setupContainer("KiwiGame"+Date.now().toString());document.body.appendChild(this.container)}else{if(document.getElementById(this._domParent)){this.container=document.getElementById(this._domParent);this._setupContainer()}else{this.container=document.createElement("div");this._setupContainer(this._domParent);document.body.appendChild(this.container)}}}if(this._callback!==null){this._callback()}}};t.prototype._setupContainer=function(t){if(typeof t==="undefined"){t=""}if(t){this.container.id=t}this.container.style.width=e.Stage.DEFAULT_WIDTH+"px";this.container.style.height=e.Stage.DEFAULT_HEIGHT+"px";this.container.style.position="relative";this.container.style.overflow="hidden"};return t}();t.Bootstrap=n})(e.System||(e.System={}));var t=e.System})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(){this.iOS=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.webGL=false;this.worker=false;this.blob=false;this.touch=false;this.pointerEnabled=false;this.arora=false;this.chrome=false;this.epiphany=false;this.firefox=false;this.ie=false;this.ieVersion=0;this.ieMobile=false;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.webApp=false;this.audioData=false;this.webaudio=false;this.ogg=false;this.mp3=false;this.wav=false;this.m4a=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this._checkAudio();this._checkBrowser();this._checkDevice();this._checkFeatures();this._checkOS()}e.prototype.objType=function(){return"Device"};e.prototype._checkOS=function(){var e=navigator.userAgent;if(/Android/.test(e)){this.android=true}else if(/CrOS/.test(e)){this.chromeOS=true}else if(/iP[ao]d|iPhone/i.test(e)){this.iOS=true}else if(/Linux/.test(e)){this.linux=true}else if(/Mac OS/.test(e)){this.macOS=true}else if(/Windows Phone/.test(e)){this.windowsPhone=true}else if(/Windows/.test(e)){this.windows=true}};e.prototype._checkFeatures=function(){if(typeof window["Blob"]!=="undefined")this.blob=true;this.canvas=!!window["CanvasRenderingContext2D"];this.webGL=!!window["WebGLRenderingContext"];try{this.localStorage=!!localStorage.getItem}catch(e){this.localStorage=false}this.file=!!window["File"]&&!!window["FileReader"]&&!!window["FileList"]&&!!window["Blob"];this.fileSystem=!!window["requestFileSystem"];this.worker=!!window["Worker"];if("ontouchstart"in document.documentElement||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0){this.touch=true}if(window.navigator.pointerEnabled||window.navigator.msPointerEnabled){this.pointerEnabled=true}};e.prototype._checkBrowser=function(){var e=navigator.userAgent;var t=navigator.appName;if(/Arora/.test(e)){this.arora=true}else if(/Chrome/.test(e)){this.chrome=true}else if(/Epiphany/.test(e)){this.epiphany=true}else if(/Firefox/.test(e)){this.firefox=true}else if(/Mobile Safari/.test(e)){this.mobileSafari=true}else if(/MSIE (\d+\.\d+);/.test(e)){this.ie=true;this.ieVersion=parseInt(RegExp.$1);if(/IEMobile/.test(e)){this.ieMobile=true}}else if(/Trident/.test(e)){this.ie=true;/rv:(\d+\.\d+)\)/.test(e);this.ieVersion=parseInt(RegExp.$1)}else if(/Midori/.test(e)){this.midori=true}else if(/Opera/.test(e)){this.opera=true}else if(/Safari/.test(e)){this.safari=true}if(navigator["standalone"]){this.webApp=true}};e.prototype._checkAudio=function(){this.audioData=!!window["Audio"];this.webaudio=!!(window["webkitAudioContext"]||window["AudioContext"]);var e=document.createElement("audio");var t=false;try{if(t=!!e.canPlayType){if(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){this.ogg=true}if(e.canPlayType("audio/mpeg;").replace(/^no$/,"")){this.mp3=true}if(e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){this.wav=true}if(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,"")){this.m4a=true}}}catch(n){}};e.prototype._checkDevice=function(){this.pixelRatio=window["devicePixelRatio"]||1;this.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;this.iPhone4=this.pixelRatio==2&&this.iPhone;this.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1};e.prototype.getAll=function(){var e="";e=e.concat("Device\n");e=e.concat("iPhone : "+this.iPhone+"\n");e=e.concat("iPhone4 : "+this.iPhone4+"\n");e=e.concat("iPad : "+this.iPad+"\n");e=e.concat("\n");e=e.concat("Operating System\n");e=e.concat("iOS: "+this.iOS+"\n");e=e.concat("Android: "+this.android+"\n");e=e.concat("ChromeOS: "+this.chromeOS+"\n");e=e.concat("Linux: "+this.linux+"\n");e=e.concat("MacOS: "+this.macOS+"\n");e=e.concat("Windows: "+this.windows+"\n");e=e.concat("\n");e=e.concat("Browser\n");e=e.concat("Arora: "+this.arora+"\n");e=e.concat("Chrome: "+this.chrome+"\n");e=e.concat("Epiphany: "+this.epiphany+"\n");e=e.concat("Firefox: "+this.firefox+"\n");e=e.concat("Internet Explorer: "+this.ie+" ("+this.ieVersion+")\n");e=e.concat("Mobile Safari: "+this.mobileSafari+"\n");e=e.concat("Midori: "+this.midori+"\n");e=e.concat("Opera: "+this.opera+"\n");e=e.concat("Safari: "+this.safari+"\n");e=e.concat("\n");e=e.concat("Features\n");e=e.concat("Blob: "+this.blob+"\n");e=e.concat("Canvas: "+this.canvas+"\n");e=e.concat("File: "+this.file+"\n");e=e.concat("FileSystem: "+this.fileSystem+"\n");e=e.concat("LocalStorage: "+this.localStorage+"\n");e=e.concat("WebGL: "+this.webGL+"\n");e=e.concat("Worker: "+this.worker+"\n");e=e.concat("Touch: "+this.touch+"\n");e=e.concat("\n");e=e.concat("Audio\n");e=e.concat("Audio Data: "+this.canvas+"\n");e=e.concat("Web Audio: "+this.canvas+"\n");e=e.concat("Can play OGG: "+this.canvas+"\n");e=e.concat("Can play MP3: "+this.canvas+"\n");e=e.concat("Can play M4A: "+this.canvas+"\n");e=e.concat("Can play WAV: "+this.canvas+"\n");return e};return e}();e.Device=t})(e.System||(e.System={}));var t=e.System})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e,t,n,r,i){this.dirty=false;this.cellIndex=0;this.name=e;this.cells=n||new Array;this.sequences=i||new Array;this.image=r;this._type=t}t.prototype.objType=function(){return"TextureAtlas"};Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:true,configurable:true});t.prototype.refreshTextureGL=function(e){if(this.glTextureWrapper)this.glTextureWrapper.refreshTexture(e);this.dirty=false};t.prototype.readJSON=function(t){var n=JSON.parse(t);if(n.name!==undefined)this.name=n.name;for(var r=0;r<n.cells.length;r++){this.cells.push(n.cells[r]);if(n.cells[r].hitboxes===undefined){this.cells[r].hitboxes=new Array;this.cells[r].hitboxes.push({x:0,y:0,w:this.cells[r].w,h:this.cells[r].h})}}if(n.sequences){for(var r=0;r<n.sequences.length;r++){var i=new e.Animations.Sequence(n.sequences[r].name,n.sequences[r].cells);if(n.sequences[r].speed!==undefined)i.speed=n.sequences[r].speed;if(n.sequences[r].loop!==undefined)i.loop=n.sequences[r].loop;this.sequences.push(i)}}};t.SINGLE_IMAGE=0;t.SPRITE_SHEET=1;t.TEXTURE_ATLAS=2;return t}();t.TextureAtlas=n})(e.Textures||(e.Textures={}));var t=e.Textures})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._game=e;this.textures=new Object}t.prototype.objType=function(){return"TextureLibrary"};t.prototype.clear=function(){for(var e in this.textures){delete this.textures[e]}};t.prototype.add=function(t){this.textures[t.name]=t;if(this._game.renderOption===e.RENDERER_WEBGL){if(e.Utils.Common.base2Sizes.indexOf(t.image.width)==-1||e.Utils.Common.base2Sizes.indexOf(t.image.height)==-1){console.log("Kiwi.TextureLibrary: Warning:Image is not of base2 size and may not render correctly.")}var n=this._game.renderer;n.addTexture(this._game.stage.gl,t)}};t.prototype.addFromFile=function(t){if(this._game.renderOption===e.RENDERER_WEBGL&&this._game.deviceTargetOption!=e.TARGET_COCOON){t=this._rebuildImage(t)}switch(t.dataType){case e.Files.File.SPRITE_SHEET:this.textures[t.key]=this._buildSpriteSheet(t);break;case e.Files.File.IMAGE:this.textures[t.key]=this._buildImage(t);break;case e.Files.File.TEXTURE_ATLAS:this.textures[t.key]=this._buildTextureAtlas(t);break;default:break}};t.prototype._rebuildImage=function(t){var n=e.Utils.Common.convertToBase2(t.data);if(t.data.width!==n.width||t.data.height!==n.height){if(t.dataType===e.Files.File.SPRITE_SHEET){if(!t.metadata.rows)t.metadata.rows=t.data.height/t.metadata.frameHeight;if(!t.metadata.cols)t.metadata.cols=t.data.width/t.metadata.frameWidth}else if(t.dataType===e.Files.File.IMAGE){if(!t.metadata.width)t.metadata.width=t.data.width;if(!t.metadata.height)t.metadata.height=t.data.height}if(this._game.debug)console.log("Kiwi.TextureLibrary: "+t.fileName+" has been rebuilt to be base2.");t.data=n}return t};t.prototype._buildTextureAtlas=function(t){var n=new e.Textures.TextureAtlas(t.key,e.Textures.TextureAtlas.TEXTURE_ATLAS,null,t.data);var r=t.metadata;var i=this._game.fileStore.getFile(r.jsonID).data;i.trim();n.readJSON(i);return n};t.prototype._buildSpriteSheet=function(t){var n=t.metadata;var r=new e.Textures.SpriteSheet(t.key,t.data,n.frameWidth,n.frameHeight,n.numCells,n.rows,n.cols,n.sheetOffsetX,n.sheetOffsetY,n.cellOffsetX,n.cellOffsetY);return r};t.prototype._buildImage=function(t){var n=t.metadata;return new e.Textures.SingleImage(t.key,t.data,n.width,n.height,n.offsetX,n.offsetY)};t.prototype.rebuild=function(e,t){this.clear();if(this._game.debug){console.log("Kiwi.TextureLibrary: Rebuilding Texture Library")}var n=e.keys;for(var r=0;r<n.length;r++){var i=this._game.fileStore.getFile(n[r]);if(i.isTexture){if(this._game.debug){console.log("  Kiwi.TextureLibrary: Adding Texture: "+i.fileName)}t.textureLibrary.addFromFile(i)}}};return t}();t.TextureLibrary=n})(e.Textures||(e.Textures={}));var t=e.Textures})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r,i,s,o,u,a,f,l,c,h){this.cellWidth=i;this.cellHeight=s;this._cols=a||r.width/i;this._rows=u||r.height/s;this.numCells=o||this.cols*this.rows;this.sheetOffsetX=f||0;this.sheetOffsetY=l||0;this.cellOffsetX=c||0;this.cellOffsetY=h||0;t.call(this,n,e.Textures.TextureAtlas.SPRITE_SHEET,this.generateAtlasCells(),r,this.sequences)}__extends(n,t);n.prototype.objType=function(){return"SpriteSheet"};Object.defineProperty(n.prototype,"rows",{get:function(){return this._rows},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"cols",{get:function(){return this._cols},enumerable:true,configurable:true});n.prototype.generateAtlasCells=function(){var t=new Array;var n=new Array;var r=this.sheetOffsetX;var i=this.sheetOffsetY;var s=0;for(var o=0;o<this.rows;o++){for(var u=0;u<this.cols;u++){t.push({x:r,y:i,w:this.cellWidth,h:this.cellHeight,hitboxes:[{x:0,y:0,w:this.cellWidth,h:this.cellHeight}]});n.push(s++);r+=this.cellOffsetX+this.cellWidth}r=this.sheetOffsetX;i+=this.cellOffsetY+this.cellHeight}this.sequences=new Array;this.sequences.push(new e.Animations.Sequence("default",n));return t};return n}(t.TextureAtlas);t.SpriteSheet=n})(e.Textures||(e.Textures={}));var t=e.Textures})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(t){function n(n,r,i,s,o,u){this.width=i||r.width;this.height=s||r.height;this.offsetX=o||0;this.offsetY=u||0;t.call(this,n,e.Textures.TextureAtlas.SINGLE_IMAGE,this.generateAtlasCells(),r)}__extends(n,t);n.prototype.objType=function(){return"SingleImage"};n.prototype.generateAtlasCells=function(){return[{x:this.offsetX,y:this.offsetY,w:this.width,h:this.height,hitboxes:[{x:0,y:0,w:this.width,h:this.height}]}]};return n}(t.TextureAtlas);t.SingleImage=n})(e.Textures||(e.Textures={}));var t=e.Textures})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Back"};e.In=function(e){var t=1.70158;return e*e*((t+1)*e-t)};e.Out=function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1};e.InOut=function(e){var t=1.70158*1.525;if((e*=2)<1)return.5*e*e*((t+1)*e-t);return.5*((e-=2)*e*((t+1)*e+t)+2)};return e}();e.Back=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){(function(t){var n=function(){function t(){}t.prototype.objType=function(){return"Bounce"};t.In=function(t){return 1-e.Animations.Tweens.Easing.Bounce.Out(1-t)};t.Out=function(e){if(e<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.75}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}};t.InOut=function(t){if(t<.5)return e.Animations.Tweens.Easing.Bounce.In(t*2)*.5;return e.Animations.Tweens.Easing.Bounce.Out(t*2-1)*.5+.5};return t}();t.Bounce=n})(t.Easing||(t.Easing={}));var n=t.Easing})(t.Tweens||(t.Tweens={}));var n=t.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Circular"};e.In=function(e){return 1-Math.sqrt(1-e*e)};e.Out=function(e){return Math.sqrt(1- --e*e)};e.InOut=function(e){if((e*=2)<1)return-.5*(Math.sqrt(1-e*e)-1);return.5*(Math.sqrt(1-(e-=2)*e)+1)};return e}();e.Circular=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Cubic"};e.In=function(e){return e*e*e};e.Out=function(e){return--e*e*e+1};e.InOut=function(e){if((e*=2)<1)return.5*e*e*e;return.5*((e-=2)*e*e+2)};return e}();e.Cubic=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Elastic"};e.In=function(e){var t,n=.1,r=.4;if(e===0)return 0;if(e===1)return 1;if(!n||n<1){n=1;t=r/4}else t=r*Math.asin(1/n)/(2*Math.PI);return-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r))};e.Out=function(e){var t,n=.1,r=.4;if(e===0)return 0;if(e===1)return 1;if(!n||n<1){n=1;t=r/4}else t=r*Math.asin(1/n)/(2*Math.PI);return n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/r)+1};e.InOut=function(e){var t,n=.1,r=.4;if(e===0)return 0;if(e===1)return 1;if(!n||n<1){n=1;t=r/4}else t=r*Math.asin(1/n)/(2*Math.PI);if((e*=2)<1)return-.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r);return n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)*.5+1};return e}();e.Elastic=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Exponential"};e.In=function(e){return e===0?0:Math.pow(1024,e-1)};e.Out=function(e){return e===1?1:1-Math.pow(2,-10*e)};e.InOut=function(e){if(e===0)return 0;if(e===1)return 1;if((e*=2)<1)return.5*Math.pow(1024,e-1);return.5*(-Math.pow(2,-10*(e-1))+2)};return e}();e.Exponential=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Linear"};e.None=function(e){return e};return e}();e.Linear=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Quadratic"};e.In=function(e){return e*e};e.Out=function(e){return e*(2-e)};e.InOut=function(e){if((e*=2)<1)return.5*e*e;return-.5*(--e*(e-2)-1)};return e}();e.Quadratic=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Quartic"};e.In=function(e){return e*e*e*e};e.Out=function(e){return 1- --e*e*e*e};e.InOut=function(e){if((e*=2)<1)return.5*e*e*e*e;return-.5*((e-=2)*e*e*e-2)};return e}();e.Quartic=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Quintic"};e.In=function(e){return e*e*e*e*e};e.Out=function(e){return--e*e*e*e*e+1};e.InOut=function(e){if((e*=2)<1)return.5*e*e*e*e*e;return.5*((e-=2)*e*e*e*e+2)};return e}();e.Quintic=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Sinusoidal"};e.In=function(e){return 1-Math.cos(e*Math.PI/2)};e.Out=function(e){return Math.sin(e*Math.PI/2)};e.InOut=function(e){return.5*(1-Math.cos(Math.PI*e))};return e}();e.Sinusoidal=t})(e.Easing||(e.Easing={}));var t=e.Easing})(e.Tweens||(e.Tweens={}));var t=e.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(){function t(e){this._game=e;this._tweens=[]}t.prototype.objType=function(){return"TweenManager"};t.prototype.getAll=function(){return this._tweens};t.prototype.removeAll=function(){this._tweens.length=0};t.prototype.create=function(t){return new e.Animations.Tween(t,this._game)};t.prototype.add=function(e){e.setParent(this._game);this._tweens.push(e);return e};t.prototype.remove=function(e){var t=this._tweens.indexOf(e);if(t!==-1){this._tweens.splice(t,1)}};t.prototype.update=function(){if(this._tweens.length===0){return false}var e=0;var t=this._tweens.length;while(e<t){if(this._tweens[e].update(this._game.time.now())){e++}else{this._tweens.splice(e,1);t--}}return true};return t}();t.TweenManager=n})(t.Tweens||(t.Tweens={}));var n=t.Tweens})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(t,n){if(typeof n==="undefined"){n=null}this._game=null;this._manager=null;this._object=null;this._valuesStart={};this._valuesEnd={};this._duration=1e3;this._delayTime=0;this._startTime=null;this._easingFunction=e.Animations.Tweens.Easing.Linear.None;this._interpolationFunction=e.Utils.GameMath.linearInterpolation;this._chainedTweens=[];this._onStartCallback=null;this._onStartContext=null;this._onStartCallbackFired=false;this._onUpdateCallback=null;this._onUpdateContext=null;this._onCompleteCallback=null;this._onCompleteCalled=false;this._onCompleteContext=null;this.isRunning=false;this._object=t;if(n!==null){this._game=n;this._manager=this._game.tweens}this.isRunning=false}t.prototype.objType=function(){return"Tween"};t.prototype.to=function(e,t,n,r){if(typeof t==="undefined"){t=1e3}if(typeof n==="undefined"){n=null}if(typeof r==="undefined"){r=false}this._duration=t;this._valuesEnd=e;if(n!==null){this._easingFunction=n}if(r===true){return this.start()}else{return this}};t.prototype.start=function(){if(this._game===null||this._object===null){return}this.isRunning=true;this._manager.add(this);this._onStartCallbackFired=false;this._onCompleteCalled=false;this._startTime=this._game.time.now()+this._delayTime;for(var e in this._valuesEnd){if(this._object[e]===null||!(e in this._object)){continue}if(this._valuesEnd[e]instanceof Array){if(this._valuesEnd[e].length===0){continue}this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}if(typeof this._object[e]==="function"){this._valuesStart[e]=this._object[e]()}else{this._valuesStart[e]=this._object[e]}}return this};t.prototype.stop=function(){if(this._manager!==null){this._manager.remove(this)}this.isRunning=false;return this};t.prototype.setParent=function(e){this._game=e;this._manager=this._game.tweens};t.prototype.delay=function(e){this._delayTime=e;return this};t.prototype.easing=function(e){this._easingFunction=e;return this};t.prototype.interpolation=function(e){this._interpolationFunction=e;return this};t.prototype.chain=function(e){this._chainedTweens.push(e);return this};t.prototype.onStart=function(e,t){this._onStartCallback=e;this._onStartContext=t;return this};t.prototype.onUpdate=function(e,t){this._onUpdateCallback=e;this._onUpdateContext=t;return this};t.prototype.onComplete=function(e,t){this._onCompleteCallback=e;this._onCompleteContext=t;return this};t.prototype.update=function(e){if(e<this._startTime){return true}if(this._onStartCallbackFired===false){if(this._onStartCallback!==null){this._onStartCallback.call(this._onStartContext,this._object)}this._onStartCallbackFired=true}var t=(e-this._startTime)/this._duration;t=t>1?1:t;var n=this._easingFunction(t);for(var r in this._valuesStart){var i=this._valuesStart[r];var s=this._valuesEnd[r];if(s instanceof Array){this._object[r]=this._interpolationFunction(s,n)}else{if(typeof this._object[r]==="function"){this._object[r](i+(s-i)*n)}else{this._object[r]=i+(s-i)*n}}}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateContext,this._object,n)}if(t==1){this.isRunning=false;if(this._onCompleteCallback!==null&&this._onCompleteCalled==false){this._onCompleteCalled=true;this._onCompleteCallback.call(this._onCompleteContext,this._object)}for(var o=0;o<this._chainedTweens.length;o++){this._chainedTweens[o].start()}return false}return true};return t}();t.Tween=n})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this.numDrawCalls=0;this._game=e}t.prototype.boot=function(){};t.prototype.objType=function(){return"CanvasRenderer"};t.prototype._recurse=function(t){if(!t.visible)return;if(t.childType()===e.GROUP){for(var n=0;n<t.members.length;n++){this._recurse(t.members[n])}}else{this.numDrawCalls++;t.render(this._currentCamera)}};t.prototype.requestRendererInstance=function(e,t){if(typeof t==="undefined"){t=null}return null};t.prototype.requestSharedRenderer=function(e,t){if(typeof t==="undefined"){t=null}return null};t.prototype.initState=function(e){};t.prototype.endState=function(e){};t.prototype.render=function(e){var t=this._game.states.current.members;this._game.stage.ctx.fillStyle="#"+this._game.stage.color;this._game.stage.ctx.fillRect(0,0,this._game.stage.canvas.width,this._game.stage.canvas.height);if(t.length==0){console.log("nothing to render");return}this.numDrawCalls=0;this._currentCamera=e;var n=e.transform.getConcatenatedMatrix();var r=e.transform;this._game.stage.ctx.save();this._game.stage.ctx.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty);this._game.stage.ctx.transform(1,0,0,1,-r.rotPointX,-r.rotPointY);for(var i=0;i<t.length;i++){this._recurse(t[i])}this._game.stage.ctx.restore()};return t}();t.CanvasRenderer=n})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function n(e){this._currentRenderer=null;this._entityCount=0;this.numDrawCalls=0;this._maxItems=1e3;this._currentTextureAtlas=null;this._sharedRenderers={};this._game=e;if(typeof mat4==="undefined"){throw"ERROR: gl-matrix.js is missing"}}n.prototype.boot=function(){this._textureManager=new t.GLTextureManager;this._shaderManager=new e.Shaders.ShaderManager;this._init()};n.prototype.objType=function(){return"GLRenderManager"};n.prototype.addTexture=function(e,t){this._textureManager.uploadTexture(e,t)};n.prototype.addSharedRenderer=function(t,n){if(typeof n==="undefined"){n=null}if(e.Renderers[t]){if(!(t in this._sharedRenderers)){this._sharedRenderers[t]=new e.Renderers[t](this._game.stage.gl,this._shaderManager,n);return true}}return false};n.prototype.requestSharedRenderer=function(e,t){if(typeof t==="undefined"){t=null}var n=this._sharedRenderers[e];if(n){return n}else{if(this.addSharedRenderer(e,t)){return this._sharedRenderers[e]}else{console.log("no renderer called "+e)}}return null};n.prototype.requestRendererInstance=function(t,n){if(typeof n==="undefined"){n=null}if(t in e.Renderers){var r=new e.Renderers[t](this._game.stage.gl,this._shaderManager,n);return r}else{console.log("No renderer with id "+t+" exists")}return null};n.prototype._init=function(){console.log("Intialising WebGL");var e=this._game.stage.gl;this._stageResolution=new Float32Array([this._game.stage.width,this._game.stage.height]);e.viewport(0,0,this._game.stage.width,this._game.stage.height);e.enable(e.BLEND);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE);this._shaderManager.init(e,"TextureAtlasShader");this.camMatrix=mat3.create();this._game.stage.onResize.add(function(t,n){this._stageResolution=new Float32Array([t,n]);if(this.currentRenderer)this._currentRenderer.updateStageResolution(e,this._stageResolution);e.viewport(0,0,t,n)},this)};n.prototype.initState=function(e){this._textureManager.clearTextures(this._game.stage.gl);this._textureManager.uploadTextureLibrary(this._game.stage.gl,e.textureLibrary)};n.prototype.endState=function(e){this._textureManager.clearTextures(this._game.stage.gl);console.log("ending WebGL on State")};n.prototype.render=function(e){var t=this._game.stage.gl;var n=this._game.stage.normalizedColor;t.clearColor(n.r,n.g,n.b,n.a);t.clear(t.COLOR_BUFFER_BIT);if(this._game.states.current.members.length==0){console.log("nothing to render");return}this.numDrawCalls=0;this._textureManager.numTextureWrites=0;this._entityCount=0;var r=e.transform.getConcatenatedMatrix();var i=e.transform;var s=vec2.create();var o=vec2.create();var u=vec2.create();vec2.set(o,i.scaleX,i.scaleY);vec2.set(s,-i.rotPointX,-i.rotPointY);vec2.set(u,r.tx,r.ty);mat3.identity(this.camMatrix);mat3.translate(this.camMatrix,this.camMatrix,u);mat3.rotate(this.camMatrix,this.camMatrix,i.rotation);mat3.scale(this.camMatrix,this.camMatrix,o);mat3.translate(this.camMatrix,this.camMatrix,s);this.collateRenderSequence();this.collateBatches();this.renderBatches(t,e)};n.prototype.collateRenderSequence=function(){this._sequence=[];var e=this._game.states.current;this.collateChild(e)};n.prototype.collateChild=function(t){if(!t.visible)return;if(t.childType()===e.GROUP){for(var n=0;n<t.members.length;n++){this.collateChild(t.members[n])}}else{var r=t;this._sequence.push({entity:r,renderer:r.glRenderer,shader:r.glRenderer.shaderPair,isBatchRenderer:r.glRenderer.isBatchRenderer,texture:r.atlas})}};n.prototype.collateBatches=function(){var e=null;var t=null;var n=null;this._batches=[];var r;for(var i=0;i<this._sequence.length;i++){if(!this._sequence[i].isBatchRenderer||this._sequence[i].renderer!==e||this._sequence[i].shader!==t||this._sequence[i].texture!==n){var r=this._batches.push(new Array)-1;e=this._sequence[i].renderer;t=this._sequence[i].shader;n=this._sequence[i].texture}this._batches[r].push(this._sequence[i])}};n.prototype.renderBatches=function(e,t){for(var n=0;n<this._batches.length;n++)this.renderBatch(e,this._batches[n],t)};n.prototype.renderBatch=function(e,t,n){if(t[0].entity.glRenderer!==this._currentRenderer)this._switchRenderer(e,t[0].entity);this._currentRenderer.clear(e,{camMatrix:this.camMatrix});for(var r=0;r<t.length;r++)t[r].entity.renderGL(e,n);if(t[0].entity.atlas!==this._currentTextureAtlas||t[0].entity.atlas.dirty)this._switchTexture(e,t[0].entity);this._currentRenderer.draw(e)};n.prototype.renderEntity=function(e,t,n){this.renderBatch(e,[t],n)};n.prototype.setupGLState=function(e,t){if(t.atlas!==this._currentTextureAtlas)this._switchTexture(e,t);if(t.glRenderer!==this._currentRenderer)this._switchRenderer(e,t)};n.prototype._switchRenderer=function(e,t){if(this._currentRenderer)this._currentRenderer.disable(e);this._currentRenderer=t.glRenderer;this._currentRenderer.enable(e,{camMatrix:this.camMatrix,stageResolution:this._stageResolution,textureAtlas:this._currentTextureAtlas})};n.prototype._switchTexture=function(e,t){this._currentTextureAtlas=t.atlas;if(this._currentRenderer)this._currentRenderer.updateTextureSize(e,new Float32Array([this._currentTextureAtlas.glTextureWrapper.image.width,this._currentTextureAtlas.glTextureWrapper.image.height]));this._textureManager.useTexture(e,t.atlas.glTextureWrapper);this._currentTextureAtlas.refreshTextureGL(e)};return n}();t.GLRenderManager=n})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(){this._shaderPairs={}}Object.defineProperty(t.prototype,"currentShader",{get:function(){return this._currentShader},enumerable:true,configurable:true});t.prototype.init=function(e,t){this._currentShader=this.requestShader(e,t)};t.prototype.requestShader=function(e,t,n){if(typeof n==="undefined"){n=true}var r;if(t in this._shaderPairs){r=this._shaderPairs[t];if(!r.loaded){this._loadShader(e,r)}if(n)this._useShader(e,r);return r}else{if(this.shaderExists){r=this._addShader(e,t);this._loadShader(e,r);if(n)this._useShader(e,r);return r}else{console.log("Shader "+t+" does not exist")}}return null};t.prototype.shaderExists=function(t,n){return n in e.Shaders};t.prototype._addShader=function(t,n){this._shaderPairs[n]=new e.Shaders[n];return this._shaderPairs[n]};t.prototype._loadShader=function(e,t){t.init(e)};t.prototype._useShader=function(e,t){if(t!==this._currentShader){this._currentShader=t}e.useProgram(t.shaderProgram)};return t}();t.ShaderManager=n})(e.Shaders||(e.Shaders={}));var t=e.Shaders})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e,t,n){if(typeof n==="undefined"){n=false}this._created=false;this._uploaded=false;this.textureAtlas=t;this.image=t.image;this._numBytes=this.image.width*this.image.height*4;this.createTexture(e);if(n)this.uploadTexture(e)}Object.defineProperty(e.prototype,"numBytes",{get:function(){return this._numBytes},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"created",{get:function(){return this._created},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"uploaded",{get:function(){return this._uploaded},enumerable:true,configurable:true});e.prototype.createTexture=function(e){this.texture=e.createTexture();this._created=true;return true};e.prototype.uploadTexture=function(e){var t=false;if(!this.created){this.createTexture(e)}if(this.uploaded){console.log("...not uploading:the image is already uploaded")}else{e.bindTexture(e.TEXTURE_2D,this.texture);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(e.TEXTURE_2D,null);this._uploaded=true;t=true}return t};e.prototype.refreshTexture=function(e){this.numBytes=this.image.width*this.image.height*4;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image)};e.prototype.deleteTexture=function(e){e.deleteTexture(this.texture);this._uploaded=false;this._created=false;return true};return e}();e.GLTextureWrapper=t})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function t(){this.numTextureWrites=0;this._numTexturesUsed=0;this._usedTextureMem=0;this.maxTextureMem=t.DEFAULT_MAX_TEX_MEM_MB*1024*1024;this._textureWrapperCache=new Array}Object.defineProperty(t.prototype,"usedTextureMem",{get:function(){return this._usedTextureMem},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"numTexturesUsed",{get:function(){return this._numTexturesUsed},enumerable:true,configurable:true});t.prototype._addTextureToCache=function(e){this._textureWrapperCache.push(e)};t.prototype._deleteTexture=function(e,t){this._textureWrapperCache[t].deleteTexture(e);this._usedTextureMem-=this._textureWrapperCache[t].numBytes;this._numTexturesUsed--};t.prototype._uploadTexture=function(e,t){if(t.numBytes+this._usedTextureMem<=this.maxTextureMem){t.uploadTexture(e);this._usedTextureMem+=t.numBytes;this._numTexturesUsed++;return true}return false};t.prototype.uploadTextureLibrary=function(e,t){this._textureWrapperCache=new Array;for(var n in t.textures){this.uploadTexture(e,t.textures[n])}};t.prototype.uploadTexture=function(t,n){var r=new e.GLTextureWrapper(t,n);this._addTextureToCache(r);n.glTextureWrapper=r;if(!this._uploadTexture(t,r)){console.log("...skipped uploading texture due to allocated texture memory exceeded")}};t.prototype.clearTextures=function(e){for(var t=0;t<this._textureWrapperCache.length;t++){this._deleteTexture(e,t);this._textureWrapperCache[t].textureAtlas.glTextureWrapper=null}this._textureWrapperCache=new Array};t.prototype.useTexture=function(e,t){if(!t.created||!t.uploaded){if(!this._uploadTexture(e,t)){this._freeSpace(e,t.numBytes);this._uploadTexture(e,t)}this.numTextureWrites++}if(t.created&&t.uploaded){e.bindTexture(e.TEXTURE_2D,t.texture);return true}return false};t.prototype._freeSpace=function(e,t){var n=99999999999;var r=-1;for(var i=0;i<this._textureWrapperCache.length;i++){var s=this._textureWrapperCache[i].numBytes;if(s===t&&this._textureWrapperCache[i].uploaded){this._deleteTexture(e,i);return true}else if(s>t&&s<n){n=s;r=i}}return true};t.DEFAULT_MAX_TEX_MEM_MB=1024;return t}();e.GLTextureManager=t})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(t,n,r,i){if(typeof i==="undefined"){i=true}this._created=false;this._uploaded=false;this.items=r||e.squareVertices;this.itemSize=n||2;this.numItems=this.items.length/this.itemSize;this.createBuffer(t);if(i){this.uploadBuffer(t,this.items)}}Object.defineProperty(e.prototype,"created",{get:function(){return this._created},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"uploaded",{get:function(){return this._uploaded},enumerable:true,configurable:true});e.prototype.clear=function(){this.items=new Array};e.prototype.createBuffer=function(e){this.buffer=e.createBuffer();this._created=true;return true};e.prototype.uploadBuffer=function(e,t){this.items=t;this.numItems=this.items.length/this.itemSize;var n=new Float32Array(this.items);e.bindBuffer(e.ARRAY_BUFFER,this.buffer);e.bufferData(e.ARRAY_BUFFER,n,e.DYNAMIC_DRAW);this._uploaded=true;return true};e.prototype.deleteBuffer=function(e){e.bindBuffer(e.ARRAY_BUFFER,this.buffer);e.deleteBuffer(this.buffer);this.uploaded=false;this.created=false;return true};e.squareVertices=[0,0,100,0,100,100,0,100];e.squareUVs=[0,0,.1,0,.1,.1,0,.1];e.squareCols=[1,1,1,1];return e}();e.GLArrayBuffer=t})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(t,n,r,i){if(typeof i==="undefined"){i=true}this.indices=r||e.square;this.itemSize=n||1;this.numItems=this.indices.length/this.itemSize;if(i){this.buffer=this.init(t)}}e.prototype.clear=function(){this.indices=new Array};e.prototype.init=function(e){var t=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),e.STATIC_DRAW);return t};e.prototype.refresh=function(e,t){this.numItems=this.indices.length/this.itemSize;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),e.STATIC_DRAW);return this.buffer};e.square=[0,1,2,0,2,3];return e}();e.GLElementArrayBuffer=t})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e,t,n){if(typeof n==="undefined"){n=false}this.loaded=false;this._isBatchRenderer=false;this.shaderManager=t;this._isBatchRenderer=n;this.loaded=true}e.prototype.enable=function(e,t){if(typeof t==="undefined"){t=null}};e.prototype.disable=function(e){};e.prototype.clear=function(e,t){};e.prototype.draw=function(e){};e.prototype.updateStageResolution=function(e,t){};e.prototype.updateTextureSize=function(e,t){};Object.defineProperty(e.prototype,"isBatchRenderer",{get:function(){return this._isBatchRenderer},enumerable:true,configurable:true});e.RENDERER_ID="Renderer";return e}();e.Renderer=t})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(n){function r(e,r,i){if(typeof i==="undefined"){i=null}n.call(this,e,r,true);this._maxItems=1e3;var s=5;this._vertexBuffer=new t.GLArrayBuffer(e,s);var o=6;this._indexBuffer=new t.GLElementArrayBuffer(e,1,this._generateIndices(this._maxItems*o));this.shaderPair=this.shaderManager.requestShader(e,"TextureAtlasShader")}__extends(r,n);r.prototype.enable=function(e,t){if(typeof t==="undefined"){t=null}this.shaderPair=this.shaderManager.requestShader(e,"TextureAtlasShader");e.uniform1i(this.shaderPair.uniforms.uSampler.location,0);e.uniform2fv(this.shaderPair.uniforms.uResolution.location,t.stageResolution);e.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,false,t.camMatrix)};r.prototype.disable=function(e){e.disableVertexAttribArray(this.shaderPair.attributes.aXYUV);e.disableVertexAttribArray(this.shaderPair.attributes.aAlpha)};r.prototype.clear=function(e,t){this._vertexBuffer.clear();e.uniformMatrix3fv(this.shaderPair.uniforms.uCamMatrix.location,false,t.camMatrix)};r.prototype.draw=function(e){this._vertexBuffer.uploadBuffer(e,this._vertexBuffer.items);e.enableVertexAttribArray(this.shaderPair.attributes.aXYUV);e.vertexAttribPointer(this.shaderPair.attributes.aXYUV,4,e.FLOAT,false,20,0);e.enableVertexAttribArray(this.shaderPair.attributes.aAlpha);e.vertexAttribPointer(this.shaderPair.attributes.aAlpha,1,e.FLOAT,false,20,16);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer.buffer);e.drawElements(e.TRIANGLES,this._vertexBuffer.items.length/20*6,e.UNSIGNED_SHORT,0)};r.prototype._generateIndices=function(e){var t=new Array;for(var n=0;n<e;n++){t.push(n*4+0,n*4+1,n*4+2,n*4+0,n*4+2,n*4+3)}return t};r.prototype.updateStageResolution=function(e,t){e.uniform2fv(this.shaderPair.uniforms.uResolution.location,t)};r.prototype.updateTextureSize=function(e,t){e.uniform2fv(this.shaderPair.uniforms.uTextureSize.location,t)};r.prototype.addToBatch=function(t,n,r){if(n.alpha<=0)return;var i=n.transform;var s=i.getConcatenatedMatrix();var o=n.atlas.cells[n.cellIndex];var u=new e.Geom.Point(0-i.rotPointX,0-i.rotPointY);var a=new e.Geom.Point(o.w-i.rotPointX,0-i.rotPointY);var f=new e.Geom.Point(o.w-i.rotPointX,o.h-i.rotPointY);var l=new e.Geom.Point(0-i.rotPointX,o.h-i.rotPointY);u=s.transformPoint(u);a=s.transformPoint(a);f=s.transformPoint(f);l=s.transformPoint(l);this._vertexBuffer.items.push(u.x,u.y,o.x,o.y,n.alpha,a.x,a.y,o.x+o.w,o.y,n.alpha,f.x,f.y,o.x+o.w,o.y+o.h,n.alpha,l.x,l.y,o.x,o.y+o.h,n.alpha)};r.prototype.concatBatch=function(e){this._vertexBuffer.items=this._vertexBuffer.items.concat(e)};r.RENDERER_ID="TextureAtlasRenderer";return r}(t.Renderer);t.TextureAtlasRenderer=n})(e.Renderers||(e.Renderers={}));var t=e.Renderers})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(){this.loaded=false}e.prototype.init=function(e){this.vertShader=this.compile(e,this.vertSource.join("\n"),e.VERTEX_SHADER);this.fragShader=this.compile(e,this.fragSource.join("\n"),e.FRAGMENT_SHADER);this.shaderProgram=this.attach(e,this.vertShader,this.fragShader);this.loaded=true};e.prototype.attach=function(e,t,n){var r=e.createProgram();e.attachShader(r,n);e.attachShader(r,t);e.linkProgram(r);return r};e.prototype.compile=function(e,t,n){var r=e.createShader(n);e.shaderSource(r,t);e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS)){return null}return r};e.prototype.setParam=function(e,t){this.uniforms[e].value=t;this.uniforms[e].dirty=true};e.prototype.applyUniforms=function(e){for(var t in this.uniforms){this.applyUniform(e,t)}};e.prototype.applyUniform=function(e,t){var n=this.uniforms[t];if(this.uniforms[t].dirty){console.log(t);e["uniform"+n.type](n.location,n.value);this.uniforms[t].dirty=false}};e.prototype.initUniforms=function(e){for(var t in this.uniforms){var n=this.uniforms[t];n.location=e.getUniformLocation(this.shaderProgram,t);n.dirty=true;n.value=null}};e.RENDERER_ID="ShaderPair";return e}();e.ShaderPair=t})(e.Shaders||(e.Shaders={}));var t=e.Shaders})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(e){function t(){e.call(this);this.attributes={aXYUV:null,aAlpha:null};this.uniforms={uCamMatrix:{type:"mat3"},uResolution:{type:"2fv"},uTextureSize:{type:"2fv"},uSampler:{type:"1i"}};this.fragSource=["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor.a *= vAlpha;","}"];this.vertSource=["attribute vec4 aXYUV;","attribute float aAlpha;","uniform mat3 uCamMatrix;","uniform vec2 uResolution;","uniform vec2 uTextureSize;","varying vec2 vTextureCoord;","varying float vAlpha;","void main(void) {","   vec2 pos = (uCamMatrix * vec3(aXYUV.xy,1)).xy; ","   gl_Position = vec4((pos / uResolution * 2.0 - 1.0) * vec2(1, -1), 0, 1);","   vTextureCoord = aXYUV.zw / uTextureSize;","   vAlpha = aAlpha;","}"]}__extends(t,e);t.prototype.init=function(t){e.prototype.init.call(this,t);this.attributes.aXYUV=t.getAttribLocation(this.shaderProgram,"aXYUV");this.attributes.aAlpha=t.getAttribLocation(this.shaderProgram,"aAlpha");this.initUniforms(t)};return t}(e.ShaderPair);e.TextureAtlasShader=t})(e.Shaders||(e.Shaders={}));var t=e.Shaders})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e,t,n,r){this._frameIndex=0;this._startTime=null;this._reverse=false;this._isPlaying=false;this._onStop=null;this._onPlay=null;this._onUpdate=null;this._onLoop=null;this.name=e;this._sequence=t;this._speed=t.speed;this._loop=t.loop;this._clock=n;this._parent=r}t.prototype.objType=function(){return"Animation"};Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"frameIndex",{get:function(){return this._frameIndex},set:function(e){if(this._validateFrame(e)){this._frameIndex=e}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentCell",{get:function(){return this._sequence.cells[this.frameIndex]},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"reverse",{get:function(){return this._reverse},set:function(e){this._reverse=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"onStop",{get:function(){if(this._onStop==null)this._onStop=new e.Signal;return this._onStop},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"onPlay",{get:function(){if(this._onPlay==null)this._onPlay=new e.Signal;return this._onPlay},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"onUpdate",{get:function(){if(this._onUpdate==null)this._onUpdate=new e.Signal;return this._onUpdate},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"onLoop",{get:function(){if(this._onLoop==null)this._onLoop=new e.Signal;return this._onLoop},enumerable:true,configurable:true});t.prototype._start=function(e){if(typeof e==="undefined"){e=null}if(e!==null){this.frameIndex=e}this._isPlaying=true;this._startTime=this._clock.elapsed();this._tick=this._startTime+this._speed;if(this._onPlay!==null)this._onPlay.dispatch()};t.prototype.play=function(){if(this._frameIndex===this.length-1)this.frameIndex=0;this.playAt(this._frameIndex)};t.prototype.playAt=function(e){this._start(e)};t.prototype.pause=function(){this.stop()};t.prototype.resume=function(){if(this._startTime!==null){this._isPlaying=true}};t.prototype.stop=function(){if(this._isPlaying){this._isPlaying=false;if(this._onStop!==null)this._onStop.dispatch()}};t.prototype.nextFrame=function(){this._frameIndex++;if(this._frameIndex>=this.length)this.frameIndex=0};t.prototype.prevFrame=function(){this._frameIndex--;if(this._frameIndex<0)this.frameIndex=this.length-1};t.prototype.update=function(){if(this._isPlaying){if(this._clock.elapsed()>=this._tick){this._tick=this._clock.elapsed()+this._speed;if(this._validateFrame(this._frameIndex+(this._reverse==true?-1:1))){this._frameIndex+=this._reverse==true?-1:1;this._parent.updateCellIndex();if(this._onUpdate!==null)this._onUpdate.dispatch()}else{if(this._loop){if(this._reverse){this._frameIndex=this.length-1}else{this._frameIndex=0}this._parent.updateCellIndex();if(this._onLoop!==null)this._onLoop.dispatch()}else{this._parent.stop()}}}}};t.prototype._validateFrame=function(e){return e<this.length&&e>=0};Object.defineProperty(t.prototype,"length",{get:function(){return this._sequence.cells.length},enumerable:true,configurable:true});t.prototype.destroy=function(){this._isPlaying=false;delete this._clock;delete this._sequence;delete this._parent;if(this._onLoop)this._onLoop.dispose();if(this._onStop)this._onStop.dispose();if(this._onPlay)this._onPlay.dispose();if(this._onUpdate)this._onUpdate.dispose();delete this._onLoop;delete this._onStop;delete this._onPlay;delete this._onUpdate;delete this.frameIndex;delete this.loop;delete this._reverse;delete this._tick};return t}();t.Animation=n})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e,t,n,r){if(typeof n==="undefined"){n=.1}if(typeof r==="undefined"){r=true}this.name=e;this.cells=t;this.speed=n;this.loop=r}return e}();e.Sequence=t})(e.Animations||(e.Animations={}));var t=e.Animations})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e,t,n){this.preventDefault=false;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.timeUp=0;this.repeats=0;this._manager=e;this.game=this._manager.game;this.keyCode=t;if(n){this.update(n)}}e.prototype.objType=function(){return"Key"};Object.defineProperty(e.prototype,"duration",{get:function(){if(this.isDown){this.timeDown=this.game.time.now()}return this.timeDown<this.timeUp?0:this.timeDown-this.timeUp},enumerable:true,configurable:true});e.prototype.update=function(e){this.keyCode=e.keyCode;if(this.preventDefault)e.preventDefault();if(e.type==="keydown"){this.altKey=e.altKey;this.ctrlKey=e.ctrlKey;this.shiftKey=e.shiftKey;if(this.isDown===true){this.repeats++;this.timeDown=this.game.time.now()}else{this.isDown=true;this.isUp=false;this.timeDown=this.game.time.now();this.repeats=0}}else if(e.type==="keyup"){this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now()}};e.prototype.justPressed=function(e){if(typeof e==="undefined"){e=this._manager.justPressedRate}if(this.isDown===true&&this.timeDown+e>this.game.time.now()){return true}else{return false}};e.prototype.justReleased=function(e){if(typeof e==="undefined"){e=this._manager.justReleasedRate}if(this.isUp===true&&this.timeUp+e>this.game.time.now()){return true}else{return false}};e.prototype.reset=function(){this.isDown=false;this.isUp=true;this.timeUp=0;this.timeDown=0;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false};return e}();e.Key=t})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._keys=[];this.justPressedRate=200;this.justReleasedRate=200;this.game=e}t.prototype.objType=function(){return"Keyboard"};Object.defineProperty(t.prototype,"keys",{get:function(){return this._keys},enumerable:true,configurable:true});t.prototype.boot=function(){this.onKeyUp=new e.Signal;this.onKeyDown=new e.Signal;this.onKeyDownOnce=new e.Signal;this.start()};t.prototype.update=function(){};t.prototype.start=function(){var t=this;if(this.game.deviceTargetOption===e.TARGET_BROWSER){document.body.addEventListener("keydown",function(e){return t._keyPressed(e)},false);document.body.addEventListener("keyup",function(e){return t._keyReleased(e)},false)}};t.prototype.stop=function(){var t=this;if(this.game.deviceTargetOption===e.TARGET_BROWSER){document.body.removeEventListener("keydown",function(e){return t._keyPressed(e)},false);document.body.removeEventListener("keyup",function(e){return t._keyReleased(e)},false)}};t.prototype._keyPressed=function(t){if(this._keys[t.keyCode]){this._keys[t.keyCode].update(t)}else{this._keys[t.keyCode]=new e.Input.Key(this,t.keyCode,t)}if(this._keys[t.keyCode].repeats==0)this.onKeyDownOnce.dispatch(t.keyCode,this._keys[t.keyCode]);this.onKeyDown.dispatch(t.keyCode,this._keys[t.keyCode])};t.prototype._keyReleased=function(t){if(this._keys[t.keyCode]){this._keys[t.keyCode].update(t)}else{this._keys[t.keyCode]=new e.Input.Key(this,t.keyCode,t)}this.onKeyUp.dispatch(t.keyCode,this._keys[t.keyCode])};t.prototype.addKey=function(t,n){if(typeof n==="undefined"){n=false}var r=new e.Input.Key(this,t);r.preventDefault=n;return this._keys[t]=r};t.prototype.justPressed=function(e,t){if(typeof t==="undefined"){t=this.justPressedRate}if(this._keys[e]){return this._keys[e].justPressed(t)}return false};t.prototype.justReleased=function(e,t){if(typeof t==="undefined"){t=this.justReleasedRate}if(this._keys[e]){return this._keys[e].justReleased(t)}return false};t.prototype.isDown=function(e){if(this._keys[e]){return this._keys[e].isDown}else{return false}};t.prototype.isUp=function(e){if(this._keys[e]){return this._keys[e].isUp}else{return false}};t.prototype.reset=function(){for(var e in this._keys){this._keys[e].reset()}};return t}();t.Keyboard=n})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(){}e.prototype.objType=function(){return"Keycodes"};e.A="A".charCodeAt(0);e.B="B".charCodeAt(0);e.C="C".charCodeAt(0);e.D="D".charCodeAt(0);e.E="E".charCodeAt(0);e.F="F".charCodeAt(0);e.G="G".charCodeAt(0);e.H="H".charCodeAt(0);e.I="I".charCodeAt(0);e.J="J".charCodeAt(0);e.K="K".charCodeAt(0);e.L="L".charCodeAt(0);e.M="M".charCodeAt(0);e.N="N".charCodeAt(0);e.O="O".charCodeAt(0);e.P="P".charCodeAt(0);e.Q="Q".charCodeAt(0);e.R="R".charCodeAt(0);e.S="S".charCodeAt(0);e.T="T".charCodeAt(0);e.U="U".charCodeAt(0);e.V="V".charCodeAt(0);e.W="W".charCodeAt(0);e.X="X".charCodeAt(0);e.Y="Y".charCodeAt(0);e.Z="Z".charCodeAt(0);e.ZERO="0".charCodeAt(0);e.ONE="1".charCodeAt(0);e.TWO="2".charCodeAt(0);e.THREE="3".charCodeAt(0);e.FOUR="4".charCodeAt(0);e.FIVE="5".charCodeAt(0);e.SIX="6".charCodeAt(0);e.SEVEN="7".charCodeAt(0);e.EIGHT="8".charCodeAt(0);e.NINE="9".charCodeAt(0);e.NUMPAD_0=96;e.NUMPAD_1=97;e.NUMPAD_2=98;e.NUMPAD_3=99;e.NUMPAD_4=100;e.NUMPAD_5=101;e.NUMPAD_6=102;e.NUMPAD_7=103;e.NUMPAD_8=104;e.NUMPAD_9=105;e.NUMPAD_MULTIPLY=106;e.NUMPAD_ADD=107;e.NUMPAD_ENTER=108;e.NUMPAD_SUBTRACT=109;e.NUMPAD_DECIMAL=110;e.NUMPAD_DIVIDE=111;e.F1=112;e.F2=113;e.F3=114;e.F4=115;e.F5=116;e.F6=117;e.F7=118;e.F8=119;e.F9=120;e.F10=121;e.F11=122;e.F12=123;e.F13=124;e.F14=125;e.F15=126;e.COLON=186;e.EQUALS=187;e.UNDERSCORE=189;e.QUESTION_MARK=191;e.TILDE=192;e.OPEN_BRACKET=219;e.BACKWARD_SLASH=220;e.CLOSED_BRACKET=221;e.QUOTES=222;e.BACKSPACE=8;e.TAB=9;e.CLEAR=12;e.ENTER=13;e.SHIFT=16;e.CONTROL=17;e.ALT=18;e.CAPS_LOCK=20;e.ESC=27;e.SPACEBAR=32;e.PAGE_UP=33;e.PAGE_DOWN=34;e.END=35;e.HOME=36;e.LEFT=37;e.UP=38;e.RIGHT=39;e.DOWN=40;e.INSERT=45;e.DELETE=46;e.HELP=47;e.NUM_LOCK=144;return e}();e.Keycodes=t})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this.game=e}t.prototype.objType=function(){return"InputManager"};Object.defineProperty(t.prototype,"pointers",{get:function(){return this._pointers},enumerable:true,configurable:true});t.prototype.boot=function(){this._pointers=[];this.mouse=new e.Input.Mouse(this.game);this.mouse.boot();this.mouse.onDown.add(this._onDownEvent,this);this.mouse.onUp.add(this._onUpEvent,this);this.keyboard=new e.Input.Keyboard(this.game);this.keyboard.boot();this.touch=new e.Input.Touch(this.game);this.touch.boot();this.touch.touchDown.add(this._onDownEvent,this);this.touch.touchUp.add(this._onUpEvent,this);this._pointers=this.touch.fingers.slice();this._pointers.push(this.mouse.cursor);this.isDown=false;this.position=new e.Geom.Point;this.onDown=new e.Signal;this.onUp=new e.Signal};t.prototype._onDownEvent=function(e,t,n,r,i,s){this.onDown.dispatch(e,t,n,r,i,s)};t.prototype._onUpEvent=function(e,t,n,r,i,s){this.onUp.dispatch(e,t,n,r,i,s)};Object.defineProperty(t.prototype,"onPressed",{get:function(){return this.onDown},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"onReleased",{get:function(){return this.onUp},enumerable:true,configurable:true});t.prototype.update=function(){this.mouse.update();this.keyboard.update();this.touch.update();if(this.touch.touchEnabled){this.position.setTo(this.touch.x,this.touch.y)}else{this.position.setTo(this.mouse.x,this.mouse.y)}this.isDown=this.mouse.isDown||this.touch.isDown};t.prototype.reset=function(){this.mouse.reset();this.keyboard.reset();this.touch.reset()};Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},enumerable:true,configurable:true});return t}();t.InputManager=n})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._domElement=null;this._game=e}t.prototype.objType=function(){return"Mouse"};Object.defineProperty(t.prototype,"cursor",{get:function(){return this._cursor},enumerable:true,configurable:true});t.prototype.boot=function(){this._domElement=this._game.stage.container;this._cursor=new e.Input.MouseCursor(this._game);this._cursor.active=true;this._cursor.id=1;this.onDown=new e.Signal;this.onUp=new e.Signal;this.onWheel=new e.Signal;this.start()};Object.defineProperty(t.prototype,"isDown",{get:function(){return this._cursor.isDown},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isUp",{get:function(){return this._cursor.isUp},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"duration",{get:function(){return this._cursor.duration},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._cursor.x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._cursor.y},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"wheelDeltaX",{get:function(){return this._cursor.wheelDeltaX},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"wheelDeltaY",{get:function(){return this._cursor.wheelDeltaY},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"ctrlKey",{get:function(){return this._cursor.ctrlKey},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"shiftKey",{get:function(){return this._cursor.shiftKey},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"altKey",{get:function(){return this._cursor.altKey},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"button",{get:function(){return this._cursor.button},enumerable:true,configurable:true});t.prototype.update=function(){this._cursor.update()};t.prototype.start=function(){var t=this;if(this._game.deviceTargetOption===e.TARGET_BROWSER){if(e.DEVICE.ie&&e.DEVICE.ieVersion<9){this._domElement.attachEvent("onmousedown",function(e){return t.onMouseDown(e)});this._domElement.attachEvent("onmousemove",function(e){return t.onMouseMove(e)});this._domElement.attachEvent("onmouseup",function(e){return t.onMouseUp(e)});this._domElement.attachEvent("onmousewheel",function(e){return t.onMouseWheel(e)})}else{this._domElement.addEventListener("mousedown",function(e){return t.onMouseDown(e)},true);this._domElement.addEventListener("mousemove",function(e){return t.onMouseMove(e)},true);this._domElement.addEventListener("mouseup",function(e){return t.onMouseUp(e)},true);this._domElement.addEventListener("mousewheel",function(e){return t.onMouseWheel(e)},true);this._domElement.addEventListener("DOMMouseScroll",function(e){return t.onMouseWheel(e)},true)}}else if(this._game.deviceTargetOption===e.TARGET_COCOON){this._game.stage.canvas.addEventListener("mousedown",function(e){return t.onMouseDown(e)},true);this._game.stage.canvas.addEventListener("mousemove",function(e){return t.onMouseMove(e)},true);this._game.stage.canvas.addEventListener("mouseup",function(e){return t.onMouseUp(e)},true);this._game.stage.canvas.addEventListener("mousewheel",function(e){return t.onMouseWheel(e)},true);this._game.stage.canvas.addEventListener("DOMMouseScroll",function(e){return t.onMouseWheel(e)},true)}};t.prototype.stop=function(){var t=this;if(this._game.deviceTargetOption===e.TARGET_BROWSER){this._domElement.removeEventListener("mousedown",function(e){return t.onMouseDown(e)},false);this._domElement.removeEventListener("mousedown",this.onMouseDown,false);this._domElement.removeEventListener("mousemove",this.onMouseMove,false);this._domElement.removeEventListener("mouseup",this.onMouseUp,false);this._domElement.removeEventListener("mousewheel",this.onMouseWheel,false);this._domElement.removeEventListener("DOMMouseScroll",this.onMouseWheel,false)}};t.prototype.onMouseDown=function(e){this._cursor.start(e);this.onDown.dispatch(this._cursor.x,this._cursor.y,this._cursor.timeDown,this._cursor.timeUp,this.duration,this._cursor)};t.prototype.onMouseMove=function(e){this._cursor.move(e)};t.prototype.onMouseUp=function(e){this._cursor.stop(e);this.onUp.dispatch(this._cursor.x,this._cursor.y,this._cursor.timeDown,this._cursor.timeUp,this.duration,this._cursor)};t.prototype.onMouseWheel=function(e){this._cursor.wheel(e);this.onWheel.dispatch(this._cursor.wheelDeltaX,this._cursor.wheelDeltaY,this._cursor)};t.prototype.justPressed=function(e){if(typeof e==="undefined"){e=this._cursor.justPressedRate}return this._cursor.justPressed(e)};t.prototype.justReleased=function(e){if(typeof e==="undefined"){e=this._cursor.justReleasedRate}return this._cursor.justReleased(e)};t.prototype.reset=function(){this._cursor.reset()};t.LEFT_BUTTON=0;t.MIDDLE_BUTTON=1;t.RIGHT_BUTTON=2;return t}();t.Mouse=n})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._domElement=null;this.isDown=false;this.isUp=true;this._maxPointers=10;this._game=e}t.prototype.objType=function(){return"TouchManager"};Object.defineProperty(t.prototype,"fingers",{get:function(){return this._fingers},enumerable:true,configurable:true});t.prototype.boot=function(){this._domElement=this._game.stage.container;this.finger1=new e.Input.Finger(this._game);this.finger2=new e.Input.Finger(this._game);this.finger3=new e.Input.Finger(this._game);this.finger4=new e.Input.Finger(this._game);this.finger5=new e.Input.Finger(this._game);this.finger6=new e.Input.Finger(this._game);this.finger7=new e.Input.Finger(this._game);this.finger8=new e.Input.Finger(this._game);this.finger9=new e.Input.Finger(this._game);this.finger10=new e.Input.Finger(this._game);this._fingers=[this.finger1,this.finger2,this.finger3,this.finger4,this.finger5,this.finger6,this.finger7,this.finger8,this.finger9,this.finger10];this.latestFinger=this.finger1;this.touchDown=new e.Signal;this.touchUp=new e.Signal;this.touchCancel=new e.Signal;this.start()};t.prototype.start=function(){var t=this;if(e.DEVICE.touch){this.touchEnabled=true;if(this._game.deviceTargetOption===e.TARGET_BROWSER){if(e.DEVICE.pointerEnabled){var n="pointerup",r="pointerdown",i="pointerenter",s="pointerleave",o="pointercancel",u="pointermove";if(window.navigator.msPointerEnabled){var n="MSPointerUp",r="MSPointerDown",i="MSPointerEnter",s="MSPointerLeave",o="MSPointerCancel",u="MSPointerMove"}this._domElement.addEventListener(n,function(e){return t.onPointerStart(e)},false);this._domElement.addEventListener(r,function(e){return t.onPointerEnd(e)},false);this._domElement.addEventListener(i,function(e){return t.onPointerEnter(e)},false);this._domElement.addEventListener(s,function(e){return t.onPointerLeave(e)},false);this._domElement.addEventListener(o,function(e){return t.onPointerCancel(e)},false);this._domElement.addEventListener(u,function(e){return t.onPointerMove(e)},false)}else{this._domElement.addEventListener("touchstart",function(e){return t.onTouchStart(e)},false);this._domElement.addEventListener("touchmove",function(e){return t.onTouchMove(e)},false);this._domElement.addEventListener("touchend",function(e){return t.onTouchEnd(e)},false);this._domElement.addEventListener("touchenter",function(e){return t.onTouchEnter(e)},false);this._domElement.addEventListener("touchleave",function(e){return t.onTouchLeave(e)},false);this._domElement.addEventListener("touchcancel",function(e){return t.onTouchCancel(e)},false);document.addEventListener("touchmove",function(e){return t.consumeTouchMove(e)},false)}}else if(this._game.deviceTargetOption===e.TARGET_COCOON){this._game.stage.canvas.addEventListener("touchstart",function(e){return t.onTouchStart(e)},false);this._game.stage.canvas.addEventListener("touchmove",function(e){return t.onTouchMove(e)},false);this._game.stage.canvas.addEventListener("touchend",function(e){return t.onTouchEnd(e)},false);this._game.stage.canvas.addEventListener("touchenter",function(e){return t.onTouchEnter(e)},false);this._game.stage.canvas.addEventListener("touchleave",function(e){return t.onTouchLeave(e)},false);this._game.stage.canvas.addEventListener("touchcancel",function(e){return t.onTouchCancel(e)},false)}}else{this.touchEnabled=false}};t.prototype.consumeTouchMove=function(e){e.preventDefault()};Object.defineProperty(t.prototype,"x",{get:function(){return this.latestFinger.x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this.latestFinger.y},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"maximumPointers",{get:function(){return this._maxPointers},set:function(e){if(e<0)e=1;if(e>this._fingers.length)e=this._fingers.length;this._maxPointers=e},enumerable:true,configurable:true});t.prototype._registerFinger=function(e,t){for(var n=0;n<this._maxPointers;n++){if(this._fingers[n].active===false){this._fingers[n].id=t;this._fingers[n].start(e);this.latestFinger=this._fingers[n];this.touchDown.dispatch(this._fingers[n].x,this._fingers[n].y,this._fingers[n].timeDown,this._fingers[n].timeUp,this._fingers[n].duration,this._fingers[n]);this.isDown=true;this.isUp=false;break}}};t.prototype._deregisterFinger=function(e,t){var n=null;for(var r=0;r<this._fingers.length;r++){if(this._fingers[r].active&&this._fingers[r].id===t){this._fingers[r].stop(e);this.latestFinger=this._fingers[r];n=this._fingers[r];this.isDown=false;this.isUp=true;break}}for(var i=0;i<this._fingers.length;i++){if(this._fingers[i].active===true){this.isDown=true;this.isUp=false}}if(n!==null){this.touchUp.dispatch(n.x,n.y,n.timeDown,n.timeUp,n.duration,n)}};t.prototype._cancelFinger=function(e,t){for(var n=0;n<this._fingers.length;n++){if(this._fingers[n].active&&this._fingers[n].id===t){this._fingers[n].stop(e);this.touchCancel.dispatch(this._fingers[n].x,this._fingers[n].y,this._fingers[n].timeDown,this._fingers[n].timeUp,this._fingers[n].duration,this._fingers[n]);break}}for(var r=0;r<this._fingers.length;r++){if(this._fingers[r].active){this.isDown=true;this.isUp=false}}};t.prototype._enterFinger=function(e,t){for(var n=0;n<this._maxPointers;n++){if(this._fingers[n].active===false){this._fingers[n].id=t;this._fingers[n].start(e);this.latestFinger=this._fingers[n];this.isDown=true;this.isUp=false;break}}};t.prototype._leaveFinger=function(e,t){for(var n=0;n<this._fingers.length;n++){if(this._fingers[n].active&&this._fingers[n].id===t){this._fingers[n].leave(e);break}}};t.prototype._moveFinger=function(e,t){for(var n=0;n<this._fingers.length;n++){if(this._fingers[n].active&&this._fingers[n].id===t){this._fingers[n].move(e);this.latestFinger=this._fingers[n];break}}};t.prototype.onTouchStart=function(e){for(var t=0;t<e.changedTouches.length;t++){this._registerFinger(e.changedTouches[t],e.changedTouches[t].identifier)}};t.prototype.onTouchCancel=function(e){for(var t=0;t<e.changedTouches.length;t++){this._cancelFinger(e.changedTouches[t],e.changedTouches[t].identifier)}};t.prototype.onTouchEnter=function(e){for(var t=0;t<e.changedTouches.length;t++){this._enterFinger(e.changedTouches[t],e.changedTouches[t].identifier)}};t.prototype.onTouchLeave=function(e){for(var t=0;t<e.changedTouches.length;t++){this._leaveFinger(e.changedTouches[t],e.changedTouches[t].identifier)}};t.prototype.onTouchMove=function(e){for(var t=0;t<e.changedTouches.length;t++){this._moveFinger(e.changedTouches[t],e.changedTouches[t].identifier)}};t.prototype.onTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){this._deregisterFinger(e.changedTouches[t],e.changedTouches[t].identifier)}};t.prototype.onPointerStart=function(e){if(e.type==="touch"){this._registerFinger(e,e.pointerId)}};t.prototype.onPointerCancel=function(e){if(e.type==="touch"){this._cancelFinger(e,e.pointerId)}};t.prototype.onPointerEnter=function(e){if(e.type==="touch"){this._enterFinger(e,e.pointerId)}};t.prototype.onPointerLeave=function(e){if(e.type==="touch"){this._leaveFinger(e,e.pointerId)}};t.prototype.onPointerMove=function(e){if(e.type==="touch"){this._moveFinger(e,e.pointerId)}};t.prototype.onPointerEnd=function(e){if(e.type==="touch"){this._deregisterFinger(e,e.pointerId)}};t.prototype.update=function(){if(this.touchEnabled&&this.isDown){for(var e=0;e<this._fingers.length;e++){if(this._fingers[e].active){this._fingers[e].update()}}}};t.prototype.stop=function(){var t=this;if(this.touchEnabled){if(this._game.deviceTargetOption===e.TARGET_BROWSER){this._domElement.removeEventListener("touchstart",function(e){return t.onTouchStart(e)},false);this._domElement.removeEventListener("touchmove",function(e){return t.onTouchMove(e)},false);this._domElement.removeEventListener("touchend",function(e){return t.onTouchEnd(e)},false);this._domElement.removeEventListener("touchenter",function(e){return t.onTouchEnter(e)},false);this._domElement.removeEventListener("touchleave",function(e){return t.onTouchLeave(e)},false);this._domElement.removeEventListener("touchcancel",function(e){return t.onTouchCancel(e)},false)}else if(this._game.deviceTargetOption===e.TARGET_COCOON){this._game.stage.canvas.removeEventListener("touchstart",function(e){return t.onTouchStart(e)},false);this._game.stage.canvas.removeEventListener("touchmove",function(e){return t.onTouchMove(e)},false);this._game.stage.canvas.removeEventListener("touchend",function(e){return t.onTouchEnd(e)},false);this._game.stage.canvas.removeEventListener("touchenter",function(e){return t.onTouchEnter(e)},false);this._game.stage.canvas.removeEventListener("touchleave",function(e){return t.onTouchLeave(e)},false);this._game.stage.canvas.removeEventListener("touchcancel",function(e){return t.onTouchCancel(e)},false)}}};t.prototype.reset=function(){for(var e=0;e<this._fingers.length;e++){this._fingers[e].reset()}};return t}();t.Touch=n})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(t){this.x=-1;this.y=-1;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.isDown=false;this.isUp=true;this.withinGame=false;this.active=false;this.timeDown=0;this.timeUp=0;this.duration=0;this.frameDuration=0;this.justPressedRate=200;this.justReleasedRate=200;this._game=t;this.point=new e.Geom.Point;this.circle=new e.Geom.Circle(0,0,1);this.startPoint=new e.Geom.Point;this.endPoint=new e.Geom.Point}t.prototype.objType=function(){return"Pointer"};Object.defineProperty(t.prototype,"game",{get:function(){return this._game},enumerable:true,configurable:true});t.prototype.start=function(e){this.move(e);this.startPoint.setTo(this.x,this.y);this.frameDuration=0;this.withinGame=true;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.now()};t.prototype.stop=function(e){this.withinGame=false;this.endPoint.setTo(this.x,this.y);this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now();this.duration=this.timeUp-this.timeDown};t.prototype.move=function(e){this.clientX=e.clientX;this.clientY=e.clientY;this.pageX=e.pageX;this.pageY=e.pageY;this.screenX=e.screenX;this.screenY=e.screenY;this.x=(this.pageX-this.game.stage.offset.x)*this.game.stage.scaleX;this.y=(this.pageY-this.game.stage.offset.y)*this.game.stage.scaleY;this.point.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;this.duration=this.game.time.now()-this.timeDown};t.prototype.justPressed=function(e){if(typeof e==="undefined"){e=this.justPressedRate}if(this.isDown===true&&this.timeDown+e>this._game.time.now()){return true}else{return false}};t.prototype.justReleased=function(e){if(typeof e==="undefined"){e=this.justReleasedRate}if(this.isUp===true&&this.timeUp+e>this._game.time.now()){return true}else{return false}};t.prototype.reset=function(){this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.duration=0;this.frameDuration=0};t.prototype.update=function(){if(this.isDown===true){this.frameDuration++;this.duration=this._game.time.now()-this.timeDown}};return t}();t.Pointer=n})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(e){function t(){e.apply(this,arguments);this.wheelDeltaX=0;this.wheelDeltaY=0}__extends(t,e);t.prototype.objType=function(){return"MouseCursor"};t.prototype.start=function(t){this.ctrlKey=t.ctrlKey;this.shiftKey=t.shiftKey;this.altKey=t.altKey;this.button-t.button;e.prototype.start.call(this,t)};t.prototype.stop=function(t){this.move(t);e.prototype.stop.call(this,t)};t.prototype.wheel=function(e){if(e["wheelDeltaX"]){this.wheelDeltaX=e["wheelDeltaX"]}else{this.wheelDeltaX=e.deltaX}if(e["wheelDeltaY"]){this.wheelDeltaY=e["wheelDeltaY"]}else{this.wheelDeltaY=e.deltaY}};return t}(e.Pointer);e.MouseCursor=t})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(e){function t(t){e.call(this,t);this.circle.diameter=44}__extends(t,e);t.prototype.objType=function(){return"Finger"};t.prototype.start=function(t){this.active=true;e.prototype.start.call(this,t)};t.prototype.stop=function(t){this.active=false;e.prototype.stop.call(this,t)};t.prototype.leave=function(e){this.withinGame=false;this.move(e)};t.prototype.reset=function(){this.active=false;e.prototype.reset.call(this)};return t}(e.Pointer);e.Finger=t})(e.Input||(e.Input={}));var t=e.Input})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function t(e,t,n,r){this.cx=0;this.cy=0;this.halfWidth=0;this.halfHeight=0;this.cx=e||0;this.cy=t||0;this.halfWidth=n/2||0;this.halfHeight=r/2||0}t.prototype.objType=function(){return"AABB"};Object.defineProperty(t.prototype,"height",{get:function(){return this.halfHeight*2},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"width",{get:function(){return this.halfWidth*2},enumerable:true,configurable:true});t.prototype.draw=function(e){e.beginPath();e.moveTo(this.cx-this.halfWidth,this.cy);e.lineTo(this.cx+this.halfWidth,this.cy);e.moveTo(this.cx,this.cy-this.halfHeight);e.lineTo(this.cx,this.cy+this.halfHeight);e.stroke();return this};t.prototype.setPosition=function(e,t){this.cx=e;this.cy=t;return this};t.prototype.setPositionPoint=function(e){this.cx=e.x;this.cy=e.y;return this};t.prototype.toRect=function(){return new e.Rectangle(this.cx-this.halfWidth,this.cy-this.halfHeight,this.halfWidth*2,this.halfHeight*2)};t.prototype.fromRect=function(e){this.halfWidth=e.width/2;this.halfHeight=e.height/2;this.cx=e.x+this.halfWidth;this.cy=e.y+this.halfHeight;return this};return t}();e.AABB=t})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function t(e,t,n){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}this._diameter=0;this._radius=0;this.x=0;this.y=0;this.setTo(e,t,n)}t.prototype.objType=function(){return"Circle"};Object.defineProperty(t.prototype,"diameter",{get:function(){return this._diameter},set:function(e){if(e>0){this._diameter=e;this._radius=e*.5}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){if(e>0){this._radius=e;this._diameter=e*2}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"circumference",{get:function(){return 2*Math.PI*this._radius},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(e){if(!isNaN(e)){if(e<this.y){this._radius=0;this._diameter=0}else{this.radius=e-this.y}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"left",{get:function(){return this.x-this._radius},set:function(e){if(!isNaN(e)){if(e<this.x){this.radius=this.x-e}else{this._radius=0;this._diameter=0}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this._radius},set:function(e){if(e&&!isNaN(e)){if(e>this.x){this.radius=e-this.x}else{this._radius=0;this._diameter=0}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"top",{get:function(){return this.y-this._radius},set:function(e){if(e&&!isNaN(e)){if(e>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-e}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"isEmpty",{get:function(){if(this._diameter<=0){return true}return false},enumerable:true,configurable:true});t.prototype.clone=function(e){if(typeof e==="undefined"){e=new t}return e.setTo(this.x,this.y,this._diameter)};t.prototype.copyFrom=function(e){return this.setTo(e.x,e.y,e.diameter)};t.prototype.copyTo=function(e){return e.copyFrom(this)};t.prototype.distanceTo=function(e,t){if(typeof t==="undefined"){t=false}var n=this.x-e.x;var r=this.y-e.y;if(t===true){return Math.round(Math.sqrt(n*n+r*r))}else{return Math.sqrt(n*n+r*r)}};t.prototype.equals=function(e){if(this.x===e.x&&this.y===e.y&&this.diameter===e.diameter){return true}return false};t.prototype.intersects=function(e){if(this.distanceTo(e,false)<this._radius+e._radius){return true}return false};t.prototype.circumferencePoint=function(t,n,r){if(typeof n==="undefined"){n=false}if(typeof r==="undefined"){r=new e.Point}if(n===true){t=t*(Math.PI/180)}r.x=this.x+this._radius*Math.cos(t);r.y=this.y+this._radius*Math.sin(t);return r};t.prototype.offset=function(e,t){if(!isNaN(e)&&!isNaN(t)){this.x+=e;this.y+=t}return this};t.prototype.offsetPoint=function(e){return this.offset(e.x,e.y)};t.prototype.setTo=function(e,t,n){this.x=e;this.y=t;this._diameter=n;this._radius=n*.5;return this};t.prototype.toString=function(){return"[{Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"};return t}();e.Circle=t})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e,t,n,r){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.setTo(e,t,n,r)}e.prototype.objType=function(){return"Ray"};e.prototype.clone=function(t){if(typeof t==="undefined"){t=new e}return t.setTo(this.x1,this.y1,this.x2,this.y2)};e.prototype.copyFrom=function(e){return this.setTo(e.x1,e.y1,e.x2,e.y2)};e.prototype.copyTo=function(e){return e.copyFrom(this)};e.prototype.setTo=function(e,t,n,r){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}this.x1=e;this.y1=t;this.x2=n;this.y2=r;return this};Object.defineProperty(e.prototype,"angle",{get:function(){return Math.atan2(this.x2-this.x1,this.y2-this.y1)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"slope",{get:function(){return(this.y2-this.y1)/(this.x2-this.x1)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"yIntercept",{get:function(){return this.y1-this.slope*this.x1},enumerable:true,configurable:true});e.prototype.isPointOnRay=function(e,t){if((e-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(t-this.y1)){if(Math.atan2(t-this.y1,e-this.x1)==Math.atan2(this.y2-this.y1,this.x2-this.x1)){return true}}return false};e.prototype.toString=function(){return"[{Ray (x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+")}]"};return e}();e.Ray=t})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function t(){}t.prototype.objType=function(){return"Intersect"};t.distance=function(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))};t.distanceSquared=function(e,t,n,r){return(n-e)*(n-e)+(r-t)*(r-t)};t.lineToLine=function(t,n,r){if(typeof r==="undefined"){r=new e.IntersectResult}var i=(t.x1-t.x2)*(n.y1-n.y2)-(t.y1-t.y2)*(n.x1-n.x2);if(i!==0){r.result=true;r.x=((t.x1*t.y2-t.y1*t.x2)*(n.x1-n.x2)-(t.x1-t.x2)*(n.x1*n.y2-n.y1*n.x2))/i;r.y=((t.x1*t.y2-t.y1*t.x2)*(n.y1-n.y2)-(t.y1-t.y2)*(n.x1*n.y2-n.y1*n.x2))/i}return r};t.lineToLineSegment=function(t,n,r){if(typeof r==="undefined"){r=new e.IntersectResult}var i=(t.x1-t.x2)*(n.y1-n.y2)-(t.y1-t.y2)*(n.x1-n.x2);if(i!==0){r.x=((t.x1*t.y2-t.y1*t.x2)*(n.x1-n.x2)-(t.x1-t.x2)*(n.x1*n.y2-n.y1*n.x2))/i;r.y=((t.x1*t.y2-t.y1*t.x2)*(n.y1-n.y2)-(t.y1-t.y2)*(n.x1*n.y2-n.y1*n.x2))/i;var s=Math.max(n.x1,n.x2);var o=Math.min(n.x1,n.x2);var u=Math.max(n.y1,n.y2);var a=Math.min(n.y1,n.y2);if((r.x<=s&&r.x>=o)===true||(r.y<=u&&r.y>=a)===true){r.result=true}}return r};t.lineToRawSegment=function(t,n,r,i,s,o){if(typeof o==="undefined"){o=new e.IntersectResult}var u=(t.x1-t.x2)*(r-s)-(t.y1-t.y2)*(n-i);if(u!==0){o.x=((t.x1*t.y2-t.y1*t.x2)*(n-i)-(t.x1-t.x2)*(n*s-r*i))/u;o.y=((t.x1*t.y2-t.y1*t.x2)*(r-s)-(t.y1-t.y2)*(n*s-r*i))/u;var a=Math.max(n,i);var f=Math.min(n,i);var l=Math.max(r,s);var c=Math.min(r,s);if((o.x<=a&&o.x>=f)===true||(o.y<=l&&o.y>=c)===true){o.result=true}}return o};t.lineToRay=function(t,n,r){if(typeof r==="undefined"){r=new e.IntersectResult}var i=(t.x1-t.x2)*(n.y1-n.y2)-(t.y1-t.y2)*(n.x1-n.x2);if(i!==0){r.x=((t.x1*t.y2-t.y1*t.x2)*(n.x1-n.x2)-(t.x1-t.x2)*(n.x1*n.y2-n.y1*n.x2))/i;r.y=((t.x1*t.y2-t.y1*t.x2)*(n.y1-n.y2)-(t.y1-t.y2)*(n.x1*n.y2-n.y1*n.x2))/i;r.result=true;if(!(n.x1>=n.x2)&&r.x<n.x1){r.result=false}if(!(n.y1>=n.y2)&&r.y<n.y1){r.result=false}}return r};t.lineToCircle=function(t,n,r){if(typeof r==="undefined"){r=new e.IntersectResult}if(t.perp(n.x,n.y).length<=n.radius){r.result=true}return r};t.lineToRectangle=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}t.lineToRawSegment(n,r.x,r.y,r.right,r.y,i);if(i.result===true){return i}t.lineToRawSegment(n,r.x,r.y,r.x,r.bottom,i);if(i.result===true){return i}t.lineToRawSegment(n,r.x,r.bottom,r.right,r.bottom,i);if(i.result===true){return i}t.lineToRawSegment(n,r.right,r.y,r.right,r.bottom,i);return i};t.lineSegmentToLineSegment=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}t.lineToLineSegment(n,r,i);if(i.result===true){if(!(i.x>=Math.min(n.x1,n.x2)&&i.x<=Math.max(n.x1,n.x2)&&i.y>=Math.min(n.y1,n.y2)&&i.y<=Math.max(n.y1,n.y2))){i.result=false}}return i};t.lineSegmentToRay=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}t.lineToRay(n,r,i);if(i.result===true){if(!(i.x>=Math.min(n.x1,n.x2)&&i.x<=Math.max(n.x1,n.x2)&&i.y>=Math.min(n.y1,n.y2)&&i.y<=Math.max(n.y1,n.y2))){i.result=false}}return i};t.lineSegmentToCircle=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}var s=n.perp(r.x,r.y);if(s.length<=r.radius){var o=Math.max(n.x1,n.x2);var u=Math.min(n.x1,n.x2);var a=Math.max(n.y1,n.y2);var f=Math.min(n.y1,n.y2);if(s.x2<=o&&s.x2>=u&&s.y2<=a&&s.y2>=f){i.result=true}else{if(t.circleContainsPoint(r,{x:n.x1,y:n.y1})||t.circleContainsPoint(r,{x:n.x2,y:n.y2})){i.result=true}}}return i};t.lineSegmentToRectangle=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}if(r.contains(n.x1,n.y1)&&r.contains(n.x2,n.y2)){i.result=true}else{t.lineToRawSegment(n,r.x,r.y,r.right,r.bottom,i);if(i.result===true){return i}t.lineToRawSegment(n,r.x,r.y,r.x,r.bottom,i);if(i.result===true){return i}t.lineToRawSegment(n,r.x,r.bottom,r.right,r.bottom,i);if(i.result===true){return i}t.lineToRawSegment(n,r.right,r.y,r.right,r.bottom,i);return i}return i};t.rayToRectangle=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}t.lineToRectangle(n,r,i);return i};t.rayToLineSegment=function(t,n,r,i,s,o,u,a,f){if(typeof f==="undefined"){f=new e.IntersectResult}var l,c,h;if((i-n)/(r-t)!=(a-o)/(u-s)){h=(r-t)*(a-o)-(i-n)*(u-s);if(h!=0){l=((n-o)*(u-s)-(t-s)*(a-o))/h;c=((n-o)*(r-t)-(t-s)*(i-n))/h;if(l>=0){if(c>=0&&c<=1){f.result=true;f.x=t+l*(r-t),n+l*(i-n)}}}}return f};t.circleToCircle=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}i.result=(n.radius+r.radius)*(n.radius+r.radius)>=t.distanceSquared(n.x,n.y,r.x,r.y);return i};t.circleToRectangle=function(t,n,r){if(typeof r==="undefined"){r=new e.IntersectResult}var i=n.clone();i.inflate(t.radius,t.radius);r.result=i.contains(t.x,t.y);return r};t.circleContainsPoint=function(n,r,i){if(typeof i==="undefined"){i=new e.IntersectResult}i.result=n.radius*n.radius>=t.distanceSquared(n.x,n.y,r.x,r.y);return i};t.pointToRectangle=function(t,n,r){if(typeof r==="undefined"){r=new e.IntersectResult}r.setTo(t.x,t.y);r.result=n.containsPoint(t);return r};t.rectangleToRectangle=function(t,n,r){if(typeof r==="undefined"){r=new e.IntersectResult}var i=Math.max(t.x,n.x);var s=Math.min(t.right,n.right);var o=Math.max(t.y,n.y);var u=Math.min(t.bottom,n.bottom);r.setTo(i,o,s-i,u-o,s-i,u-o);var a=r.x+r.width*.5;var f=r.y+r.height*.5;if(a>t.x&&a<t.right&&f>t.y&&f<t.bottom){r.result=true}return r};return t}();e.Intersect=t})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(){this.result=false}e.prototype.objType=function(){return"IntersectResult"};e.prototype.setTo=function(e,t,n,r,i,s){if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}this.x=e;this.y=t;this.x1=e;this.y1=t;this.x2=n;this.y2=r;this.width=i;this.height=s};return e}();e.IntersectResult=t})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e,t,n,r){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.setTo(e,t,n,r)}t.prototype.objType=function(){return"Line"};t.prototype.clone=function(e){if(typeof e==="undefined"){e=new t}return e.setTo(this.x1,this.y1,this.x2,this.y2)};t.prototype.copyFrom=function(e){return this.setTo(e.x1,e.y1,e.x2,e.y2)};t.prototype.copyTo=function(e){return e.copyFrom(this)};t.prototype.setTo=function(e,t,n,r){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}this.x1=e;this.y1=t;this.x2=n;this.y2=r;return this};Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt((this.x2-this.x1)*(this.x2-this.x1)+(this.y2-this.y1)*(this.y2-this.y1))},enumerable:true,configurable:true});t.prototype.getY=function(e){if(this.x1==this.x2)return null;else return this.slope*e+this.yIntercept};Object.defineProperty(t.prototype,"angle",{get:function(){return Math.atan2(this.x2-this.x1,this.y2-this.y1)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"slope",{get:function(){return(this.y2-this.y1)/(this.x2-this.x1)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"perpSlope",{get:function(){return-((this.x2-this.x1)/(this.y2-this.y1))},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"yIntercept",{get:function(){return this.y1-this.slope*this.x1},enumerable:true,configurable:true});t.prototype.isPointOnLine=function(e,t){if((e-this.x1)*(this.y2-this.y1)===(this.x2-this.x1)*(t-this.y1)){return true}else{return false}};t.prototype.isPointOnLineSegment=function(e,t){var n=Math.min(this.x1,this.x2);var r=Math.max(this.x1,this.x2);var i=Math.min(this.y1,this.y2);var s=Math.max(this.y1,this.y2);if(this.isPointOnLine(e,t)&&e>=n&&e<=r&&t>=i&&t<=s){return true}else{return false}};t.prototype.intersectLineLine=function(t){return e.Geom.Intersect.lineToLine(this,t)};t.prototype.perp=function(e,n,r){if(this.y1===this.y2){if(r){r.setTo(e,n,e,this.y1)}else{return new t(e,n,e,this.y1)}}var i=n-this.perpSlope*e;var s=this.intersectLineLine({x1:e,y1:n,x2:0,y2:i});if(r){r.setTo(e,n,s.x,s.y)}else{return new t(e,n,s.x,s.y)}};t.prototype.toString=function(){return"[{Line (x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+")}]"};return t}();t.Line=n})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e,t,n,r,i,s){if(typeof e==="undefined"){e=1}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=1}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;this.setTo(e,t,n,r,i,s)}t.prototype.objType=function(){return"Matrix"};t.prototype.setTo=function(e,t,n,r,i,s){if(typeof e==="undefined"){e=1}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=1}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}this.a=e;this.b=t;this.c=n;this.d=r;this.tx=i;this.ty=s;return this};t.prototype.setFromTransform=function(e,t,n,r,i){this.identity();var s=Math.cos(i);var o=Math.sin(i);this.append(s*n,o*n,-o*r,s*r,e,t);return this};t.prototype.setFromOffsetTransform=function(e,t,n,r,i,s,o){this.identity();var u=Math.cos(i);var a=Math.sin(i);this.append(u*n,a*n,-a*r,u*r,e+s,t+o);return this};t.prototype.prepend=function(e,t,n,r,i,s){if(typeof e==="undefined"){e=1}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=1}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}var o=this.tx;var u=this.a;var a=this.c;this.a=u*e+this.b*n;this.b=u*t+this.b*r;this.c=a*e+this.d*n;this.d=a*t+this.d*r;this.tx=o*e+this.ty*n+i;this.ty=o*t+this.ty*r+s;return this};t.prototype.prependMatrix=function(e){var t=this.tx;var n=this.a;var r=this.c;this.a=n*e.a+this.b*e.c;this.b=n*e.b+this.b*e.d;this.c=r*e.a+this.d*e.c;this.d=r*e.b+this.d*e.d;this.tx=t*e.a+this.ty*e.c+e.tx;this.ty=t*e.b+this.ty*e.d+e.ty;return this};t.prototype.append=function(e,t,n,r,i,s){if(typeof e==="undefined"){e=1}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=1}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}var o=this.a;var u=this.b;var a=this.c;var f=this.d;this.a=e*o+t*a;this.b=e*u+t*f;this.c=n*o+r*a;this.d=n*u+r*f;this.tx=i*o+s*a+this.tx;this.ty=i*u+s*f+this.ty;return this};t.prototype.appendMatrix=function(e){var t=this.a;var n=this.b;var r=this.c;var i=this.d;this.a=e.a*t+e.b*r;this.b=e.a*n+e.b*i;this.c=e.c*t+e.d*r;this.d=e.c*n+e.d*i;this.tx=e.tx*t+e.ty*r+this.tx;this.ty=e.tx*n+e.ty*i+this.ty;return this};t.prototype.setPosition=function(e,t){this.tx=e;this.ty=t;return this};t.prototype.setPositionPoint=function(e){this.tx=e.x;this.ty=e.y;return this};t.prototype.getPosition=function(t){if(typeof t==="undefined"){t=new e.Geom.Point}return t.setTo(this.tx,this.ty)};t.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};t.prototype.rotate=function(e){var t=Math.cos(e);var n=Math.sin(e);var r=this.a;var i=this.c;var s=this.tx;this.a=r*t-this.b*n;this.b=r*n+this.b*t;this.c=i*t-this.d*n;this.d=i*n+this.d*t;this.tx=s*t-this.ty*n;this.ty=s*n+this.ty*t;return this};t.prototype.translate=function(e,t){this.tx+=e;this.ty+=t;return this};t.prototype.scale=function(e,t){this.a*=e;this.d*=t;return this};t.prototype.transformPoint=function(e){var t=e.x;var n=e.y;e.x=this.a*t+this.c*n+this.tx;e.y=this.b*t+this.d*n+this.ty;return e};t.prototype.invert=function(){var e=this.a;var t=this.b;var n=this.c;var r=this.d;var i=this.tx;var s=e*r-t*n;this.a=r/s;this.b=-t/s;this.c=-n/s;this.d=e/s;this.tx=(n*this.ty-r*i)/s;this.ty=-(e*this.ty-t*i)/s;return this};t.prototype.copyFrom=function(e){this.a=e.a;this.b=e.b;this.c=e.c;this.d=e.d;this.tx=e.tx;this.ty=e.ty;return this};t.prototype.copyTo=function(e){e.a=this.a;e.b=this.b;e.c=this.c;e.d=this.d;e.tx=this.tx;e.ty=this.ty;return this};t.prototype.clone=function(){return new e.Geom.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)};Object.defineProperty(t.prototype,"toString",{get:function(){return"[{Matrix (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")}]"},enumerable:true,configurable:true});return t}();t.Matrix=n})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e,t){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}this.setTo(e,t)}e.prototype.objType=function(){return"Point"};e.prototype.polar=function(e,t){this.x=e*Math.cos(t*Math.PI/180);this.y=e*Math.sin(t*Math.PI/180);return this};e.prototype.add=function(t,n){if(typeof n==="undefined"){n=new e}return n.setTo(this.x+t.x,this.y+t.y)};e.prototype.addTo=function(e,t){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}return this.setTo(this.x+e,this.y+t)};e.prototype.subtractFrom=function(e,t){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}return this.setTo(this.x-e,this.y-t)};e.prototype.invert=function(){return this.setTo(this.y,this.x)};e.prototype.clamp=function(e,t){this.clampX(e,t);this.clampY(e,t);return this};e.prototype.clampX=function(e,t){this.x=Math.max(Math.min(this.x,t),e);return this};e.prototype.clampY=function(e,t){this.x=Math.max(Math.min(this.x,t),e);this.y=Math.max(Math.min(this.y,t),e);return this};e.prototype.clone=function(t){if(typeof t==="undefined"){t=new e}return t.setTo(this.x,this.y)};e.prototype.copyFrom=function(e){return this.setTo(e.x,e.y)};e.prototype.copyTo=function(e){return e.setTo(this.x,this.y)};e.prototype.angleTo=function(e){return Math.atan2(e.x-this.x,e.y-this.y)};e.prototype.angleToXY=function(e,t){return Math.atan2(e-this.x,t-this.y)};e.prototype.distanceTo=function(e,t){if(typeof t==="undefined"){t=false}var n=this.x-e.x;var r=this.y-e.y;if(t===true){return Math.round(Math.sqrt(n*n+r*r))}else{return Math.sqrt(n*n+r*r)}};e.prototype.distanceToXY=function(e,t,n){if(typeof n==="undefined"){n=false}var r=this.x-e;var i=this.y-t;if(n===true){return Math.round(Math.sqrt(r*r+i*i))}else{return Math.sqrt(r*r+i*i)}};e.distanceBetween=function(e,t,n){if(typeof n==="undefined"){n=false}var r=e.x-t.x;var i=e.y-t.y;if(n===true){return Math.round(Math.sqrt(r*r+i*i))}else{return Math.sqrt(r*r+i*i)}};e.polar=function(t,n){return new e(t*Math.cos(n*Math.PI/180),t*Math.sin(n*Math.PI/180))};e.prototype.distanceCompare=function(e,t){if(this.distanceTo(e)>=t){return true}else{return false}};e.prototype.equals=function(e){if(this.x===e.x&&this.y===e.y){return true}else{return false}};e.interpolate=function(t,n,r){var i=n.x-t.x;var s=n.y-t.y;return new e(n.x-i*r,n.y-s*r)};e.prototype.offset=function(e,t){this.x+=e;this.y+=t;return this};e.prototype.setTo=function(e,t){this.x=e;this.y=t;return this};e.prototype.subtract=function(t,n){if(typeof n==="undefined"){n=new e}return n.setTo(this.x-t.x,this.y-t.y)};e.prototype.getCSS=function(){return this.x+"px "+this.y+"px"};e.prototype.toString=function(){return"[{Point (x="+this.x+" y="+this.y+")}]"};return e}();e.Point=t})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function n(e,t,n,r){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=0}this.x=0;this.y=0;this.width=0;this.height=0;this.setTo(e,t,n,r)}n.prototype.objType=function(){return"Rectangle"};Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){if(e){if(e<this.y){this.height=0}else{this.height=e}}},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"center",{get:function(){var e=new t.Point;return e.setTo(Math.round(this.width/2),Math.round(this.height/2))},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"bottomRight",{get:function(){var e=new t.Point;return e.setTo(this.right,this.bottom)},set:function(e){if(e){this.right=e.x;this.bottom=e.y}},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"left",{get:function(){return this.x},set:function(e){if(e){var t=this.x-e;if(this.width+t<0){this.width=0;this.x=e}else{this.width+=t;this.x=e}}},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},set:function(e){if(e){if(e<this.x){this.width=0}else{this.width=e-this.x}}},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"size",{get:function(){var e=new t.Point;return e.setTo(this.width,this.height)},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"volume",{get:function(){return this.width*this.height},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"perimeter",{get:function(){return this.width*2+this.height*2},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"top",{get:function(){return this.y},set:function(e){if(e){var t=this.y-e;if(this.height+t<0){this.height=0;this.y=e}else{this.height+=t;this.y=e}}},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"topLeft",{get:function(){var e=new t.Point;return e.setTo(this.x,this.y)},set:function(e){if(e){this.x=e.x;this.y=e.y}},enumerable:true,configurable:true});n.prototype.clone=function(e){if(typeof e==="undefined"){e=new n}return e.setTo(this.x,this.y,this.width,this.height)};n.prototype.contains=function(e,t){if(e>=this.x&&e<=this.right&&t>=this.y&&t<=this.bottom){return true}return false};n.prototype.containsPoint=function(e){return this.contains(e.x,e.y)};n.prototype.containsRect=function(e){if(e.volume>this.volume){return false}if(e.x>=this.x&&e.y>=this.y&&e.right<=this.right&&e.bottom<=this.bottom){return true}return false};n.prototype.copyFrom=function(e){return this.setTo(e.x,e.y,e.width,e.height)};n.prototype.copyTo=function(e){if(typeof e==="undefined"){e=new n}return e.copyFrom(this)};n.prototype.equals=function(e){if(this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height){return true}return false};n.prototype.inflate=function(e,t){if(!isNaN(e)&&!isNaN(t)){this.x-=e;this.width+=2*e;this.y-=t;this.height+=2*t}return this};n.prototype.inflatePoint=function(e){return this.inflate(e.x,e.y)};n.prototype.intersection=function(e,t){if(typeof t==="undefined"){t=new n}if(this.intersects(e)===true){t.x=Math.max(e.x,this.x);t.y=Math.max(e.y,this.y);t.width=Math.min(e.right,this.right)-t.x;t.height=Math.min(e.bottom,this.bottom)-t.y}return t};n.prototype.intersects=function(e){if(e.x>this.right-1){return false}if(e.right-1<this.x){return false}if(e.bottom-1<this.y){return false}if(e.y>this.bottom-1){return false}return true};n.prototype.overlap=function(e){var t={top:false,bottom:false,left:false,right:false,contains:false,contained:false};var n=this.intersection(e);if(n.isEmpty)return t;if(this.containsRect(e))t.contains=true;if(e.containsRect(this))t.contained=true;if(this.top<e.top)t.top=true;if(this.bottom>e.bottom)t.bottom=true;if(this.left<e.left)t.left=true;if(this.right>e.right)t.right=true;return t};n.prototype.isEmpty=function(){if(this.width<1||this.height<1){return true}return false};n.prototype.offset=function(e,t){if(!isNaN(e)&&!isNaN(t)){this.x+=e;this.y+=t}return this};n.prototype.offsetPoint=function(e){return this.offset(e.x,e.y)};n.prototype.setEmpty=function(){return this.setTo(0,0,0,0)};n.prototype.setTo=function(e,t,n,r){if(!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&!isNaN(r)){this.x=e;this.y=t;if(n>=0){this.width=n}if(r>=0){this.height=r}}return this};n.prototype.union=function(e,t){if(typeof t==="undefined"){t=new n}return t.setTo(Math.min(e.x,this.x),Math.min(e.y,this.y),Math.max(e.right,this.right),Math.max(e.bottom,this.bottom))};n.prototype.scale=function(t,n,r){var i=new e.Geom.Transform;i.scaleX=t;i.scaleY=n;i.x=r.x;i.y=r.y;var s=this.topLeft;i.transformPoint(s);this.topLeft=s;this.width*=t;this.height*=n;return this};n.prototype.toString=function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" isEmpty="+this.isEmpty()+")}]"};return n}();t.Rectangle=n})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function n(e,n,r,i,s,o,u){if(typeof e==="undefined"){e=0}if(typeof n==="undefined"){n=0}if(typeof r==="undefined"){r=1}if(typeof i==="undefined"){i=1}if(typeof s==="undefined"){s=0}if(typeof o==="undefined"){o=0}if(typeof u==="undefined"){u=0}this._x=0;this._y=0;this._scaleX=1;this._scaleY=1;this._rotation=0;this._rotPointX=0;this._rotPointY=0;this.setTransform(e,n,r,i,s,o,u);this._matrix=new t.Matrix;this._matrix.setFromOffsetTransform(this._x,this._y,this._scaleX,this._scaleY,this._rotation,this._rotPointX,this._rotPointY);this._cachedConcatenatedMatrix=this.getConcatenatedMatrix()}n.prototype.objType=function(){return"Transform"};Object.defineProperty(n.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"rotPointX",{get:function(){return this._rotPointX},set:function(e){this._rotPointX=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"rotPointY",{get:function(){return this._rotPointY},set:function(e){this._rotPointY=e},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"matrix",{get:function(){return this._matrix},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"worldX",{get:function(){return this.getConcatenatedMatrix().tx-this._rotPointX},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"worldY",{get:function(){return this.getConcatenatedMatrix().ty-this._rotPointY},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},set:function(e){if(!this.checkAncestor(e)){this._parent=e}},enumerable:true,configurable:true});n.prototype.setPosition=function(e,t){this._x=e;this._y=t;return this};n.prototype.setPositionFromPoint=function(e){this._x=e.x;this._y=e.y;return this};n.prototype.translatePositionFromPoint=function(e){this._x+=e.x;this._y+=e.y;return this};n.prototype.getPositionPoint=function(t){if(typeof t==="undefined"){t=new e.Geom.Point}return t.setTo(this._x,this._y)};Object.defineProperty(n.prototype,"scale",{set:function(e){this._scaleX=e;this._scaleY=e},enumerable:true,configurable:true});n.prototype.setTransform=function(e,t,n,r,i,s,o){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=1}if(typeof r==="undefined"){r=1}if(typeof i==="undefined"){i=0}if(typeof s==="undefined"){s=0}if(typeof o==="undefined"){o=0}this._x=e;this._y=t;this._scaleX=n;this._scaleY=r;this._rotation=i;this._rotPointX=s;this._rotPointY=o;return this};n.prototype.getParentMatrix=function(){if(this._parent){return this._parent.getConcatenatedMatrix()}return null};n.prototype.getConcatenatedMatrix=function(){this._matrix.setFromOffsetTransform(this._x,this._y,this._scaleX,this._scaleY,this._rotation,this._rotPointX,this._rotPointY);var e=this.getParentMatrix();if(e){var t=this._matrix.clone();t.prependMatrix(e);this._cachedConcatenatedMatrix.copyFrom(t);return t}return this._matrix};n.prototype.transformPoint=function(e){var t=this.getConcatenatedMatrix();return t.transformPoint(e)};n.prototype.copyFrom=function(e){this.setTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.rotPointX,e.rotPointY);this.parent=e.parent;this._matrix=e.matrix.clone();return this};n.prototype.copyTo=function(e){e.copyFrom(this);return this};n.prototype.clone=function(e){if(typeof e==="undefined"){e=new n}e.copyFrom(this);return e};n.prototype.checkAncestor=function(e){return false};Object.defineProperty(n.prototype,"toString",{get:function(){return"[{Transform (x="+this._x+" y="+this._y+" scaleX="+this._scaleX+" scaleY="+this._scaleY+" rotation="+this._rotation+" regX="+this._rotPointX+" regY="+this.rotPointY+" matrix="+this._matrix+")}]"},enumerable:true,configurable:true});return n}();t.Transform=n})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function n(e,t){if(typeof e==="undefined"){e=0}if(typeof t==="undefined"){t=0}this.setTo(e,t)}n.prototype.objType=function(){return"Vector2"};n.fromAngle=function(e){return new n(Math.cos(e),Math.sin(e))};n.randomRadius=function(e){return(new n(Math.random()*2-1,Math.random()*2-1)).multiplyScalar(e)};n.fromPoint=function(e){return new n(e.x,e.y)};n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)};n.prototype.addX=function(e){return new n(this.x+e.x,this.y)};n.prototype.addY=function(e){return new n(this.x,this.y+e.y)};n.prototype.subtract=function(t){return new e.Geom.Vector2(this.x-t.x,this.y-t.y)};n.prototype.multiply=function(t){return new e.Geom.Vector2(this.x*t.x,this.y*t.y)};n.prototype.multiplyScalar=function(t){return new e.Geom.Vector2(this.x*t,this.y*t)};n.prototype.dot=function(e){return this.x*e.x+this.y*e.y};n.prototype.lenSqr=function(){return this.x*this.x+this.y*this.y};n.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};n.prototype.unit=function(){var e=1/this.len();return this.multiplyScalar(e)};n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))};n.prototype.ceil=function(){return new n(Math.ceil(this.x),Math.ceil(this.y))};n.prototype.round=function(){return new n(Math.round(this.x),Math.round(this.y))};n.prototype.clamp=function(e,t){return new n(Math.max(Math.min(this.x,t.x),e.x),Math.max(Math.min(this.y,t.y),e.y))};n.prototype.perp=function(){return new n(-this.y,this.x)};n.prototype.neg=function(){return new n(-this.x,-this.y)};n.prototype.equal=function(e){return this.x===e.x&&this.y===e.y};n.prototype.point=function(){return new t.Point(this.x,this.y)};n.prototype.clear=function(){this.x=0;this.y=0;return this};n.prototype.clone=function(e){if(e){return e.setTo(this.x,this.y)}else{return new n(this.x,this.y)}};n.prototype.copyFrom=function(e){this.x=e.x;this.y=e.y;return this};n.prototype.copyTo=function(e){e.x=this.x;e.y=this.y;return e};n.prototype.setTo=function(e,t){this.x=e;this.y=t;return this};n.prototype.toString=function(){return"[{Vector2 (x="+this.x+" y="+this.y+")}]"};return n}();t.Vector2=n})(e.Geom||(e.Geom={}));var t=e.Geom})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(t,n){this._game=t;this.name=n;this._manager=this._game.huds;this._device=this._game.deviceTargetOption;if(this._manager.supported){switch(this._device){case e.TARGET_BROWSER:this.container=document.createElement("div");this.container.id="HUD-layer-"+t.rnd.uuid();this.container.style.width="100%";this.container.style.height="100%";this.container.style.position="absolute";this._widgets=new Array;break}this.class="kiwi-display"}}t.prototype.objType=function(){return"HUDDisplay"};t.prototype.addWidget=function(t){if(this._manager.supported){this._widgets.push(t);if(this._device==e.TARGET_BROWSER){this.container.appendChild(t.container);return true}}return false};t.prototype.removeWidget=function(e){if(this._manager.supported){if(this.removeFromContainer(e)){var t=this._widgets.indexOf(e);if(t!==-1){this._widgets.splice(t,1);return true}}}return false};t.prototype.removeAllWidgets=function(){for(var e=0;e<this._widgets.length;e++){this.removeFromContainer(this._widgets[e])}this._widgets=[]};t.prototype.removeFromContainer=function(t){if(this._manager.supported){if(this._device==e.TARGET_BROWSER){if(this.container.contains(t.container)){this.container.removeChild(t.container);return true}}}return false};t.prototype.update=function(){for(var e=0;e<this._widgets.length;e++){this._widgets[e].update()}};t.prototype.show=function(){this.container.style.display="block"};t.prototype.hide=function(){this.container.style.display="none"};Object.defineProperty(t.prototype,"class",{get:function(){if(this._device==e.TARGET_BROWSER){return this.container.className}},set:function(t){if(this._device==e.TARGET_BROWSER){this.container.className=t}},enumerable:true,configurable:true});return t}();t.HUDDisplay=n})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._game=e;this._device=this._game.deviceTargetOption}Object.defineProperty(t.prototype,"supported",{get:function(){return this._supported},enumerable:true,configurable:true});t.prototype.boot=function(){if(this._device===e.TARGET_BROWSER){this._supported=true;this._hudContainer=document.createElement("div");this._hudContainer.id="HUDContainer";this._hudContainer.style.position="absolute";this._hudContainer.style.width="100%";this._hudContainer.style.height="100%";this._hudContainer.style.top="0";this._hudContainer.style.left="0";this._game.stage.container.appendChild(this._hudContainer);this._huds=new Array;this._defaultHUD=this.createHUD("defaultHUD");this._currentHUD=this._defaultHUD;this.setHUD(this._defaultHUD)}else{this._supported=false}};t.prototype.objType=function(){return"HUDManager"};Object.defineProperty(t.prototype,"defaultHUD",{get:function(){return this._defaultHUD},set:function(e){if(this._currentHUD===this._defaultHUD){this._currentHUD=e;this.setHUD(this._currentHUD)}this._defaultHUD=e},enumerable:true,configurable:true});t.prototype.setHUD=function(e){if(this.supported){this.hideHUD();this._currentHUD=e;this.showHUD()}};t.prototype.showHUD=function(e){if(typeof e==="undefined"){e=this._currentHUD}e.show()};t.prototype.hideHUD=function(e){if(typeof e==="undefined"){e=this._currentHUD}e.hide()};t.prototype.createHUD=function(t,n){if(typeof n==="undefined"){n=false}if(this.supported){var r=new e.HUD.HUDDisplay(this._game,t);r.hide();this.addToContainer(r);this._huds.push(r);if(n===true)this.setHUD(r);return r}};t.prototype.removeHUD=function(e){if(this.supported){if(e===this._defaultHUD){return false}if(this._currentHUD===e){this.setHUD(this._defaultHUD)}this.removeFromContainer(e);var t=this._huds.indexOf(e);if(t!==-1){this._huds.splice(t,1)}return true}};t.prototype.addToContainer=function(t){if(this._device==e.TARGET_BROWSER){this._hudContainer.appendChild(t.container)}};t.prototype.removeFromContainer=function(t){if(this._device==e.TARGET_BROWSER){if(this._hudContainer.contains(t.container)){this._hudContainer.removeChild(t.container)}}};t.prototype.update=function(){if(this._supported){for(var e=0;e<this._huds.length;e++){this._huds[e].update()}}};return t}();t.HUDManager=n})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(t,n,r,i){this.name=n;this.game=t;this._manager=this.game.huds;this._device=this.game.deviceTargetOption;this.components=new e.ComponentManager(e.HUD_WIDGET,this);if(this._manager.supported){if(this._device===e.TARGET_BROWSER){this.container=document.createElement("div");this.container.id="HUD-widget-"+this.game.rnd.uuid();this.container.className="HUD-widget";this.container.style.position="absolute"}this.onCoordsUpdate=new e.Signal;this.x=r;this.y=i}}t.prototype.objType=function(){return"HUDWidget"};Object.defineProperty(t.prototype,"style",{get:function(){if(this._device===e.TARGET_BROWSER){return this.container.style}},set:function(t){if(this._device===e.TARGET_BROWSER){this.container.style=t}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){if(this._manager.supported){this._x=t;if(this._device==e.TARGET_BROWSER)this.container.style.left=this.x+"px";this.onCoordsUpdate.dispatch(this.x,this.y)}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){if(this._manager.supported){this._y=t;if(this._device==e.TARGET_BROWSER)this.container.style.top=this.y+"px";this.onCoordsUpdate.dispatch(this.x,this.y)}},enumerable:true,configurable:true});t.prototype.setTemplate=function(t,n){var r=[];for(var i=0;i<arguments.length-2;i++){r[i]=arguments[i+2]}if(this._device==e.TARGET_BROWSER){var s=document.getElementById(t);if(s===undefined){return}if(n===undefined){var o=s}else{var o=document.getElementById(n);if(o===undefined||s.contains(o)===false){return}}this.tempElement=o;this._tempContainer=s;this._tempParent=s.parentElement;this._tempParent.removeChild(s);this.container.appendChild(s)}};t.prototype.removeTemplate=function(){if(this._device==e.TARGET_BROWSER){if(this.tempElement!==undefined){this.container.removeChild(this._tempContainer);this._tempParent.appendChild(this._tempContainer);this.tempElement=null;this._tempParent=null;this._tempContainer=null}}};Object.defineProperty(t.prototype,"class",{get:function(){if(this._device==e.TARGET_BROWSER){return this.container.className}},set:function(t){if(this._device==e.TARGET_BROWSER){this.container.className=t}},enumerable:true,configurable:true});t.prototype.update=function(){this.components.update()};t.prototype.destroy=function(){delete this.game;delete this._manager;delete this._device;if(this.onCoordsUpdate)this.onCoordsUpdate.dispose();delete this.onCoordsUpdate};return t}();t.HUDWidget=n})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r,i,s){t.call(this,n,"textField",i,s);this._prefix="";this._suffix="";this.class="kiwi-textfield-widget kiwi-widget";if(this._manager.supported){if(this._device===e.TARGET_BROWSER){this._textField=this.container;this._textField.innerHTML=r}}}__extends(n,t);n.prototype.objType=function(){return"TextFieldWidget"};n.prototype.setTemplate=function(n,r){if(this._device===e.TARGET_BROWSER){this._textField.innerText="";t.prototype.setTemplate.call(this,n,r);if(this.tempElement!==undefined){this._textField=this.tempElement}this._textField.innerHTML=this._text}};n.prototype.removeTemplate=function(){if(this._device===e.TARGET_BROWSER){t.prototype.removeTemplate.call(this);if(this._device===e.TARGET_BROWSER){this._textField=this.container;this._textField.innerHTML=this._text}}};Object.defineProperty(n.prototype,"text",{get:function(){return this._text},set:function(t){if(this._manager.supported){if(this._device===e.TARGET_BROWSER){if(this._prefix!=="")t=this._prefix+t;if(this._suffix!=="")t+=this._suffix;this._text=t;this._textField.innerHTML=this._text}}},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"suffix",{get:function(){return this._suffix},set:function(e){this._suffix=e;this._updateText()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"prefix",{get:function(){return this._prefix},set:function(e){this._prefix=e;this._updateText()},enumerable:true,configurable:true});n.prototype._updateText=function(){this.text=this._text};return n}(e.HUD.HUDWidget);t.TextField=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r,i,s,o,u,a,f){if(typeof u==="undefined"){u=120}if(typeof a==="undefined"){a=20}if(typeof f==="undefined"){f="#000"}t.call(this,n,"bar",s,o);this._horizontal=true;this.class="kiwi-bar-widget kiwi-widget";if(this._manager.supported){if(this._device==e.TARGET_BROWSER){this._bar=document.createElement("div");this._bar.className="kiwi-innerbar-widget";this._bar.style.backgroundColor=f;this.bar=this._bar;this.container.appendChild(this.bar)}this.counter=this.components.add(new e.HUD.HUDComponents.Counter(this,r,i,0));this.counter.updated.add(this.updateCSS,this);this.width=u;this.height=a;this._bar.style.height="100%";this._bar.style.width="100%";this.updateCSS()}}__extends(n,t);n.prototype.objType=function(){return"BarWidget"};Object.defineProperty(n.prototype,"width",{get:function(){return this._width},set:function(t){if(this._device==e.TARGET_BROWSER){this.container.style.width=t+"px"}this._width=t},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(t){if(this._device==e.TARGET_BROWSER){this.container.style.height=t+"px"}this._height=t},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"horizontal",{get:function(){return this._horizontal},set:function(e){this._horizontal=e;this.updateCSS()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"vertical",{get:function(){return!this._horizontal},set:function(e){this._horizontal=!e;this.updateCSS()},enumerable:true,configurable:true});n.prototype.setTemplate=function(n,r){if(this._device==e.TARGET_BROWSER){t.prototype.setTemplate.call(this,n,r);if(this.tempElement!==undefined){this.bar=this.tempElement}}};n.prototype.removeTemplate=function(){if(this._device==e.TARGET_BROWSER){t.prototype.removeTemplate.call(this);this.bar=this._bar;this.container.appendChild(this.bar);this.updateCSS()}};n.prototype.updateCSS=function(){if(this.horizontal===true){this.bar.style.width=String(this.counter.currentPercent())+"%";this.bar.style.height="100%"}else{this.bar.style.height=String(this.counter.currentPercent())+"%";this.bar.style.width="100%"}};return n}(e.HUD.HUDWidget);t.Bar=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(e,n,r,i){t.call(this,e,"Icon",r,i);this._cellIndex=0;this.class="kiwi-icon-widget kiwi-widget";this.atlas=n;this.icon=this.container;this._applyCSS()}__extends(n,t);Object.defineProperty(n.prototype,"cellIndex",{get:function(){return this._cellIndex},set:function(e){this._cellIndex=e;this.width=this.atlas.cells[this.cellIndex].w;this.height=this.atlas.cells[this.cellIndex].h;this._applyCSS()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"width",{get:function(){return this.atlas.cells[this.cellIndex].w},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"height",{get:function(){return this.atlas.cells[this.cellIndex].h},enumerable:true,configurable:true});n.prototype._removeCSS=function(){this.icon.style.width="";this.icon.style.height="";this.icon.style.backgroundImage="";this.icon.style.backgroundRepeat=""};n.prototype._applyCSS=function(){this.icon.style.width=this.width+"px";this.icon.style.height=this.height+"px";this.icon.style.backgroundPositionX=-this.atlas.cells[this.cellIndex].x+"px";this.icon.style.backgroundPositionY=-this.atlas.cells[this.cellIndex].y+"px";this.icon.style.backgroundRepeat="no-repeat";if(e.Utils.Common.isUndefined(this.atlas.image.src)==false){this.icon.style.backgroundImage='url("'+this.atlas.image.src+'")'}else{this.icon.style.backgroundImage='url("'+this.atlas.image.toDataURL("image/png")+'")'}};n.prototype.setTemplate=function(n,r){if(this._device==e.TARGET_BROWSER){this._removeCSS();t.prototype.setTemplate.call(this,n,r);if(this.tempElement!==undefined){this.icon=this.tempElement}this._applyCSS()}};n.prototype.removeTemplate=function(){if(this._device==e.TARGET_BROWSER){t.prototype.removeTemplate.call(this);this._removeCSS();this.icon=this.container;this._applyCSS()}};return n}(e.HUD.HUDWidget);t.Icon=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r,i,s,o,u){t.call(this,n,"IconBar",o,u);this.iconGap=0;this.class="kiwi-iconbar-widget kiwi-widget";this.atlas=r;this.width=this.atlas.cells[0].w;this.height=this.atlas.cells[0].h;this._horizontal=true;this.counter=this.components.add(new e.HUD.HUDComponents.Counter(this,i,s,0));this.counter.updated.add(this._amountChanged,this);this._icons=[];this._amountChanged()}__extends(n,t);n.prototype.objType=function(){return"IconBarWidget"};n.prototype._amountChanged=function(){if(this.counter.max!==this._icons.length){if(this.counter.max>this._icons.length){var e=this.counter.max-this._icons.length;for(var t=0;t<e;t++){this._addIcon()}}else{for(var t=this.counter.max;t<this._icons.length;t++){this._removeIcon(this._icons[t]);this._icons[t].destroy();this._icons.splice(t,1);t--}}}for(var t=0;t<this._icons.length;t++){if(t>this.counter.current-1){this._icons[t].style.display="none"}else{this._icons[t].style.display="block"}}};n.prototype._addIcon=function(){if(this.horizontal){var t=new e.HUD.Widget.Icon(this.game,this.atlas,this.x+(this.width+this.iconGap)*(this._icons.length-1),this.y)}else{var t=new e.HUD.Widget.Icon(this.game,this.atlas,this.x,(this.height+this.iconGap)*(this._icons.length-1)+this.y)}this._icons.push(t);if(this._device==e.TARGET_BROWSER){this.container.appendChild(t.container)}};n.prototype._removeIcon=function(t){if(this._device==e.TARGET_BROWSER){this.container.removeChild(t.container)}};Object.defineProperty(n.prototype,"horizontal",{get:function(){return this._horizontal},set:function(e){this._horizontal=e;this._amountChanged()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"vertical",{get:function(){return!this._horizontal},set:function(e){this._horizontal=!e;this._amountChanged()},enumerable:true,configurable:true});return n}(e.HUD.HUDWidget);t.IconBar=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r,i,s){if(typeof s==="undefined"){s=0}t.call(this,n,"basicScore",r,i);this.name="basicScore";this.class="kiwi-basicscore-widget kiwi-widget";this.counter=this.components.add(new e.HUD.HUDComponents.Counter(this,s));this.counter.updated.add(this._updateText,this);this._updateText()}__extends(n,t);n.prototype.objType=function(){return"BasicScoreWidget"};n.prototype._updateText=function(){this.text=String(this.counter.current)};return n}(e.HUD.Widget.TextField);t.BasicScore=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r,i,s){t.call(this,n,r,i,s);this.name="button";this.class="kiwi-button-widget kiwi-widget";this.input=this.components.add(new e.HUD.HUDComponents.WidgetInput(this,this.container))}__extends(n,t);n.prototype.objType=function(){return"ButtonWidget"};return n}(e.HUD.Widget.TextField);t.Button=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r,i,s){t.call(this,n,"time",i,s);this.name="time";this.class="kiwi-time-widget kiwi-widget";this.time=this.components.add(new e.HUD.HUDComponents.Time(this,r))}__extends(n,t);n.prototype.objType=function(){return"TimeWidget"};n.prototype.pause=function(){this.time.pause()};n.prototype.stop=function(){this.time.stop()};n.prototype.start=function(){this.time.start()};n.prototype.resume=function(){this.time.resume()};n.prototype.update=function(){t.prototype.update.call(this);if(this.time.isRunning){this.text=this.time.getTime()}};return n}(e.HUD.Widget.TextField);t.Time=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(e,n,r){t.call(this,e,"menu",n,r);this._menuItems=[];this._styles=[];this.class="kiwi-menu-widget kiwi-widget"}__extends(n,t);n.prototype.objType=function(){return"MenuWidget"};n.prototype.setIconStyle=function(e,t){this._styles.push({index:e,value:t});for(var n=0;n<this._menuItems.length;n++){this._menuItems[n].style[e]=t}};Object.defineProperty(n.prototype,"menuItems",{get:function(){return this._menuItems},enumerable:true,configurable:true});n.prototype.createMenuItem=function(t,n,r){return this.addMenuItem(new e.HUD.Widget.MenuItem(this.game,t,n,r))};n.prototype.addMenuItem=function(t){this._menuItems.push(t);t.menu=this;for(var n=0;n<this._styles.length;n++){t.style[this._styles[n].index]=this._styles[n].value}if(this._device==e.TARGET_BROWSER){this.container.appendChild(t.container)}return t};n.prototype.addMenuItems=function(e){for(var t=0;t<e.length;t++){this.addMenuItem(e[t])}};n.prototype.getMenuItem=function(e){return this._menuItems[e]};n.prototype.setTemplate=function(e,n){if(false){var r=document.getElementById(e);if(r===undefined){return}var i=r.getElementsByTagName(n);if(i===undefined){return}t.prototype.setTemplate.call(this,e)}};n.prototype.removeTemplate=function(){};n.prototype.update=function(){for(var e=0;e<this._menuItems.length;e++){this._menuItems[e].update()}t.prototype.update.call(this)};return n}(e.HUD.HUDWidget);t.Menu=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(e){function t(t,n,r,i){e.call(this,t,n,r,i);this.name="menuItem";this.class="kiwi-menuitem-widget kiwi-widget"}__extends(t,e);t.prototype.objType=function(){return"MenuItem"};return t}(e.HUD.Widget.Button);t.MenuItem=n})(t.Widget||(t.Widget={}));var n=t.Widget})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r,i,s){if(typeof i==="undefined"){i=null}if(typeof s==="undefined"){s=null}t.call(this,n,"counter");this._current=r;this._max=i;this._min=s;this.updated=new e.Signal}__extends(n,t);n.prototype.objType=function(){return"CounterComponent"};Object.defineProperty(n.prototype,"max",{get:function(){return this._max},set:function(e){this._max=e;this.updated.dispatch(this._current,this._max,this._min)},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"min",{get:function(){return this._min},set:function(e){this._min=e;this.updated.dispatch(this._current,this._max,this._min)},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"current",{get:function(){return this._current},set:function(e){if(this._max!==null&&e>this._max){this._current=this._max}else if(this._min!==null&&e<this._min){this._current=this._min}else{this._current=e}this.updated.dispatch(this._current,this._max,this._min)},enumerable:true,configurable:true});n.prototype.decrease=function(e){if(typeof e==="undefined"){e=1}if(this._min===null||this._current>this._min){if(this._min!==null&&this._current-e<this._min){this._current=this._min}else{this._current-=e}this.updated.dispatch(this._current,this._max,this._min)}return this._current};n.prototype.increase=function(e){if(typeof e==="undefined"){e=1}if(this._max===null||this._current<this._max){if(this._max!==null&&this._current+e>this._max){this._current=this._max}else{this._current+=e}this.updated.dispatch(this._current,this._max,this._min)}return this._current};n.prototype.currentPercent=function(){if(this.max!==null)return this.current/this.max*100};return n}(e.Component);t.Counter=n})(t.HUDComponents||(t.HUDComponents={}));var n=t.HUDComponents})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(t){function n(n,r){t.call(this,n,"WidgetInput");this._active=false;this._container=r;this.onUp=new e.Signal;this.onDown=new e.Signal;this.onOver=new e.Signal;this.onOut=new e.Signal;this._addEvents()}__extends(n,t);n.prototype.objType=function(){return"WidgetInputComponent"};n.prototype.setElement=function(e){this._removeEvents();this._container=e;this._addEvents()};n.prototype._addEvents=function(){if(!this._active){this._binds=[];this._binds.push({event:"mouseup","function":this._up.bind(this)});this._binds.push({event:"mousedown","function":this._down.bind(this)});this._binds.push({event:"mouseover","function":this._over.bind(this)});this._binds.push({event:"mouseout","function":this._out.bind(this)});for(var e=0;e<this._binds.length;e++){this._container.addEventListener(this._binds[e].event,this._binds[e].function,false)}this._active=true}};n.prototype._removeEvents=function(){if(this._active){for(var e=0;e<this._binds.length;e++){this._container.removeEventListener(this._binds[e].event,this._binds[e].function,false)}this._binds=[];this._active=false}};n.prototype._up=function(e){this.onUp.dispatch(e)};n.prototype._down=function(e){this.onDown.dispatch(e)};n.prototype._over=function(e){this.onOver.dispatch(e)};n.prototype._out=function(e){this.onOut.dispatch(e)};return n}(e.Component);t.WidgetInput=n})(t.HUDComponents||(t.HUDComponents={}));var n=t.HUDComponents})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){(function(t){var n=function(e){function t(t,n){if(typeof n==="undefined"){n=""}e.call(this,t,"time");this.countDown=false;this._displayString="";this._currentTime=0;this._timeBefore=0;this.speed=1;this.clock=this.game.time.addClock(name+"-clock",1e3);this.format=n}__extends(t,e);t.prototype.objType=function(){return"TimeComponent"};Object.defineProperty(t.prototype,"isRunning",{get:function(){return this.clock.isRunning()},enumerable:true,configurable:true});t.prototype.pause=function(){this.clock.pause()};t.prototype.stop=function(){this.clock.stop()};t.prototype.start=function(){this.clock.start();this._timeBefore=this.clock.elapsed()};t.prototype.resume=function(){this.clock.resume()};Object.defineProperty(t.prototype,"format",{get:function(){return this._format},set:function(e){this._format=e},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:true,configurable:true});t.prototype.setTime=function(e,t,n){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}this._currentTime=e;if(t!=0)this._currentTime+=t*1e3;if(n!=0)this._currentTime+=n*60*1e3};t.prototype.addTime=function(e,t,n){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}this._currentTime+=e;if(t!=0)this._currentTime+=t*1e3;if(n!=0)this._currentTime+=n*60*1e3};t.prototype.removeTime=function(e,t,n){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=0}this._currentTime-=e;if(t!=0)this._currentTime-=t*1e3;if(n!=0)this._currentTime-=n*60*1e3};t.prototype.getTime=function(){if(this.countDown){this._currentTime-=(this.clock.elapsed()-this._timeBefore)*this.speed}else{this._currentTime+=(this.clock.elapsed()-this._timeBefore)*this.speed}this._timeBefore=this.clock.elapsed();if(this._format!==""){this._displayString=this._format;if(this._displayString.indexOf("ms")!==-1){var e=String(Math.floor(this._currentTime*1e3)%1e3);this._displayString=this._displayString.replace("ms",e)}if(this._displayString.indexOf("ss")!=-1){var e=String(Math.floor(this._currentTime)%60);if(e.length<2)e="0"+e;this._displayString=this._displayString.replace("ss",e)}if(this._displayString.indexOf("mm")!==-1){var e=String(Math.floor(this._currentTime/60)%60);if(e.length<2)e="0"+e;this._displayString=this._displayString.replace("mm",e)}if(this._displayString.indexOf("s")!=-1){var e=String(Math.floor(this._currentTime)%60);this._displayString=this._displayString.replace("s",e)}if(this._displayString.indexOf("m")!==-1){var e=String(Math.floor(this._currentTime/60)%60);this._displayString=this._displayString.replace("m",e)}return this._displayString}else{return String(this._currentTime.toFixed(2))}};return t}(e.Component);t.Time=n})(t.HUDComponents||(t.HUDComponents={}));var n=t.HUDComponents})(e.HUD||(e.HUD={}));var t=e.HUD})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this.noAudio=false;this.usingWebAudio=false;this.usingAudioTag=false;this.context=null;this.masterGain=null;this._unlockedSource=null;this._game=e}t.prototype.objType=function(){return"AudioManager"};Object.defineProperty(t.prototype,"locked",{get:function(){return this._locked},enumerable:true,configurable:true});t.prototype.boot=function(){this._volume=1;this._muted=false;this._sounds=[];if(e.DEVICE.iOS&&e.DEVICE.webaudio==false){this.channels=1}if(e.DEVICE.iOS&&this._game.deviceTargetOption!==e.TARGET_COCOON){this._locked=true;this._game.input.onUp.addOnce(this._unlocked,this);console.log("Kiwi.AudioManager: Audio is currently Locked until at touch event.")}else{this._locked=false}this.usingWebAudio=true;this.usingAudioTag=false;if(!!window["AudioContext"]){this.context=new window["AudioContext"]}else if(!!window["webkitAudioContext"]){this.context=new window["webkitAudioContext"]}else if(!!window["Audio"]){this.usingWebAudio=false;this.usingAudioTag=true}else{this.usingWebAudio=false;this.noAudio=true}if(this.context!==null){if(this.context.createGain===undefined){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}};t.prototype._unlocked=function(){console.log("Kiwi.AudioManager: Audio now Unlocked");if(this.usingAudioTag){this._locked=false;for(var e=0;e<this._sounds.length;e++){this._sounds[e].playable=true}}else{var t=this.context.createBuffer(1,1,22050);this._unlockedSource=this.context.createBufferSource();this._unlockedSource.buffer=t;this._unlockedSource.connect(this.context.destination);this._unlockedSource.noteOn(0)}};Object.defineProperty(t.prototype,"mute",{get:function(){return this._muted},set:function(e){if(e===true){if(this._muted)return;this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}else if(this.usingAudioTag){for(var t=0;t<this._sounds.length;t++){this._sounds[t].mute=true}}}else{if(this._muted==false)return;this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}else if(this.usingAudioTag){for(var t=0;t<this._sounds.length;t++){this._sounds[t].mute=false}}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t!==undefined){t=e.Utils.GameMath.clamp(t,1,0);this._volume=t;if(this._muted){this._muteVolume=this._volume}if(this.usingWebAudio){this.masterGain.gain.value=t}else if(this.usingAudioTag){for(var n=0;n<this._sounds.length;n++){this._sounds[n].volume=this._sounds[n].volume}}}},enumerable:true,configurable:true});t.prototype.isRegistered=function(e){if(this.noAudio)return;if(this._sounds.indexOf(e)!==-1){return true}else{return false}};t.prototype.registerSound=function(e){if(this.isRegistered(e)===false){e.id=this._game.rnd.uuid();this._sounds.push(e);return true}return false};t.prototype.add=function(t,n,r){if(typeof n==="undefined"){n=1}if(typeof r==="undefined"){r=false}if(this.noAudio)return;var i=new e.Sound.Audio(this._game,t,n,r);return i};t.prototype.remove=function(e,t){if(typeof t==="undefined"){t=true}for(var n=0;n<this._sounds.length;n++){if(e.id==this._sounds[n].id){if(this.usingWebAudio)this._sounds[n].gainNode.disconnect();if(t==true)this._sounds[n].destroy();this._sounds.splice(n,1,0);return}}};t.prototype.playAll=function(){for(var e=0;e<this._sounds.length;e++){if(this._sounds[e]){this._sounds[e].play()}}};t.prototype.stopAll=function(){for(var e=0;e<this._sounds.length;e++){if(this._sounds[e]){this._sounds[e].stop()}}};t.prototype.pauseAll=function(){for(var e=0;e<this._sounds.length;e++){if(this._sounds[e]){this._sounds[e].pause()}}};t.prototype.resumeAll=function(){for(var e=0;e<this._sounds.length;e++){if(this._sounds[e]){this._sounds[e].resume()}}};t.prototype.update=function(){if(this._locked){if(this.usingWebAudio&&this._unlockedSource!==null){if(this._unlockedSource.playbackState===this._unlockedSource.PLAYING_STATE||this._unlockedSource.playbackState===this._unlockedSource.FINISHED_STATE){this._locked=false;this._unlockedSource=null;for(var e=0;e<this._sounds.length;e++){this._sounds[e].playable=true}}}}if(!this.noAudio){for(var e=0;e<this._sounds.length;e++){this._sounds[e].update()}}};return t}();t.AudioManager=n})(e.Sound||(e.Sound={}));var t=e.Sound})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(t,n,r,i){this._muted=false;this.totalDuration=0;this._buffer=null;this._decoded=false;this._markers=[];this._currentMarker="default";this.ready=false;this._game=t;this._game.audio.registerSound(this);this._usingAudioTag=this._game.audio.usingAudioTag;this._usingWebAudio=this._game.audio.usingWebAudio;this._playable=this._game.audio.locked==true?false:true;this.duration=0;this._volume=r;this._muteVolume=r;this._muted=this._game.audio.mute;this._loop=i;this.key=n;if(this._game.audio.noAudio||this._game.fileStore.exists(this.key)===false){if(this._game.debugOption)console.log("Could not play Audio. Either the browser doesn't support audio or the Audio file was not found on the filestore");return}if(this._usingWebAudio){this._setAudio();if(this.ready){this.context=this._game.audio.context;this.masterGainNode=this._game.audio.masterGain;if(typeof this.context.createGain==="undefined"){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this._decode();this.gainNode.gain.value=this.volume*this._game.audio.volume;this.gainNode.connect(this.masterGainNode)}}else if(this._usingAudioTag){if(this._playable===true){this._setAudio();if(this.ready){this.totalDuration=this._sound.duration;this._sound.volume=this.volume*this._game.audio.volume;if(isNaN(this.totalDuration)||this.totalDuration==0)this._pending=true}}}this.addMarker("default",0,this.totalDuration,this._loop);this._currentMarker="default";this.onPlay=new e.Signal;this.onStop=new e.Signal;this.onPause=new e.Signal;this.onResume=new e.Signal;this.onLoop=new e.Signal;this.onMute=new e.Signal}Object.defineProperty(t.prototype,"playable",{get:function(){return this._playable},set:function(e){if(this._playable!==true&&e==true){this._playable=e;this._setAudio();if(this.ready&&this._usingAudioTag){this.totalDuration=this._sound.duration;this._sound.volume=this.volume*this._game.audio.volume}}},enumerable:true,configurable:true});t.prototype.objType=function(){return"Audio"};t.prototype._setAudio=function(){this._file=this._game.fileStore.getFile(this.key);if(typeof this._file.data=="undefined")return;if(this._usingAudioTag){this._sound=this._file.data.cloneNode(true);this._sound.play();this._sound.pause()}else{this._sound=this._file.data}this.ready=true};t.prototype._decode=function(){if(this.ready==false||this._usingAudioTag)return;if(this._file.data.decoded===true&&this._file.data.buffer!==null){this._buffer=this._file.data.buffer;this._decoded=true;return}var e=this;this.context.decodeAudioData(this._file.data.raw,function(t){e._buffer=t;e._decoded=true})};Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this._game.audio.noAudio||this.ready===false)return;t=e.Utils.GameMath.clamp(t,1,0);this._volume=t;if(this._muted){this._muteVolume=this._volume}if(this._playable){if(this._usingWebAudio){this.gainNode.gain.value=this._volume*this._game.audio.volume}else if(this._usingAudioTag){this._sound.volume=this._volume*this._game.audio.volume}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"mute",{get:function(){return this._muted},set:function(e){if(this._game.audio.noAudio)return;if(e!==undefined&&this._muted!==e){if(e===true){this._muteVolume=this._volume;this.volume=0;this._muted=true}else{this._muted=false;this.volume=this._muteVolume}this.onMute.dispatch(this._muted)}},enumerable:true,configurable:true});t.prototype.addMarker=function(e,t,n,r){if(typeof r==="undefined"){r=false}this._markers[e]={start:t,stop:n,duration:n-t,loop:r}};t.prototype.removeMarker=function(e){if(e==="default")return;if(this.isPlaying&&this._currentMarker==e){this.stop();this._currentMarker="default"}delete this._markers[e]};t.prototype.play=function(t,n){if(typeof t==="undefined"){t=this._currentMarker}if(typeof n==="undefined"){n=false}if(this.isPlaying&&n==false||this._game.audio.noAudio)return;if(n===true&&this._pending===false)this.stop();if(typeof this._markers[t]=="undefined")return;if(this._currentMarker===t&&this.isPlaying&&n==false)return;this.paused=false;this._currentMarker=t;this.duration=this._markers[this._currentMarker].duration*1e3;this._loop=this._markers[this._currentMarker].loop;if(this._playable===false){this._pending=true;return}if(this._usingWebAudio){if(this._decoded===true){if(this._buffer==null)this._buffer=this._file.data.buffer;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this._sound.connect(this.gainNode);this.totalDuration=this._sound.buffer.duration;if(this.duration==0)this.duration=this.totalDuration*1e3;if(this._loop)this._sound.loop=true;if(this._sound.start===undefined){this._sound.noteGrainOn(0,this._markers[this._currentMarker].start,this.duration/1e3)}else{this._sound.start(0,this._markers[this._currentMarker].start,this.duration/1e3)}this.isPlaying=true;this._startTime=this._game.time.now();this._currentTime=0;this._stopTime=this._startTime+this.duration;this.onPlay.dispatch()}else{this._pending=true;this._decode()}}else if(this._usingAudioTag){if(this._sound&&this._sound.readyState==4||this._game.deviceTargetOption==e.TARGET_COCOON){if(this.duration==0||isNaN(this.duration))this.duration=this.totalDuration*1e3;if(this._muted)this._sound.volume=0;else this._sound.volume=this._volume;this._sound.currentTime=this._markers[this._currentMarker].start;this._sound.play();this.isPlaying=true;this._startTime=this._game.time.now();this._currentTime=0;this._stopTime=this._startTime+this.duration;if(!this.paused)this.onPlay.dispatch()}else{this._pending=true}}};t.prototype.stop=function(){if(this.isPlaying&&this._sound){if(this._usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{this._sound.stop(0)}}else if(this._usingAudioTag){this._sound.pause();this._sound.currentTime=0}this.isPlaying=false;if(this.paused==false)this.onStop.dispatch()}};t.prototype.pause=function(){if(this.isPlaying){this.paused=true;this.stop();this.onPause.dispatch()}};t.prototype.resume=function(){if(this.paused&&this.isPlaying==false){if(this._usingWebAudio){if(this._buffer==null)this._buffer=this._file.data.buffer;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this._sound.connect(this.gainNode);if(this._sound.start===undefined){this._sound.noteGrainOn(0,this._markers[this._currentMarker].start+this._currentTime/1e3,this.duration/1e3)}else{this._sound.start(0,this._markers[this._currentMarker].start+this._currentTime/1e3,this.duration/1e3)}}else{this._sound.currentTime=this._markers[this._currentMarker].start+this._currentTime/1e3;this._sound.play()}this.paused=false;this.isPlaying=true;this.onResume.dispatch()}};t.prototype.update=function(){if(!this.ready)return;if(this._playable&&this._pending){if(this._decoded===true||this._file.data&&this._file.data.decoded){this._pending=false;this.play()}else if(this._usingAudioTag&&!isNaN(this._sound.duration)||this._game.deviceTargetOption==e.TARGET_COCOON&&this._sound.duration!==0){this.totalDuration=this._sound.duration;this._markers["default"].duration=this.totalDuration;this._pending=false;if(this.isPlaying&&this._currentMarker=="default")this.duration=this.totalDuration}}if(this.isPlaying){this._currentTime=this._game.time.now()-this._startTime;if(this._currentTime>=this.duration){if(this._usingWebAudio){if(this._loop){if(this._currentMarker=="default"){this._currentTime=0;this._startTime=this._game.time.now()}else{this.play(this._currentMarker,true)}this.onLoop.dispatch()}else{this.stop()}}else if(this._usingAudioTag){if(this._loop){this.play(this._currentMarker,true);this.onLoop.dispatch()}else{this.stop()}}}}};t.prototype.destroy=function(){if(this._game){this._game.audio.remove(this)}if(this.onLoop)this.onLoop.dispose();if(this.onStop)this.onStop.dispose();if(this.onPlay)this.onPlay.dispose();if(this.onMute)this.onMute.dispose();if(this.onPause)this.onPause.dispose();if(this.onResume)this.onResume.dispose();delete this.onLoop;delete this.onStop;delete this.onPause;delete this.onMute;delete this.onPlay;delete this.onResume;delete this._game;delete this._sound;delete this._currentTime;delete this._startTime;delete this._stopTime;delete this._pending;delete this.masterGainNode;delete this.gainNode;delete this.totalDuration;delete this.duration;delete this._file;delete this._buffer;delete this._decoded};return t}();t.Audio=n})(e.Sound||(e.Sound={}));var t=e.Sound})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e){this._game=e;this.audio={}}t.prototype.objType=function(){return"AudioLibrary"};t.prototype.clear=function(){for(var e in this.audio){delete this.audio[e]}};t.prototype.rebuild=function(e,t){this.clear();if(this._game.debug){console.log("Kiwi.AudioLibrary: Rebuilding Audio Library")}var n=e.keys;for(var r=0;r<n.length;r++){var i=this._game.fileStore.getFile(n[r]);if(i.isAudio){if(this._game.debug){console.log("  Kiwi.AudioLibrary: Adding Audio: "+i.fileName)}t.audioLibrary.add(i)}}};t.prototype.add=function(t){switch(t.dataType){case e.Files.File.AUDIO:this.audio[t.key]=t;break;default:break}};return t}();t.AudioLibrary=n})(e.Sound||(e.Sound={}));var t=e.Sound})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function t(e,t,n,r){if(typeof r==="undefined"){r=1e3}this._timeFirstStarted=null;this._timeLastStarted=null;this._timeLastStopped=null;this._timeLastPaused=null;this._timeLastUnpaused=null;this._totalPaused=0;this._isRunning=false;this._isStopped=true;this._isPaused=false;this._elapsedState=0;this.manager=null;this.master=null;this.name=null;this.units=0;this.manager=e;this.master=t;this.name=n;this.units=r;this.timers=[];if(this.units<1){this.units=1}}t.prototype.objType=function(){return"Clock"};t.prototype.elapsedSinceFirstStarted=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeFirstStarted)/this.units:null};t.prototype.started=function(){return this._timeLastStarted};t.prototype.elapsed=function(){if(this._elapsedState===0){return this._timeLastStarted?(this.master.elapsed()-this._timeLastStarted-this._totalPaused)/this.units:null}else if(this._elapsedState===1){return(this._timeLastPaused-this._timeLastStarted-this._totalPaused)/this.units}else if(this._elapsedState===2){return this._timeLastStarted?(this.master.elapsed()-this._timeLastStarted-this._totalPaused)/this.units:null}else if(this._elapsedState===3){return(this._timeLastStopped-this._timeLastStarted-this._totalPaused)/this.units}};t.prototype.elapsedSinceLastStopped=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastStopped)/this.units:null};t.prototype.elapsedSinceLastPaused=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastPaused)/this.units:null};t.prototype.elapsedSinceLastUnpaused=function(){return this._timeLastStarted?(this.master.elapsed()-this._timeLastUnpaused)/this.units:null};t.prototype.isRunning=function(){return this._isRunning};t.prototype.isStopped=function(){return this._isStopped};t.prototype.isPaused=function(){return this._isPaused};t.prototype.addTimer=function(e){this.timers.push(e);return this};t.prototype.createTimer=function(t,n,r,i){if(typeof n==="undefined"){n=1}if(typeof r==="undefined"){r=0}if(typeof i==="undefined"){i=true}this.timers.push(new e.Timer(t,this,n,r));if(i===true){this.timers[this.timers.length-1].start()}return this.timers[this.timers.length-1]};t.prototype.removeTimer=function(e,t){if(typeof e==="undefined"){e=null}if(typeof t==="undefined"){t=""}if(e!==null){if(this.timers[e.name]){delete this.timers[e.name];return true}else{return false}}if(t!==""){if(this.timers[t]){delete this.timers[t];return true}else{return false}}return false};t.prototype.checkExists=function(e){if(this.timers[e]){return true}else{return false}};t.prototype.stopAllTimers=function(){for(var e=0;e<this.timers.length;e++){this.timers[e].stop()}return this};t.prototype.convertToMilliseconds=function(e){return e*this.units};t.prototype.update=function(){for(var e=0;e<this.timers.length;e++){this.timers[e].update()}};t.prototype.start=function(){this._timeLastStarted=this.master.elapsed();this._totalPaused=0;if(!this._timeFirstStarted){this._timeFirstStarted=this._timeLastStarted}this._isRunning=true;this._isPaused=false;this._isStopped=false;this._elapsedState=0;return this};t.prototype.pause=function(){if(this._isRunning===true){this._timeLastPaused=this.master.elapsed();this._isRunning=false;this._isPaused=true;this._isStopped=false;this._elapsedState=1}return this};t.prototype.resume=function(){if(this._isPaused===true){this._timeLastUnpaused=this.master.elapsed();this._totalPaused+=this._timeLastUnpaused-this._timeLastPaused;this._isRunning=true;this._isPaused=false;this._isStopped=false;this._elapsedState=2}return this};t.prototype.stop=function(){if(this._isStopped===false){this._timeLastStopped=this.master.elapsed();if(this._isPaused===true){this._totalPaused+=this._timeLastStopped-this._timeLastPaused}this._isRunning=false;this._isPaused=false;this._isStopped=true;this._elapsedState=3}return this};t.prototype.toString=function(){return"[{Clock (name="+this.name+" units="+this.units+" running="+this._isRunning+")}]"};return t}();e.Clock=t})(e.Time||(e.Time={}));var t=e.Time})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function n(e){this._clocks=[];this._game=e}n.prototype.objType=function(){return"ClockManager"};n.prototype.boot=function(){this.master=new e.Time.MasterClock;this.clock=new t.Clock(this,this.master,"default",1e3);this.clock.start()};n.prototype.addClock=function(e,n){if(typeof n==="undefined"){n=1e3}this._clocks.push(new t.Clock(this,this.master,e,n));return this._clocks[this._clocks.length-1]};n.prototype.getClock=function(e){for(var t=0;t<this._clocks.length;t++){if(this._clocks[t].name===e){return this._clocks[t]}}};n.prototype.update=function(){this.master.update();this.clock.update();for(var e=0;e<this._clocks.length;e++){this._clocks[e].update()}};n.prototype.now=function(){return this.master.now};n.prototype.delta=function(){return this.master.delta};return n}();t.ClockManager=n})(e.Time||(e.Time={}));var t=e.Time})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(){this.time=0;this.now=0;this.delta=0;this._started=Date.now();this.time=this._started}e.prototype.objType=function(){return"MasterClock"};e.prototype.elapsed=function(){return this.now-this._started};e.prototype.totalElapsedSeconds=function(){return(this.now-this._started)*.001};e.prototype.update=function(){this.now=Date.now();this.delta=this.now-this.time;this.time=this.now;if(this.delta>.1){this.delta=.1}};e.prototype.elapsedSince=function(e){return this.now-e};e.prototype.elapsedSecondsSince=function(e){return(this.now-e)*.001};e.prototype.reset=function(){this._started=this.now};return e}();e.MasterClock=t})(e.Time||(e.Time={}));var t=e.Time})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function t(e,t,n,r){if(typeof r==="undefined"){r=0}this._currentCount=0;this._startEvents=null;this._countEvents=null;this._stopEvents=null;this._clock=null;this._timeLastCount=null;this._isRunning=false;this._isStopped=true;this._isPaused=false;this.name=null;this.delay=0;this.repeatCount=0;this._clock=t;this._startEvents=[];this._countEvents=[];this._stopEvents=[];this.name=e;this.delay=n;this.repeatCount=r}t.prototype.objType=function(){return"Timer"};t.prototype.currentCount=function(){return this._currentCount};t.prototype.isRunning=function(){return this._isRunning};t.prototype.isStopped=function(){return this._isStopped};t.prototype.isPaused=function(){return this._isPaused};t.prototype.processEvents=function(t){if(t===e.TimerEvent.TIMER_START){for(var n=0;n<this._startEvents.length;n++){this._startEvents[n].run()}}else if(t===e.TimerEvent.TIMER_COUNT){for(var n=0;n<this._countEvents.length;n++){this._countEvents[n].run()}}else if(t===e.TimerEvent.TIMER_STOP){for(var n=0;n<this._stopEvents.length;n++){this._stopEvents[n].run()}}};t.prototype.update=function(){if(this._isRunning&&this._clock.elapsed()-this._timeLastCount>=this.delay&&this._isPaused===false){this._currentCount++;this.processEvents(e.TimerEvent.TIMER_COUNT);this._timeLastCount=this._clock.elapsed()||0;if(this.repeatCount!==-1&&this._currentCount>=this.repeatCount){this.stop()}}};t.prototype.start=function(){if(this._isStopped===true){this._isRunning=true;this._isPaused=false;this._isStopped=false;this._currentCount=0;this._timeLastCount=this._clock.elapsed()||0;this.processEvents(e.TimerEvent.TIMER_START)}return this};t.prototype.stop=function(){if(this._isRunning===true||this._isPaused===true){this._isRunning=false;this._isPaused=false;this._isStopped=true;this.processEvents(e.TimerEvent.TIMER_STOP)}return this};t.prototype.pause=function(){if(this._isRunning===true){this._isRunning=false;this._isPaused=true}return this};t.prototype.resume=function(){if(this._isPaused===true){this._isRunning=true;this._isPaused=false}return this};t.prototype.addTimerEvent=function(t){if(t.type===e.TimerEvent.TIMER_START){this._startEvents.push(t)}else if(t.type===e.TimerEvent.TIMER_COUNT){this._countEvents.push(t)}else if(t.type===e.TimerEvent.TIMER_STOP){this._stopEvents.push(t)}return t};t.prototype.createTimerEvent=function(t,n,r){if(t===e.TimerEvent.TIMER_START){this._startEvents.push(new e.TimerEvent(t,n,r));return this._startEvents[this._startEvents.length-1]}else if(t===e.TimerEvent.TIMER_COUNT){this._countEvents.push(new e.TimerEvent(t,n,r));return this._countEvents[this._countEvents.length-1]}else if(t===e.TimerEvent.TIMER_STOP){this._stopEvents.push(new e.TimerEvent(t,n,r));return this._stopEvents[this._stopEvents.length-1]}return null};t.prototype.removeTimerEvent=function(t){var n=[];if(t.type===e.TimerEvent.TIMER_START){n=this._startEvents.splice(this._startEvents.indexOf(t),1)}else if(t.type===e.TimerEvent.TIMER_COUNT){n=this._countEvents.splice(this._countEvents.indexOf(t),1)}else if(t.type===e.TimerEvent.TIMER_STOP){n=this._stopEvents.splice(this._stopEvents.indexOf(t),1)}if(n.length===1){return true}else{return false}};t.prototype.clear=function(t){if(typeof t==="undefined"){t=0}if(t===0){this._startEvents.length=0;this._countEvents.length=0;this._stopEvents.length=0}else if(t===e.TimerEvent.TIMER_START){this._startEvents.length=0}else if(t===e.TimerEvent.TIMER_COUNT){this._countEvents.length=0}else if(t===e.TimerEvent.TIMER_STOP){this._stopEvents.length=0}};t.prototype.toString=function(){return"[{Timer (name="+this.name+" delay="+this.delay+" repeatCount="+this.repeatCount+" running="+this._isRunning+")}]"};return t}();e.Timer=t})(e.Time||(e.Time={}));var t=e.Time})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e,t,n){this._callback=null;this.type=0;this.type=e;this._callback=t;this._callbackContext=n}e.prototype.objType=function(){return"TimerEvent"};e.prototype.run=function(){if(this._callback){this._callback.apply(this._callbackContext)}};e.TIMER_START=1;e.TIMER_COUNT=2;e.TIMER_STOP=3;return e}();e.TimerEvent=t})(e.Time||(e.Time={}));var t=e.Time})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(e,t,n,r){if(typeof n==="undefined"){n=true}if(typeof r==="undefined"){r=false}this.domElement=null;this.context=null;this._visible=true;this._offScreen=false;this._clearMode=1;this.bgColor="rgb(0, 0, 0)";this.domElement=document.createElement("canvas");this.domElement.width=e;this.domElement.height=t;this._width=e;this._height=t;this.context=this.domElement.getContext("2d");this._offScreen=r;this._visible=n;if(n===false){this.domElement.style.display="none"}}Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e;this._updatedSize()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e;this._updatedSize()},enumerable:true,configurable:true});t.prototype.objType=function(){return"Canvas"};t.prototype._updatedSize=function(){this.domElement.width=this._width;this.domElement.height=this._height};t.prototype.destroy=function(){if(this._offScreen===false){this.domElement.style.display="none"}};Object.defineProperty(t.prototype,"visible",{get:function(){return this._visible},set:function(e){if(e!==null&&e!==this._visible){this._visible=e;if(e===true){this.domElement.style.display="block"}else{this.domElement.style.display="none"}}},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"clearMode",{get:function(){return this._clearMode},set:function(t){if(t!==null&&t!==this._clearMode&&t>=e.Utils.Canvas.CLEARMODE_NONE&&t<=e.Utils.Canvas.CLEARMODE_FILLRECT_ALPHA){this._clearMode=t}},enumerable:true,configurable:true});t.prototype.clear=function(){if(this._clearMode===t.CLEARMODE_NONE){}else if(this._clearMode===t.CLEARMODE_CLEARRECT){this.context.clearRect(0,0,this.domElement.width,this.domElement.height)}else if(this._clearMode===t.CLEARMODE_FILLRECT){this.context.fillStyle=this.bgColor;this.context.fillRect(0,0,this.domElement.width,this.domElement.height)}else if(this._clearMode===t.CLEARMODE_FILLRECT_ALPHA){this.context.clearRect(0,0,this.domElement.width,this.domElement.height);this.context.fillStyle=this.bgColor;this.context.fillRect(0,0,this.domElement.width,this.domElement.height)}};t.prototype.saveAsPNG=function(){return this.domElement.toDataURL()};t.prototype.toString=function(){return"[{Canvas (width="+this.width+" height="+this.height+" visible="+this.visible+" offScreen="+this._offScreen+" clearMode="+this.clearMode+")}]"};t.CLEARMODE_NONE=0;t.CLEARMODE_CLEARRECT=1;t.CLEARMODE_FILLRECT=2;t.CLEARMODE_FILLRECT_ALPHA=3;return t}();t.Canvas=n})(e.Utils||(e.Utils={}));var t=e.Utils})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(){}t.defaultCompare=function(e,t){if(e<t){return-1}else if(e===t){return 0}else{return 1}};t.prototype.objType=function(){return"Common"};t.defaultEquals=function(e,t){return e===t};t.defaultTostring=function(t){if(t===null){return"KIWI_NULL"}else if(e.Utils.Common.isUndefined(t)){return"KIWI_UNDEFINED"}else if(e.Utils.Common.isString(t)){return t}else{return t.toString()}};t.isFunction=function(e){return typeof e==="function"};t.isNumeric=function(e){return!isNaN(e)};t.isUndefined=function(e){return typeof e==="undefined"};t.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"};t.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};t.reverseCompareFunction=function(t){if(!e.Utils.Common.isFunction(t)){return function(e,t){if(e<t){return 1}else if(e===t){return 0}else{return-1}}}else{return function(e,n){return t(e,n)*-1}}};t.compareToEquals=function(e){return function(t,n){return e(t,n)===0}};t.shuffleArray=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1));var r=e[t];e[t]=e[n];e[n]=r}return e};t.convertToBase2=function(e){var t=e.width;var n=e.height;if(this.base2Sizes.indexOf(t)==-1){var r=0;while(t>this.base2Sizes[r])r++;t=this.base2Sizes[r]}if(this.base2Sizes.indexOf(n)==-1){var r=0;while(n>this.base2Sizes[r])r++;n=this.base2Sizes[r]}if(e.width!==t||e.height!==n){var i=document.createElement("canvas");i.width=t;i.height=n;i.getContext("2d").drawImage(e,0,0);return i}return e};t.base2Sizes=[2,4,16,32,64,128,256,512,1024,2048,4096];return t}();t.Common=n})(e.Utils||(e.Utils={}));var t=e.Utils})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(t){var n=function(){function t(){}t.prototype.objType=function(){return"GameMath"};t.computeMachineEpsilon=function(){var e=4/3;var t=e-1;var n=t+t+t;return Math.abs(1-n)};t.fuzzyEqual=function(e,t,n){if(typeof n==="undefined"){n=1e-4}return Math.abs(e-t)<n};t.fuzzyLessThan=function(e,t,n){if(typeof n==="undefined"){n=1e-4}return e<t+n};t.fuzzyGreaterThan=function(e,t,n){if(typeof n==="undefined"){n=1e-4}return e>t-n};t.fuzzyCeil=function(e,t){if(typeof t==="undefined"){t=1e-4}return Math.ceil(e-t)};t.fuzzyFloor=function(e,t){if(typeof t==="undefined"){t=1e-4}return Math.floor(e+t)};t.average=function(){var e=[];for(var t=0;t<arguments.length-0;t++){e[t]=arguments[t+0]}var n=0;for(var r=0;r<e.length;r++){n+=e[r]}return n/e.length};t.slam=function(e,t,n){if(typeof n==="undefined"){n=1e-4}return Math.abs(e-t)<n?t:e};t.percentageMinMax=function(e,t,n){if(typeof n==="undefined"){n=0}e-=n;t-=n;if(!t)return 0;else return e/t};t.sign=function(e){if(e)return e/Math.abs(e);else return 0};t.truncate=function(e){return e>0?Math.floor(e):Math.ceil(e)};t.shear=function(e){return e%1};t.wrap=function(e,t,n){if(typeof n==="undefined"){n=0}e-=n;t-=n;if(t==0)return n;e%=t;e+=n;while(e<n)e+=t;return e};t.arithWrap=function(e,t,n){if(typeof n==="undefined"){n=0}t-=n;if(t==0)return n;return e-t*Math.floor((e-n)/t)};t.clamp=function(e,t,n){if(typeof n==="undefined"){n=0}return Math.max(n,Math.min(t,e))};t.snapTo=function(e,t,n){if(typeof n==="undefined"){n=0}if(t==0)return e;e-=n;e=t*Math.round(e/t);return n+e};t.snapToFloor=function(e,t,n){if(typeof n==="undefined"){n=0}if(t==0)return e;e-=n;e=t*Math.floor(e/t);return n+e};t.snapToCeil=function(e,t,n){if(typeof n==="undefined"){n=0}if(t==0)return e;e-=n;e=t*Math.ceil(e/t);return n+e};t.snapToInArray=function(e,t,n){if(typeof n==="undefined"){n=true}if(n)t.sort();if(e<t[0])return t[0];var r=1;while(t[r]<e)r++;var i=t[r-1];var s=r<t.length?t[r]:Number.POSITIVE_INFINITY;return s-e<=e-i?s:i};t.roundTo=function(e,t,n){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=10}var r=Math.pow(n,-t);return Math.round(e*r)/r};t.floorTo=function(e,t,n){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=10}var r=Math.pow(n,-t);return Math.floor(e*r)/r};t.ceilTo=function(e,t,n){if(typeof t==="undefined"){t=0}if(typeof n==="undefined"){n=10}var r=Math.pow(n,-t);return Math.ceil(e*r)/r};t.interpolateFloat=function(e,t,n){return(t-e)*n+e};t.radiansToDegrees=function(e){return e*t.RAD_TO_DEG};t.degreesToRadians=function(e){return e*t.DEG_TO_RAD};t.angleBetween=function(e,t,n,r){return Math.atan2(r-t,n-e)};t.normalizeAngle=function(e,n){if(typeof n==="undefined"){n=true}var r=n?t.PI:180;return t.wrap(e,r,-r)};t.nearestAngleBetween=function(e,n,r){if(typeof r==="undefined"){r=true}var i=r?t.PI:180;e=t.normalizeAngle(e,r);n=t.normalizeAngle(n,r);if(e<-i/2&&n>i/2)e+=i*2;if(n<-i/2&&e>i/2)n+=i*2;return n-e};t.normalizeAngleToAnother=function(t,n,r){if(typeof r==="undefined"){r=true}return n+e.Utils.GameMath.nearestAngleBetween(n,t,r)};t.normalizeAngleAfterAnother=function(t,n,r){if(typeof r==="undefined"){r=true}t=e.Utils.GameMath.normalizeAngle(t-n,r);return n+t};t.normalizeAngleBeforeAnother=function(t,n,r){if(typeof r==="undefined"){r=true}t=e.Utils.GameMath.normalizeAngle(n-t,r);return n-t};t.interpolateAngles=function(t,n,r,i,s){if(typeof i==="undefined"){i=true}if(typeof s==="undefined"){s=null}t=e.Utils.GameMath.normalizeAngle(t,i);n=e.Utils.GameMath.normalizeAngleToAnother(n,t,i);return typeof s==="function"?s(r,t,n-t,1):e.Utils.GameMath.interpolateFloat(t,n,r)};t.logBaseOf=function(e,t){return Math.log(e)/Math.log(t)};t.GCD=function(e,t){var n;e=Math.abs(e);t=Math.abs(t);if(e<t){n=e;e=t;t=n}while(true){n=e%t;if(!n)return t;e=t;t=n}return 1};t.LCM=function(t,n){return t*n/e.Utils.GameMath.GCD(t,n)};t.factorial=function(e){if(e==0)return 1;var t=e;while(--e){t*=e}return t};t.gammaFunction=function(t){return e.Utils.GameMath.factorial(t-1)};t.fallingFactorial=function(t,n){return e.Utils.GameMath.factorial(t)/e.Utils.GameMath.factorial(t-n)};t.risingFactorial=function(t,n){return e.Utils.GameMath.factorial(t+n-1)/e.Utils.GameMath.factorial(t-1)};t.binCoef=function(t,n){return e.Utils.GameMath.fallingFactorial(t,n)/e.Utils.GameMath.factorial(n)};t.risingBinCoef=function(t,n){return e.Utils.GameMath.risingFactorial(t,n)/e.Utils.GameMath.factorial(n)};t.chanceRoll=function(e){if(typeof e==="undefined"){e=50}if(e<=0){return false}else if(e>=100){return true}else{if(Math.random()*100>=e){return false}else{return true}}};t.maxAdd=function(e,t,n){e+=t;if(e>n){e=n}return e};t.minSub=function(e,t,n){e-=t;if(e<n){e=n}return e};t.wrapValue=function(e,t,n){var r;e=Math.abs(e);t=Math.abs(t);n=Math.abs(n);r=(e+t)%n;return r};t.randomSign=function(){return Math.random()>.5?1:-1};t.isOdd=function(e){if(e&1){return true}else{return false}};t.isEven=function(e){if(e&1){return false}else{return true}};t.wrapAngle=function(e){var t=e;if(e>=-180&&e<=180){return e}t=(e+180)%360;if(t<0){t+=360}return t-180};t.angleLimit=function(e,t,n){var r=e;if(e>n){r=n}else if(e<t){r=t}return r};t.linearInterpolation=function(t,n){var r=t.length-1;var i=r*n;var s=Math.floor(i);if(n<0)return e.Utils.GameMath.linear(t[0],t[1],i);if(n>1)return e.Utils.GameMath.linear(t[r],t[r-1],r-i);return e.Utils.GameMath.linear(t[s],t[s+1>r?r:s+1],i-s)};t.bezierInterpolation=function(t,n){var r=0;var i=t.length-1;for(var s=0;s<=i;s++){r+=Math.pow(1-n,i-s)*Math.pow(n,s)*t[s]*e.Utils.GameMath.bernstein(i,s)}return r};t.catmullRomInterpolation=function(t,n){var r=t.length-1;var i=r*n;var s=Math.floor(i);if(t[0]===t[r]){if(n<0)s=Math.floor(i=r*(1+n));return e.Utils.GameMath.catmullRom(t[(s-1+r)%r],t[s],t[(s+1)%r],t[(s+2)%r],i-s)}else{if(n<0)return t[0]-(e.Utils.GameMath.catmullRom(t[0],t[0],t[1],t[1],-i)-t[0]);if(n>1)return t[r]-(e.Utils.GameMath.catmullRom(t[r],t[r],t[r-1],t[r-1],i-r)-t[r]);return e.Utils.GameMath.catmullRom(t[s?s-1:0],t[s],t[r<s+1?r:s+1],t[r<s+2?r:s+2],i-s)}};t.linear=function(e,t,n){return(t-e)*n+e};t.bernstein=function(t,n){return e.Utils.GameMath.factorial(t)/e.Utils.GameMath.factorial(n)/e.Utils.GameMath.factorial(t-n)};t.catmullRom=function(e,t,n,r,i){var s=(n-e)*.5,o=(r-t)*.5,u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t};t.difference=function(e,t){return Math.abs(e-t)};t.PI=3.141592653589793;t.PI_2=1.5707963267948966;t.PI_4=.7853981633974483;t.PI_8=.39269908169872414;t.PI_16=.19634954084936207;t.TWO_PI=6.283185307179586;t.THREE_PI_2=4.71238898038469;t.E=2.71828182845905;t.LN10=2.302585092994046;t.LN2=.6931471805599453;t.LOG10E=.4342944819032518;t.LOG2E=1.4426950408889634;t.SQRT1_2=.7071067811865476;t.SQRT2=1.4142135623730951;t.DEG_TO_RAD=.017453292519943295;t.RAD_TO_DEG=57.29577951308232;t.B_16=65536;t.B_31=2147483648;t.B_32=4294967296;t.B_48=281474976710656;t.B_53=9007199254740992;t.B_64=0x10000000000000000;t.ONE_THIRD=.3333333333333333;t.TWO_THIRDS=.6666666666666666;t.ONE_SIXTH=.16666666666666666;t.COS_PI_3=.8660254037844386;t.SIN_2PI_3=.03654595;t.CIRCLE_ALPHA=.5522847498307935;t.ON=true;t.OFF=false;t.SHORT_EPSILON=.1;t.PERC_EPSILON=.001;t.EPSILON=1e-4;t.LONG_EPSILON=1e-8;return t}();t.GameMath=n})(e.Utils||(e.Utils={}));var t=e.Utils})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e){if(typeof e==="undefined"){e=[]}this.c=1;this._data={lipsum:["lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","nunc","sagittis","tortor","ac","mi","pretium","sed","convallis","massa","pulvinar","curabitur","non","turpis","velit","vitae","rutrum","odio","aliquam","sapien","orci","tempor","sed","elementum","sit","amet","tincidunt","sed","risus","etiam","nec","lacus","id","ante","hendrerit","malesuada","donec","porttitor","magna","eget","libero","pharetra","sollicitudin","aliquam","mattis","mattis","massa","et","porta","morbi","vitae","magna","augue","vestibulum","at","lectus","sed","tellus","facilisis","tincidunt","suspendisse","eros","magna","consequat","at","sollicitudin","ac","vestibulum","vel","dolor","in","egestas","lacus","quis","lacus","placerat","et","molestie","ipsum","scelerisque","nullam","sit","amet","tortor","dui","aenean","pulvinar","odio","nec","placerat","fringilla","neque","dolor"]};this.sow(e)}e.prototype.objType=function(){return"RandomDataGenerator"};e.prototype.uint32=function(){return this.rnd.apply(this)*4294967296};e.prototype.fract32=function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16};e.prototype.rnd=function(){var e=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=e|0;this.s0=this.s1;this.s1=this.s2;this.s2=e-this.c;return this.s2};e.prototype.hash=function(e){var t,n,r;r=4022871197;e=e.toString();for(n=0;n<e.length;n++){r+=e.charCodeAt(n);t=.02519603282416938*r;r=t>>>0;t-=r;t*=r;r=t>>>0;t-=r;r+=t*4294967296}return(r>>>0)*2.3283064365386963e-10};e.prototype.sow=function(e){if(typeof e==="undefined"){e=[]}this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);var t;for(var n=0;t=e[n++];){this.s0-=this.hash(t);this.s0+=~~(this.s0<0);this.s1-=this.hash(t);this.s1+=~~(this.s1<0);this.s2-=this.hash(t);this.s2+=~~(this.s2<0)}};e.prototype.integer=function(){return this.uint32()};e.prototype.frac=function(){return this.fract32()};e.prototype.real=function(){return this.uint32()+this.fract32()};e.prototype.integerInRange=function(e,t){return Math.floor(this.realInRange(e,t))};e.prototype.realInRange=function(e,t){e=e||0;t=t||0;return this.frac()*(t-e)+e};e.prototype.normal=function(){return 1-2*this.frac()};e.prototype.uuid=function(){var e,t;for(t=e="";e++<36;t+=~e%5|e*3&4?(e^15?8^this.frac()*(e^20?16:4):4).toString(16):"-");return t};e.prototype.pick=function(e){return e[this.integerInRange(0,e.length)]};e.prototype.weightedPick=function(e){return e[~~(Math.pow(this.frac(),2)*e.length)]};e.prototype.word=function(){return this.pick(this._data.lipsum)};e.prototype.words=function(e){if(typeof e==="undefined"){e=3}var t=[];for(var n=0;n<e;n++){t.push(this.pick(this._data.lipsum))}return t.join(" ")};e.prototype.sentence=function(){var e;e=this.words(this.integerInRange(2,16)).replace(/[a-z]/,function(e){return e.toUpperCase()});return e+"."};e.prototype.sentences=function(e){if(typeof e==="undefined"){e=3}var t=[];for(var n=0;n<e;n++){t.push(this.sentence())}return t.join(" ")};e.prototype.timestamp=function(e,t){if(typeof e==="undefined"){e=9466848e5}if(typeof t==="undefined"){t=1577862e6}return this.realInRange(e,t)};e.prototype.angle=function(){return this.integerInRange(-180,180)};return e}();e.RandomDataGenerator=t})(e.Utils||(e.Utils={}));var t=e.Utils})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(e){this._isSetTimeOut=false;this.lastTime=0;this.currentTime=0;this.isRunning=false;this._callback=e;var t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;n++){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]}}e.prototype.objType=function(){return"RequestAnimationFrame"};e.prototype.setCallback=function(e){this._callback=e};e.prototype.isUsingSetTimeOut=function(){return this._isSetTimeOut};e.prototype.isUsingRAF=function(){if(this._isSetTimeOut===true){return false}else{return true}};e.prototype.start=function(e){var t=this;if(typeof e==="undefined"){e=null}if(e){this._callback=e}if(!window.requestAnimationFrame){this._isSetTimeOut=true;this._timeOutID=window.setTimeout(function(){return t.SetTimeoutUpdate()},0)}else{this._isSetTimeOut=false;window.requestAnimationFrame(function(){return t.RAFUpdate()})}this.isRunning=true};e.prototype.stop=function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame}this.isRunning=false};e.prototype.RAFUpdate=function(){var e=this;this.currentTime=Date.now();if(this._callback){this._callback()}var t=Math.max(0,16-(this.currentTime-this.lastTime));window.requestAnimationFrame(function(){return e.RAFUpdate()});this.lastTime=this.currentTime+t};e.prototype.SetTimeoutUpdate=function(){var e=this;this.currentTime=Date.now();if(this._callback){this._callback()}var t=Math.max(0,16-(this.currentTime-this.lastTime));this._timeOutID=window.setTimeout(function(){return e.SetTimeoutUpdate()},t);this.lastTime=this.currentTime+t};return e}();e.RequestAnimationFrame=t})(e.Utils||(e.Utils={}));var t=e.Utils})(Kiwi||(Kiwi={}));var Kiwi;(function(e){(function(e){var t=function(){function e(){}e.parseVersion=function(e){var t=e.split(".");return{majorVersion:parseInt(t[0]),minorVersion:parseInt(t[1]),patchVersion:parseInt(t[2])}};e.compareVersions=function(t,n){var r=e.parseVersion(t);var i=e.parseVersion(n);if(r.majorVersion>i.majorVersion){return"greater"}if(r.majorVersion<i.majorVersion){return"less"}if(r.minorVersion>i.minorVersion){return"greater"}if(r.minorVersion<i.minorVersion){return"less"}if(r.patchVersion>i.patchVersion){return"greater"}if(r.patchVersion<i.patchVersion){return"less"}return"equal"};e.greaterOrEqual=function(t,n){var r=e.compareVersions(t,n);return r=="greater"||r=="equal"};return e}();e.Version=t})(e.Utils||(e.Utils={}));var t=e.Utils})(Kiwi||(Kiwi={}));var Kiwi;(function(e){e.VERSION="1.1.0";e.RENDERER_CANVAS=0;e.RENDERER_WEBGL=1;e.RENDERER_AUTO=2;e.TARGET_BROWSER=0;e.TARGET_COCOON=1;e.DEBUG_ON=0;e.DEBUG_OFF=1;e.DEVICE=null;e.STATE=0;e.GROUP=2;e.ENTITY=3;e.CAMERA=4;e.HUD_WIDGET=5;e.TILE_LAYER=6;var t=function(){function t(){}t.prototype.objType=function(){return"GameManager"};t.register=function(t){return e.GameManager._games.push(t)};t.total=function(){return e.GameManager._games.length};t._games=[];return t}();e.GameManager=t;e.Plugins={};e.extend=function(e,t){function r(){this.constructor=e}for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];r.prototype=t.prototype;e.prototype=new r}})(Kiwi||(Kiwi={}));(function(e){"use strict";var t={};typeof exports=="undefined"?typeof define=="function"&&typeof define.amd=="object"&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports=typeof window!="undefined"?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!n)var n=typeof Float32Array!="undefined"?Float32Array:Array;if(!r)var r=Math.random;var i={};i.setMatrixArrayType=function(e){n=e},typeof e!="undefined"&&(e.glMatrix=i);var s={};s.create=function(){var e=new n(2);return e[0]=0,e[1]=0,e},s.clone=function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},s.fromValues=function(e,t){var r=new n(2);return r[0]=e,r[1]=t,r},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},s.set=function(e,t,n){return e[0]=t,e[1]=n,e},s.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},s.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},s.sub=s.subtract,s.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},s.mul=s.multiply,s.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},s.div=s.divide,s.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},s.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},s.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},s.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},s.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},s.dist=s.distance,s.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},s.len=s.length,s.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},s.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},s.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},s.random=function(e,t){t=t||1;var n=r()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},s.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},s.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},s.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},s.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},s.forEach=function(){var e=s.create();return function(t,n,r,i,s,o){var u,a;n||(n=2),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),s.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},typeof e!="undefined"&&(e.vec2=s);var o={};o.create=function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},o.clone=function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.fromValues=function(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},o.div=o.divide,o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},o.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},o.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},o.cross=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];return e[0]=i*a-s*u,e[1]=s*o-r*a,e[2]=r*u-i*o,e},o.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e},o.random=function(e,t){t=t||1;var n=r()*2*Math.PI,i=r()*2-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=i*t,e},o.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12],e[1]=n[1]*r+n[5]*i+n[9]*s+n[13],e[2]=n[2]*r+n[6]*i+n[10]*s+n[14],e},o.transformMat3=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e},o.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,a;n||(n=3),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),o.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},typeof e!="undefined"&&(e.vec3=o);var u={};u.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},u.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.fromValues=function(e,t,r,i){var s=new n(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},u.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},u.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},u.sub=u.subtract,u.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},u.mul=u.multiply,u.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},u.div=u.divide,u.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},u.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},u.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},u.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},u.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)},u.dist=u.distance,u.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},u.len=u.length,u.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},u.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},u.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},u.random=function(e,t){return t=t||1,e[0]=r(),e[1]=r(),e[2]=r(),e[3]=r(),u.normalize(e,e),u.scale(e,e,t),e},u.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e},u.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},u.forEach=function(){var e=u.create();return function(t,n,r,i,s,o){var u,a;n||(n=4),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),u.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.vec4=u);var a={};a.create=function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},a.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},a.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},a.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},a.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*u+i*f,e[1]=r*a+i*l,e[2]=s*u+o*f,e[3]=s*a+o*l,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=r*-u+i*a,e[2]=s*a+o*u,e[3]=s*-u+o*a,e},a.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];return e[0]=r*u,e[1]=i*a,e[2]=s*u,e[3]=o*a,e},a.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.mat2=a);var f={};f.create=function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.clone=function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=n*s-r*i;return a?(a=1/a,e[0]=s*a,e[1]=-r*a,e[2]=-i*a,e[3]=n*a,e[4]=(i*u-s*o)*a,e[5]=(r*o-n*u)*a,e):null},f.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},f.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1],c=n[2],h=n[3],p=n[4],d=n[5];return e[0]=r*f+i*c,e[1]=r*l+i*h,e[2]=s*f+o*c,e[3]=s*l+o*h,e[4]=f*u+c*a+p,e[5]=l*u+h*a+d,e},f.mul=f.multiply,f.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*f,e[1]=-r*f+i*l,e[2]=s*l+o*f,e[3]=-s*f+l*o,e[4]=l*u+f*a,e[5]=l*a-f*u,e},f.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=t[0]*r,e[1]=t[1]*i,e[2]=t[2]*r,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*i,e},f.translate=function(e,t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+n[0],e[5]=t[5]+n[1],e},f.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},typeof e!="undefined"&&(e.mat2d=f);var l={};l.create=function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},l.clone=function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},l.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*r+i*f)*d,e[2]=(u*r-i*o)*d,e[3]=h*d,e[4]=(l*n-i*a)*d,e[5]=(-u*n+i*s)*d,e[6]=p*d,e[7]=(-f*n+r*a)*d,e[8]=(o*n-r*s)*d,e):null},l.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return e[0]=o*l-u*f,e[1]=i*f-r*l,e[2]=r*u-i*o,e[3]=u*a-s*l,e[4]=n*l-i*a,e[5]=i*s-n*u,e[6]=s*f-o*a,e[7]=r*a-n*f,e[8]=n*o-r*s,e},l.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},l.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return e[0]=h*r+p*o+d*f,e[1]=h*i+p*u+d*l,e[2]=h*s+p*a+d*c,e[3]=v*r+m*o+g*f,e[4]=v*i+m*u+g*l,e[5]=v*s+m*a+g*c,e[6]=y*r+b*o+w*f,e[7]=y*i+b*u+w*l,e[8]=y*s+b*a+w*c,e},l.mul=l.multiply,l.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=u,e[5]=a,e[6]=h*r+p*o+f,e[7]=h*i+p*u+l,e[8]=h*s+p*a+c,e},l.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*r+h*o,e[1]=p*i+h*u,e[2]=p*s+h*a,e[3]=p*o-h*r,e[4]=p*u-h*i,e[5]=p*a-h*s,e[6]=f,e[7]=l,e[8]=c,e},l.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},l.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[3]=l+g,e[6]=c-m,e[1]=l-g,e[4]=1-(f+d),e[7]=p+v,e[2]=c+m,e[5]=p-v,e[8]=1-(f+h),e},l.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(a*C-o*A-f*N)*O,e[2]=(o*L-u*C+f*T)*O,e[3]=(i*L-r*A-s*k)*O,e[4]=(n*A-i*C+s*N)*O,e[5]=(r*C-n*L-s*T)*O,e[6]=(v*x-m*S+g*E)*O,e[7]=(m*w-d*x-g*b)*O,e[8]=(d*S-v*w+g*y)*O,e):null},l.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},typeof e!="undefined"&&(e.mat3=l);var c={};c.create=function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.clone=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},c.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(i*L-r*A-s*k)*O,e[2]=(v*x-m*S+g*E)*O,e[3]=(h*S-c*x-p*E)*O,e[4]=(a*C-o*A-f*N)*O,e[5]=(n*A-i*C+s*N)*O,e[6]=(m*w-d*x-g*b)*O,e[7]=(l*x-h*w+p*b)*O,e[8]=(o*L-u*C+f*T)*O,e[9]=(r*C-n*L-s*T)*O,e[10]=(d*S-v*w+g*y)*O,e[11]=(c*w-l*S-p*y)*O,e[12]=(u*N-o*k-a*T)*O,e[13]=(n*k-r*N+i*T)*O,e[14]=(v*b-d*E-m*y)*O,e[15]=(l*E-c*b+h*y)*O,e):null},c.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h),e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h)),e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a),e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a)),e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h)),e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h),e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a)),e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a),e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c),e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c)),e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u),e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u)),e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c)),e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c),e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u)),e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u),e},c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x},c.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=n[0],w=n[1],E=n[2],S=n[3];return e[0]=b*r+w*u+E*c+S*v,e[1]=b*i+w*a+E*h+S*m,e[2]=b*s+w*f+E*p+S*g,e[3]=b*o+w*l+E*d+S*y,b=n[4],w=n[5],E=n[6],S=n[7],e[4]=b*r+w*u+E*c+S*v,e[5]=b*i+w*a+E*h+S*m,e[6]=b*s+w*f+E*p+S*g,e[7]=b*o+w*l+E*d+S*y,b=n[8],w=n[9],E=n[10],S=n[11],e[8]=b*r+w*u+E*c+S*v,e[9]=b*i+w*a+E*h+S*m,e[10]=b*s+w*f+E*p+S*g,e[11]=b*o+w*l+E*d+S*y,b=n[12],w=n[13],E=n[14],S=n[15],e[12]=b*r+w*u+E*c+S*v,e[13]=b*i+w*a+E*h+S*m,e[14]=b*s+w*f+E*p+S*g,e[15]=b*o+w*l+E*d+S*y,e},c.mul=c.multiply,c.translate=function(e,t,n){var r=n[0],i=n[1],s=n[2],o,u,a,f,l,c,h,p,d,v,m,g;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],e[0]=o,e[1]=u,e[2]=a,e[3]=f,e[4]=l,e[5]=c,e[6]=h,e[7]=p,e[8]=d,e[9]=v,e[10]=m,e[11]=g,e[12]=o*r+l*i+d*s+t[12],e[13]=u*r+c*i+v*s+t[13],e[14]=a*r+h*i+m*s+t[14],e[15]=f*r+p*i+g*s+t[15]),e},c.scale=function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.rotate=function(e,n,r,i){var s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return Math.abs(a)<t?null:(a=1/a,s*=a,o*=a,u*=a,f=Math.sin(r),l=Math.cos(r),c=1-l,h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11],T=s*s*c+l,N=o*s*c+u*f,C=u*s*c-o*f,k=s*o*c-u*f,L=o*o*c+l,A=u*o*c+s*f,O=s*u*c+o*f,M=o*u*c-s*f,_=u*u*c+l,e[0]=h*T+m*N+w*C,e[1]=p*T+g*N+E*C,e[2]=d*T+y*N+S*C,e[3]=v*T+b*N+x*C,e[4]=h*k+m*L+w*A,e[5]=p*k+g*L+E*A,e[6]=d*k+y*L+S*A,e[7]=v*k+b*L+x*A,e[8]=h*O+m*M+w*_,e[9]=p*O+g*M+E*_,e[10]=d*O+y*M+S*_,e[11]=v*O+b*M+x*_,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},c.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+f*r,e[5]=o*i+l*r,e[6]=u*i+c*r,e[7]=a*i+h*r,e[8]=f*i-s*r,e[9]=l*i-o*r,e[10]=c*i-u*r,e[11]=h*i-a*r,e},c.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-f*r,e[1]=o*i-l*r,e[2]=u*i-c*r,e[3]=a*i-h*r,e[8]=s*r+f*i,e[9]=o*r+l*i,e[10]=u*r+c*i,e[11]=a*r+h*i,e},c.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+f*r,e[1]=o*i+l*r,e[2]=u*i+c*r,e[3]=a*i+h*r,e[4]=f*i-s*r,e[5]=l*i-o*r,e[6]=c*i-u*r,e[7]=h*i-a*r,e},c.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return e[0]=1-(p+v),e[1]=c+y,e[2]=h-g,e[3]=0,e[4]=c-y,e[5]=1-(l+v),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},c.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[1]=l+g,e[2]=c-m,e[3]=0,e[4]=l-g,e[5]=1-(f+d),e[6]=p+v,e[7]=0,e[8]=c+m,e[9]=p-v,e[10]=1-(f+h),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.frustum=function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);return e[0]=s*2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*a,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*a,e[10]=(o+s)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*f,e[15]=0,e},c.perspective=function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},c.ortho=function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*a,e[14]=(o+s)*f,e[15]=1,e},c.lookAt=function(e,n,r,i){var s,o,u,a,f,l,h,p,d,v,m=n[0],g=n[1],y=n[2],b=i[0],w=i[1],E=i[2],S=r[0],x=r[1],T=r[2];return Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t?c.identity(e):(h=m-S,p=g-x,d=y-T,v=1/Math.sqrt(h*h+p*p+d*d),h*=v,p*=v,d*=v,s=w*d-E*p,o=E*h-b*d,u=b*p-w*h,v=Math.sqrt(s*s+o*o+u*u),v?(v=1/v,s*=v,o*=v,u*=v):(s=0,o=0,u=0),a=p*u-d*o,f=d*s-h*u,l=h*o-p*s,v=Math.sqrt(a*a+f*f+l*l),v?(v=1/v,a*=v,f*=v,l*=v):(a=0,f=0,l=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=o,e[5]=f,e[6]=p,e[7]=0,e[8]=u,e[9]=l,e[10]=d,e[11]=0,e[12]=-(s*m+o*g+u*y),e[13]=-(a*m+f*g+l*y),e[14]=-(h*m+p*g+d*y),e[15]=1,e)},c.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},typeof e!="undefined"&&(e.mat4=c);var h={};h.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.rotationTo=function(){var e=o.create(),t=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,i,s){var u=o.dot(i,s);return u<-.999999?(o.cross(e,t,i),o.length(e)<1e-6&&o.cross(e,n,i),o.normalize(e,e),h.setAxisAngle(r,e,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+u,h.normalize(r,r))}}(),h.setAxes=function(){var e=l.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=n[0],e[5]=n[1],e[8]=n[2],h.normalize(t,h.fromMat3(t,e))}}(),h.clone=u.clone,h.fromValues=u.fromValues,h.copy=u.copy,h.set=u.set,h.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},h.add=u.add,h.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},h.mul=h.multiply,h.scale=u.scale,h.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+o*u,e[1]=i*a+s*u,e[2]=s*a-i*u,e[3]=o*a-r*u,e},h.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*u,e[1]=i*a+o*u,e[2]=s*a+r*u,e[3]=o*a-i*u,e},h.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=i*a-r*u,e[2]=s*a+o*u,e[3]=o*a-s*u,e},h.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},h.dot=u.dot,h.lerp=u.lerp,h.slerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=n[3],h,p,d,v,m;return p=i*a+s*f+o*l+u*c,p<0&&(p=-p,a=-a,f=-f,l=-l,c=-c),1-p>1e-6?(h=Math.acos(p),d=Math.sin(h),v=Math.sin((1-r)*h)/d,m=Math.sin(r*h)/d):(v=1-r,m=r),e[0]=v*i+m*a,e[1]=v*s+m*f,e[2]=v*o+m*l,e[3]=v*u+m*c,e},h.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=s*u,e},h.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},h.length=u.length,h.len=h.length,h.squaredLength=u.squaredLength,h.sqrLen=h.squaredLength,h.normalize=u.normalize,h.fromMat3=function(){var e=typeof Int8Array!="undefined"?new Int8Array([1,2,0]):[1,2,0];return function(t,n){var r=n[0]+n[4]+n[8],i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(n[7]-n[5])*i,t[1]=(n[2]-n[6])*i,t[2]=(n[3]-n[1])*i;else{var s=0;n[4]>n[0]&&(s=1),n[8]>n[s*3+s]&&(s=2);var o=e[s],u=e[o];i=Math.sqrt(n[s*3+s]-n[o*3+o]-n[u*3+u]+1),t[s]=.5*i,i=.5/i,t[3]=(n[u*3+o]-n[o*3+u])*i,t[o]=(n[o*3+s]+n[s*3+o])*i,t[u]=(n[u*3+s]+n[s*3+u])*i}return t}}(),h.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.quat=h)}(t.exports)})(this)