var Death=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.ghost,b,c),this.state=a,this.box.hitbox=new Kiwi.Geom.Rectangle(60,65,60,55),this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box));var d=.1;this.animation.add("invis",[30],.1,!1),this.animation.add("appear",[0,1,2,3,4,6,7,8,9,10,12,13,14,15],.06,!1),this.animation.add("death",[16,18,19,20,21,23,24,25,26,27],d,!1),this.animation.play("death"),this.animation.getAnimation("death").onStop.add(this.die,this)};Kiwi.extend(Death,Kiwi.GameObjects.Sprite),Death.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this)},Death.prototype.die=function(){this.state.itemManager.addItem("cash",this.x,this.y),this.state.weaponManager.stopShooting(),this.destroy()};var Ghost=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.ghost,b,c),this.state=a,this.box.hitbox=new Kiwi.Geom.Rectangle(60,65,60,55),this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box)),this.objType="Ghost",null==this.releaseTime;var d=.1;this.animation.add("invis",[0],.1,!1),this.animation.add("appear",[0,1,2,3,4,6,7,8,9,10,12,13,14,15],.06,!1),this.animation.add("disappear",[30,31,32,33,34,35,36,37,38,39,40,41],.06,!1),this.animation.add("capture",[16,18,19,20,21,23,24,25,26,27],d,!1),this.animation.add("idle",[5,11],.1,!0),this.animation.add("dash",[5,11],.1,!0),this.animation.add("damage1",[17],.1,!1),this.animation.add("damage2",[23],.1,!1),this.animation.add("damage3",[29],.1,!1),this.animation.play("invis");var e=.5*this.width,f=.5*this.height;this.centerPoint=new Kiwi.Geom.Point(e,f),this.animation.getAnimation("capture").onStop.add(this.capture,this),this.health=3,this.yVelo=0,this.xVelo=0,this.dashSpeed=1.5,this.speed=.3,this.detectionDistance=300,this.oriSpeed=this.speed,this.inYRange=!1,this.inXRange=!1,this.hit=!1,this.distanceToEgon=1e11,this.pauseTime=0,this.isVisible=!1,this.targetLocation=[0,0],this.setupAI()};Kiwi.extend(Ghost,Kiwi.GameObjects.Sprite),Ghost.prototype.update=function(){if(Kiwi.GameObjects.Sprite.prototype.update.call(this),this.alpha=this.isVisible||"appear"==this.animation.currentAnimation.name?1:0,this.centerPoint.x=this.worldX+.5*this.width,this.centerPoint.y=this.worldY+.5*this.height,this.state.player.x>this.x?this.scaleX=-1:this.state.player.x<this.x&&(this.scaleX=1),this.physics.update(),this.ai.update(),this.hit){if(void 0!=this.state.weaponManager.beamManager.beams[0]){var a=.5,b=new Kiwi.Geom.Point(this.x,this.y),c=new Kiwi.Geom.Point(0,0),d=this.state.weaponManager.beamManager.beams[0].members[0];b.x=this.x+.5*this.width,b.y=this.y+.5*this.height,c.x=d.worldX+.5*d.width,c.y=d.worldY+.5*d.height,b.x>c.x&&(this.x-=a),b.x<c.x&&(this.x+=a),b.y>c.y&&(this.y-=a),b.y<c.y&&(this.y+=a)}switch(this.health){case 1:"damage1"!=this.animation.currentAnimation.name&&this.animation.play("damage1");break;case 2:"damage2"!=this.animation.currentAnimation.name&&this.animation.play("damage2");break;case 3:"damage3"!=this.animation.currentAnimation.name&&this.animation.play("damage3")}}},Ghost.prototype.capture=function(){this.state.addCash(1,this.x,this.y),this.state.weaponManager.stopShooting(),this.destroy()},Ghost.prototype.startLoop=function(){"idle"!=this.animation.currentAnimation.name&&this.animation.play("idle")},Ghost.prototype.dash=function(){},Ghost.prototype.damageEnemy=function(){this.health-=1,this.health<=0&&(this.state.enemyManager.killEnemy(this,this.x,this.y),"capture"!=this.animation.currentAnimation.name)},Ghost.prototype.killSelf=function(){this.state.weaponManager.stopShooting(),this.state.enemyManager.kill(this)},Ghost.prototype.updateDirection=function(){this.y>=this.state.player.y-20?(this.yVelo=-this.speed,this.inYRange=!1):this.y<=this.state.player.y-20?(this.yVelo=this.speed,this.inYRange=!1):(this.inYRange=!0,this.yVelo=0),this.x<this.state.player.x-0?this.inXRange=!1:this.x>=this.state.player.x+0?this.inXRange=!1:(this.xVelo=0,this.inXRange=!0),this.speed=this.oriSpeed},Ghost.prototype.checkDash=function(){{var a=new Kiwi.Geom.Point(this.x,this.y);new Kiwi.Geom.Point(this.state.player.x,this.state.player.y)}this.distanceToEgon=a.distanceToXY(this.state.player.x,this.state.player.y)},Ghost.prototype.teleport=function(){var a=Math.floor(909*Math.random())+1255,b=440;this.survival,this.x=a,this.y=b},Ghost.prototype.finishedAppear=function(){},Ghost.prototype.setupAI=function(){var a=new Kiwi.Plugins.AITree.AI,b=new Kiwi.Plugins.GhostAI.Actions.MoveToLocation({sprite:this}),c=new Kiwi.Plugins.GhostAI.Actions.SelectNewLocation({sprite:this,top:0,bottom:600,left:0,right:800,distance:200}),d=new Kiwi.Plugins.GhostAI.Actions.Pause({sprite:this,length:100}),e=new Kiwi.Plugins.GhostAI.Actions.Dash({sprite:this,target:this.state.player}),f=new Kiwi.Plugins.GhostAI.Actions.Pause({sprite:this,length:80}),g=new Kiwi.Plugins.GhostAI.Actions.Pause({sprite:this,length:240}),h=new Kiwi.Plugins.GhostAI.Actions.Teleport({sprite:this,length:120}),i=new Kiwi.Plugins.GhostAI.Actions.SelectDashTarget({sprite:this,target:this.state.player}),j=new Kiwi.Plugins.GhostAI.Conditions.DetectVisible({sprite:this}),k=new Kiwi.Plugins.GhostAI.Conditions.DetectEgon({sprite:this,target:this.state.player}),l=new Kiwi.Plugins.GhostAI.Actions.Appear({sprite:this}),m=new Kiwi.Plugins.GhostAI.Actions.Hit({sprite:this}),n=new Kiwi.Plugins.GhostAI.Conditions.DetectHit({sprite:this}),o=new Kiwi.Plugins.AITree.Sequencer({name:"randomMoveSequence"});o.addChild(c),o.addChild(b),o.addChild(d);var p=new Kiwi.Plugins.AITree.Sequencer({name:"detectEgonSequencer"});p.addChild(k),p.addChild(l);var q=new Kiwi.Plugins.AITree.Selector({name:"detectEgonSelector"});q.addChild(p),q.addChild(o);var r=new Kiwi.Plugins.AITree.Sequencer({name:"detectHitSequencer"});r.addChild(n),r.addChild(m);var s=new Kiwi.Plugins.AITree.Sequencer({name:"dashSequence"});s.addChild(j),s.addChild(i),s.addChild(f),s.addChild(e),s.addChild(g),s.addChild(h);var t=new Kiwi.Plugins.AITree.Selector({name:"dashSelector"});t.addChild(s),t.addChild(q);var u=new Kiwi.Plugins.AITree.Selector({name:"detectHitSelector"});u.addChild(r),u.addChild(t),a.addChild(u),this.ai=a};var Beam=function(a,b,c,d,e){Kiwi.GameObjects.Sprite.call(this,a,a.textures.beam,b,c);var f=.1;this.beamStage=0,this.objType="beam",this.direction=e;var g=.5*this.width,h=.5*this.height;this.centerPoint=new Kiwi.Geom.Point(g,h),this.shouldRemove=!1,this.timer=this.game.time.clock.createTimer("removeBeam",3,0,!1),this.timerEvent=this.timer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_COUNT,this.removeBeam,this),this.timer.start(),this.beamStage=d,this.animation.add("stage1",[0,1,2,3,4,5,6,7,8,9,10,11],f,!0),this.animation.add("stage2",[12,13,14,15,16,17,18,19,20,21,22,23],f,!0),this.animation.add("stage3",[24,25,26,27,28,29,30,31,32,33,34,35],f,!0),maximumFrames=12,this.playFrom=Math.floor(Math.random()*maximumFrames),this.modFrame=game.time.now()%maximumFrames,this.beamStage<=0?"stage1"!=this.animation.currentAnimation.name&&this.animation.playAt(this.playFrom,"stage1"):(this.beamStage=1)?"stage2"!=this.animation.currentAnimation.name&&this.animation.playAt(this.playFrom,"stage2"):this.beamStage>=2&&"stage3"!=this.animation.currentAnimation.name&&this.animation.playAt(this.playFrom,"stage3")};Kiwi.extend(Beam,Kiwi.GameObjects.Sprite),Beam.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this),this.centerPoint.x=this.worldX+.5*this.width,this.centerPoint.y=this.worldY+.5*this.height},Beam.prototype.updateAnimation=function(a){switch(a){case 0:"stage1"!=this.animation.currentAnimation.name&&(this.beamStage=0,this.animation.play("stage1",!1));break;case 1:"stage2"!=this.animation.currentAnimation.name&&(this.beamStage=1,this.animation.playAt(this.playFrom,"stage2"));break;case 2:"stage3"!=this.animation.currentAnimation.name&&(this.beamStage=2,this.animation.playAt(this.playFrom,"stage3"));break;default:console.error(a,": Stage was undefined"),"stage1"!=this.animation.currentAnimation.name&&this.animation.play("stage1",!1)}},Beam.prototype.removeBeam=function(){this.stopTimers(),this.exists=!1},Beam.prototype.stopTimers=function(){(this.timer||this.timer.running())&&this.timer.stop()};var Impact=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.impact,b,c),this.animation.add("impact",[0,1,2,3,4,5,6,7,8],.06,!0,!0),this.objType="impact";var d=.5*this.width,e=.5*this.height;this.centerPoint=new Kiwi.Geom.Point(d,e)};Kiwi.extend(Impact,Kiwi.GameObjects.Sprite),Impact.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this),this.centerPoint.x=this.worldX+.5*this.width,this.centerPoint.y=this.worldY+.5*this.height},Impact.prototype.startLoop=function(){this.animation.play("shoot")};var Spark=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.beamSpark,b,c);var d=.1;this.animation.add("initiate",[0,1,2,3,4,5,6,7,8,9],.06,!1,!0),this.animation.add("shoot",[11,12,13],d,!0),this.animation.play("shoot")};Kiwi.extend(Spark,Kiwi.GameObjects.Sprite),Spark.prototype.startLoop=function(){};var Book=function(a,b,c,d,e,f){switch(Kiwi.GameObjects.Sprite.call(this,a,a.textures.books,c,d),this.state=a,this.health=3,this.phase=1,this.objType="Book",this.targetImpact=null,this.type=b,this.throwSpeed=1500,this.maxHoldTime=5,this.moving=!0,this.moveTo(e,f),b){case"bible":this.animation.add("disappear",[0,1,2,3,4,5,6,7],.05,!1),this.animation.add("hold",[8,9],.05,!0),this.animation.add("idle",[10,11,12],.7,!0);break;case"book1":this.animation.add("disappear",[16,17,18,19,20],.05,!1),this.animation.add("hold",[13,14],.05,!0),this.animation.add("idle",[24,25,26],.7,!0);break;case"book2":this.animation.add("disappear",[27,28,29,30,31],.05,!1),this.animation.add("hold",[32,33],.05,!0),this.animation.add("idle",[34,35,36],.7,!0);break;case"book3":this.animation.add("disappear",[40,41,42,43,44],.05,!1),this.animation.add("hold",[37,38],.05,!0),this.animation.add("idle",[45,46,47],.7,!0);break;default:console.error("Book type did not match any given case")}this.animation.play("idle"),this.box.hitbox=new Kiwi.Geom.Rectangle(25,20,35,80),this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box)),this.animation.getAnimation("disappear").onStop.add(this.removeBook,this),this.centerPoint=new Kiwi.Geom.Point(this.x+.5*this.width,this.y+.5*this.height)};Kiwi.extend(Book,Kiwi.GameObjects.Sprite),Book.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this),this.updateCenterPoint(),this.checkCollisions()},Book.prototype.switchToIdle=function(){"idle"!=this.animation.currentAnimation&&this.animation.play("idle")},Book.prototype.removeBook=function(){this.alpha=0,this.exists=!1},Book.prototype.grabbed=function(){},Book.prototype.moveTo=function(a,b){this.x,this.y;this.tween=this.game.tweens.create(this);var c={};c.x=a,c.y=b,this.moving=!0,this.tween.to(c,1e3,Kiwi.Animations.Tweens.Easing.Linear.None),this.tween.onComplete(this.finishedMoving,this),this.tween.start()},Book.prototype.checkCollisions=function(){},Book.prototype.collideWithBoss=function(){},Book.prototype.updateCenterPoint=function(){this.centerPoint.x=this.worldX+.5*this.width,this.centerPoint.y=this.worldY+.5*this.height},Book.prototype.throwAt=function(a){this.moving=!0;{var b,c;this.x,this.y}c=a.x-this.x,b=a.y-this.y;var d=this.game.tweens.create(this),e={};e.x=a.x+2*c,e.y=a.y+2*b,d.to(e,this.throwSpeed,Kiwi.Animations.Tweens.Easing.Linear.None),d.onComplete(this.finishedThrow,this),d.delay(100),d.start()},Book.prototype.finishedThrow=function(){this.exists=!1},Book.prototype.trapped=function(){this.deathTimer=this.game.time.clock.createTimer("spawn",this.maxHoldTime,0,!1),this.deathTimer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_STOP,this.disappear,this),this.deathTimer.start()},Book.prototype.disappear=function(){this.exists&&"disappear"!=this.animation.currentAnimation.name&&this.animation.play("disappear",!1)},Book.prototype.finishedMoving=function(){this.moving=!1};var Boss=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.boss,b,c),this.state=a,this.health=3,this.phase=1,this.timerDelay=2,this.books=new Kiwi.Group(this.state),this.trappedBooks=new Kiwi.Group(this.state),this.state.addChild(this.books),this.state.addChild(this.trappedBooks),this.objType="Boss",this.bossMiniGame=!1,this.vulnerable=!1,this.animation.add("idle",[6,7,8,9,10,11],.0625,!0),this.animation.add("leftThrow",[24,25,26,26,26,27,28],.0625,!1),this.animation.add("rightThrow",[30,31,32,32,32,33,34],.0625,!1),this.animation.add("appear",[12,13,14,13,15,13],.0625,!1),this.animation.add("disappear",[18,19,20,21,22],.0625,!1),this.animation.add("damage",[0,1,2],.0625,!1),this.animation.add("death",[3,4,5],.0625,!1),this.box.hitbox=new Kiwi.Geom.Rectangle(25,20,35,80),this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box)),this.animation.getAnimation("leftThrow").onStop.add(this.switchToIdle,this),this.animation.getAnimation("rightThrow").onStop.add(this.switchToIdle,this),this.animation.getAnimation("disappear").onStop.add(this.switchToIdle,this),this.animation.getAnimation("damage").onStop.add(this.switchToIdle,this),this.animation.getAnimation("death").onStop.add(this.bossDead,this),this.animation.getAnimation("appear").onStop.add(this.finishedAppearing,this),this.centerPoint=new Kiwi.Geom.Point(this.x+.5*this.width,this.y+.5*this.height),this.shield=new Shield(this.state,b,c),this.state.addChild(this.shield),this.currentPhase="throwBooks",this.timer=this.game.time.clock.createTimer("spawn",this.timerDelay,0,!1),this.timer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_STOP,this.nextTimer,this),this.appear()};Kiwi.extend(Boss,Kiwi.GameObjects.Sprite),Boss.prototype.appear=function(){this.animation.play("appear")},Boss.prototype.finishedAppearing=function(){console.log("Started Boss"),this.currentPhase="throwBooks",this.timer.start(),this.switchToIdle()},Boss.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this),this.updateTrappedBooks(),this.checkIfHit(),this.health<=0&&(this.shield.alpha=0,this.nextPhase=null,this.currentPhase=null,"death"!=this.animation.currentAnimation.name&&this.animation.play("death"),this.game.tweens.removeAll())},Boss.prototype.bossHitWithBeam=function(){!this.bossMiniGame&&this.vulnerable&&(this.bossMiniGame=!0,this.state.miniGameManager.createMiniGame(this.centerPoint,this.health))},Boss.prototype.hurtByBeam=function(){"damage"!=this.animation.currentAnimation&&this.animation.play("damage",!1),this.health-=1,this.state.weaponManager.stopShooting(),this.state.weaponManager.beamManager.enemyKilled()},Boss.prototype.updateDamage=function(){this.state.collisionManager.checkBossHit()},Boss.prototype.checkIfHit=function(){for(var a=this.trappedBooks.members.length-1;a>=0;a--)"bible"==this.trappedBooks.members[a].type&&this.state.collisionManager.checkShieldBossHit(this,this.trappedBooks.members[a])&&(this.shield.takeDamage(),this.shieldDown())},Boss.prototype.shieldDown=function(){this.vulnerable=!0,"damage"!=this.animation.currentAnimation&&this.animation.play("damage",!1)},Boss.prototype.shieldUp=function(){this.vulnerable=!1,this.bossMiniGame=!1},Boss.prototype.updateTrappedBooks=function(){for(var a=this.trappedBooks.members.length-1;a>=0;a--)this.moveToImpact(this.trappedBooks.members[a]),this.updateBookAnimations(this.trappedBooks.members[a])},Boss.prototype.updateBookAnimations=function(a){"hold"!=a.animation.currentAnimation&&"disappear"!=this.animation.currentAnimation.name&&a.animation.play("hold",!1)},Boss.prototype.moveToImpact=function(a){if(a.exists&&a.targetImpact.exists){var b=a.targetImpact,c=this.getDist(a,b);a.x+=c.x-.5*a.width+.5*b.width,a.y+=c.y-.5*a.height+.5*b.height}},Boss.prototype.getDist=function(a,b){var c=new Kiwi.Geom.Point(0,0);return c.x=b.worldX-a.worldX,c.y=b.worldY-a.worldY,c},Boss.prototype.nextTimer=function(){switch(this.currentPhase){case"pickBooksUp":this.pickUpBooks(),this.nextPhase="throwBooks";break;case"throwBooks":this.bookAmount()>0?(this.throwBook(),this.nextPhase="throwBooks"):this.nextPhase="pickBooksUp"}this.nextPhase&&(this.timer=this.game.time.clock.createTimer("spawn",this.timerDelay,0,!1),this.timer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_STOP,this.nextTimer,this),this.timer.start()),this.currentPhase=this.nextPhase},Boss.prototype.bookAmount=function(){return this.books.members.length},Boss.prototype.pickUpBooks=function(){void 0!=this&&(this.health>1?this.createBooks(2):1===this.health&&this.createBooks(4))},Boss.prototype.createBooks=function(a){if(2==a){var b,c,d,e,f;f=this.spawnOrder(2),d=this.bookPos(f[0]),e=this.bookStartPos(),b=new Book(this.state,this.getBookType(),e.x,e.y,d.x,d.y),this.books.addChild(b),e=this.bookStartPos(),d=this.bookPos(f[1]),c=new Book(this.state,this.getBookType(),e.x,e.y,d.x,d.y),this.books.addChild(c)}if(4==a){var b,c,g,h,d,e,f;f=this.spawnOrder(4),d=this.bookPos(f[0]),e=this.bookStartPos(),b=new Book(this.state,this.getBookType(),e.x,e.y,d.x,d.y),this.books.addChild(b),e=this.bookStartPos(),d=this.bookPos(f[1]),c=new Book(this.state,this.getBookType(),e.x,e.y,d.x,d.y),this.books.addChild(c),e=this.bookStartPos(),d=this.bookPos(f[2]),g=new Book(this.state,this.getBookType(),e.x,e.y,d.x,d.y),this.books.addChild(g),e=this.bookStartPos(),d=this.bookPos(f[3]),h=new Book(this.state,this.getBookType(),e.x,e.y,d.x,d.y),this.books.addChild(h)}},Boss.prototype.spawnOrder=function(a){for(var b=[],c=[],d=0;a>d;d++)c[d]=d+1;for(;c.length>0;){var e=Math.floor(Math.random()*c.length);b[b.length]=c[e],c.splice(e,1)}return b},Boss.prototype.throwBook=function(){this.throwAni(),this.books.members[0].throwAt(this.state.player)},Boss.prototype.throwAni=function(){this.animation.play(this.books.members[0].x<this.x?"leftThrow":"rightThrow")},Boss.prototype.switchToIdle=function(){"idle"!=this.animation.currentAnimation&&this.animation.play("idle")},Boss.prototype.bossDead=function(){console.log("Boss Dead"),this.game.tweens.removeAll(),this.state.miniGameManager.beamTarget=this.state.player,this.state.weaponManager.beamManager.targetEnemy=this.state.player,this.shield.alpha=0,this.books.alpha=0,this.trappedBooks.alpha=0,this.alpha=0,this.state.levelManager.gameOver()},Boss.prototype.getBookType=function(){var a=Math.floor(4*Math.random());switch(a){case 0:return"bible";case 1:return"book1";case 2:return"book2";case 3:return"book3";default:return console.error("Book type was not defined properly"),"book3"}},Boss.prototype.bookPos=function(a){var b;return 1==a?b=new Kiwi.Geom.Point(this.x-300,this.y):2==a?b=new Kiwi.Geom.Point(this.x+this.width+100,this.y):3==a?b=new Kiwi.Geom.Point(this.x+this.width+200,this.y+100):4==a&&(b=new Kiwi.Geom.Point(this.x-400,this.y+100)),b},Boss.prototype.bookStartPos=function(){var a,b;return a=Math.floor(2*Math.random()),b=1==a?new Kiwi.Geom.Point(this.state.bookPileL.x,this.state.bookPileL.y):new Kiwi.Geom.Point(this.state.bookPileR.x,this.state.bookPileR.y)},Boss.prototype.endState=function(){this.shield.destroy(),this.stopAllTweens(),this.currentPhase=null,this.nextPhase=null,this.timer.stop()},Boss.prototype.trapBook=function(a,b){this.trappedBooks.addChild(a),a.trapped(),a.targetImpact=b.getChildAt(0)},Boss.prototype.stopAllTweens=function(){this.game.tweens.removeAll()};var Shield=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.shield,b,c),this.state=a,this.damageTimer,this.timerDelay=4,this.vulnerable=!1,this.animation.add("damage",[0,1,0,1,0,1,2,3],.05,!1),this.animation.add("idle",[4,5,6,7,7,6,5,4],.25,!0),this.animation.add("recharge",[8,9,10,11],.5,!1),this.animation.play("idle"),this.box.hitbox=new Kiwi.Geom.Rectangle(25,20,35,80),this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box)),this.animation.getAnimation("recharge").onStop.add(this.playIdle,this),this.centerPoint=new Kiwi.Geom.Point(this.x+.5*this.width,this.y+.5*this.height)};Kiwi.extend(Shield,Kiwi.GameObjects.Sprite),Shield.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this)},Shield.prototype.playIdle=function(){"idle"!=this.animation.currentAnimation&&this.animation.play("idle"),this.state.boss.shieldUp()},Shield.prototype.bossMiniGameStarted=function(){},Shield.prototype.takeDamage=function(){"damage"!=this.animation.currentAnimation&&this.animation.play("damage"),this.damageTime=this.game.time.clock.createTimer("spawn",this.timerDelay,0,!1),this.damageTime.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_STOP,this.recharge,this),this.damageTime.start()},Shield.prototype.recharge=function(){this.exists&&"recharge"!=this.animation.currentAnimation&&this.animation.play("recharge")};var DeathAnimation=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.egonSprite,b,c),this.state=a,this.animation.add("death",[43],.1,!1),this.animation.play("death"),this.rightKeyDown=!1,this.leftKeyDown=!1,this.jumpKeyDown=!1,this.tweenA=this.game.tweens.create(this),this.tweenB=this.game.tweens.create(this),this.tweenA.to({y:this.y-120},400,Kiwi.Animations.Tweens.Easing.Cubic.Out,!1),this.tweenB.to({y:this.y+400},1600,Kiwi.Animations.Tweens.Easing.Cubic.Out,!1),this.tweenB.onComplete(this.gameOver,this),this.tweenA.chain(this.tweenB),this.tweenA.start()};Kiwi.extend(DeathAnimation,Kiwi.GameObjects.Sprite),DeathAnimation.prototype.gameOver=function(){this.state.levelManager.gameOver()};var Platform=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.platform,b,c),this.state=a,this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box)),this.physics.immovable=!0};Kiwi.extend(Platform,Kiwi.GameObjects.Sprite),Platform.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this),this.physics.update()};var Cash=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.cash,b,c),this.state=a,this.box.hitbox=new Kiwi.Geom.Rectangle(60,65,60,55),this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box)),this.animation.add("drop",[0,1,2,3,4,5,6,7,7,8,8,7,7,8,8,7,7,8,8,7,7,8,8],.05,!1,!0),this.animation.play("drop"),this.animation.getAnimation("drop").onStop.add(this.removeCash,this),this.hittable=!1,this.state.gameManager.addScore(5e3)};Kiwi.extend(Cash,Kiwi.GameObjects.Sprite),Cash.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this)},Cash.prototype.removeCash=function(){this.exists=!1};var Gem=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.gem,b,c),this.state=a,this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box));var d=.05*Math.random()+.1;this.animation.add("idle",[0,1,2,3,4,5,6,7,8,9],d,!0,!0),this.animation.add("pickup",[10,11,12,13,14,15,16,17],.1,!1),this.animation.play("idle"),this.animation.getAnimation("pickup").onStop.add(this.removeSelf,this),this.hittable=!0};Kiwi.extend(Gem,Kiwi.GameObjects.Sprite),Gem.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this)},Gem.prototype.removeSelf=function(){this.exists=!1},Gem.prototype.hitPlayer=function(){this.hittable=!1,this.state.gameManager.addScore(500),this.animation.play("pickup")};var BeamManager=function(a){"use strict";this.state=a,this.beams=[],this.activeBeamImpact,this.activeBeamImpacts,this.targetEnemy,this.beamStage=0,this.spark=new Spark(this.state,-100,-100),this.spark.anchorPointX=-24,this.state.addChild(this.spark)};BeamManager.prototype.update=function(){"use strict";this.state.weaponManager.currentlyShooting()&&this.shoot(),this.updateTopImpact(),this.updateActiveBeamPosition(),this.updateBeams(),this.removeOldBeams(),this.updateSpark()},BeamManager.prototype.updateTopImpact=function(){this.beams[0]?"impact"==this.beams[0].members[0].objType?(this.activeBeamImpact.alpha=1,this.activeBeamImpact.x=this.beams[0].members[0].worldX,this.activeBeamImpact.y=this.beams[0].members[0].worldY):this.activeBeamImpact.alhpa=0:this.activeBeamImpact&&(this.activeBeamImpact.exists=!1)},BeamManager.prototype.updateSpark=function(){this.beams[0]&&(this.spark.rotation=this.beams[0].rotation,this.spark.x=this.beams[0].x+.5*this.spark.width,this.spark.y=this.beams[0].y-.5*this.spark.height,this.spark.alpha=this.state.weaponManager.currentlyShooting()?1:0)},BeamManager.prototype.updateActiveBeamPosition=function(){void 0!=this.beams[0]&&this.state.weaponManager.currentlyShooting()&&(this.beams[0].x=this.state.player.x+this.state.player.width/2,this.beams[0].y=this.state.player.y+this.state.player.height/2+10)},BeamManager.prototype.drawCollisionBoxes=function(){game.stage.clearDebugCanvas();for(var a=this.beams.length-1;a>=0;a--)for(var b=this.beams[a].members.length-1;b>=0;b--)this.beams[a].members[b].box.draw(game.stage.dctx)},BeamManager.prototype.removeOldBeams=function(){for(var a=this.beams.length-1;a>=0;a--)this.beams[a].members.length<=1&&(this.beams[a].members[0].objType?(this.removeBeamGroup(this.beams[a]),this.beams.splice(a,1)):"beam"!=this.beams[a].members[0].objType&&(this.removeBeamGroup(this.beams[a]),this.beams.splice(a,1)))},BeamManager.prototype.removeBeamGroup=function(a){for(var b=a.members.length-1;b>=0;b--)a.members[b].exists=!1;a===this.beams[0]&&(this.isActiveGroup(a)&&this.finishedColliding(a),this.state.miniGameManager.stopMiniGame()),a.exists=!1},BeamManager.prototype.updateBeams=function(){"use strict";var a,b;for(a=this.beams.length-1;a>=0;a-=1)for(b=0;b<=this.beams[a].members.length-1;b+=1)this.updateBeamSegment(this.beams[a].members[b],this.beams[a])},BeamManager.prototype.updateBeamSegment=function(a,b){"use strict";if("beam"==a.objType)return this.checkCollision(a)?this.isActiveGroup(b)&&!this.activeGroupColliding()?void this.activeBeamCollision(this.isLeader(a,b),a):this.hittingImpactPoint(a,b)?void this.collideBeam(a,b):void this.updateBeamMovement(a):void(this.state.collisionManager.checkBossHit(a)?(this.targetEnemy=this.state.boss,this.state.boss.bossHitWithBeam(),this.updateBeamMovement(a)):this.updateBeamMovement(a))},BeamManager.prototype.hittingImpactPoint=function(a,b){var c=this.state.collisionManager.collidesWithImpact(a,b);return c},BeamManager.prototype.beamVelocity=function(){var a=12,b=0;return[a,b]},BeamManager.prototype.getDirection=function(){var a=this.state.inputManager.getKeysDown();return a.upKey?a.leftKey?-(Math.PI/4):a.rightKey?Math.PI/4:0:a.leftKey?-(Math.PI/2):a.rightKey?Math.PI/2:this.state.player.scaleX<0?Math.PI/2:-(Math.PI/2)},BeamManager.prototype.updateBeamMovement=function(a){var b=this.beamVelocity(a);a.x+=b[0],a.y+=b[1]},BeamManager.prototype.isActiveGroup=function(a){"use strict";return a===this.beams[0]},BeamManager.prototype.activeGroupColliding=function(){"use strict";return"impact"==this.beams[0].members[0].objType},BeamManager.prototype.isLeader=function(a,b){"use strict";return a==b.members[0]},BeamManager.prototype.createNewActiveBeam=function(){"use strict";var a=new Kiwi.Group(this.state);return this.state.addChild(a),this.beams.unshift(a)},BeamManager.prototype.createNewActiveImpact=function(){"use strict";this.activeBeamImpact&&(this.activeBeamImpact.exists=!1),this.activeBeamImpact=new Impact(this.state,0,0),this.activeBeamImpact.alpha=0,this.state.addChild(this.activeBeamImpact)},BeamManager.prototype.activeBeamExists=function(){return this.beams[0].members[0]?!0:!1},BeamManager.prototype.activeBeamCollision=function(a,b){"use strict";var c=this.beams[0];if(this.activeBeamExists())if(a)this.setTargetEnemy(b),this.startColliding(b,c);else if("beam"===b.objType){if("impact"==this.beams[0].members[0].objType||void 0==this.beams[0].members[0])return;var d=this.breakActiveBeam(b),e=d.members[d.members.length-1];this.setTargetEnemy(e),this.startColliding(e,this.beams[0]),this.collideBeam(e,d)}},BeamManager.prototype.setTargetEnemy=function(a){var b=this.state.collisionManager.beamCollision(a);if(b===!1)return!1;switch(b.collision.objType){case"Book":this.targetEnemy=null;break;case"Ghost":this.targetEnemy=b.collision;break;case"Boss":this.targetEnemy=this.state.boss;default:console.error("Enemy was not confirmed"),this.targetEnemy=void 0}},BeamManager.prototype.breakActiveBeam=function(a){for(var b=this.beams[0].getChildIndex(a),c=new Kiwi.Group(this.state),d=this.beams[0].members.length-1;d>=0;d--)d>=b&&c.addChild(this.beams[0].members[d]);c=this.copyGroupProperties(c,this.beams[0]),this.beams.unshift(c),this.state.addChild(this.beams[0]);[c.members[0],c];return c},BeamManager.prototype.copyGroupProperties=function(a,b){return a.rotation=b.rotation,a},BeamManager.prototype.collideBeam=function(a,b){if(a==b.members[0]);else if(a==b.members[1])return void this.destroyBeam(a,b)},BeamManager.prototype.startColliding=function(a,b){"use strict";var c,d,e=a,f=new Impact(this.state,e.x,e.y),g=60,h=8;this.targetEnemy&&this.state.miniGameManager.createMiniGame(a,3),this.state.cameraManager.damageState=!0,c=e.x+e.width/2-f.width/2,d=e.y+e.width/2-f.width/2,this.impact=new Kiwi.Geom.Point(c,d),f.box.hitbox=new Kiwi.Geom.Rectangle(500,10,1e3,1e3),b.members.length<h&&(this.impact.x=+g),f.x=this.impact.x,f.y=this.impact.y,b.addChildAt(f,0)},BeamManager.prototype.finishedColliding=function(a){a.exists=!1,this.state.cameraManager.damageState=!1,this.state.miniGameManager.stopMiniGame()},BeamManager.prototype.stoppedShooting=function(){this.state.cameraManager.damageState=!1,this.state.miniGameManager.stopMiniGame()},BeamManager.prototype.enemyKilled=function(){this.stoppedShooting(),this.removeImpact()},BeamManager.prototype.destroyBeam=function(a,b){a.exists=!1,b.removeChild(a)},BeamManager.prototype.removeImpact=function(){for(var a=this.beams[0].members.length-1;a>=0;a--)"impact"==this.beams[0].members[a].objType&&(this.beams[0].members[a].alpha=0,this.beams[0].members[a].exists=!1)},BeamManager.prototype.shoot=function(){"use strict";return this.state.weaponManager.currentlyShooting()?(this.activeGroupExists()&&this.createBeam(),!0):(this.clearBeam(),this.state.weaponManager.shooting=!0,this.beamStage=0,this.createNewActiveBeam(),this.createNewActiveImpact(),this.beams[0].rotation=this.getDirection()-Math.PI/2,this.createBeam(),void 0)},BeamManager.prototype.clearBeam=function(){this.targetEnemy=null,this.state.miniGameManager.removeOldGame()},BeamManager.prototype.createBeam=function(){var a=new Beam(this.state,0,0,this.beamStage,0);a.y-=.5*a.height,a.x+=30,this.beams[0].addChild(a)},BeamManager.prototype.activeGroupExists=function(){return void 0==this.beams[0]?!1:"Group"!=this.beams[0].objType?!0:!1},BeamManager.prototype.checkCollision=function(a){var b=this.state.collisionManager.beamCollision(a);if(b===!1)return!1;switch(b.collision.objType){case"Ghost":this.state.enemyManager.trap(b.collision),this.hittingImpactPoint(a,this.getBeamGroup(a));break;case"Book":this.setTargetEnemy(a),this.state.boss.trapBook(b.collision,this.getBeamGroup(a)),this.hittingImpactPoint(a,this.getBeamGroup(a))}return!0},BeamManager.prototype.getBeamGroup=function(a){for(var b=this.beams.length-1;b>=0;b--)if(this.beams[b].contains(a))return this.beams[b]},BeamManager.prototype.canTrap=function(){return this.state.weaponManager.shootKeyIsDown},BeamManager.prototype.beamUpgrade=function(){this.beamStage+=1,this.updateBeamAnimations()},BeamManager.prototype.updateBeamAnimations=function(){if(this.beams[0]&&this.beamStage<3)for(var a=this.beams[0].members.length-1;a>=0;a--)this.beams[0].members[a].updateAnimation&&this.beams[0].members[a].updateAnimation(this.beamStage)},CameraManager=function(a){this.state=a,this.shakeSize=3,this.damageState=!1,this.shakeDamage=this.state.game.time.clock.createTimer("shakeDamage",.005,0,!1),this.lockCamera=!1},CameraManager.prototype.update=function(){this.updatePosition(),this.shakeCamera(),this.damageState&&this.shakeCameraDamage()},CameraManager.prototype.takeDamage=function(){this.shakeDamage.clear(),this.shakeDamage.stop(),this.shakeDamage.delay=.45,this.shakeDamage.repeatCount=1,this.shakeDamage.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_COUNT,this.damageReset,this),this.shakeDamage.start(),this.damageState=!0},CameraManager.prototype.shakeCameraDamage=function(){this.state.camera.transform.x+=Math.floor(6*Math.random()-3),this.state.camera.transform.y+=Math.floor(6*Math.random()-3)
},CameraManager.prototype.damageReset=function(){this.damageState=!1},CameraManager.prototype.shakeCamera=function(){this.shakeSize=3*this.state.weaponManager.beamStage+3,this.state.weaponManager.enemyTargeted&&(this.state.camera.transform.x+=Math.floor(Math.random()*this.shakeSize-.5*this.shakeSize),this.state.camera.transform.y+=Math.floor(Math.random()*this.shakeSize-.5*this.shakeSize))},CameraManager.prototype.updatePosition=function(){this.lockCamera?(this.state.camera.transform.x=-(this.state.levelManager.groundLayer.widthInPixels-this.state.game.stage.width),this.state.camera.transform.y=this.state.player.y<this.state.game.stage.height/2?0:this.state.player.y>this.state.levelManager.groundLayer.heightInPixels-this.state.game.stage.height/2?-(this.state.levelManager.groundLayer.heightInPixels-this.state.game.stage.height):-this.state.player.y+this.state.game.stage.height/2):(this.state.player.x<this.state.game.stage.width/2?this.state.camera.transform.x=0:this.state.player.x>this.state.levelManager.groundLayer.widthInPixels-this.state.game.stage.width/2?(this.lockCamera=!0,this.state.createSurvivalGame(),this.state.camera.transform.x=-(this.state.levelManager.groundLayer.widthInPixels-this.state.game.stage.width)):this.state.camera.transform.x=-this.state.player.x+this.state.game.stage.width/2,this.state.camera.transform.y=this.state.player.y<this.state.game.stage.height/2?0:this.state.player.y>this.state.levelManager.groundLayer.heightInPixels-this.state.game.stage.height/2?-(this.state.levelManager.groundLayer.heightInPixels-this.state.game.stage.height):-this.state.player.y+this.state.game.stage.height/2)},CollisionManager=function(a){this.state=a,this.beamCollideDistance=12,this.ghostCollideDistance=40,this.bookCollideDistance=30,this.shieldHitDistance=200,this.bossHitDistance=70,this.bookHitDistance=30},CollisionManager.prototype.update=function(){var a=!1;this.state.sloping?this.state.player.physics.velocity.y>=0&&(this.state.jumps=0,this.state.player.jumping&&this.state.player.roll(),a=!0):(this.state.levelManager.groundLayer.physics.overlapsTiles(this.state.player,!0),this.state.player.physics.isTouching(Kiwi.Components.ArcadePhysics.DOWN)&&(this.jumps=0,this.state.player.jumping&&this.state.player.roll(),a=!0)),a&&0==this.state.player.physics.velocity.x},CollisionManager.prototype.checkLeftSlope=function(){var a=Math.floor(this.state.px/this.state.tileWidth),b=Math.floor(this.state.py/this.state.tileHeight),c=this.state.levelManager.slopeLeftLayer.getTileFromXY(a,b);if(null!=c&&0!=c.index){var d=a*this.state.tileWidth,e=b*this.state.tileHeight;this.state.sloping=!0;var f=this.state.px-d,g=this.state.py-e;if(g>=this.state.tileHeight-f||this.state.px-this.state.player.physics.velocity.x/10>=d+this.tileWidth){var h=e+this.state.tileHeight-f;return void(this.state.player.y=Math.ceil(h-this.state.player.height))}}var i=this.state.levelManager.slopeLeftLayer.getTileFromXY(a,b-1);if(null!=i&&0!=i.index){var j=a*this.state.tileWidth,k=(b-1)*this.state.tileHeight;this.state.sloping=!0;var f=this.state.px-j,h=k+this.state.tileHeight-f;this.state.player.y=h-this.state.player.height}},CollisionManager.prototype.checkRightSlope=function(){if(!this.sloping){var a=Math.floor(this.state.px/this.state.tileWidth),b=Math.floor(this.state.py/this.state.tileHeight),c=this.state.levelManager.slopeRightLayer.getTileFromXY(a,b);if(null!=c&&0!=c.index){var d=a*this.state.tileWidth,e=b*this.state.tileHeight;this.state.sloping=!0;var f=this.state.px-d,g=this.state.py-e;if(g>=f||this.state.px-this.state.player.physics.velocity.x/10<=d)return void(this.state.player.y=Math.ceil(e+f-this.state.player.height))}var h=this.state.levelManager.slopeRightLayer.getTileFromXY(a,b-1);if(null!=h&&0!=h.index){this.state.sloping=!0;var i=a*this.state.tileWidth,j=(b-1)*this.state.tileHeight,f=this.state.px-i;this.state.player.y=Math.ceil(j+f-this.state.player.height)}}},CollisionManager.prototype.beamCollision=function(a){if(void 0==a)return!1;void 0==a.box.bounds;for(var b=this.state.enemyManager.enemies.members.length-1;b>=0;b--)if(a.centerPoint.distanceTo(this.state.enemyManager.enemies.members[b].centerPoint)<this.ghostCollideDistance){target=this.state.enemyManager.enemies.members[b];var c={collision:this.state.enemyManager.enemies.members[b]};return c}if(void 0!=this.state.boss){for(var b=this.state.boss.books.members.length-1;b>=0;b--)if(!this.state.boss.books.members[b].moving&&a.centerPoint.distanceTo(this.state.boss.books.members[b].centerPoint)<this.bookCollideDistance){target=this.state.boss.books.members[b];var c={collision:this.state.boss.books.members[b]};return c}for(var b=this.state.boss.trappedBooks.members.length-1;b>=0;b--)if(!this.state.boss.trappedBooks.members[b].moving&&a.centerPoint.distanceTo(this.state.boss.trappedBooks.members[b].centerPoint)<this.bookCollideDistance){target=this.state.boss.trappedBooks.members[b];var c={collision:this.state.boss.trappedBooks.members[b]};return c}}return!1},CollisionManager.prototype.collidesWithImpact=function(a,b){return void 0==a?(console.log("No beam"),!1):a.centerPoint.distanceTo(b.members[0].centerPoint)<this.beamCollideDistance?(a.exists=!1,!0):!1},CollisionManager.prototype.checkShieldBossHit=function(a,b){return a.centerPoint.distanceTo(b.centerPoint)<this.shieldHitDistance?!0:!1},CollisionManager.prototype.checkBossHit=function(a){if(void 0==a)return!1;if(void 0==a.box.bounds,void 0!=this.state.boss){if(a.centerPoint.distanceTo(this.state.boss.centerPoint)<this.bossHitDistance){target=this.state.boss;var b={collision:this.state.boss};return b}return!1}},CollisionManager.prototype.bookHitPlayer=function(){for(var a=this.state.boss.books.members,b=a.length-1;b>=0;b--)if(this.state.player.centerPoint.distanceTo(a[b].centerPoint)<this.bookHitDistance)return!0;return!1},CollisionManager.prototype.releaseGhost=function(a){if(void 0==a)return!1;for(var b=this.state.weaponManager.beamManager.beams.length-1;b>=0;b--)for(var c=this.state.weaponManager.beamManager.beams[b].members.length-1;c>=0;c--)if(a.centerPoint.distanceTo(this.state.weaponManager.beamManager.beams[b].members[c].centerPoint)<this.ghostCollideDistance)return a.hit=!0,a.releaseTime=null,!0;return null==a.releaseTime&&a.hit?(console.log("Release Ghost"),a.releaseTime=this.state.game.time.now()+2e3):a.releaseTime<this.state.game.time.now()&&a.hit&&(a.hit=!1,a.releaseTime=null),!1};var EnemyManager=function(a){Kiwi.Group.call(this,a),this.state=a,this.enemies=new Kiwi.Group(a),this.deathGroup=new Kiwi.Group(a),this.itemGroup=new Kiwi.Group(a),this.addChild(this.enemies),this.state.addChild(this.deathGroup),this.addChild(this.itemGroup),this.enemiesLength=0,this.rotChanged=!1};Kiwi.extend(EnemyManager,Kiwi.Group),EnemyManager.prototype.checkCollision=function(a){var b=this.enemies.members;this.enemiesLength=this.enemies.members.length;for(var c=null,d=this.enemiesLength-1;d>=0;d--)b[d].physics.overlaps(a)&&(c=b[d],this.enemies.members[d].hit=!0);return c},EnemyManager.prototype.releaseGhost=function(){for(var a=this.enemies.members.length-1;a>=0;a--)this.state.collisionManager.releaseGhost(this.enemies.members[a])},EnemyManager.prototype.enemiesAlive=function(){return this.enemies.members.length},EnemyManager.prototype.resetHit=function(){for(var a=this.enemies.members.length-1;a>=0;a--)this.enemies.members[a].hit=!1},EnemyManager.prototype.resetEnemies=function(){this.resetHit()},EnemyManager.prototype.trap=function(a){var b;!a.hit&&this.state.miniGameManager.miniGameActive&&(console.log("INSIDE"),a.hit=!0,b=this.state.miniGameManager.getHealth(),this.state.miniGameManager.skullGroup.clear(),this.state.miniGameManager.createSkulls(b+3)),a.hit=!0},EnemyManager.prototype.checkGroupCollision=function(a){var b=this.enemies.members;this.enemiesLength=this.enemies.members.length;for(var c=(a.members,this.enemiesLength-1);c>=0;c--)if(b[c].physics.overlaps(entity))return!0;return!1},EnemyManager.prototype.addEnemies=function(a){for(var b=a-1;b>=0;b--){var c=new Ghost(this.state,Math.random()*this.state.width*.5+.5*this.state.width,440);this.enemies.addChild(c),this.enemiesLength++}},EnemyManager.prototype.spawnSurvivalGhost=function(){var a=Math.floor(909*Math.random())+1255,b=440,c=new Ghost(this.state,a,b);c.survival=!0,this.enemies.addChild(c),this.enemiesLength++},EnemyManager.prototype.getTrappedEnemies=function(){for(var a=[],b=this.enemies.members.length-1;b>=0;b--)this.enemies.members[b].hit&&a.push(this.enemies.members[b]);return a},EnemyManager.prototype.updateTrappedAnimation=function(){for(var a,b=this.getTrappedEnemies(),c=b.length-1;c>=0;c--)switch(a=Math.floor(3*Math.random()),b[c].health-=1,a){case 0:b[c].animation.play("damage1");break;case 1:b[c].animation.play("damage2");break;case 2:b[c].animation.play("damage3");break;default:b[c].animation.play("damage3")}},EnemyManager.prototype.updateTrappedEnemies=function(){for(var a=this.state.player.physics.velocity.x,b=this.state.player.physics.velocity.y,c=this.enemies.members.length-1;c>=0;c--)this.enemies.members[c].hit&&(console.log(a,b,"Updating Hit Ghost"),this.enemies.members[c].x+=a,this.enemies.members[c].y+=b)},EnemyManager.prototype.addEnemy=function(a,b,c){if("ghost"==a){var d=new Ghost(this.state,b,c);this.enemies.addChild(d),this.enemiesLength++}},EnemyManager.prototype.removeEnemies=function(){this.animation.play("shoot")},EnemyManager.prototype.update=function(){Kiwi.Group.prototype.update.call(this);var a=this.enemies.members;this.enemiesLength=a.length,this.checkPlayerCollision(),this.releaseGhost();for(var b=this.enemiesLength-1;b>=0;b--);},EnemyManager.prototype.kill=function(a){this.enemies.members;this.enemies.removeChild(a,!0),this.state.egon.stopShooting()},EnemyManager.prototype.changeRotPoint=function(){for(var a=this.getTrappedEnemies(),b=a.length-1;b>=0;b--)0==a[b].rotPointX&&(a[b].rotPointX=30*Math.random()-15,a[b].rotPointY=30*Math.random()-15)},EnemyManager.prototype.restoreRotPoint=function(){this.getTrappedEnemies();this.rotChanged=!1;for(var a=this.enemies.members.length-1;a>=0;a--)0!=this.enemies.members[a].rotPointX&&(this.enemies.members[a].rotPointX=0,this.enemies.members[a].rotPointY=0)},EnemyManager.prototype.killTrapped=function(){for(var a=this.enemies.members.length-1;a>=0;a--)this.enemies.members[a].hit&&this.killEnemy(this.enemies.members[a])},EnemyManager.prototype.killEnemy=function(a){a.exists=!1;var b=new Death(this.state,a.x,a.y);this.deathGroup.addChild(b)},EnemyManager.prototype.killAll=function(){for(var a=this.enemies.members.length-1;a>=0;a--)this.enemies.members[a].exists=!1},EnemyManager.prototype.checkPlayerCollision=function(){Kiwi.Group.prototype.update.call(this);var a=this.enemies.members;this.enemiesLength=a.length;for(var b=this.enemiesLength-1;b>=0;b--)a[b].physics.overlaps(this.state.player)&&this.state.player.hitByEnemy()};var GameManager=function(a){this.state=a,this.playersEnergy=100,this.playersHealth=10,this.playerDamage=1,this.DAMAGE_TIMER=70,this.canTakeDamage=!0,this.score=0,this.damageTimer=this.state.game.time.clock.createTimer("damageTimer",.45,0,!1)};GameManager.prototype.update=function(){this.playersHealth<=0&&this.state.player.die(),this.state.weaponManager.shooting?this.playersEnergy>0?this.playersEnergy-=.1:this.state.weaponManager.stopShooting():this.playersEnergy<=100&&(this.playersEnergy+=.5)},GameManager.prototype.addScore=function(a){this.score+=a},GameManager.prototype.playersEnergy=function(){return this.playersEnergy},GameManager.prototype.playerHitByEnemy=function(){this.canTakeDamage&&(this.startDamageTimer(),this.state.player.takeDamage(),this.state.cameraManager.shakeCamera(),this.playersHealth-=this.playerDamage)},GameManager.prototype.startDamageTimer=function(){this.damageTimer.clear(),this.damageTimer.stop(),this.damageTimer.delay=.45,this.damageTimer.repeatCount=1,this.damageTimer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_COUNT,this.damageReset,this),this.damageTimer.start(),this.canTakeDamage=!1},GameManager.prototype.damageReset=function(){this.canTakeDamage=!0},GameManager.prototype.gameOver=function(){var a={score:this.score};return a},HUDManager=function(a){this.state=a,this.playersHealth=new Kiwi.HUD.Widget.Bar(this.state.game,6,10,130,13,80,9),this.playersHealth.style.backgroundColor="#transparent",this.playersHealth.style.boxShadow="2px 2px 2px 0px #000000, 0px 0px 2px 2px #FF0000 inset ",this.playersHealth.bar.style.backgroundColor="#FF0000",this.playersHealth.bar.style.boxShadow=" 2px 2px 2px 0px #777777 inset",this.playersEnergy=new Kiwi.HUD.Widget.Bar(this.state.game,100,100,130,27,80,9),this.playersEnergy.style.backgroundColor="#transparent",this.playersEnergy.style.boxShadow="2px 2px 2px 0px #000000, 0px 0px 2px 2px #3c8fdc inset",this.playersEnergy.bar.style.backgroundColor="#3c8fdc",this.playersEnergy.bar.style.boxShadow="2px 2px 2px 0px #999999 inset",this.hudScore=new Kiwi.HUD.Widget.TextField(this.state.game,"$6500",150,42),this.hudScore.style.fontFamily="myFirstFont",this.hudScore.style.color="#FFB674",this.hudScore.style.textShadow="2px 2px #000000",this.hudScore.style.fontSize="12px",this.hudScore.style.letterSpacing="1px",this.state.game.huds.defaultHUD.addWidget(this.playersHealth),this.state.game.huds.defaultHUD.addWidget(this.playersEnergy),this.state.game.huds.defaultHUD.addWidget(this.hudScore),this.energy=100,this.health=10,this.score=0,this.faceIcon=new Kiwi.HUD.Widget.Icon(this.state.game,this.state.textures.UI,10,10),this.state.game.huds.defaultHUD.addWidget(this.faceIcon)},HUDManager.prototype.update=function(){this.energy=this.state.gameManager.playersEnergy,this.health=this.state.gameManager.playersHealth,this.score=this.state.gameManager.score,this.playersEnergy.counter.current=this.energy,this.playersHealth.counter.current=this.health,this.hudScore.text="$"+this.score},HUDManager.prototype.endState=function(){this.state.game.huds.defaultHUD.removeAllWidgets()};var InputManager=function(a){this.state=a,this.keyboard=this.state.game.input.keyboard,this.mouse=this.state.game.input.mouse,this.rightKey=this.keyboard.addKey(Kiwi.Input.Keycodes.D),this.rightArrowKey=this.keyboard.addKey(Kiwi.Input.Keycodes.RIGHT),this.leftKey=this.keyboard.addKey(Kiwi.Input.Keycodes.A),this.leftArrowKey=this.keyboard.addKey(Kiwi.Input.Keycodes.LEFT),this.upKey=this.keyboard.addKey(Kiwi.Input.Keycodes.W),this.upArrowKey=this.keyboard.addKey(Kiwi.Input.Keycodes.UP),this.downKey=this.keyboard.addKey(Kiwi.Input.Keycodes.S),this.downArrowKey=this.keyboard.addKey(Kiwi.Input.Keycodes.DOWN),this.spawnKey=this.keyboard.addKey(Kiwi.Input.Keycodes.Q),this.restartKey=this.keyboard.addKey(Kiwi.Input.Keycodes.R),this.shootKey=this.keyboard.addKey(Kiwi.Input.Keycodes.J),this.shoot2Key=this.keyboard.addKey(Kiwi.Input.Keycodes.Z),this.jumpKey=this.keyboard.addKey(Kiwi.Input.Keycodes.K),this.jump2Key=this.keyboard.addKey(Kiwi.Input.Keycodes.X),this.gemKey=this.keyboard.addKey(Kiwi.Input.Keycodes.G),this.gameOverKey=this.keyboard.addKey(Kiwi.Input.Keycodes.F),this.captureKey=this.keyboard.addKey(Kiwi.Input.Keycodes.SPACEBAR),this.keyboard.onKeyDownOnce.add(this.keyDownOnce,this),this.keyboard.onKeyUp.add(this.keyUp,this)};InputManager.prototype.keyDownOnce=function(a){if((a==this.rightKey.keyCode||a==this.rightArrowKey.keyCode)&&this.state.player.updateKeyDown("RIGHT"),(a==this.leftKey.keyCode||a==this.leftArrowKey.keyCode)&&this.state.player.updateKeyDown("LEFT"),(a==this.upKey.keyCode||a==this.upArrowKey.keyCode)&&this.state.player.updateKeyDown("UP"),(a==this.jumpKey.keyCode||a==this.jump2Key.keyCode)&&(this.state.player.updateKeyDown("JUMP"),this.keyUp(this.shootKey.keyCode,this.jumpKey)),a==this.spawnKey.keyCode&&this.state.enemyManager.addEnemies(1),(a==this.shootKey.keyCode||a==this.shoot2Key.keyCode)&&this.state.weaponManager.shootKeyDown(),a==this.captureKey.keyCode){var b=this.state.miniGameManager.attemptMatch();b||this.state.miniGameManager.miniGameActive&&(this.state.gameManager.playersEnergy-=10)}if(a==this.gemKey.keyCode){var c=new Kiwi.Geom.Point(this.mouse.x,this.mouse.y);c=game.cameras.defaultCamera.transformPoint(c),this.state.itemManager.addItem("gem",c.x,c.y)}},InputManager.prototype.keyUp=function(a){(a==this.rightKey.keyCode||a==this.rightArrowKey.keyCode)&&this.state.player.updateKeyUp("RIGHT"),(a==this.leftKey.keyCode||a==this.leftArrowKey.keyCode)&&this.state.player.updateKeyUp("LEFT"),(a==this.upKey.keyCode||a==this.upArrowKey.keyCode)&&this.state.player.updateKeyUp("UP"),(a==this.jumpKey.keyCode||a==this.jump2Key.keyCode)&&this.state.player.updateKeyUp("JUMP"),(a==this.shootKey.keyCode||a==this.shoot2Key.keyCode)&&this.state.weaponManager.shootKeyUp(),a==this.restartKey.keyCode&&this.state.levelManager.switchStates(),a==this.gameOverKey.keyCode},InputManager.prototype.switchStates=function(){this.keyboard.onKeyDownOnce.remove(this.keyDownOnce,this),this.keyboard.onKeyUp.remove(this.keyUp,this)},InputManager.prototype.getKeysDown=function(){var a={rightKey:this.rightKey.isDown||this.rightArrowKey.isDown,leftKey:this.leftKey.isDown||this.leftArrowKey.isDown,upKey:this.upKey.isDown||this.upArrowKey.isDown,downKey:this.downKey.isDown||this.downArrowKey.isDown};return a};var ItemManager=function(a){Kiwi.Group.call(this,a),this.state=a,this.items=new Kiwi.Group(a),this.itemGroup=new Kiwi.Group(a),this.addChild(this.items),this.addChild(this.itemGroup),this.enemiesLength=0};Kiwi.extend(ItemManager,Kiwi.Group),ItemManager.prototype.addItem=function(a,b,c){if("cash"==a){var d=new Cash(this.state,b,c);this.items.addChild(d)}if("gem"==a){var d=new Gem(this.state,b,c);this.items.addChild(d)}},ItemManager.prototype.update=function(){Kiwi.Group.prototype.update.call(this);var a=this.items.members;this.itemsLength=a.length,this.checkCollision()},ItemManager.prototype.removeItem=function(a){this.items.members;this.items.removeChild(a,!0)},ItemManager.prototype.checkCollision=function(){var a=this.items.members;this.itemsLength=a.length;for(var b=this.itemsLength-1;b>=0;b--)a[b].hittable&&a[b].physics.overlaps(this.state.player)&&a[b].hitPlayer()},LevelManager=function(a){this.state=a},LevelManager.prototype.generateTileMap=function(){this.tilemap=new Kiwi.GameObjects.Tilemap.TileMap(this.state,"tilemap",this.state.textures.tiles),this.backgroundLayer=this.tilemap.getLayerByName("Background"),this.backgroundLayer.allowCollisions=Kiwi.Components.ArcadePhysics.ANY,this.state.addChild(this.backgroundLayer),this.groundLayer=this.tilemap.getLayerByName("Ground"),this.groundLayer.allowCollisions=Kiwi.Components.ArcadePhysics.ANY,this.state.addChild(this.groundLayer),this.objectLayer=this.tilemap.getLayerByName("Objects"),this.objectLayer.allowCollisions=Kiwi.Components.ArcadePhysics.ANY,this.state.addChild(this.objectLayer),this.slopeLeftLayer=this.tilemap.getLayerByName("SlopeLeft"),this.slopeLeftLayer.allowCollisions=Kiwi.Components.ArcadePhysics.ANY,this.state.addChild(this.slopeLeftLayer),this.slopeRightLayer=this.tilemap.getLayerByName("SlopeRight"),this.slopeRightLayer.allowCollisions=Kiwi.Components.ArcadePhysics.ANY,this.state.addChild(this.slopeRightLayer);for(var a=1;a<this.tilemap.tileTypes.length;a++)this.tilemap.tileTypes[a].allowCollisions=Kiwi.Components.ArcadePhysics.ANY},LevelManager.prototype.generateForegroundTileMap=function(){this.foregroundRightLayer=this.tilemap.getLayerByName("Foreground"),this.state.addChild(this.foregroundRightLayer),this.slopeRightForegroundLayer=this.tilemap.getLayerByName("SlopeRight"),this.state.addChild(this.slopeRightForegroundLayer),this.slopeLeftForegroundLayer=this.tilemap.getLayerByName("SlopeLeft"),this.state.addChild(this.slopeLeftForegroundLayer)},LevelManager.prototype.gemsLevelOne=function(){},LevelManager.prototype.ghostsLevelOne=function(){this.state.enemyManager.addEnemy("ghost",992,479),this.state.enemyManager.addEnemy("ghost",1610,320)},LevelManager.prototype.gameOver=function(){this.state.hudManager.endState(),this.state.survivalGame&&this.state.survivalGame.spawnTimer.stop();var a=this.state.gameManager.gameOver();void 0!=this.boss&&this.state.boss.endState(),game.states.switchState("GameOver",null,null,a)},LevelManager.prototype.switchStates=function(){this.state.hudManager.endState(),this.state.inputManager.switchStates(),game.states.switchState("Intro")};var PlayerManager=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.egonSprite,b,c),this.state=a,this.animation.add("idle",[15],.1,!0),this.animation.add("walk",[8,9,10,11,12,13,14,15],.05,!0),this.animation.add("shootHorz",[8,9,10,11,12,13,14,15],.05,!0),this.animation.add("shootVert",[16,17,18,19,20,21,22,23],.05,!0),this.animation.add("shootDiagonal",[0,1,2,3,4,5,6,7],.05,!0),this.animation.add("jump",[24,25],.1,!1),this.animation.add("roll",[26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33],.005,!1),this.animation.add("death",[43],1,!0),this.animation.play("idle"),this.box.hitbox=new Kiwi.Geom.Rectangle(25,20,35,80),this.physics=this.components.add(new Kiwi.Components.ArcadePhysics(this,this.box)),this.physics.acceleration.y=30,this.force=4,this.maxRunVelo=26,this.beamStage=0,this.jumpHeight=40,this.shootingMovementSpeed=.7,this.playedDeath=!1,this.centerPoint=new Kiwi.Geom.Point(0,0),this.rightKeyDown=!1,this.leftKeyDown=!1,this.upKeyDown=!1,this.jumpKeyDown=!1,this.currDir=this.RIGHT,this.jumping=!1,this.takeDamageTimer=this.game.time.clock.createTimer("takeDamageTimer",.25,0,!1),this.animation.getAnimation("roll").onStop.add(this.finishedRoll,this)};Kiwi.extend(PlayerManager,Kiwi.GameObjects.Sprite),PlayerManager.prototype.takeDamage=function(){this.state.cameraManager.takeDamage(),this.state.weaponManager.stopShooting(),this.physics.velocity.x=70*this.scaleX,this.physics.velocity.y=-20,this.takeDamageTimer.clear(),this.takeDamageTimer.stop(),this.takeDamageTimer.delay=.14,this.takeDamageTimer.repeatCount=6,this.takeDamageTimer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_COUNT,this.flash,this),this.takeDamageTimer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_STOP,this.stopFlash,this),this.takeDamageTimer.start()},PlayerManager.prototype.flash=function(){this.alpha=.75==this.alpha?1:.75},PlayerManager.prototype.stopFlash=function(){this.alpha=1},PlayerManager.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this),this.x>2200?this.x=-50:this.x<-50&&(this.x=2200),this.updateMovement(),this.state.boss&&this.updateBookCollisions(),this.y>1e3&&(this.y=50),this.x=Math.round(this.x),this.y=Math.round(this.y),this.state.playersLegs.updateLegs(),this.state.weaponManager.shooting&&(this.animation.play(this.shootAnimation,!1),this.state.playersLegs.animation.currentAnimation.reverse=this.scaleX!=this.shootScaleX?!0:!1,this.scaleX=this.shootScaleX,this.state.playersLegs.scaleX=this.shootScaleX)},PlayerManager.prototype.updateBookCollisions=function(){this.state.collisionManager.bookHitPlayer()&&this.hitByEnemy()},PlayerManager.prototype.setAnimation=function(){var a=this.state.weaponManager.beamManager.getDirection();switch(a){case-(Math.PI/4):this.shootAnimation="shootDiagonal";break;case Math.PI/4:this.shootAnimation="shootDiagonal";break;case 0:this.shootAnimation="shootVert";break;case-(Math.PI/2):this.shootAnimation="shootHorz";break;case Math.PI/2:this.shootAnimation="shootHorz"}this.shootScaleX=this.scaleX},PlayerManager.prototype.setNormalAnimation=function(){var a=this.state.weaponManager.beamManager.getDirection();switch(a){case-(Math.PI/4):this.normalAnimation="shootDiagonal";break;case Math.PI/4:this.normalAnimation="shootDiagonal";break;case 0:this.normalAnimation="shootVert";break;case-(Math.PI/2):this.normalAnimation="shootHorz";break;case Math.PI/2:this.normalAnimation="shootHorz"}},PlayerManager.prototype.jump=function(){this.jumpKeyDown&&!this.jumping&&(0==this.physics.velocity.x&&(this.physics.velocity.x+=1.25*this.maxRunVelo*-this.scaleX),this.physics.velocity.y=-this.jumpHeight,this.physics.velocity.x=2*this.maxRunVelo*-this.scaleX,this.jumping=!0,"jump"!=this.animation.currentAnimation.name&&this.animation.play("jump"))},PlayerManager.prototype.roll=function(){"roll"!=this.animation.currentAnimation.name&&this.animation.play("roll")},PlayerManager.prototype.finishedRoll=function(){this.jumping=!1},PlayerManager.prototype.updateAnimations=function(){this.setNormalAnimation(),this.leftKeyDown||this.rightKeyDown?(this.animation.currentAnimation.name==this.normalAnimation||this.jumping||this.animation.play(this.normalAnimation),this.state.playersLegs.animation.play("walk",!1)):this.upKeyDown?this.animation.currentAnimation.name==this.normalAnimation||this.jumping||this.animation.play(this.normalAnimation):"idle"==this.animation.currentAnimation.name||this.jumping||(this.animation.play("idle"),this.state.playersLegs.animation.play("idle",!1))},PlayerManager.prototype.negativeAccel=function(){this.rightKeyDown||this.leftKeyDown||this.jumping||(this.physics.velocity.x>6||this.physics.velocity.x<-6?this.physics.velocity.x*=.92:this.physics.velocity.x=0)},PlayerManager.prototype.modifyVelocity=function(){return this.jumping?2:this.state.weaponManager.shooting?this.shootingMovementSpeed:1},PlayerManager.prototype.updateMovement=function(){this.negativeAccel(),this.updateAnimations();var a=this.modifyVelocity();this.rightKeyDown?(this.scaleX=-1,this.physics.velocity.x<this.maxRunVelo*a?this.physics.velocity.x+=this.force:this.jumping||(this.physics.velocity.x=this.maxRunVelo*a)):this.leftKeyDown&&(this.scaleX=1,this.physics.velocity.x>-this.maxRunVelo*a?this.physics.velocity.x-=this.force:this.jumping||(this.physics.velocity.x=-this.maxRunVelo*a)),this.centerPoint.x=this.worldX+.5*this.width,this.centerPoint.y=this.worldY+.5*this.height,this.state.cameraManager.lockCamera&&(this.x<1255?this.x=1255:this.x>2164&&(this.x=2164))},PlayerManager.prototype.updateKeyDown=function(a){"RIGHT"==a&&(this.rightKeyDown=!0),"LEFT"==a&&(this.leftKeyDown=!0),"UP"==a&&(this.upKeyDown=!0),"JUMP"==a&&(this.jumpKeyDown=!0,this.jump())},PlayerManager.prototype.updateKeyUp=function(a){"RIGHT"==a&&(this.rightKeyDown=!1),"LEFT"==a&&(this.leftKeyDown=!1),"UP"==a&&(this.upKeyDown=!1),"JUMP"==a&&(this.jumpKeyDown=!1)},PlayerManager.prototype.hitByEnemy=function(){this.jumping||this.state.gameManager.playerHitByEnemy()},PlayerManager.prototype.die=function(){this.alpha=0,this.playedDeath||(this.playedDeath=!0,this.deathAni=new DeathAnimation(this.state,this.x,this.y),this.state.addChild(this.deathAni))};var SurvivalGame=function(a){Kiwi.Group.call(this,a),this.state=a,this.wave=1,this.waveLimit=1,this.waveCounter=0,this.attempt=0,this.maxWave=5,this.spawnTimer=this.game.time.clock.createTimer("shoot",2,-1,!1),this.spawnEvent=this.spawnTimer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_COUNT,this.attemptSpawn,this),this.spawnTimer.start()};Kiwi.extend(SurvivalGame,Kiwi.Group),SurvivalGame.prototype.attemptSpawn=function(){var a=this.state.enemyManager.enemiesAlive();this.waveCounter<this.waveLimit&&a<this.waveLimit?(this.spawnEnemy(),this.waveCounter++):0==this.state.enemyManager.enemiesAlive()?this.newWave():(this.attempt+=1,this.attempt>10&&(this.newWave(),this.attempt=0,this.removeAllEnemies()))},SurvivalGame.prototype.spawnEnemy=function(){this.state.enemyManager.spawnSurvivalGhost()},SurvivalGame.prototype.newWave=function(){this.wave+=1,this.attempt=0,this.wave<this.maxWave?(this.waveLimit+=1,this.waveCounter=0):(this.waveLimit=Math.floor(Math.random()*(this.maxWave+1))+1,this.waveCounter=0)},SurvivalGame.prototype.removeAllEnemies=function(){this.state.enemyManager.killAll()};var WeaponManager=function(a){this.state=a,this.shootKeyIsDown=!1,this.shooting=!1,this.beamShooting=!1,this.beamNeedsUpdating=!1,this.enemyTargeted=!1,this.beamManager=new BeamManager(this.state)};WeaponManager.prototype.currentlyShooting=function(){return this.shooting},WeaponManager.prototype.update=function(){this.beamManager.update()},WeaponManager.prototype.stopShooting=function(){this.shooting=!1,this.beamShooting=!1,this.enemyTargeted=!1,this.beamStage=0},WeaponManager.prototype.startShooting=function(){0!=this.shooting||this.state.player.jumping||(this.beamManager.shoot(),this.state.player.setAnimation())},WeaponManager.prototype.damageEnemy=function(){},WeaponManager.prototype.shootKeyUp=function(){this.shootKeyIsDown=!1,this.shooting=!1,this.beamManager.stoppedShooting(),this.state.enemyManager.resetEnemies(),this.stopShooting(),this.state.enemyManager.resetHit()},WeaponManager.prototype.shootKeyDown=function(){this.shootIsKeyDown=!0,this.startShooting()};var BlueCircle=function(a,b,c,d){Kiwi.GameObjects.Sprite.call(this,a,a.textures.blueCircle,c,d),this.state=a,this.myParent=b;this.animation.add("loop",[0,1],.06,!0),this.animation.add("fade",[2,3,4,5],.1,!1),this.animation.add("missedOne",[6,6,1,6,1,6,6],.1,!1),this.animation.add("missedTwo",[7,7,1,7,7,1,7,7],.1,!1),this.animation.add("missedThree",[8,8,1,8,8,1,8,8],.1,!1),this.animation.play("loop"),this.timesMissed=0,this.animation.getAnimation("fade").onStop.add(this.resume,this),this.animation.getAnimation("missedTwo").onStop.add(this.resume,this),this.animation.getAnimation("missedThree").onStop.add(this.resume,this),this.animation.getAnimation("missedOne").onStop.add(this.resume,this)};Kiwi.extend(BlueCircle,Kiwi.GameObjects.Sprite),BlueCircle.prototype.startLoop=function(){},BlueCircle.prototype.startNextStage=function(){this.myParent.hit=!1,this.myParent.skullGroup.members[0].alpha=1,this.animation.play("loop"),this.myParent.stageUp()},BlueCircle.prototype.resume=function(){this.animation.play("loop"),this.state.miniGameManager.continueMiniGame()},BlueCircle.prototype.capture=function(){},BlueCircle.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this)},BlueCircle.prototype.missedHit=function(){return 0==this.timesMissed?this.animation.play("missedThree"):1==this.timesMissed?this.animation.play("missedTwo"):2==this.timesMissed&&this.animation.play("missedOne"),this.timesMissed+=1,this.timesMissed};var Confirm=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.confirm,b,c),this.state=a,this.animation.add("one",[0,0,1,0,1,0,1,0,1],.1,!1,!0),this.animation.add("two",[2,2,3,2,3,2,3,2,3],.1,!1),this.animation.add("three",[4,4,5,4,5,4,5,4,5],.1,!1),this.animation.play("one"),console.log("Here");var d=3*Math.random();Math.floor(d)};Kiwi.extend(Confirm,Kiwi.GameObjects.Sprite),Confirm.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this)};var MiniGame=function(a){Kiwi.Group.call(this,a),this.state=a,this.hitRange=2*Math.PI/360*15,this.rotBlue=0,this.rotSkull=2*Math.PI,this.rotBlueSpeed=-.0176,this.rotSkullSpeed=.0227,this.redCircle,this.blueCircle,this.skullGroup,this.center=new Kiwi.Geom.Point(0,0),this.radius=84,this.miniGameActive=!1,this.missCount=0,this.trappedGhosts=0};Kiwi.extend(MiniGame,Kiwi.Group),MiniGame.prototype.createMiniGame=function(a,b){this.beamTarget=this.state.weaponManager.beamManager.targetEnemy,this.removeOldGame(),this.missCount=0,this.updateMiniGamePos(),this.moveMiniGame,this.createRedCircle(),this.createSkulls(b),this.createBlueCircle(),this.startMiniGame()},MiniGame.prototype.updateMiniGamePos=function(){void 0!=this.beamTarget&&this.beamTarget.exists&&(this.center.x=this.beamTarget.worldX+.5*this.beamTarget.width,this.center.y=this.beamTarget.worldY+.5*this.beamTarget.height)},MiniGame.prototype.moveMiniGame=function(){this.redCircle.x=this.center.x-.5*this.redCircle.width,this.redCircle.y=this.center.y-.5*this.redCircle.width,this.blueCircleGroup.x=this.center.x,this.blueCircleGroup.y=this.center.y,this.skullGroup.x=this.center.x,this.skullGroup.y=this.center.y},MiniGame.prototype.removeOldGame=function(){this.miniGameActive=!1,this.miniGamePaused=!1,this.trappedGhosts=0,this.capturedGhosts=0,this.redCircle&&(this.redCircle.exists=!1),this.blueCircleGroup&&(this.blueCircleGroup.exists=!1),this.skullGroup&&(this.skullGroup.exists=!1)},MiniGame.prototype.createRedCircle=function(){this.redCircle=new Kiwi.GameObjects.Sprite(this.state,this.state.textures.redCircle,this.center.x,this.center.y),this.redCircle.x-=.5*this.redCircle.width,this.redCircle.y-=.5*this.redCircle.height,this.addChild(this.redCircle)
},MiniGame.prototype.createSkulls=function(a){var b,c,d;for(this.skullGroup=new Kiwi.Group(this.state),b=a-1;b>=0;b--)d=new Skull(this.state,0,0,this.radius),c=2*Math.PI/a*b,d.rotation=c,this.skullGroup.addChild(d);this.skullGroup.x=this.center.x,this.skullGroup.y=this.center.y,this.addChild(this.skullGroup)},MiniGame.prototype.resetHealth=function(){},MiniGame.prototype.getHealth=function(){return void 0!=this.skullGroup?this.skullGroup.members.length:void 0},MiniGame.prototype.createBlueCircle=function(){this.blueCircleGroup=new Kiwi.Group(this.state);var a=new BlueCircle(this.state,0,0);a.y=-this.radius,this.blueCircleGroup.addChild(a),this.blueCircleGroup.x=this.center.x,this.blueCircleGroup.y=this.center.y,this.state.addChild(this.blueCircleGroup)},MiniGame.prototype.startMiniGame=function(){this.miniGameActive=!0},MiniGame.prototype.missedHit=function(){this.timesMissed=this.blueCircleGroup.members[0].missedHit()},MiniGame.prototype.startNextStage=function(){this.stage+=1,this.hit=!1,this.skullGroup.members[0].alpha=1},MiniGame.prototype.updateRotation=function(){this.miniGamePaused||(this.updateSkullRotation(),this.updateBlueCircleRotation())},MiniGame.prototype.updateSkullRotation=function(){for(var a=this.skullGroup.members.length-1;a>=0;a--)this.skullGroup.members[a].rotation+=this.rotSkullSpeed},MiniGame.prototype.updateBlueCircleRotation=function(){this.blueCircleGroup.rotation+=this.rotBlueSpeed,this.blueCircleGroup.members[0].rotation=-this.blueCircleGroup.rotation},MiniGame.prototype.catchSkull=function(a){var b,c;return b=this.getAngle(this.blueCircleGroup.rotation),c=this.getAngle(a.rotation),this.calculateDifference(b,c)<this.hitRange},MiniGame.prototype.getAngle=function(a){for(;0>a;)a+=2*Math.PI;return a%(2*Math.PI)},MiniGame.prototype.calculateDifference=function(a,b){var c=Math.abs(a-b);return c>Math.PI?2*Math.PI-c:c},MiniGame.prototype.capture=function(){this.state.enemyManager.updateTrappedAnimation(),this.miniGamePaused=!0,this.blueCircleGroup.members[0].animation.play("fade")},MiniGame.prototype.failCapture=function(){switch(this.miniGamePaused=!0,this.missCount){case 0:this.blueCircleGroup.members[0].animation.play("missedOne");break;case 1:this.blueCircleGroup.members[0].animation.play("missedTwo");break;case 2:this.blueCircleGroup.members[0].animation.play("missedThree");break;default:this.state.weaponManager.stopShooting(),this.removeOldGame()}this.missCount+=1},MiniGame.prototype.continueMiniGame=function(){this.blueCircleGroup.members[0].animation.play("loop"),this.miniGamePaused=!1},MiniGame.prototype.update=function(){if(Kiwi.Group.prototype.update.call(this),this.miniGameActive&&(this.updateRotation(),this.updateMiniGamePos(),this.moveMiniGame(),this.state.enemyManager.getTrappedEnemies().length>this.trappedGhosts)){var a=this.state.enemyManager.getTrappedEnemies().length,b=3;switch(a){case 1:b=3;break;case 2:b=5;break;default:b=6}this.createMiniGame(this.state.weaponManager.beamManager.targetEnemy,b),this.trappedGhosts=a}},MiniGame.prototype.updatePosition=function(){console.log("Update Circle Pos");var a=this.state.weaponManager.beamManager.beams[0];this.center.x=a.worldX+.5*a.width,this.center.y=a.worldY+.5*a.height,this.updateObjectPos(this.redCircle),this.updateObjectPos(this.blueCircleGroup),this.updateObjectPos(this.skullGroup)},MiniGame.prototype.updateObjectPos=function(a){a.x=this.center.x,a.y=this.center.y,console.log(this.center.x,this.center.y,"Update Circle Pos")},MiniGame.prototype.stageUp=function(){this.myParent.beamStage+=1,this.myParent.beamNeedsUpdating=!0,this.myParent.updateBeamStage(),this.myParent.damageEnemy()},MiniGame.prototype.stopMiniGame=function(){this.removeOldGame()},MiniGame.prototype.attemptMatch=function(){if(this.miniGameActive){for(var a=this.skullGroup.members.length-1;a>=0;a--)if(this.catchSkull(this.skullGroup.members[a]))return this.skullCaptured(this.skullGroup.members[a]),"Boss"==this.beamTarget.objType&&this.state.boss.hurtByBeam(),!0;return this.failCapture(),!1}},MiniGame.prototype.skullCaptured=function(a){return a.exists=!1,this.getHealth()>1?(this.state.weaponManager.beamManager.beamUpgrade(),this.capture(),!0):void this.killTarget()},MiniGame.prototype.killTarget=function(){this.state.enemyManager.killTrapped(),this.state.weaponManager.stopShooting(),this.state.weaponManager.beamManager.enemyKilled()};var Skull=function(a,b,c,d){Kiwi.Group.call(this,a),this.x=b,this.y=c,this.state=a;var e=new Kiwi.GameObjects.Sprite(this.state,this.state.textures.skull,0,-d),f=Math.floor(4*Math.random());e.cellIndex=f,this.addChild(e)};Kiwi.extend(Skull,Kiwi.Group),Skull.prototype.update=function(){Kiwi.Group.prototype.update.call(this),this.members[0].rotation=-this.rotation};var PlayersLegs=function(a,b,c){Kiwi.GameObjects.Sprite.call(this,a,a.textures.egonSprite,b,c),this.state=a,this.animation.add("walk",[34,35,36,37,38,39,40,41],.05,!0),this.animation.add("idle",[42],.1,!1),this.animation.play("idle"),this.rightKeyDown=!1,this.leftKeyDown=!1,this.jumpKeyDown=!1};Kiwi.extend(PlayersLegs,Kiwi.GameObjects.Sprite),PlayersLegs.prototype.updateLegs=function(){this.x=this.state.player.x,this.y=this.state.player.y,this.scaleX=this.state.player.scaleX,this.alpha=this.state.player.jumping?0:this.state.player.alpha},Kiwi.Plugins.AITree={name:"AITree",version:"1.0"},Kiwi.PluginManager.register(Kiwi.Plugins.AITree),Kiwi.Plugins.AITree.AI=function(){return this.root=void 0,this.uniqueChildren=[],this.update=function(){var a=4;void 0!=this.root.update&&(a=this.root.update());for(var b=0;b<this.uniqueChildren.length;b++)this.uniqueChildren[b].reset();return a},this.updateCensus=function(){var a=this.root.getDescendants();this.uniqueChildren=[this.root];for(var b=0;b<a.length;b++)-1==this.uniqueChildren.indexOf(a[b])&&this.uniqueChildren.push(a[b]);return!0},this.setRoot=function(a){void 0!=a&&(this.root=a,this.root.addParent(this),this.updateCensus())},this.addChild=function(a){return this.setRoot(a)},this.hasAncestor=function(){return!1},this},Kiwi.Plugins.AITree.AITreeOuterNode=function(a){return this.name="untitledNode",void 0!=a&&void 0!=a.name&&(this.name=a.name),this.STATUS_READY=0,this.STATUS_RUNNING=1,this.STATUS_SUCCESS=2,this.STATUS_FAILURE=3,this.STATUS_ERROR=4,this.status=this.STATUS_READY,this.runningDirty=!1,this.runsParent=!0,this.parents=[],this.update=function(){return this.onUpdate(),this.run(),this.runningDirty=this.status==this.STATUS_RUNNING?!0:!1,this.status},this.onUpdate=function(){},this.run=function(){},this.reset=function(){return this.status==this.STATUS_RUNNING&&this.runningDirty?void(this.runningDirty=!1):(this.status==this.STATUS_ERROR&&console.log("Error detected in "+this.name,this),void(this.status=this.STATUS_READY))},this.addParent=function(a){return-1==this.parents.indexOf(a)?(this.parents.push(a),!0):!1},this.removeParent=function(a){var b=this.parents.indexOf(a);return-1!=b?(this.parents.splice(b,1),!0):!1},this.updateCensus=function(){for(var a=0;a<this.parents.length;a++){var b=this.parents[a].updateCensus();if(b)return!0}return!1},this},Kiwi.Plugins.AITree.AITreeInnerNode=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.runsParent=!1,this.children=[],this.currentlyRunningNode=void 0,this.shuffle=!1,void 0!=a&&a.shuffle&&(this.shuffle=a.shuffle),this.onUpdate=function(){this.shuffle&&this.shuffleChildren()},this.addChild=function(a){return void 0!=a&&-1==this.children.indexOf(a)?this.hasAncestor(a)||this===a?!1:(this.children.push(a),a.addParent(this),this.updateCensus(),!0):void 0},this.removeChild=function(a){var b=this.children.indexOf(a);-1!=b&&(this.children.splice(b,1),a.removeParent(this),this.updateCensus())},this.shuffleChildren=function(){for(var a=[];0<this.children.length;){var b=Math.floor(Math.random()*this.children.length);a.push(this.children[b]),this.children.splice(b,1)}this.children=a},this.hasAncestor=function(a){if(this===a)return!0;for(var b=0;b<this.parents.length;b++){var c=this.parents[b].hasAncestor(a);if(c)return!0}return!1},this.getDescendants=function(){for(var a=[],b=0;b<this.children.length;b++)a.push(this.children[b]),void 0!=this.children[b].getDescendants&&(a=a.concat(this.children[b].getDescendants()));return a},this},Kiwi.Plugins.AITree.Sequencer=function(a){return Kiwi.Plugins.AITree.AITreeInnerNode.call(this,a),this.run=function(){var a=0;if(void 0!=this.currentlyRunningNode){var b=this.children.indexOf(this.currentlyRunningNode);-1!=b&&(a=b)}for(var c=a;c<this.children.length;c++){var d=this.children[c].update();if(d==this.STATUS_RUNNING)return void(this.children[c].runsParent?(this.status=this.STATUS_RUNNING,this.currentlyRunningNode=this.children[c]):(this.status=this.STATUS_SUCCESS,this.currentlyRunningNode=void 0));if(this.currentlyRunningNode=void 0,d==this.STATUS_FAILURE)return void(this.status=this.STATUS_FAILURE)}this.currentlyRunningNode=void 0,this.status=this.STATUS_SUCCESS},this},Kiwi.Plugins.AITree.Selector=function(a){return Kiwi.Plugins.AITree.AITreeInnerNode.call(this,a),this.run=function(){var a=0;if(void 0!=this.currentlyRunningNode){var b=this.children.indexOf(this.currentlyRunningNode);-1!=b&&(a=b)}for(var c=a;c<this.children.length;c++){var d=this.children[c].update();if(d==this.STATUS_RUNNING)return void(this.children[c].runsParent?(this.status=this.STATUS_RUNNING,this.currentlyRunningNode=this.children[c]):(this.status=this.STATUS_SUCCESS,this.currentlyRunningNode=void 0));if(this.currentlyRunningNode=void 0,d==this.STATUS_SUCCESS)return void(this.status=this.STATUS_SUCCESS)}this.currentlyRunningNode=void 0,this.status=this.STATUS_FAILURE},this},Kiwi.Plugins.AITree.UntilFailure=function(a){return Kiwi.Plugins.AITree.AITreeInnerNode.call(this,a),this.run=function(){var a=0;if(void 0!=this.currentlyRunningNode){var b=this.children.indexOf(this.currentlyRunningNode);-1!=b&&(a=b)}for(;0<this.children.length;){var c=this.children[a].update();if(c==this.STATUS_RUNNING)return void(this.children[a].runsParent?(this.status=this.STATUS_RUNNING,this.currentlyRunningNode=this.children[a]):(this.status=this.STATUS_SUCCESS,this.currentlyRunningNode=void 0));if(this.currentlyRunningNode=void 0,c==this.STATUS_FAILURE)return void(this.status=this.STATUS_SUCCESS);a++,this.children.length<=a&&(a=0)}},this},Kiwi.Plugins.AITree.UntilSuccess=function(a){return Kiwi.Plugins.AITree.AITreeInnerNode.call(this,a),this.run=function(){var a=0;if(void 0!=this.currentlyRunningNode){var b=this.children.indexOf(this.currentlyRunningNode);-1!=b&&(a=b)}for(;0<this.children.length;){var c=this.children[a].update();if(c==this.STATUS_RUNNING)return void(this.children[a].runsParent?(this.status=this.STATUS_RUNNING,this.currentlyRunningNode=this.children[a]):(this.status=this.STATUS_SUCCESS,this.currentlyRunningNode=void 0));if(this.currentlyRunningNode=void 0,c==this.STATUS_SUCCESS)return void(this.status=this.STATUS_SUCCESS);a++,this.children.length<=a&&(a=0)}},this},Kiwi.Plugins.AITree.UntilTime=function(a){return Kiwi.Plugins.AITree.AITreeInnerNode.call(this,a),this.timerDuration=100,void 0!=a&&void 0!=a.timerDuration&&(this.timerDuration=a.timerDuration),this.run=function(){var a=this.getTime()+this.timerDuration,b=0;if(void 0!=this.currentlyRunningNode){var c=this.children.indexOf(this.currentlyRunningNode);-1!=c&&(b=c)}for(;this.getTime()<a;){var d=this.children[b].update();if(d==this.STATUS_RUNNING)return void(this.children[b].runsParent?(this.status=this.STATUS_RUNNING,this.currentlyRunningNode=this.children[b]):(this.status=this.STATUS_SUCCESS,this.currentlyRunningNode=void 0));b++,this.children.length<=b&&(b=0)}this.status=this.STATUS_SUCCESS},this.getTime=function(){return window.performance.now?window.performance.now():window.performance.webkitNow?window.performance.webkitNow():(new Date).getTime()},this},Kiwi.Plugins.ShareButton={name:"ShareButton",version:"1.0.0"},Kiwi.PluginManager.register(Kiwi.Plugins.ShareButton),"undefined"==typeof Kiwi.Plugins.GameObjects&&(Kiwi.Plugins.GameObjects={}),Kiwi.Plugins.GameObjects.ShareButton=function(a,b,c,d){Kiwi.GameObjects.Sprite.call(this,a,b,c,d),this.animation.add("up",[0],.1,!1),this.animation.add("down",[1],.1,!1),this.animation.play("up"),this.isDown=!1,this.isUp=!0,this.hitbox=new Kiwi.Geom.Rectangle(c,d,this.width,this.height),this.enabled=!0},Kiwi.extend(Kiwi.Plugins.GameObjects.ShareButton,Kiwi.GameObjects.Sprite),Kiwi.Plugins.GameObjects.ShareButton.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this);var a=!1;if(this.enabled&&this.game.input.isDown)for(var b=0;b<this.game.input.pointers.length;b++)this.game.input.pointers[b].active&&this.hitbox.containsPoint(this.game.input.pointers[b].point)&&(this.isUp&&(this.isDown=!0,this.isUp=!1,"down"!=this.animation.currentAnimation.name&&this.animation.switchTo("down",!0),this.buttonDown()),a=!0);a||this.isDown&&(this.isDown=!1,this.isUp=!0,"up"!=this.animation.currentAnimation.name&&this.animation.switchTo("up",!0))},Kiwi.Plugins.GameObjects.ShareButton.prototype.disable=function(){this.enabled=!1},Kiwi.Plugins.GameObjects.ShareButton.prototype.enable=function(){this.enabled=!0},Kiwi.Plugins.GameObjects.ShareButton.prototype.hide=function(){this.visibility=!1},Kiwi.Plugins.GameObjects.ShareButton.prototype.show=function(){this.visibility=!0},Kiwi.Plugins.GameObjects.ShareButton.prototype.buttonDown=function(){console.log("Share button hit")},Kiwi.Plugins.GhostAI={name:"GhostAI",version:"1.0"},Kiwi.PluginManager.register(Kiwi.Plugins.GhostAI),Kiwi.Plugins.GhostAI.Actions={},Kiwi.Plugins.GhostAI.Conditions={},Kiwi.Plugins.GhostAI.Actions.MoveToLocation=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.target=a.sprite.targetLocation,this.proximityThreshold=16,this.run=function(){var a=this.target[0]-this.sprite.x,b=this.target[1]-this.sprite.y,c=Math.sqrt(a*a+b*b);if(c<this.proximityThreshold)this.status=this.STATUS_SUCCESS;else if(0!=c){var d=a/c,e=b/c;this.sprite.x+=d*this.sprite.speed,this.sprite.y+=e*this.sprite.speed,this.status=this.STATUS_RUNNING}},this},Kiwi.Plugins.GhostAI.Actions.SelectNewLocation=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.top=a.top,this.bottom=a.bottom,this.left=a.left,this.right=a.right,this.distance=a.distance,this.run=function(){var a=360*Math.random(),b=Math.cos(a)*this.distance,c=Math.sin(a)*this.distance,d=this.sprite.x+b,e=this.sprite.y+c;e>this.sprite.bottom&&(e=this.sprite.bottom),e<this.sprite.top&&(e=this.sprite.top),d<this.sprite.left&&(d=this.sprite.left),d>this.sprite.right&&(d=this.sprite.right),this.sprite.targetLocation[0]=d,this.sprite.targetLocation[1]=e,this.status=this.STATUS_SUCCESS},this},Kiwi.Plugins.GhostAI.Actions.Hit=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.proximityThreshold=16,this.run=function(){},this},Kiwi.Plugins.GhostAI.Actions.Pause=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.length=a.length,this.run=function(){this.sprite.pauseTime<this.length?(this.sprite.pauseTime++,this.status=this.STATUS_RUNNING):(this.sprite.pauseTime=0,this.status=this.STATUS_SUCCESS)},this},Kiwi.Plugins.GhostAI.Actions.Teleport=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.length=a.length,this.run=function(){this.status=this.STATUS_SUCCESS,this.sprite.isVisible=!1,this.sprite.teleport()},this},Kiwi.Plugins.GhostAI.Conditions.DetectVisible=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.run=function(){this.status=this.STATUS_FAILURE,this.sprite.isVisible&&(this.status=this.STATUS_SUCCESS)},this},Kiwi.Plugins.GhostAI.Conditions.DetectHit=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.run=function(){this.status=this.STATUS_FAILURE,this.sprite.hit&&(this.status=this.STATUS_SUCCESS)},this},Kiwi.Plugins.GhostAI.Conditions.DetectEgon=function(a){Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.target=a.target,this.run=function(){this.status=this.STATUS_FAILURE;var a=new Kiwi.Geom.Point(this.sprite.x,this.sprite.y);a.distanceToXY(this.target.x,this.target.y)<this.sprite.detectionDistance&&(this.status=this.STATUS_SUCCESS)}},Kiwi.Plugins.GhostAI.Actions.Appear=function(a){Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.run=function(){this.status=this.STATUS_RUNNING,"appear"!=this.sprite.animation.currentAnimation.name?this.sprite.animation.switchTo("appear",!0):15==this.sprite.animation.currentCell&&(this.sprite.isVisible=!0,this.sprite.animation.switchTo("dash",!0),this.status=this.STATUS_SUCCESS)}},Kiwi.Plugins.GhostAI.Actions.Dash=function(a){return Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.target=a.target,this.proximityThreshold=1,this.stepSizeZach=.01,this.run=function(){this.targetLocation=this.sprite.targetLocation;var a=this.targetLocation[0]-this.sprite.x,b=this.targetLocation[1]-this.sprite.y,c=Math.sqrt(a*a+b*b);if(c<this.proximityThreshold)this.sprite.animation.play("disappear",!1),this.status=this.STATUS_SUCCESS;else if(0!=c){var d=.2;this.sprite.x+=(this.targetLocation[0]-this.sprite.x)*this.stepSizeZach,this.sprite.y+=(this.targetLocation[1]-this.sprite.y)*this.stepSizeZach,this.targetLocation[0]-this.sprite.x>=0?this.sprite.x+=d:this.sprite.x-=d,this.targetLocation[1]-this.sprite.y>=0?this.sprite.y+=d:this.sprite.y-=d,"dash"!=this.sprite.animation.currentAnimation.name&&this.sprite.animation.switchTo("dash",!0),this.status=this.STATUS_RUNNING}},this},Kiwi.Plugins.GhostAI.Actions.SelectDashTarget=function(a){Kiwi.Plugins.AITree.AITreeOuterNode.call(this,a),this.sprite=a.sprite,this.target=a.target,this.run=function(){this.sprite.x>this.target.x?(this.sprite.targetLocation[0]=this.target.x-150,this.sprite.targetLocation[1]=this.target.y):(this.sprite.targetLocation[0]=this.target.x+150,this.sprite.targetLocation[1]=this.target.y),this.status=this.STATUS_SUCCESS}},Kiwi.Plugins.TouchButton={name:"TouchButton",version:"1.0.0"},Kiwi.PluginManager.register(Kiwi.Plugins.TouchButton),"undefined"==typeof Kiwi.Plugins.GameObjects&&(Kiwi.Plugins.GameObjects={}),Kiwi.Plugins.GameObjects.TouchButton=function(a,b,c,d){Kiwi.GameObjects.Sprite.call(this,a,b,c,d),this.animation.add("up",[0],.1,!1),this.animation.add("down",[1],.1,!1),this.animation.play("up"),this.isDown=!1,this.isUp=!0,this.hitbox=new Kiwi.Geom.Rectangle(c,d,this.width,this.height),this.enabled=!0},Kiwi.extend(Kiwi.Plugins.GameObjects.TouchButton,Kiwi.GameObjects.Sprite),Kiwi.Plugins.GameObjects.TouchButton.prototype.update=function(){Kiwi.GameObjects.Sprite.prototype.update.call(this);var a=!1;if(this.enabled&&this.game.input.isDown)for(var b=0;b<this.game.input.pointers.length;b++)this.game.input.pointers[b].active&&this.hitbox.containsPoint(this.game.input.pointers[b].point)&&(this.isUp&&(this.isDown=!0,this.isUp=!1,"down"!=this.animation.currentAnimation.name&&this.animation.switchTo("down",!0)),a=!0);a||this.isDown&&(this.isDown=!1,this.isUp=!0,"up"!=this.animation.currentAnimation.name&&this.animation.switchTo("up",!0))},Kiwi.Plugins.GameObjects.TouchButton.prototype.disable=function(){this.enabled=!1},Kiwi.Plugins.GameObjects.TouchButton.prototype.enable=function(){this.enabled=!0},Kiwi.Plugins.GameObjects.TouchButton.prototype.hide=function(){this.visibility=!1},Kiwi.Plugins.GameObjects.TouchButton.prototype.show=function(){this.visibility=!0};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.Credits=new Kiwi.State("Credits"),PlatformBlueprint.Credits.create=function(a){this.keyboard=this.game.input.keyboard,this.mouse=this.game.input.mouse,this.score=a,this.credits=new Kiwi.GameObjects.Sprite(this,this.textures.credits,0,-20),this.addChild(this.credits),this.keyboard.onKeyDownOnce.add(this.changeFrame,this),this.mouse.onDown.add(this.openURL,this)},PlatformBlueprint.Credits.changeFrame=function(){this.credits.cellIndex<0?this.credits.cellIndex++:this.exitState()},PlatformBlueprint.Credits.exitState=function(){this.mouse.onDown.remove(this.openURL,this),this.keyboard.onKeyDownOnce.remove(this.changeFrame,this),game.states.switchState("Intro")},PlatformBlueprint.Credits.openURL=function(){window.open("http://store.steampowered.com/app/279580/")};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.GameOver=new Kiwi.State("GameOver"),PlatformBlueprint.GameOver.create=function(a){this.gameOverKeyboard=this.game.input.keyboard,this.mouse=this.game.input.mouse,this.score=a,this.game.stage.color="000000",this.beam=new Kiwi.GameObjects.Sprite(this,this.textures.GOBeam,0,0),this.beam.animation.add("play",[0,1,2,3,3,2,1,0],.075,!0),this.beam.animation.play("play"),this.beam.x=.5*this.game.stage.width-.5*this.beam.width,this.addChild(this.beam),this.egon=new Kiwi.GameObjects.Sprite(this,this.textures.GOEgon,430,300),this.egon.animation.add("standUp",[2,3,4,5,6,7,8],.075,!1),this.egon.animation.getAnimation("standUp").onStop.add(this.exitState,this),this.addChild(this.egon),this.GOText=new Kiwi.GameObjects.Sprite(this,this.textures.GOText,0,125),this.GOText.x=.5*this.game.stage.width-.5*this.GOText.width,this.addChild(this.GOText),this.GOContinueQuit=new Kiwi.GameObjects.Sprite(this,this.textures.GOContinueQuit,0,190),this.GOContinueQuit.x=.5*this.game.stage.width-.5*this.GOContinueQuit.width,this.addChild(this.GOContinueQuit),this.rightKey=this.gameOverKeyboard.addKey(Kiwi.Input.Keycodes.D),this.leftKey=this.gameOverKeyboard.addKey(Kiwi.Input.Keycodes.A),this.selectKey=this.gameOverKeyboard.addKey(Kiwi.Input.Keycodes.SPACEBAR),this.game.cameras.defaultCamera.transform.x=0,this.game.cameras.defaultCamera.transform.y=0,this.hudScore=new Kiwi.HUD.Widget.TextField(game,"GAME OVER - YOUR SCORE IS: "+this.score,0,480),this.hudScore.style.fontFamily="myFirstFont",this.hudScore.style.color="#FFEAD1",this.hudScore.style.fontSize="16px",this.hudScore.style.letterSpacing="1px",this.hudScore.style.width="100%",this.hudScore.style.textAlign="center",game.huds.defaultHUD.addWidget(this.hudScore),this.gameOverKeyboard.onKeyDownOnce.add(this.keyDownOnce,this),this.shareTwitter=new Kiwi.GameObjects.Sprite(this,this.textures.twitterShare,360,510),this.addChild(this.shareTwitter),this.shareTwitter.input.onUp.add(this.share,this)},PlatformBlueprint.GameOver.update=function(){Kiwi.State.prototype.update.call(this)},PlatformBlueprint.GameOver.share=function(){console.log("Share"),this.tweetWindow("http://bit.ly/1xGBN0s","Happy Halloween, #Ghostbusters! Kick ectoplasmic ass in the new game by @secretbaseSG, powered by @kiwijsengine!")},PlatformBlueprint.GameOver.tweetWindow=function(a,b){window.open("http://twitter.com/share?url="+encodeURIComponent(a)+"&text="+encodeURIComponent(b)+"&count=none/","tweet","height=300,width=550,resizable=1")},PlatformBlueprint.GameOver.keyDownOnce=function(a){a==this.rightKey.keyCode&&this.GOContinueQuit.animation.switchTo(1),a==this.leftKey.keyCode&&this.GOContinueQuit.animation.switchTo(0),a==this.selectKey.keyCode&&(0==this.GOContinueQuit.animation.currentCell?this.continueGame():this.exitState())},PlatformBlueprint.GameOver.continueGame=function(){this.egon.animation.play("standUp")},PlatformBlueprint.GameOver.exitState=function(){this.gameOverKeyboard.onKeyDownOnce.remove(this.keyDownOnce,this),this.gameOverKeyboard.onKeyUp.remove(this.keyDownOnce,this),game.huds.defaultHUD.removeAllWidgets(),game.states.switchState("Credits")};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.HowToPlay=new Kiwi.State("HowToPlay"),PlatformBlueprint.HowToPlay.create=function(a){this.keyboard=this.game.input.keyboard,this.mouse=this.game.input.mouse,this.score=a,this.howTo=new Kiwi.GameObjects.Sprite(this,this.textures.howTo,0,0),this.addChild(this.howTo),this.keyboard.onKeyDownOnce.add(this.changeFrame,this)},PlatformBlueprint.HowToPlay.changeFrame=function(){this.howTo.cellIndex<2?this.howTo.cellIndex++:this.exitState()},PlatformBlueprint.HowToPlay.exitState=function(){this.keyboard.onKeyDownOnce.remove(this.changeFrame,this),game.states.switchState("Play")};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.Intro=new Kiwi.State("Intro"),PlatformBlueprint.Intro.init=function(){this.timer=this.game.time.clock.createTimer("changeVisible",.175,-1,!1),this.timerEvent=this.timer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_COUNT,this.changeVisible,this)},PlatformBlueprint.Intro.create=function(){this.keyboard=this.game.input.keyboard,this.mouse=this.game.input.mouse,this.rightKey=this.keyboard.addKey(Kiwi.Input.Keycodes.D),this.keyboard.onKeyDownOnce.add(this.startGame,this),this.menuBackground=new Kiwi.GameObjects.Sprite(this,this.textures.menu,0,0),this.menuBackground.animation.add("play",[0,1,2,2,1],.075,!0),this.menuBackground.animation.play("play"),this.addChild(this.menuBackground),this.startText=new Kiwi.GameObjects.StaticImage(this,this.textures.startText,375,440),this.addChild(this.startText),this.timer.start(),this.counter=0,this.game.cameras.defaultCamera.transform.x=0,this.game.cameras.defaultCamera.transform.y=0,this.hudScore=new Kiwi.HUD.Widget.TextField(game,"ORIGINAL CONCEPT BY SECRET BASE",0,10),this.hudScore.style.fontFamily="myFirstFont",this.hudScore.style.color="#FFEAD1",this.hudScore.style.fontSize="16px",this.hudScore.style.letterSpacing="1px",this.hudScore.style.width="100%",this.hudScore.style.textAlign="center",game.huds.defaultHUD.addWidget(this.hudScore)},PlatformBlueprint.Intro.startGame=function(a){a==this.rightKey.keyCode,this.keyboard.onKeyDownOnce.remove(this.startGame,this),this.timer.stop(),this.hudScore.style.opacity=0,game.states.switchState("HowToPlay")},PlatformBlueprint.Intro.changeVisible=function(){1==this.startText.alpha?1==this.counter?this.startText.alpha=0:this.counter+=1:(this.startText.alpha=1,this.counter=0)};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.Loading=new KiwiLoadingScreen("Loading","SplashState","assets/img/loading/"),PlatformBlueprint.Loading.preload=function(){KiwiLoadingScreen.prototype.preload.call(this),this.addImage("background1","assets/img/environment/background.jpg"),this.addImage("secretBaseLogo","assets/img/loading/LogoSecretBase0150.png"),this.addSpriteSheet("egonSprite","assets/img/sprites/egon-sprite.png",100,100),this.addImage("UI","assets/img/UI/UI.png"),this.addImage("cashUI","assets/img/UI/cashUI.png"),this.addSpriteSheet("beam","assets/img/beam/beam.png",24,24),this.addSpriteSheet("beamSpark","assets/img/beam/beamSpark.png",48,48),this.addSpriteSheet("impact","assets/img/beam/impact.png",68,68),this.addSpriteSheet("ghost","assets/img/enemies/ghost2.png",160,160),this.addSpriteSheet("boss","assets/img/enemies/boss.png",300,200),this.addSpriteSheet("books","assets/img/enemies/books.png",200,200),this.addSpriteSheet("shield","assets/img/enemies/shield.png",300,220),this.addSpriteSheet("GOContinueQuit","assets/img/gameOver/continue-quit.png",380,18),this.addSpriteSheet("GOEgon","assets/img/gameOver/egonGameOver.png",120,120),this.addImage("GOText","assets/img/gameOver/Gameover_text_gameover.png"),this.addSpriteSheet("GOBeam","assets/img/gameOver/gameOverBeam.png",294,451),this.addImage("twitterShare","assets/img/gameOver/Twitter2.png"),this.addSpriteSheet("blueCircle","assets/img/minigame/blue3.png",70,70),this.addImage("redCircle","assets/img/minigame/redCircle.png"),this.addSpriteSheet("skull","assets/img/minigame/pacGhostSprite.png",70,70),this.addSpriteSheet("confirm","assets/img/minigame/confirm.png",66,14),this.addSpriteSheet("cash","assets/img/items/cash.png",160,160),this.addSpriteSheet("gem","assets/img/items/diamond.png",32,32),this.addSpriteSheet("bookPile","assets/img/items/bookPiles.png",248,72),this.addSpriteSheet("shareButton","assets/img/buttons/Share.png",250,70),this.addSpriteSheet("menu","assets/img/menu/MenuAnimation.png",960,540),this.addSpriteSheet("howTo","assets/img/menu/HowTo.png",960,540),this.addSpriteSheet("credits","assets/img/menu/Credits.png",960,540),this.addImage("startText","assets/img/menu/PressStart1.png"),this.addImage("open1","assets/img/menu/Menu_Opening1.png"),this.addImage("open2","assets/img/menu/Menu_Opening2.png"),this.addImage("open3","assets/img/menu/Menu_Opening3.png"),this.addImage("open4","assets/img/menu/Menu_Opening4.png"),this.addSpriteSheet("leftButton","assets/img/controller/leftButton.png",51,73),this.addSpriteSheet("rightButton","assets/img/controller/rightButton.png",51,73),this.addSpriteSheet("upButton","assets/img/controller/upButton.png",73,51),this.addSpriteSheet("downButton","assets/img/controller/downButton.png",73,51),this.addSpriteSheet("tiles","assets/img/tiles2.png",32,32),this.addJSON("tilemap","assets/map/BossLevel.json")};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.MenuOpening=new Kiwi.State("MenuOpening"),PlatformBlueprint.MenuOpening.create=function(){this.open1=new Kiwi.GameObjects.Sprite(this,this.textures.open1,0,0),this.open1.alpha=0,this.open1.x=.5*this.game.stage.width-.5*this.open1.width,this.open1.y=.5*this.game.stage.height-.5*this.open1.height,this.open2=new Kiwi.GameObjects.Sprite(this,this.textures.open2,0,0),this.open2.alpha=0,this.open2.x=.5*this.game.stage.width-.5*this.open2.width,this.open2.y=.5*this.game.stage.height-.5*this.open2.height,this.open3=new Kiwi.GameObjects.Sprite(this,this.textures.open3,0,0),this.open3.alpha=0,this.open3.x=.5*this.game.stage.width-.5*this.open3.width,this.open3.y=.5*this.game.stage.height-.5*this.open3.height,this.open4=new Kiwi.GameObjects.Sprite(this,this.textures.open4,0,0),this.open4.alpha=0,this.open4.x=.5*this.game.stage.width-.5*this.open4.width,this.open4.y=.5*this.game.stage.height-.5*this.open4.height,this.menuBackground=new Kiwi.GameObjects.Sprite(this,this.textures.menu,0,0),this.menuBackground.animation.add("play",[0,1,2,2,1],.075,!0),this.menuBackground.animation.play("play"),this.menuBackground.alpha=0,this.addChild(this.menuBackground),this.addChild(this.open4),this.addChild(this.open3),this.addChild(this.open2),this.addChild(this.open1),this.tweenTime=500,this.tweenHoldTime=1e3,this.tweenInTime=500,this.delayTime=200,this.tween1In=this.game.tweens.create(this.open1),this.tween1Hold=this.game.tweens.create(this.open1),this.tween1Out=this.game.tweens.create(this.open1),this.tween2In=this.game.tweens.create(this.open2),this.tween2Hold=this.game.tweens.create(this.open2),this.tween2Out=this.game.tweens.create(this.open2),this.tween3In=this.game.tweens.create(this.open3),this.tween3Hold=this.game.tweens.create(this.open3),this.tween3Out=this.game.tweens.create(this.open3),this.tween4In=this.game.tweens.create(this.open4),this.tween4Hold=this.game.tweens.create(this.open4),this.tween1In.to({alpha:1},this.tweenInTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween1Hold.to({alpha:1},this.tweenHoldTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween1Out.to({alpha:0},this.tweenTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween2In.to({alpha:1},this.tweenInTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween2Hold.to({alpha:1},this.tweenHoldTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween2Out.to({alpha:0},this.tweenTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween3In.to({alpha:1},this.tweenInTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween3Hold.to({alpha:1},this.tweenHoldTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween3Out.to({alpha:0},this.tweenTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween4In.to({alpha:1},this.tweenInTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween4Hold.to({alpha:1},this.tweenHoldTime,Kiwi.Animations.Tweens.Easing.Linear.None,!1),this.tween1In.delay(this.delayTime),this.tween2In.delay(this.delayTime),this.tween3In.delay(this.delayTime),this.tween4In.delay(this.delayTime),this.tween1In.chain(this.tween1Hold),this.tween1Hold.chain(this.tween1Out),this.tween1Out.chain(this.tween2In),this.tween2In.chain(this.tween2Hold),this.tween2Hold.chain(this.tween2Out),this.tween2Out.chain(this.tween3In),this.tween3In.chain(this.tween3Hold),this.tween3Hold.chain(this.tween3Out),this.tween3Out.chain(this.tween4In),this.tween4In.chain(this.tween4Hold),this.tween4Hold.onComplete(this.startFlash,this),this.tween1In.start()
},PlatformBlueprint.MenuOpening.startFlash=function(){this.menuBackground.alpha=1,this.timer=this.game.time.clock.createTimer("flash",.125,16,!1),this.timerEvent=this.timer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_COUNT,this.flash,this),this.timerEvent=this.timer.createTimerEvent(Kiwi.Time.TimerEvent.TIMER_STOP,this.exitState,this),this.timer.start()},PlatformBlueprint.MenuOpening.flash=function(){this.open4.alpha=1==this.open4.alpha?0:1},PlatformBlueprint.MenuOpening.exitState=function(){game.states.switchState("Intro")};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.Play=new Kiwi.State("Play"),PlatformBlueprint.Play.create=function(){this.camera=this.game.cameras.defaultCamera,this.game.input.keyboard.onKeyDown.removeAll(),this.game.input.keyboard.onKeyDownOnce.removeAll(),this.game.input.keyboard.onKeyUp.removeAll(),this.background=new Kiwi.GameObjects.StaticImage(this,this.textures.background1,0,-57),this.addChild(this.background),this.background.scaleX=1,this.background.scaleY=1,this.width=this.game.stage.width,this.game.stage.color="ffffff",this.gameManager=new GameManager(this),this.inputManager=new InputManager(this),this.bookPileL=new Kiwi.GameObjects.Sprite(this,this.textures.bookPile,1100,475),this.bookPileL.animation.add("left",[0],1,!1,!0),this.bookPileL.scaleX=-1,this.bookPileR=new Kiwi.GameObjects.Sprite(this,this.textures.bookPile,2150,480),this.bookPileR.animation.add("right",[1],1,!1,!0),this.bookPileR.scaleX=-1,this.addChild(this.bookPileR),this.addChild(this.bookPileL),this.levelManager=new LevelManager(this),this.levelManager.generateTileMap(),this.enemyManager=new EnemyManager(this),this.addChild(this.enemyManager),this.itemManager=new ItemManager(this),this.addChild(this.itemManager),this.hudManager=new HUDManager(this),this.collisionManager=new CollisionManager(this),this.cameraManager=new CameraManager(this),this.playersLegs=new PlayersLegs(this,0,0),this.addChild(this.playersLegs),this.player=new PlayerManager(this,100,444),this.addChild(this.player),this.weaponManager=new WeaponManager(this),this.miniGameManager=new MiniGame(this),this.addChild(this.miniGameManager),this.tileWidth=32,this.tileHeight=32,this.cashGroup=new Kiwi.Group(this),this.addChild(this.cashGroup),this.sloping=!0,this.px=this.player.x+this.player.box.bounds.width/2,this.py=this.player.y+this.player.height,this.levelManager.generateForegroundTileMap(),console.log("CREATE GAME"),this.levelManager.gemsLevelOne(),this.levelManager.ghostsLevelOne()},PlatformBlueprint.Play.update=function(){this.cameraManager.update(),this.gameManager.update(),this.hudManager.update(),this.weaponManager.update(),this.enemyManager.update(),this.player.update(),this.player.physics.update(),this.updateCash(),Kiwi.State.prototype.update.call(this),this.sloping=!1,this.px=Math.round(this.player.x+this.player.box.bounds.width/2),this.py=this.player.y+this.player.height,this.collisionManager.checkLeftSlope(),this.collisionManager.checkRightSlope(),this.collisionManager.update()},PlatformBlueprint.Play.updateCash=function(){for(var a=this.cashGroup.members.length-1;a>=0;a--)this.cashGroup.members[a].physics.update()},PlatformBlueprint.Play.createBoss=function(){this.boss=new Boss(this,1625,200),this.addChild(this.boss),this.swapChildren(this.boss,this.boss.shield),this.swapChildren(this.boss,this.miniGameManager)},PlatformBlueprint.Play.createSurvivalGame=function(){this.survivalGame=new SurvivalGame(this)};var PlatformBlueprint=PlatformBlueprint||{};PlatformBlueprint.SplashState=new Kiwi.State("SplashState"),PlatformBlueprint.SplashState.create=function(a){this.keyboard=this.game.input.keyboard,this.mouse=this.game.input.mouse,this.score=a,this.game.cameras.defaultCamera.transform.x=0,this.game.cameras.defaultCamera.transform.y=0,this.game.stage.color="000000",this.logo=new Kiwi.GameObjects.Sprite(this,this.textures.secretBaseLogo,0,0),this.logo.x=.5*this.game.stage.width-.5*this.logo.width,this.logo.alpha=0,this.addChild(this.logo),this.tweenA=this.game.tweens.create(this.logo),this.tweenB=this.game.tweens.create(this.logo),this.tweenC=this.game.tweens.create(this.logo),this.tweenA.to({alpha:1},500,Kiwi.Animations.Tweens.Easing.Quintic.In,!1),this.tweenB.to({alpha:1},3e3,Kiwi.Animations.Tweens.Easing.Circular.InOut,!1),this.tweenC.to({alpha:0},500,Kiwi.Animations.Tweens.Easing.Quintic.Out,!1),this.tweenC.onComplete(this.splashFinished,this),this.tweenA.chain(this.tweenB),this.tweenB.chain(this.tweenC),this.tweenA.start()},PlatformBlueprint.SplashState.update=function(){Kiwi.State.prototype.update.call(this)},PlatformBlueprint.SplashState.splashFinished=function(){game.states.switchState("MenuOpening")};var gameOptions={renderer:Kiwi.RENDERER_CANVAS,width:960,height:540,plugins:["ShareButton"],scaleType:Kiwi.Stage.SCALE_FIT},game=new Kiwi.Game("content","PlatformBlueprint",null,gameOptions);game.states.addState(PlatformBlueprint.Loading),game.states.addState(PlatformBlueprint.MenuOpening),game.states.addState(PlatformBlueprint.HowToPlay),game.states.addState(PlatformBlueprint.Credits),game.states.addState(PlatformBlueprint.SplashState),game.states.addState(PlatformBlueprint.Intro),game.states.addState(PlatformBlueprint.Play),game.states.addState(PlatformBlueprint.GameOver),game.states.switchState("Loading");